[{"$match":{"$expr":{"$eq":["$fechaProceso",{"$toDate":"@fechaProceso"}]}}},{"$addFields":{"loanDelincuency":{"$cond":[{"$gt":["$overdueLoans1",0]},{"$divide":[{"$sum":["$restructuredLoans1","$overdueLoans1"]},{"$sum":["$currentLoans1","$restructuredLoans1","$overdueLoans1","$itigationLoans1"]}]},0]}}},{"$addFields":{"resultLoanDelincuency":{"$round":[{"$cond":[{"$gt":["$globalLoanDelincuency",0]},{"$divide":[{"$multiply":["$loanDelincuency",100]},"$globalLoanDelincuency"]},0]},5]}}},{"$lookup":{"from":"sidis_tasaconversion","localField":"fechaProceso","foreignField":"Fecha","as":"result"}},{"$addFields":{"tasaDolar":{"$arrayElemAt":["$result.Tasa_DOL",0]},"tasaEuro":{"$arrayElemAt":["$result.Tasa_EUR",0]},"factorConversion":{"$arrayElemAt":["$result.Conversion",0]}}},{"$sort":{"resultLoanDelincuency":-1}},{"$project":{"_id":0,"fechaProceso":1,"name":1,"resultLoanDelincuency":1,"tasaDolar":1,"tasaEuro":1,"factorConversion":1,"loanDelincuency":1,"globalLoanDelincuency":1,"globalLoanDelincuencyUSD":1}},{"$group":{"_id":{"fechaProceso":"$fechaProceso"},"loanDelincuency":{"$push":{"name":"$name","prctValue":"$resultLoanDelincuency","amountBsValue":"$loanDelincuency","amountUsdValue":{"$divide":["$loanDelincuency","$tasaDolar"]},"globalValue":"$globalLoanDelincuencyUSD"}}}},{"$addFields":{"fechaProceso":"$_id.fechaProceso","_id":"$$REMOVE"}},{"$merge":{"into":"Financialstatementdashboard","on":"fechaProceso"}}]