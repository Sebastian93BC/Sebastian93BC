[{"$addFields":{"rifCedula":{"$concat":["$petipdoc",{"$substr":["$penumdoc",{"$subtract":[{"$strLenCP":"$penumdoc"},8]},8]}]},"contrato":{"$concat":["$entidad","$oficina","$cuenta"]},"feforma":{"$dateFromString":{"dateString":"$feforma","format":"%Y-%m-%d","onNull":null,"onError":null}},"feoper":{"$dateFromString":{"dateString":"$feoper","format":"%Y-%m-%d","onNull":null,"onError":null}},"fevalor":{"$dateFromString":{"dateString":"$fevalor","format":"%Y-%m-%d","onNull":null,"onError":null}},"feliq":{"$dateFromString":{"dateString":"$feliq","format":"%Y-%m-%d","onNull":null,"onError":null}}}},{"$addFields":{"fechaProceso":{"$dateFromParts":{"year":{"$year":"$feoper"},"month":{"$add":[{"$month":"$feoper"},1]},"day":{"$subtract":[{"$dayOfMonth":{"$dateFromParts":{"year":{"$year":"$feoper"},"month":{"$add":[{"$month":"$feoper"},1]},"day":1}}},1]},"hour":0,"minute":0,"second":0,"millisecond":0}}}},{"$match":{"$and":[{"$expr":{"$gt":["$fevalor",{"$toDate":"@fechaProceso"}]}}]}},{"$group":{"_id":{"rifCedula":"$rifCedula","cod_evento":"$cod_evento","cod_usuario":"$cod_usuario","contrato":"$contrato","cta_contable":"$cta_contable","cuenta":"$cuenta","entidad":"$entidad","feforma":"$feforma","feoper":"$feoper","fevalor":"$fevalor","formpago":"$formpago","indretro":"$indretro","oficina":"$oficina","oftit":"$oftit","producto":"$producto","sitdeuct":"$sitdeuct","sitdeuda":"$sitdeuda","sitpres":"$sitpres","subpro":"$subpro","monto_pago":"$monto_pago"},"doc":{"$first":"$$ROOT"}}},{"$replaceRoot":{"newRoot":"$doc"}},{"$merge":{"into":"sidis_activosIa","on":["rifCedula","cod_evento","cod_usuario","contrato","cta_contable","cuenta","entidad","feforma","feoper","fevalor","formpago","indretro","oficina","oftit","producto","sitdeuct","sitdeuda","sitpres","subpro","monto_pago"],"whenMatched":"replace","whenNotMatched":"insert"}}]