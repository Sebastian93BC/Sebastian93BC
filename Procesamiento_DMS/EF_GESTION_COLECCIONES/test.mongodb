[
    {
      "$match": {
        "$and": [
          {
            "$expr": {
              "$eq": [
                {
                  "$substr": [
                    "$tra_rif", 8, -1
                  ]
                }, "{{$json.parallelizationIndex}}"
              ]
            }
          }, {
            "$expr": {
              "$lte": [
                "$file_date", {
                  "$dateSubtract": {
                    "startDate": {
                      "$dateSubtract": {
                        "startDate": {
                          "$dateAdd": {
                            "startDate": {
                              "$dateTrunc": {
                                "date": {
                                  "$toDate": "{{$json.processDate}}"
                                }, 
                                "unit": "month"
                              }
                            }, 
                            "unit": "month", 
                            "amount": 1
                          }
                        }, 
                        "unit": "month", 
                        "amount": {
                          "$toInt": "{{$json.timingInMonth}}"
                        }
                      }
                    }, 
                    "unit": "day", 
                    "amount": 1
                  }
                }
              ]
            }
          }
        ]
      }
    }, {
      "$group": {
        "_id": "documentos", 
        "cant": {
          "$sum": 1
        }
      }
    }, {
      "$project": {
        "_id": 0, 
        "cant": 1, 
        "test": {
          "$toString": {
            "$cond": [
              {
                "$gt": [
                  "$cant", 1
                ]
              }, "Falta", "Finalizado"
            ]
          }
        }, 
        "parallelizationIndex": "{{$json.parallelizationIndex}}",
        "processDate": "{{$json.processDate}}",
        "timingInMonth": "{{$json.timingInMonth}}",
        "fromCollection": "{{$json.fromCollection}}", 
        "subProcessName": "{{$json.subProcessName}}", 
        "subProcessDate": "{{$json.subProcessDate}}", 
        "aggregate": "{{$json.rawAgregate}}",
        "offSet": "{{$json.offSet}}",
        "subStage": "{{$json.subStage}}"
      }
    }
  ]