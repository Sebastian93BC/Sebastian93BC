{
    "meta": {
      "instanceId": "4d013cb9b9f3f11a95d998b63c089cd0dac18358633956000546ed033b0c26b8"
    },
    "nodes": [
      {
        "parameters": {},
        "id": "fd1cf9e7-a570-42d4-b485-be1047ebeace",
        "name": "Start",
        "type": "n8n-nodes-base.start",
        "typeVersion": 1,
        "position": [
          -2980,
          7340
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Objective",
          "query": "=[\n  {\n    \"$project\": {\n      \"_id\": 0, \n      \"name\": \"$name\", \n      \"fecha\": \"$fechaObjetivo\", \n      \"iccTot\": {\n        \"$multiply\": [\n          \"$IngresosCarteraCreditoTotalGoalMensual\", 1000000\n        ]\n      }, \n      \"icProdSaldo\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicConsultaSaldoGoal\", 1000000\n        ]\n      }, \n      \"icProdMedPagos\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicMediosPagoGoal\", 1000000\n        ]\n      }, \n      \"icProdNomina\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicNominaGoal\", 1000000\n        ]\n      }, \n      \"icProdOpCamb\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicOpCambiariasGoal\", 1000000\n        ]\n      }, \n      \"icProdOtros\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicOtrosGoal\", 1000000\n        ]\n      }, \n      \"icProdPagmov\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicPagoMovilGoal\", 1000000\n        ]\n      }, \n      \"icProdPagosProv\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicPagosProveedoresGoal\", 1000000\n        ]\n      }, \n      \"icProdPos\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicPosGoal\", 1000000\n        ]\n      }, \n      \"icProdRecaud\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicRecaudacionGoal\", 1000000\n        ]\n      }, \n      \"icTot\": {\n        \"$multiply\": [\n          \"$IngresosComisionesicTotalGoalMensual\", 1000000\n        ]\n      }, \n      \"cmCobAct\": {\n        \"$multiply\": [\n          \"$cobranzaMoragoalCobranzaActual\", 1000000\n        ]\n      }, \n      \"cmCobRet\": {\n        \"$multiply\": [\n          \"$cobranzaMoragoalCobranzaRetrazo\", 1000000\n        ]\n      }, \n      \"liqPlazoEmprBdv1a\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqEmprendeBdvPlazo1a\", 100\n        ]\n      }, \n      \"liqPlazoEmprBdv45d\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqEmprendeBdvPlazo45d\", 100\n        ]\n      }, \n      \"liqPlazoEmprBdv6m\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqEmprendeBdvPlazo6m\", 100\n        ]\n      }, \n      \"liqPlazoEmprBdv9m\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqEmprendeBdvPlazo9m\", 100\n        ]\n      }, \n      \"liqPlazoEmprBdv1aM\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqEmprendeBdvPlazoMas1a\", 100\n        ]\n      }, \n      \"liqPlazoMicCre1a\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqMicroCredPlazo1a\", 100\n        ]\n      }, \n      \"liqPlazoMicCre45d\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqMicroCredPlazo45d\", 100\n        ]\n      }, \n      \"liqPlazoMicCre6m\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqMicroCredPlazo6m\", 100\n        ]\n      }, \n      \"liqPlazoMicCre9m\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqMicroCredPlazo9m\", 100\n        ]\n      }, \n      \"liqPlazoMicCre1aM\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiqMicroCredPlazoMas1a\", 100\n        ]\n      }, \n      \"liqPlazoTot1a\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiquidadoPlazo1a\", 100\n        ]\n      }, \n      \"liqPlazoTot45d\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiquidadoPlazo45d\", 100\n        ]\n      }, \n      \"liqPlazoTot6m\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiquidadoPlazo6m\", 100\n        ]\n      }, \n      \"liqPlazoTot9m\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiquidadoPlazo9m\", 100\n        ]\n      }, \n      \"liqPlazoTot1aM\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalMontLiquidadoPlazoMas1a\", 100\n        ]\n      }, \n      \"liqProdMtoTot\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdMontTotal\", 1000000\n        ]\n      }, \n      \"liqProdMtoProduc\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdMontProductivo\", 1000000\n        ]\n      }, \n      \"liqProdMtoHip\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdMontHipotecario\", 1000000\n        ]\n      }, \n      \"liqProdMtoCom\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdMontComercial\", 1000000\n        ]\n      }, \n      \"liqProdMtoEmprend\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdMontEmprende\", 1000000\n        ]\n      }, \n      \"liqProdMtoMicroCred\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdMontMicroCred\", 1000000\n        ]\n      }, \n      \"liqProdNumTot\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdNumTotal\", 1\n        ]\n      }, \n      \"liqProdNumProduc\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdNumProductivo\", 1\n        ]\n      }, \n      \"liqProdNumHip\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdNumHipotecario\", 1\n        ]\n      }, \n      \"liqProdNumCom\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdNumComercial\", 1\n        ]\n      }, \n      \"liqProdNumEmprend\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdNumEmprende\", 1\n        ]\n      }, \n      \"liqProdNumMicroCred\": {\n        \"$multiply\": [\n          \"$liquidacionesgoalProdNumMicroCred\", 1\n        ]\n      }, \n      \"objectiveType\": \"$objetiveType\", \n      \"updatedAt\": \"$updatedAt\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Objectiveformat\", \n      \"on\": \"fecha\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "5aa911d8-50de-49fe-9fde-97d2d3076d79",
        "name": "1_FormateoObjetivos",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -2480,
          7800
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "55010ff3-f73f-4226-8fab-93866a3b26a5",
        "name": "Merge12",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2000,
          6080
        ]
      },
      {
        "parameters": {
          "content": "Cobranza y Mora",
          "height": 546.9338736470833,
          "width": 4066.8996696098693
        },
        "id": "62917058-d802-4ee2-94e0-d1297f9ca78c",
        "name": "Note8",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          720,
          5880
        ]
      },
      {
        "parameters": {
          "content": "Liquidacion",
          "height": 956.30045436608,
          "width": 4069.737241157857
        },
        "id": "11351f7a-f3c1-409a-a0c7-8463ee4c69ef",
        "name": "Note9",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          720,
          4880
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"6_Procesamiento_IngresosPorCartera\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem4",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1180,
          6780
        ],
        "id": "ff37f5cf-0071-4f34-a6a2-aeaa66c7ec07",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "content": "ingreso comision",
          "height": 398.9438075314031,
          "width": 4070.4021364222676
        },
        "id": "8d12139c-f32e-40d0-9bd7-35232cfa23b8",
        "name": "Note3",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          720,
          7560
        ]
      },
      {
        "parameters": {
          "content": "Ingresos por cartera de credito",
          "height": 463.34352441977194,
          "width": 4069.7542501189255
        },
        "id": "140abce3-d963-43e6-ab67-104a845fe5bd",
        "name": "Note4",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          720,
          6480
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "ce3ce562-3e88-408a-ba82-676b85d7b36c",
        "name": "Merge25",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2400,
          6060
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch"
        },
        "id": "90293e13-dd4a-4170-ad05-0a5426bca282",
        "name": "Merge27",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          3120,
          6060
        ]
      },
      {
        "parameters": {
          "content": "AJUSTE DE VALORES EN LA COLECCIÃ“N BRM\nProcesan los datos el mes anterior a la fecha de \"hoy\"",
          "height": 672.3331856458367,
          "width": 1910.0994076097636
        },
        "id": "04a48f13-7056-4d7c-abb1-60454e82ae86",
        "name": "Note11",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -2520,
          7520
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "2d701975-21d5-40de-9578-76fa56f3a522",
        "name": "Merge1",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2140,
          6720
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "708684c6-318f-474d-bec2-5160240e3a06",
        "name": "Merge2",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1740,
          6740
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "TK32Balancemetric",
          "options": {}
        },
        "id": "65b202ce-f41f-4a01-8f9f-31b5839e71c3",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          -2720,
          7580
        ],
        "webhookId": "9cfa5440-7fa2-4430-9ed6-76fa4c183d17"
      },
      {
        "parameters": {
          "content": "Captaciones",
          "height": 1421.615387618657,
          "width": 4059.908757782762
        },
        "id": "d72a9292-eae2-4094-9b78-bd88f00fd4a4",
        "name": "Note13",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          740,
          7980
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "Balancemetric_TK32_IngresosComision",
          "options": {}
        },
        "id": "6d5b10b2-add5-49af-9965-a320ca9aa5c5",
        "name": "Webhook5",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          940,
          7800
        ],
        "webhookId": "fc2ee95d-6a96-49db-a26c-66560c0a16db"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "Balancemetric_TK32_Captaciones",
          "options": {}
        },
        "id": "653cf764-1d58-4cc9-bf90-0126117f1aee",
        "name": "Webhook6",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          1020,
          8680
        ],
        "webhookId": "365c07ae-6bde-4560-8e38-a05ca274cf79"
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "empty"
        },
        "id": "9a167506-ebb1-4108-9e58-614b207ee105",
        "name": "Merge3",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1520,
          8120
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "empty"
        },
        "id": "262ef243-b65f-4963-b3b0-f7b8af8d6523",
        "name": "Merge5",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1540,
          8960
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "empty"
        },
        "id": "4ce3301c-ec89-4fb9-a01c-4c2d45b5908b",
        "name": "Merge7",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1860,
          8600
        ]
      },
      {
        "parameters": {},
        "id": "8bdfba65-65aa-4598-99ed-3ccdb11fd5b4",
        "name": "NoOp3",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          2540,
          8600
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$facet\": {\n      \"captTotalMes\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$fechaProceso\"\n                  ]\n                }\n              }, {\n                \"nucta\": \"21103\"\n              }\n            ]\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$fechaProceso\"\n            }, \n            \"totalCaptacionesBs\": {\n              \"$sum\": \"$sal_act\"\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"fechaProceso\": \"$_id.fechaProceso\", \n            \"mesActual\": {\n              \"$month\": \"$$NOW\"\n            }, \n            \"anioActual\": {\n              \"$year\": \"$$NOW\"\n            }, \n            \"mesFechaProceso\": {\n              \"$month\": \"$_id.fechaProceso\"\n            }, \n            \"anioFechaProceso\": {\n              \"$year\": \"$_id.fechaProceso\"\n            }, \n            \"_id\": \"$$REMOVE\"\n          }\n        }, {\n          \"$lookup\": {\n            \"from\": \"sidis_tasaconversion\", \n            \"localField\": \"fechaProceso\", \n            \"foreignField\": \"Fecha\", \n            \"as\": \"result\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesUsd\": {\n              \"$round\": [\n                {\n                  \"$divide\": [\n                    \"$totalCaptacionesBs\", {\n                      \"$arrayElemAt\": [\n                        \"$result.Tasa_DOL\", 0\n                      ]\n                    }\n                  ]\n                }, 2\n              ]\n            }, \n            \"tasaDolar\": {\n              \"$arrayElemAt\": [\n                \"$result.Tasa_DOL\", 0\n              ]\n            }, \n            \"result\": \"$$REMOVE\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesDicBs\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesBs\", \"$$REMOVE\"\n              ]\n            }, \n            \"totalCaptacionesDicUsd\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesUsd\", \"$$REMOVE\"\n              ]\n            }\n          }\n        }\n      ], \n      \"captTotalMesDic\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$fechaProceso\"\n                  ]\n                }\n              }, {\n                \"nucta\": \"21103\"\n              }\n            ]\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$fechaProceso\"\n            }, \n            \"totalCaptacionesBs\": {\n              \"$sum\": \"$sal_act\"\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"fechaProceso\": \"$_id.fechaProceso\", \n            \"mesActual\": {\n              \"$month\": \"$$NOW\"\n            }, \n            \"anioActual\": {\n              \"$year\": \"$$NOW\"\n            }, \n            \"mesFechaProceso\": {\n              \"$month\": \"$_id.fechaProceso\"\n            }, \n            \"anioFechaProceso\": {\n              \"$year\": \"$_id.fechaProceso\"\n            }, \n            \"_id\": \"$$REMOVE\"\n          }\n        }, {\n          \"$lookup\": {\n            \"from\": \"sidis_tasaconversion\", \n            \"localField\": \"fechaProceso\", \n            \"foreignField\": \"Fecha\", \n            \"as\": \"result\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesUsd\": {\n              \"$round\": [\n                {\n                  \"$divide\": [\n                    \"$totalCaptacionesBs\", {\n                      \"$arrayElemAt\": [\n                        \"$result.Tasa_DOL\", 0\n                      ]\n                    }\n                  ]\n                }, 2\n              ]\n            }, \n            \"tasaDolar\": {\n              \"$arrayElemAt\": [\n                \"$result.Tasa_DOL\", 0\n              ]\n            }, \n            \"result\": \"$$REMOVE\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesDicBs\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesBs\", \"$$REMOVE\"\n              ]\n            }, \n            \"totalCaptacionesDicUsd\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesUsd\", \"$$REMOVE\"\n              ]\n            }\n          }\n        }, {\n          \"$match\": {\n            \"totalCaptacionesDicBs\": {\n              \"$exists\": true\n            }\n          }\n        }\n      ], \n      \"captacionesTotales\": [\n        {\n          \"$match\": {\n            \"nucta\": \"21103\"\n          }\n        }, {\n          \"$addFields\": {\n            \"name\": \"total\", \n            \"actual\": \"$sal_act\", \n            \"anterior\": \"$sal_ant\", \n            \"netoActual\": \"$sal_net_act\"\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv\": {\n        \"captacionesTotales\": \"$captacionesTotales\", \n        \"captTotalMesDic\": \"$captTotalMesDic\", \n        \"captTotalMes\": \"$captTotalMes\"\n      }, \n      \"captTotalMes\": \"$$REMOVE\", \n      \"captTotalMesDic\": \"$$REMOVE\", \n      \"captacionesTotales\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$captacionesBdv.captacionesTotales\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicBs\": {\n        \"$arrayElemAt\": [\n          \"$captacionesBdv.captTotalMesDic.totalCaptacionesDicBs\", 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\": {\n        \"$arrayElemAt\": [\n          \"$captacionesBdv.captTotalMesDic.totalCaptacionesDicUsd\", 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$captacionesBdv.captTotalMes\", \n      \"captacionesBdv.captTotalMesDic\": \"$$REMOVE\", \n      \"captacionesBdv.captTotalMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$captacionesBdv.captacionesTotales.captTotalMes\", \n              \"as\": \"mes\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$mes.fechaProceso\", \"$captacionesBdv.captacionesTotales.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": \"$captacionesBdv.captacionesTotales.mensual.totalCaptacionesBs\", \n      \"captacionesBdv.captacionesTotales.tasaDolar\": \"$captacionesBdv.captacionesTotales.mensual.tasaDolar\", \n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.actual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.actual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.anterior\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.anterior\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.netoActual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.netoActual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.mensual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicBs\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\", -1\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.anioFechaProceso\": {\n        \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n      }, \n      \"captacionesBdv.captacionesTotales.anioActual\": {\n        \"$year\": \"$$NOW\"\n      }, \n      \"captacionesBdv.captacionesTotales.mesFechaProceso\": {\n        \"$month\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n      }, \n      \"captacionesBdv.captacionesTotales.mesActual\": {\n        \"$month\": \"$$NOW\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.agrupacion\": true, \n      \"captacionesBdv.captacionesTotales.varMensual\": {\n        \"$round\": [\n          {\n            \"$subtract\": [\n              \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.anterior\"\n            ]\n          }, 4\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$subtract\": [\n                  \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$group\": {\n      \"_id\": {\n        \"mesAgrupado\": \"$captacionesBdv.captacionesTotales.agrupacion\"\n      }, \n      \"captDataArray\": {\n        \"$push\": {\n          \"fechaProceso\": \"$captacionesBdv.captacionesTotales.fechaProceso\", \n          \"fecha_valor\": \"$captacionesBdv.captacionesTotales.fecha_odate\", \n          \"name\": \"$captacionesBdv.captacionesTotales.name\", \n          \"actual\": \"$captacionesBdv.captacionesTotales.actual\", \n          \"anterior\": \"$captacionesBdv.captacionesTotales.anterior\", \n          \"netoActual\": \"$captacionesBdv.captacionesTotales.netoActual\", \n          \"totalCaptacionesDicBs\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\", \n          \"totalCaptacionesDicUsd\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\", \n          \"mensual\": \"$captacionesBdv.captacionesTotales.mensual\", \n          \"tasaDolar\": \"$captacionesBdv.captacionesTotales.tasaDolar\", \n          \"varMensual\": \"$captacionesBdv.captacionesTotales.varMensual\", \n          \"varAnual\": \"$captacionesBdv.captacionesTotales.varAnual\", \n          \"creAnual\": \"$captacionesBdv.captacionesTotales.creAnual\"\n        }\n      }\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$captDataArray\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$captDataArray\"\n    }\n  }, {\n    \"$facet\": {\n      \"resultados\": [\n        {\n          \"$match\": {\n            \"name\": \"total\"\n          }\n        }\n      ], \n      \"resultadoNulo\": [\n        {\n          \"$match\": {\n            \"mensual\": {\n              \"$eq\": null\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"fecha_valor\": -1\n          }\n        }, {\n          \"$project\": {\n            \"fechaProceso\": 1, \n            \"fecha_valor\": 1, \n            \"actual\": 1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"actualNulo\": {\n        \"$slice\": [\n          \"$resultadoNulo\", 1\n        ]\n      }, \n      \"resultadoNulo\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$resultados\"\n    }\n  }, {\n    \"$addFields\": {\n      \"resultados.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$resultados.fechaProceso\", {\n                \"$arrayElemAt\": [\n                  \"$actualNulo.fechaProceso\", 0\n                ]\n              }\n            ]\n          }, {\n            \"$arrayElemAt\": [\n              \"$actualNulo.actual\", 0\n            ]\n          }, \"$resultados.mensual\"\n        ]\n      }, \n      \"actualNulo\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$resultados\"\n    }\n  }, {\n    \"$project\": {\n      \"fechaProceso\": 1, \n      \"fecha_valor\": 1, \n      \"captacionesBs.conv20\": {\n        \"actual\": \"$actual\", \n        \"anterior\": \"$anterior\", \n        \"netoActual\": \"$netoActual\", \n        \"mensual\": \"$mensual\", \n        \"varMensual\": \"$varMensual\", \n        \"varAnual\": \"$varAnual\", \n        \"creAnual\": \"$creAnual\"\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"result.captacionesBs.conv20\": \"$captacionesBs.conv20\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$result\"\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captaciones\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0,\n      \"ingresosCartera\":0,\n      \"ingresosCarteraBs\":0\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "2312959a-552d-47c4-91b8-45af3d3e0cd5",
        "name": "CaptacionesConv20VersionFinalBs",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1340,
          8020
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"file_date\": \"$$REMOVE\",\n      \"prod_alt\": \"$$REMOVE\",\n      \"rel_linea\": \"$$REMOVE\",\n      \"sub_prod_alt\": \"$$REMOVE\",\n      \"desc_nucta\": \"$$REMOVE\",\n      \"haber\": \"$$REMOVE\",\n      \"debe\": \"$$REMOVE\",\n      \"_id\": \"$$REMOVE\",\n      \"sal_act\": {\n        \"$multiply\": [\n          \"$sal_act\",\n          -1\n        ]\n      },\n      \"sal_ant\": {\n        \"$multiply\": [\n          \"$sal_ant\",\n          -1\n        ]\n      },\n      \"sal_net_act\": {\n        \"$multiply\": [\n          \"$sal_net_act\",\n          -1\n        ]\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\",\n      \"localField\": \"fecha_odate\",\n      \"foreignField\": \"Fecha\",\n      \"as\": \"result\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"tasaDolar\": {\n        \"$arrayElemAt\": [\n          \"$result.Tasa_DOL\",\n          0\n        ]\n      },\n      \"result\": \"$$REMOVE\",\n      \"fecha_odate_mes_anterior\": {\n        \"$dateFromString\": {\n          \"dateString\": {\n            \"$dateToString\": {\n              \"date\": {\n                \"$subtract\": [\n                  {\n                    \"$toDate\": \"$fecha_odate\"\n                  },\n                  2592000000\n                ]\n              },\n              \"format\": \"%Y-%m-01\"\n            }\n          }\n        }\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"fechaProcesoAnt\": {\n        \"$dateFromParts\": {\n          \"year\": {\n            \"$year\": \"$fecha_odate_mes_anterior\"\n          },\n          \"month\": {\n            \"$add\": [\n              {\n                \"$month\": \"$fecha_odate_mes_anterior\"\n              },\n              1\n            ]\n          },\n          \"day\": {\n            \"$subtract\": [\n              {\n                \"$dayOfMonth\": {\n                  \"$dateFromParts\": {\n                    \"year\": {\n                      \"$year\": \"$fecha_odate_mes_anterior\"\n                    },\n                    \"month\": {\n                      \"$add\": [\n                        {\n                          \"$month\": \"$fecha_odate_mes_anterior\"\n                        },\n                        1\n                      ]\n                    },\n                    \"day\": 1\n                  }\n                }\n              },\n              1\n            ]\n          },\n          \"hour\": 0,\n          \"minute\": 0,\n          \"second\": 0,\n          \"millisecond\": 0\n        }\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\",\n      \"localField\": \"fechaProcesoAnt\",\n      \"foreignField\": \"Fecha\",\n      \"as\": \"resultTasaAnt\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"tasaDolarAnt\": {\n        \"$arrayElemAt\": [\n          \"$resultTasaAnt.Tasa_DOL\",\n          0\n        ]\n      },\n      \"resultTasaAnt\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_act\",\n              \"$tasaDolar\"\n            ]\n          },\n          4\n        ]\n      },\n      \"anterior\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_ant\",\n              \"$tasaDolarAnt\"\n            ]\n          },\n          4\n        ]\n      },\n      \"netoActual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_act\",\n              \"$tasaDolar\"\n            ]\n          },\n          4\n        ]\n      },\n      \"sal_ant\": \"$$REMOVE\",\n      \"sal_net_act\": \"$$REMOVE\",\n      \"sal_act\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$facet\": {\n      \"captacionesTotales\": [\n        {\n          \"$match\": {\n            \"nucta\": \"21103\"\n          }\n        }\n      ],\n      \"captTotalMes\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\",\n                    \"$fechaProceso\"\n                  ]\n                }\n              },\n              {\n                \"nucta\": \"21103\"\n              }\n            ]\n          }\n        },\n        {\n          \"$project\": {\n            \"fechaProceso\": 1,\n            \"actual\": 1,\n            \"tasaDolar\": 1\n          }\n        }\n      ],\n      \"captTotalMesDic\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\",\n                    \"$fechaProceso\"\n                  ]\n                }\n              },\n              {\n                \"nucta\": \"21103\"\n              },\n              {\n                \"$expr\": {\n                  \"$ne\": [\n                    {\n                      \"$year\": \"$fechaProceso\"\n                    },\n                    {\n                      \"$year\": \"$$NOW\"\n                    }\n                  ]\n                }\n              },\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    {\n                      \"$month\": \"$fechaProceso\"\n                    },\n                    12\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv\": {\n        \"captacionesTotales\": \"$captacionesTotales\",\n        \"captTotalMesDic\": \"$captTotalMesDic\",\n        \"captTotalMes\": \"$captTotalMes\"\n      },\n      \"captTotalMes\": \"$$REMOVE\",\n      \"captTotalMesDic\": \"$$REMOVE\",\n      \"captacionesTotales\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$captacionesBdv.captacionesTotales\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.totalCaptacionesDic\": {\n        \"$arrayElemAt\": [\n          \"$captacionesBdv.captTotalMesDic.actual\",\n          0\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$captacionesBdv.captTotalMes\",\n      \"captacionesBdv.captTotalMesDic\": \"$$REMOVE\",\n      \"captacionesBdv.captTotalMes\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$captacionesBdv.captacionesTotales.captTotalMes\",\n              \"as\": \"mes\",\n              \"cond\": {\n                \"$eq\": [\n                  \"$$mes.fechaProceso\",\n                  \"$captacionesBdv.captacionesTotales.fechaProceso\"\n                ]\n              }\n            }\n          },\n          0\n        ]\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": \"$captacionesBdv.captacionesTotales.mensual.actual\",\n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.agrupacion\": true,\n      \"captacionesBdv.captacionesTotales.varMensual\": {\n        \"$round\": [\n          {\n            \"$subtract\": [\n              \"$captacionesBdv.captacionesTotales.actual\",\n              \"$captacionesBdv.captacionesTotales.anterior\"\n            ]\n          },\n          4\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              },\n              {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          },\n          {\n            \"$round\": [\n              {\n                \"$subtract\": [\n                  \"$captacionesBdv.captacionesTotales.actual\",\n                  \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                ]\n              },\n              4\n            ]\n          },\n          0\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              },\n              {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          },\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$captacionesBdv.captacionesTotales.actual\",\n                          \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                        ]\n                      },\n                      100\n                    ]\n                  },\n                  \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                ]\n              },\n              4\n            ]\n          },\n          0\n        ]\n      }\n    }\n  },\n  {\n    \"$group\": {\n      \"_id\": {\n        \"mesAgrupado\": \"$captacionesBdv.captacionesTotales.agrupacion\"\n      },\n      \"captDataArray\": {\n        \"$push\": {\n          \"fechaProceso\": \"$captacionesBdv.captacionesTotales.fechaProceso\",\n          \"fecha_valor\": \"$captacionesBdv.captacionesTotales.fecha_odate\",\n          \"actual\": \"$captacionesBdv.captacionesTotales.actual\",\n          \"anterior\": \"$captacionesBdv.captacionesTotales.anterior\",\n          \"netoActual\": \"$captacionesBdv.captacionesTotales.netoActual\",\n          \"totalCaptacionesDic\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\",\n          \"mensual\": \"$captacionesBdv.captacionesTotales.mensual\",\n          \"tasaDolar\": \"$captacionesBdv.captacionesTotales.tasaDolar\",\n          \"varMensual\": \"$captacionesBdv.captacionesTotales.varMensual\",\n          \"varAnual\": \"$captacionesBdv.captacionesTotales.varAnual\",\n          \"creAnual\": \"$captacionesBdv.captacionesTotales.creAnual\"\n        }\n      }\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$captDataArray\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$captDataArray\"\n    }\n  },\n  {\n    \"$facet\": {\n      \"resultados\": [\n        {\n          \"$match\": {\n            \"fecha_valor\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ],\n      \"resultadoNulo\": [\n        {\n          \"$match\": {\n            \"mensual\": {\n              \"$eq\": null\n            }\n          }\n        },\n        {\n          \"$sort\": {\n            \"fecha_valor\": -1\n          }\n        },\n        {\n          \"$project\": {\n            \"fechaProceso\": 1,\n            \"fecha_valor\": 1,\n            \"actual\": 1,\n            \"tasaDolar\": 1\n          }\n        }\n      ]\n    }\n  },\n  {\n    \"$addFields\": {\n      \"actualNulo\": {\n        \"$slice\": [\n          \"$resultadoNulo\",\n          1\n        ]\n      },\n      \"resultadoNulo\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$resultados\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"resultados.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$resultados.fechaProceso\",\n              {\n                \"$arrayElemAt\": [\n                  \"$actualNulo.fechaProceso\",\n                  0\n                ]\n              }\n            ]\n          },\n          {\n            \"$arrayElemAt\": [\n              \"$actualNulo.actual\",\n              0\n            ]\n          },\n          \"$resultados.mensual\"\n        ]\n      },\n      \"actualNulo\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$resultados\"\n    }\n  },\n  {\n    \"$project\": {\n      \"fechaProceso\": 1,\n      \"fecha_valor\": 1,\n      \"captaciones.conv20\": {\n        \"actual\": \"$actual\",\n        \"anterior\": \"$anterior\",\n        \"netoActual\": \"$netoActual\",\n        \"mensual\": \"$mensual\",\n        \"varMensual\": \"$varMensual\",\n        \"varAnual\": \"$varAnual\",\n        \"creAnual\": \"$creAnual\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\",\n      \"localField\": \"fecha_valor\",\n      \"foreignField\": \"fecha_valor\",\n      \"as\": \"result\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$result\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"result.captaciones.conv20\": \"$captaciones.conv20\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$result\"\n    }\n  },\n  {\n    \"$project\": {\n      \"_id\": 0,\n      \"captacionesBs\": 0,\n      \"cobranzaMora\": 0,\n      \"cobranzaMoraUVC\": 0,\n      \"liquidaciones\": 0,\n      \"liquidacionesUVC\": 0,\n      \"cobranzaMoraBs\": 0,\n      \"cobranzaMoraUVCBs\": 0,\n      \"liquidacionesBs\": 0,\n      \"liquidacionesUVCBs\": 0,\n      \"carteraCredito\": 0,\n      \"carteraCreditoBs\": 0,\n      \"ingresosComisiones\": 0,\n      \"ingresosComisionesBs\": 0,\n      \"ingresosCartera\": 0,\n      \"ingresosCarteraBs\": 0\n    }\n  },\n  {\n    \"$merge\": {\n      \"into\": \"Balancemetric\",\n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "e37e9312-d131-41c2-8546-d529fc95c4c7",
        "name": "CaptacionesConv20VersionFinalUsd",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1340,
          8240
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"file_date\": \"$$REMOVE\",\n      \"prod_alt\": \"$$REMOVE\",\n      \"rel_linea\": \"$$REMOVE\",\n      \"sub_prod_alt\": \"$$REMOVE\",\n      \"desc_nucta\": \"$$REMOVE\",\n      \"haber\": \"$$REMOVE\",\n      \"debe\": \"$$REMOVE\",\n      \"_id\": \"$$REMOVE\",\n      \"sal_act\": {\n        \"$multiply\": [\n          \"$sal_act\",\n          -1\n        ]\n      },\n      \"sal_ant\": {\n        \"$multiply\": [\n          \"$sal_ant\",\n          -1\n        ]\n      },\n      \"sal_net_act\": {\n        \"$multiply\": [\n          \"$sal_net_act\",\n          -1\n        ]\n      },\n      \"fecha_odate_mes_anterior\": {\n        \"$dateFromString\": {\n          \"dateString\": {\n            \"$dateToString\": {\n              \"date\": {\n                \"$subtract\": [\n                  {\n                    \"$toDate\": \"$fecha_odate\"\n                  },\n                  2592000000\n                ]\n              },\n              \"format\": \"%Y-%m-01\"\n            }\n          }\n        }\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\",\n      \"localField\": \"fecha_odate\",\n      \"foreignField\": \"Fecha\",\n      \"as\": \"result\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"tasaDolar\": {\n        \"$arrayElemAt\": [\n          \"$result.Tasa_DOL\",\n          0\n        ]\n      },\n      \"result\": \"$$REMOVE\",\n      \"fechaProcesoAnt\": {\n        \"$dateFromParts\": {\n          \"year\": {\n            \"$year\": \"$fecha_odate_mes_anterior\"\n          },\n          \"month\": {\n            \"$add\": [\n              {\n                \"$month\": \"$fecha_odate_mes_anterior\"\n              },\n              1\n            ]\n          },\n          \"day\": {\n            \"$subtract\": [\n              {\n                \"$dayOfMonth\": {\n                  \"$dateFromParts\": {\n                    \"year\": {\n                      \"$year\": \"$fecha_odate_mes_anterior\"\n                    },\n                    \"month\": {\n                      \"$add\": [\n                        {\n                          \"$month\": \"$fecha_odate_mes_anterior\"\n                        },\n                        1\n                      ]\n                    },\n                    \"day\": 1\n                  }\n                }\n              },\n              1\n            ]\n          },\n          \"hour\": 0,\n          \"minute\": 0,\n          \"second\": 0,\n          \"millisecond\": 0\n        }\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\",\n      \"localField\": \"fechaProcesoAnt\",\n      \"foreignField\": \"Fecha\",\n      \"as\": \"resultTasaAnt\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"tasaDolarAnt\": {\n        \"$arrayElemAt\": [\n          \"$resultTasaAnt.Tasa_DOL\",\n          0\n        ]\n      },\n      \"resultTasaAnt\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_act\",\n              \"$tasaDolar\"\n            ]\n          },\n          4\n        ]\n      },\n      \"anterior\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_ant\",\n              \"$tasaDolarAnt\"\n            ]\n          },\n          4\n        ]\n      },\n      \"netoActual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_act\",\n              \"$tasaDolar\"\n            ]\n          },\n          4\n        ]\n      },\n      \"sal_ant\": \"$$REMOVE\",\n      \"sal_net_act\": \"$$REMOVE\",\n      \"sal_act\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$facet\": {\n      \"captacionesTotales\": [\n        {\n          \"$match\": {\n            \"nucta\": \"21\"\n          }\n        }\n      ],\n      \"captTotalMes\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\",\n                    \"$fechaProceso\"\n                  ]\n                }\n              },\n              {\n                \"nucta\": \"21\"\n              }\n            ]\n          }\n        },\n        {\n          \"$project\": {\n            \"fechaProceso\": 1,\n            \"actual\": 1,\n            \"tasaDolar\": 1\n          }\n        }\n      ],\n      \"captTotalMesDic\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\",\n                    \"$fechaProceso\"\n                  ]\n                }\n              },\n              {\n                \"nucta\": \"21\"\n              },\n              {\n                \"$expr\": {\n                  \"$ne\": [\n                    {\n                      \"$year\": \"$fechaProceso\"\n                    },\n                    {\n                      \"$year\": \"$$NOW\"\n                    }\n                  ]\n                }\n              },\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    {\n                      \"$month\": \"$fechaProceso\"\n                    },\n                    12\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv\": {\n        \"captacionesTotales\": \"$captacionesTotales\",\n        \"captTotalMesDic\": \"$captTotalMesDic\",\n        \"captTotalMes\": \"$captTotalMes\"\n      },\n      \"captTotalMes\": \"$$REMOVE\",\n      \"captTotalMesDic\": \"$$REMOVE\",\n      \"captacionesTotales\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$captacionesBdv.captacionesTotales\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.totalCaptacionesDic\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$captacionesBdv.captTotalMesDic\",\n              \"as\": \"mes\",\n              \"cond\": {\n                \"$eq\": [\n                  {\n                    \"$year\": \"$$mes.fechaProceso\"\n                  },\n                  {\n                    \"$subtract\": [\n                      {\n                        \"$year\": \"$captacionesBdv.captacionesTotales.fecha_odate\"\n                      },\n                      1\n                    ]\n                  }\n                ]\n              }\n            }\n          },\n          0\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$captacionesBdv.captTotalMes\",\n      \"captacionesBdv.captTotalMesDic\": \"$$REMOVE\",\n      \"captacionesBdv.captTotalMes\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.totalCaptacionesDic\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDic.actual\",\n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$captacionesBdv.captacionesTotales.captTotalMes\",\n              \"as\": \"mes\",\n              \"cond\": {\n                \"$eq\": [\n                  \"$$mes.fechaProceso\",\n                  \"$captacionesBdv.captacionesTotales.fechaProceso\"\n                ]\n              }\n            }\n          },\n          0\n        ]\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": \"$captacionesBdv.captacionesTotales.mensual.actual\",\n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.agrupacion\": true,\n      \"captacionesBdv.captacionesTotales.varMensual\": {\n        \"$round\": [\n          {\n            \"$subtract\": [\n              \"$captacionesBdv.captacionesTotales.actual\",\n              \"$captacionesBdv.captacionesTotales.anterior\"\n            ]\n          },\n          4\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              },\n              {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          },\n          {\n            \"$round\": [\n              {\n                \"$subtract\": [\n                  \"$captacionesBdv.captacionesTotales.actual\",\n                  \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                ]\n              },\n              4\n            ]\n          },\n          0\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              },\n              {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          },\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$captacionesBdv.captacionesTotales.actual\",\n                          \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                        ]\n                      },\n                      100\n                    ]\n                  },\n                  \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                ]\n              },\n              4\n            ]\n          },\n          0\n        ]\n      }\n    }\n  },\n  {\n    \"$group\": {\n      \"_id\": {\n        \"mesAgrupado\": \"$captacionesBdv.captacionesTotales.agrupacion\"\n      },\n      \"captDataArray\": {\n        \"$push\": {\n          \"fechaProceso\": \"$captacionesBdv.captacionesTotales.fechaProceso\",\n          \"fecha_valor\": \"$captacionesBdv.captacionesTotales.fecha_odate\",\n          \"actual\": \"$captacionesBdv.captacionesTotales.actual\",\n          \"anterior\": \"$captacionesBdv.captacionesTotales.anterior\",\n          \"netoActual\": \"$captacionesBdv.captacionesTotales.netoActual\",\n          \"totalCaptacionesDic\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\",\n          \"mensual\": \"$captacionesBdv.captacionesTotales.mensual\",\n          \"tasaDolar\": \"$captacionesBdv.captacionesTotales.tasaDolar\",\n          \"varMensual\": \"$captacionesBdv.captacionesTotales.varMensual\",\n          \"varAnual\": \"$captacionesBdv.captacionesTotales.varAnual\",\n          \"creAnual\": \"$captacionesBdv.captacionesTotales.creAnual\"\n        }\n      }\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$captDataArray\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$captDataArray\"\n    }\n  },\n  {\n    \"$facet\": {\n      \"resultados\": [\n        {\n          \"$match\": {\n            \"fecha_valor\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ],\n      \"resultadoNulo\": [\n        {\n          \"$match\": {\n            \"mensual\": {\n              \"$eq\": null\n            }\n          }\n        },\n        {\n          \"$sort\": {\n            \"fecha_valor\": -1\n          }\n        },\n        {\n          \"$project\": {\n            \"fechaProceso\": 1,\n            \"fecha_valor\": 1,\n            \"actual\": 1,\n            \"tasaDolar\": 1\n          }\n        }\n      ]\n    }\n  },\n  {\n    \"$addFields\": {\n      \"actualNulo\": {\n        \"$slice\": [\n          \"$resultadoNulo\",\n          1\n        ]\n      },\n      \"resultadoNulo\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$resultados\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"resultados.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$resultados.fechaProceso\",\n              {\n                \"$arrayElemAt\": [\n                  \"$actualNulo.fechaProceso\",\n                  0\n                ]\n              }\n            ]\n          },\n          {\n            \"$arrayElemAt\": [\n              \"$actualNulo.actual\",\n              0\n            ]\n          },\n          \"$resultados.mensual\"\n        ]\n      },\n      \"actualNulo\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$resultados\"\n    }\n  },\n  {\n    \"$project\": {\n      \"fechaProceso\": 1,\n      \"fecha_valor\": 1,\n      \"captaciones.total\": {\n        \"actual\": \"$actual\",\n        \"anterior\": \"$anterior\",\n        \"netoActual\": \"$netoActual\",\n        \"mensual\": \"$mensual\",\n        \"varMensual\": \"$varMensual\",\n        \"varAnual\": \"$varAnual\",\n        \"creAnual\": \"$creAnual\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\",\n      \"localField\": \"fecha_valor\",\n      \"foreignField\": \"fecha_valor\",\n      \"as\": \"result\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$result\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"result.captaciones.total\": \"$captaciones.total\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$result\"\n    }\n  },\n  {\n    \"$project\": {\n      \"_id\": 0,\n      \"captacionesBs\": 0,\n      \"cobranzaMora\": 0,\n      \"cobranzaMoraUVC\": 0,\n      \"liquidaciones\": 0,\n      \"liquidacionesUVC\": 0,\n      \"cobranzaMoraBs\": 0,\n      \"cobranzaMoraUVCBs\": 0,\n      \"liquidacionesBs\": 0,\n      \"liquidacionesUVCBs\": 0,\n      \"carteraCredito\": 0,\n      \"carteraCreditoBs\": 0,\n      \"ingresosComisiones\": 0,\n      \"ingresosComisionesBs\": 0,\n      \"ingresosCartera\": 0,\n      \"ingresosCarteraBs\": 0\n    }\n  },\n  {\n    \"$merge\": {\n      \"into\": \"Balancemetric\",\n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "00bcd4ff-c36b-4dc9-8e5b-1d10d42e6a2b",
        "name": "CaptacionesTotalesVersionFinalUsd",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1340,
          9060
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$facet\": {\n      \"captTotalMes\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$fechaProceso\"\n                  ]\n                }\n              }, {\n                \"nucta\": \"21\"\n              }\n            ]\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$fechaProceso\"\n            }, \n            \"totalCaptacionesBs\": {\n              \"$sum\": \"$sal_act\"\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"fechaProceso\": \"$_id.fechaProceso\", \n            \"mesActual\": {\n              \"$month\": \"$$NOW\"\n            }, \n            \"anioActual\": {\n              \"$year\": \"$$NOW\"\n            }, \n            \"mesFechaProceso\": {\n              \"$month\": \"$_id.fechaProceso\"\n            }, \n            \"anioFechaProceso\": {\n              \"$year\": \"$_id.fechaProceso\"\n            }, \n            \"_id\": \"$$REMOVE\"\n          }\n        }, {\n          \"$lookup\": {\n            \"from\": \"sidis_tasaconversion\", \n            \"localField\": \"fechaProceso\", \n            \"foreignField\": \"Fecha\", \n            \"as\": \"result\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesUsd\": {\n              \"$round\": [\n                {\n                  \"$divide\": [\n                    \"$totalCaptacionesBs\", {\n                      \"$arrayElemAt\": [\n                        \"$result.Tasa_DOL\", 0\n                      ]\n                    }\n                  ]\n                }, 2\n              ]\n            }, \n            \"tasaDolar\": {\n              \"$arrayElemAt\": [\n                \"$result.Tasa_DOL\", 0\n              ]\n            }, \n            \"result\": \"$$REMOVE\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesDicBs\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesBs\", \"$$REMOVE\"\n              ]\n            }, \n            \"totalCaptacionesDicUsd\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesUsd\", \"$$REMOVE\"\n              ]\n            }\n          }\n        }\n      ], \n      \"captTotalMesDic\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$fechaProceso\"\n                  ]\n                }\n              }, {\n                \"nucta\": \"21\"\n              }\n            ]\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$fechaProceso\"\n            }, \n            \"totalCaptacionesBs\": {\n              \"$sum\": \"$sal_act\"\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"fechaProceso\": \"$_id.fechaProceso\", \n            \"mesActual\": {\n              \"$month\": \"$$NOW\"\n            }, \n            \"anioActual\": {\n              \"$year\": \"$$NOW\"\n            }, \n            \"mesFechaProceso\": {\n              \"$month\": \"$_id.fechaProceso\"\n            }, \n            \"anioFechaProceso\": {\n              \"$year\": \"$_id.fechaProceso\"\n            }, \n            \"_id\": \"$$REMOVE\"\n          }\n        }, {\n          \"$lookup\": {\n            \"from\": \"sidis_tasaconversion\", \n            \"localField\": \"fechaProceso\", \n            \"foreignField\": \"Fecha\", \n            \"as\": \"result\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesUsd\": {\n              \"$round\": [\n                {\n                  \"$divide\": [\n                    \"$totalCaptacionesBs\", {\n                      \"$arrayElemAt\": [\n                        \"$result.Tasa_DOL\", 0\n                      ]\n                    }\n                  ]\n                }, 2\n              ]\n            }, \n            \"tasaDolar\": {\n              \"$arrayElemAt\": [\n                \"$result.Tasa_DOL\", 0\n              ]\n            }, \n            \"result\": \"$$REMOVE\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesDicBs\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesBs\", \"$$REMOVE\"\n              ]\n            }, \n            \"totalCaptacionesDicUsd\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesUsd\", \"$$REMOVE\"\n              ]\n            }\n          }\n        }, {\n          \"$match\": {\n            \"totalCaptacionesDicBs\": {\n              \"$exists\": true\n            }\n          }\n        }\n      ], \n      \"captacionesTotales\": [\n        {\n          \"$match\": {\n            \"nucta\": \"21\"\n          }\n        }, {\n          \"$addFields\": {\n            \"name\": \"total\", \n            \"actual\": \"$sal_act\", \n            \"anterior\": \"$sal_ant\", \n            \"netoActual\": \"$sal_net_act\"\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv\": {\n        \"captacionesTotales\": \"$captacionesTotales\", \n        \"captTotalMesDic\": \"$captTotalMesDic\", \n        \"captTotalMes\": \"$captTotalMes\"\n      }, \n      \"captTotalMes\": \"$$REMOVE\", \n      \"captTotalMesDic\": \"$$REMOVE\", \n      \"captacionesTotales\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$captacionesBdv.captacionesTotales\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicBs\": {\n        \"$arrayElemAt\": [\n          \"$captacionesBdv.captTotalMesDic.totalCaptacionesDicBs\", 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\": {\n        \"$arrayElemAt\": [\n          \"$captacionesBdv.captTotalMesDic.totalCaptacionesDicUsd\", 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$captacionesBdv.captTotalMes\", \n      \"captacionesBdv.captTotalMesDic\": \"$$REMOVE\", \n      \"captacionesBdv.captTotalMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$captacionesBdv.captacionesTotales.captTotalMes\", \n              \"as\": \"mes\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$mes.fechaProceso\", \"$captacionesBdv.captacionesTotales.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": \"$captacionesBdv.captacionesTotales.mensual.totalCaptacionesBs\", \n      \"captacionesBdv.captacionesTotales.tasaDolar\": \"$captacionesBdv.captacionesTotales.mensual.tasaDolar\", \n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.actual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.actual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.anterior\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.anterior\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.netoActual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.netoActual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.mensual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicBs\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\", -1\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.anioFechaProceso\": {\n        \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n      }, \n      \"captacionesBdv.captacionesTotales.anioActual\": {\n        \"$year\": \"$$NOW\"\n      }, \n      \"captacionesBdv.captacionesTotales.mesFechaProceso\": {\n        \"$month\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n      }, \n      \"captacionesBdv.captacionesTotales.mesActual\": {\n        \"$month\": \"$$NOW\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.agrupacion\": true, \n      \"captacionesBdv.captacionesTotales.varMensual\": {\n        \"$round\": [\n          {\n            \"$subtract\": [\n              \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.anterior\"\n            ]\n          }, 4\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$subtract\": [\n                  \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$group\": {\n      \"_id\": {\n        \"mesAgrupado\": \"$captacionesBdv.captacionesTotales.agrupacion\"\n      }, \n      \"captDataArray\": {\n        \"$push\": {\n          \"fechaProceso\": \"$captacionesBdv.captacionesTotales.fechaProceso\", \n          \"fecha_valor\": \"$captacionesBdv.captacionesTotales.fecha_odate\", \n          \"name\": \"$captacionesBdv.captacionesTotales.name\", \n          \"actual\": \"$captacionesBdv.captacionesTotales.actual\", \n          \"anterior\": \"$captacionesBdv.captacionesTotales.anterior\", \n          \"netoActual\": \"$captacionesBdv.captacionesTotales.netoActual\", \n          \"totalCaptacionesDicBs\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\", \n          \"totalCaptacionesDicUsd\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\", \n          \"mensual\": \"$captacionesBdv.captacionesTotales.mensual\", \n          \"tasaDolar\": \"$captacionesBdv.captacionesTotales.tasaDolar\", \n          \"varMensual\": \"$captacionesBdv.captacionesTotales.varMensual\", \n          \"varAnual\": \"$captacionesBdv.captacionesTotales.varAnual\", \n          \"creAnual\": \"$captacionesBdv.captacionesTotales.creAnual\"\n        }\n      }\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$captDataArray\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$captDataArray\"\n    }\n  }, {\n    \"$facet\": {\n      \"resultados\": [\n        {\n          \"$match\": {\n            \"name\": \"total\"\n          }\n        }\n      ], \n      \"resultadoNulo\": [\n        {\n          \"$match\": {\n            \"mensual\": {\n              \"$eq\": null\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"fecha_valor\": -1\n          }\n        }, {\n          \"$lookup\": {\n            \"from\": \"sidis_tasaconversion\", \n            \"localField\": \"fecha_valor\", \n            \"foreignField\": \"Fecha\", \n            \"as\": \"result\"\n          }\n        }, {\n          \"$addFields\": {\n            \"tasaDolar\": {\n              \"$arrayElemAt\": [\n                \"$result.Tasa_DOL\", 0\n              ]\n            }\n          }\n        }, {\n          \"$project\": {\n            \"fechaProceso\": 1, \n            \"fecha_valor\": 1, \n            \"actual\": 1, \n            \"tasaDolar\": 1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"actualNulo\": {\n        \"$slice\": [\n          \"$resultadoNulo\", 1\n        ]\n      }, \n      \"resultadoNulo\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$resultados\"\n    }\n  }, {\n    \"$addFields\": {\n      \"resultados.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$resultados.fechaProceso\", {\n                \"$arrayElemAt\": [\n                  \"$actualNulo.fechaProceso\", 0\n                ]\n              }\n            ]\n          }, {\n            \"$arrayElemAt\": [\n              \"$actualNulo.actual\", 0\n            ]\n          }, \"$resultados.mensual\"\n        ]\n      }, \n      \"resultados.tasaDolar\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$resultados.fechaProceso\", {\n                \"$arrayElemAt\": [\n                  \"$actualNulo.fechaProceso\", 0\n                ]\n              }\n            ]\n          }, {\n            \"$arrayElemAt\": [\n              \"$actualNulo.tasaDolar\", 0\n            ]\n          }, \"$resultados.tasaDolar\"\n        ]\n      }, \n      \"actualNulo\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$resultados\"\n    }\n  }, {\n    \"$project\": {\n      \"fechaProceso\": 1, \n      \"fecha_valor\": 1, \n      \"captacionesBs.total\": {\n        \"actual\": \"$actual\", \n        \"anterior\": \"$anterior\", \n        \"netoActual\": \"$netoActual\", \n        \"mensual\": \"$mensual\", \n        \"varMensual\": \"$varMensual\", \n        \"varAnual\": \"$varAnual\", \n        \"creAnual\": \"$creAnual\"\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"result\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$size\": \"$result\"\n              }, 0\n            ]\n          }, {\n            \"$map\": {\n              \"input\": {\n                \"$objectToArray\": \"$captacionesBs\"\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.v\"\n            }\n          }, \"$result\"\n        ]\n      }\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"result.captacionesBs.total\": \"$captacionesBs.total\", \n      \"result.actual\": \"$$REMOVE\", \n      \"result.anterior\": \"$$REMOVE\", \n      \"result.netoActual\": \"$$REMOVE\", \n      \"result.varMensual\": \"$$REMOVE\", \n      \"result.varAnual\": \"$$REMOVE\", \n      \"result.creAnual\": \"$$REMOVE\", \n      \"result.mensual\": \"$$REMOVE\", \n      \"result.fechaProceso\": \"$fechaProceso\", \n      \"result.fecha_valor\": \"$fecha_valor\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$result\"\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captaciones\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0,\n \t  \"ingresosCartera\":0,\n\t  \"ingresosCarteraBs\":0\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "8f58803f-3aaf-4255-a233-332190039e90",
        "name": "CaptacionesTotalesVersionFinalBs1",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1340,
          8860
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"captaciones.conDivisa.actual\": {\n        \"$add\": [\n          \"$captaciones.libreConv.actual\", \"$captaciones.conv20.actual\"\n        ]\n      }, \n      \"captaciones.conDivisa.anterior\": {\n        \"$add\": [\n          \"$captaciones.libreConv.anterior\", \"$captaciones.conv20.anterior\"\n        ]\n      }, \n      \"captaciones.conDivisa.netoActual\": {\n        \"$add\": [\n          \"$captaciones.libreConv.netoActual\", \"$captaciones.conv20.netoActual\"\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captacionesBs\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0\n    }\n  }, {\n    \"$facet\": {\n      \"corteMes\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$fecha_valor\", \"$fechaProceso\"\n              ]\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"captaciones.conDivisa.mensual\": \"$captaciones.conDivisa.actual\"\n          }\n        }, {\n          \"$project\": {\n            \"captaciones.conDivisa.mensual\": 1, \n            \"fechaProceso\": 1\n          }\n        }\n      ], \n      \"data\": []\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.conDivisa.corteMes\": \"$corteMes\", \n      \"corteMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.conDivisa.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captaciones.conDivisa.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$fecha.fechaProceso\", \"$data.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }, \n      \"data.captaciones.conDivisa.captacionesDic\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captaciones.conDivisa.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$$fecha.fechaProceso\"\n                      }, 12\n                    ]\n                  }, {\n                    \"$ne\": [\n                      {\n                        \"$year\": \"$data.fechaProces\"\n                      }, {\n                        \"$year\": \"$$fecha.fechaProceso\"\n                      }\n                    ]\n                  }\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.conDivisa.mensual\": \"$data.captaciones.conDivisa.mensual.captaciones.conDivisa.mensual\", \n      \"data.captaciones.conDivisa.corteMes\": \"$$REMOVE\", \n      \"data.captaciones.conDivisa.captacionesDic\": \"$data.captaciones.conDivisa.captacionesDic.captaciones.conDivisa.mensual\", \n      \"data.captaciones.conDivisa.varMensual\": {\n        \"$subtract\": [\n          \"$data.captaciones.conDivisa.actual\", \"$data.captaciones.conDivisa.anterior\"\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.conDivisa.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$subtract\": [\n              \"$data.captaciones.conDivisa.actual\", \"$data.captaciones.conDivisa.captacionesDic\"\n            ]\n          }, 0\n        ]\n      }, \n      \"data.captaciones.conDivisa.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$data.captaciones.conDivisa.actual\", \"$data.captaciones.conDivisa.captacionesDic\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$data.captaciones.conDivisa.captacionesDic\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$facet\": {\n      \"data\": [\n        {\n          \"$match\": {\n            \"data.captaciones.conDivisa.actual\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ], \n      \"dataNotNull\": [\n        {\n          \"$match\": {\n            \"data.captaciones.conDivisa.actual\": {\n              \"$ne\": null\n            }\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$data.fechaProceso\", \n              \"fechaValor\": \"$data.fecha_valor\"\n            }, \n            \"maxFechaValor\": {\n              \"$max\": \"$data.fecha_valor\"\n            }, \n            \"maxMensual\": {\n              \"$max\": \"$data.captaciones.conDivisa.actual\"\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"_id.fechaValor\": -1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"ultimoActual\": {\n        \"$slice\": [\n          \"$dataNotNull\", 1\n        ]\n      }, \n      \"dataNotNull\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$ultimoActual\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.data.captaciones.conDivisa.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$data.data.fechaProceso\", \"$ultimoActual._id.fechaProceso\"\n            ]\n          }, \"$ultimoActual.maxMensual\", \"$data.data.captaciones.conDivisa.mensual\"\n        ]\n      }, \n      \"ultimoActual\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$data.data\"\n    }\n  }, {\n    \"$project\": {\n      \"mensualAnt\": 0\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "6bb9b8ad-2893-4824-8748-fb893ccdba72",
        "name": "CaptacionesConDivisaVersionFinalBs",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2100,
          8200
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n    {\n      \"$addFields\": {\n        \"captaciones.conDivisa.actual\": {\n          \"$add\": [\n            \"$captaciones.libreConv.actual\", \"$captaciones.conv20.actual\"\n          ]\n        }, \n        \"captaciones.conDivisa.anterior\": {\n          \"$add\": [\n            \"$captaciones.libreConv.anterior\", \"$captaciones.conv20.anterior\"\n          ]\n        }, \n        \"captaciones.conDivisa.netoActual\": {\n          \"$add\": [\n            \"$captaciones.libreConv.netoActual\", \"$captaciones.conv20.netoActual\"\n          ]\n        }\n      }\n    }, {\n      \"$project\": {\n        \"_id\": 0, \n        \"captacionesBs\": 0, \n        \"cobranzaMora\": 0, \n        \"cobranzaMoraUVC\": 0, \n        \"liquidaciones\": 0, \n        \"liquidacionesUVC\": 0, \n        \"cobranzaMoraBs\": 0, \n        \"cobranzaMoraUVCBs\": 0, \n        \"liquidacionesBs\": 0, \n        \"liquidacionesUVCBs\": 0, \n        \"carteraCredito\": 0, \n        \"carteraCreditoBs\": 0, \n        \"ingresosComisiones\": 0, \n        \"ingresosComisionesBs\": 0\n      }\n    }, {\n      \"$facet\": {\n        \"corteMes\": [\n          {\n            \"$match\": {\n              \"$expr\": {\n                \"$eq\": [\n                  \"$fecha_valor\", \"$fechaProceso\"\n                ]\n              }\n            }\n          }, {\n            \"$addFields\": {\n              \"captaciones.conDivisa.mensual\": \"$captaciones.conDivisa.actual\"\n            }\n          }, {\n            \"$project\": {\n              \"captaciones.conDivisa.mensual\": 1, \n              \"fechaProceso\": 1\n            }\n          }\n        ], \n        \"data\": []\n      }\n    }, {\n      \"$unwind\": {\n        \"path\": \"$data\"\n      }\n    }, {\n      \"$addFields\": {\n        \"data.captaciones.conDivisa.corteMes\": \"$corteMes\", \n        \"corteMes\": \"$$REMOVE\"\n      }\n    }, {\n      \"$addFields\": {\n        \"data.captaciones.conDivisa.mensual\": {\n          \"$arrayElemAt\": [\n            {\n              \"$filter\": {\n                \"input\": \"$data.captaciones.conDivisa.corteMes\", \n                \"as\": \"fecha\", \n                \"cond\": {\n                  \"$eq\": [\n                    \"$$fecha.fechaProceso\", \"$data.fechaProceso\"\n                  ]\n                }\n              }\n            }, 0\n          ]\n        }, \n        \"data.captaciones.conDivisa.captacionesDic\": {\n          \"$arrayElemAt\": [\n            {\n              \"$filter\": {\n                \"input\": \"$data.captaciones.conDivisa.corteMes\", \n                \"as\": \"fecha\", \n                \"cond\": {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$month\": \"$$fecha.fechaProceso\"\n                        }, 12\n                      ]\n                    }, {\n                      \"$ne\": [\n                        {\n                          \"$year\": \"$data.fechaProces\"\n                        }, {\n                          \"$year\": \"$$fecha.fechaProceso\"\n                        }\n                      ]\n                    }\n                  ]\n                }\n              }\n            }, 0\n          ]\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"data.captaciones.conDivisa.mensual\": \"$data.captaciones.conDivisa.mensual.captaciones.conDivisa.mensual\", \n        \"data.captaciones.conDivisa.corteMes\": \"$$REMOVE\", \n        \"data.captaciones.conDivisa.captacionesDic\": \"$data.captaciones.conDivisa.captacionesDic.captaciones.conDivisa.mensual\", \n        \"data.captaciones.conDivisa.varMensual\": {\n          \"$subtract\": [\n            \"$data.captaciones.conDivisa.actual\", \"$data.captaciones.conDivisa.anterior\"\n          ]\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"data.captaciones.conDivisa.varAnual\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                {\n                  \"$year\": \"$data.fechaProceso\"\n                }, {\n                  \"$year\":\"$$NOW\"\n                }\n              ]\n            }, {\n              \"$subtract\": [\n                \"$data.captaciones.conDivisa.actual\", \"$data.captaciones.conDivisa.captacionesDic\"\n              ]\n            }, 0\n          ]\n        }, \n        \"data.captaciones.conDivisa.creAnual\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                {\n                  \"$year\": \"$data.fechaProceso\"\n                }, {\n                  \"$year\":\"$$NOW\"\n                }\n              ]\n            }, {\n              \"$round\": [\n                {\n                  \"$divide\": [\n                    {\n                      \"$multiply\": [\n                        {\n                          \"$subtract\": [\n                            \"$data.captaciones.conDivisa.actual\", \"$data.captaciones.conDivisa.captacionesDic\"\n                          ]\n                        }, 100\n                      ]\n                    }, \"$data.captaciones.conDivisa.captacionesDic\"\n                  ]\n                }, 4\n              ]\n            }, 0\n          ]\n        }\n      }\n    }, {\n      \"$facet\": {\n        \"data\": [\n          {\n            \"$match\": {\n              \"data.captaciones.conDivisa.actual\": {\n                \"$ne\": null\n              }\n            }\n          }\n        ], \n        \"dataNotNull\": [\n          {\n            \"$match\": {\n              \"data.captaciones.conDivisa.actual\": {\n                \"$ne\": null\n              }\n            }\n          }, {\n            \"$group\": {\n              \"_id\": {\n                \"fechaProceso\": \"$data.fechaProceso\", \n                \"fechaValor\": \"$data.fecha_valor\"\n              }, \n              \"maxFechaValor\": {\n                \"$max\": \"$data.fecha_valor\"\n              }, \n              \"maxMensual\": {\n                \"$max\": \"$data.captaciones.conDivisa.actual\"\n              }\n            }\n          }, {\n            \"$sort\": {\n              \"_id.fechaValor\": -1\n            }\n          }\n        ]\n      }\n    }, {\n      \"$addFields\": {\n        \"ultimoActual\": {\n          \"$slice\": [\n            \"$dataNotNull\", 1\n          ]\n        }, \n        \"dataNotNull\": \"$$REMOVE\"\n      }\n    }, {\n      \"$unwind\": {\n        \"path\": \"$ultimoActual\"\n      }\n    }, {\n      \"$unwind\": {\n        \"path\": \"$data\"\n      }\n    }, {\n      \"$addFields\": {\n        \"data.data.captaciones.conDivisa.mensual\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$data.data.fechaProceso\", \"$ultimoActual._id.fechaProceso\"\n              ]\n            }, \"$ultimoActual.maxMensual\", \"$data.data.captaciones.conDivisa.mensual\"\n          ]\n        }, \n        \"ultimoActual\": \"$$REMOVE\"\n      }\n    }, {\n      \"$replaceRoot\": {\n        \"newRoot\": \"$data.data\"\n      }\n    }, {\n      \"$project\": {\n        \"mensualAnt\": 0\n      }\n    }, {\n      \"$merge\": {\n        \"into\": \"Balancemetric\", \n        \"on\": \"fecha_valor\"\n      }\n    }\n  ]"
        },
        "id": "55999f08-5d86-4a9a-8be4-eb939e7b0bf2",
        "name": "CaptacionesConDivisaVersionFinalUsd",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2280,
          8200
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$facet\": {\n      \"captTotalMes\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$fechaProceso\"\n                  ]\n                }\n              }, {\n                \"nucta\": \"21105\"\n              }\n            ]\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$fechaProceso\"\n            }, \n            \"totalCaptacionesBs\": {\n              \"$sum\": \"$sal_act\"\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"fechaProceso\": \"$_id.fechaProceso\", \n            \"mesActual\": {\n              \"$month\": \"$$NOW\"\n            }, \n            \"anioActual\": {\n              \"$year\": \"$$NOW\"\n            }, \n            \"mesFechaProceso\": {\n              \"$month\": \"$_id.fechaProceso\"\n            }, \n            \"anioFechaProceso\": {\n              \"$year\": \"$_id.fechaProceso\"\n            }, \n            \"_id\": \"$$REMOVE\"\n          }\n        }, {\n          \"$lookup\": {\n            \"from\": \"sidis_tasaconversion\", \n            \"localField\": \"fechaProceso\", \n            \"foreignField\": \"Fecha\", \n            \"as\": \"result\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesUsd\": {\n              \"$round\": [\n                {\n                  \"$divide\": [\n                    \"$totalCaptacionesBs\", {\n                      \"$arrayElemAt\": [\n                        \"$result.Tasa_DOL\", 0\n                      ]\n                    }\n                  ]\n                }, 2\n              ]\n            }, \n            \"tasaDolar\": {\n              \"$arrayElemAt\": [\n                \"$result.Tasa_DOL\", 0\n              ]\n            }, \n            \"result\": \"$$REMOVE\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesDicBs\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesBs\", \"$$REMOVE\"\n              ]\n            }, \n            \"totalCaptacionesDicUsd\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesUsd\", \"$$REMOVE\"\n              ]\n            }\n          }\n        }\n      ], \n      \"captTotalMesDic\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$fechaProceso\"\n                  ]\n                }\n              }, {\n                \"nucta\": \"21105\"\n              }\n            ]\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$fechaProceso\"\n            }, \n            \"totalCaptacionesBs\": {\n              \"$sum\": \"$sal_act\"\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"fechaProceso\": \"$_id.fechaProceso\", \n            \"mesActual\": {\n              \"$month\": \"$$NOW\"\n            }, \n            \"anioActual\": {\n              \"$year\": \"$$NOW\"\n            }, \n            \"mesFechaProceso\": {\n              \"$month\": \"$_id.fechaProceso\"\n            }, \n            \"anioFechaProceso\": {\n              \"$year\": \"$_id.fechaProceso\"\n            }, \n            \"_id\": \"$$REMOVE\"\n          }\n        }, {\n          \"$lookup\": {\n            \"from\": \"sidis_tasaconversion\", \n            \"localField\": \"fechaProceso\", \n            \"foreignField\": \"Fecha\", \n            \"as\": \"result\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesUsd\": {\n              \"$round\": [\n                {\n                  \"$divide\": [\n                    \"$totalCaptacionesBs\", {\n                      \"$arrayElemAt\": [\n                        \"$result.Tasa_DOL\", 0\n                      ]\n                    }\n                  ]\n                }, 2\n              ]\n            }, \n            \"tasaDolar\": {\n              \"$arrayElemAt\": [\n                \"$result.Tasa_DOL\", 0\n              ]\n            }, \n            \"result\": \"$$REMOVE\"\n          }\n        }, {\n          \"$addFields\": {\n            \"totalCaptacionesDicBs\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesBs\", \"$$REMOVE\"\n              ]\n            }, \n            \"totalCaptacionesDicUsd\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$subtract\": [\n                            \"$anioActual\", \"$anioFechaProceso\"\n                          ]\n                        }, 1\n                      ]\n                    }, {\n                      \"$eq\": [\n                        \"$mesFechaProceso\", 12\n                      ]\n                    }\n                  ]\n                }, \"$totalCaptacionesUsd\", \"$$REMOVE\"\n              ]\n            }\n          }\n        }, {\n          \"$match\": {\n            \"totalCaptacionesDicBs\": {\n              \"$exists\": true\n            }\n          }\n        }\n      ], \n      \"captacionesTotales\": [\n        {\n          \"$match\": {\n            \"nucta\": \"21105\"\n          }\n        }, {\n          \"$addFields\": {\n            \"name\": \"total\", \n            \"actual\": \"$sal_act\", \n            \"anterior\": \"$sal_ant\", \n            \"netoActual\": \"$sal_net_act\"\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv\": {\n        \"captacionesTotales\": \"$captacionesTotales\", \n        \"captTotalMesDic\": \"$captTotalMesDic\", \n        \"captTotalMes\": \"$captTotalMes\"\n      }, \n      \"captTotalMes\": \"$$REMOVE\", \n      \"captTotalMesDic\": \"$$REMOVE\", \n      \"captacionesTotales\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$captacionesBdv.captacionesTotales\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicBs\": {\n        \"$arrayElemAt\": [\n          \"$captacionesBdv.captTotalMesDic.totalCaptacionesDicBs\", 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\": {\n        \"$arrayElemAt\": [\n          \"$captacionesBdv.captTotalMesDic.totalCaptacionesDicUsd\", 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$captacionesBdv.captTotalMes\", \n      \"captacionesBdv.captTotalMesDic\": \"$$REMOVE\", \n      \"captacionesBdv.captTotalMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$captacionesBdv.captacionesTotales.captTotalMes\", \n              \"as\": \"mes\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$mes.fechaProceso\", \"$captacionesBdv.captacionesTotales.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": \"$captacionesBdv.captacionesTotales.mensual.totalCaptacionesBs\", \n      \"captacionesBdv.captacionesTotales.tasaDolar\": \"$captacionesBdv.captacionesTotales.mensual.tasaDolar\", \n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.actual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.actual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.anterior\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.anterior\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.netoActual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.netoActual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.mensual\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\", -1\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.totalCaptacionesDicBs\": {\n        \"$multiply\": [\n          \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\", -1\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.anioFechaProceso\": {\n        \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n      }, \n      \"captacionesBdv.captacionesTotales.anioActual\": {\n        \"$year\": \"$$NOW\"\n      }, \n      \"captacionesBdv.captacionesTotales.mesFechaProceso\": {\n        \"$month\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n      }, \n      \"captacionesBdv.captacionesTotales.mesActual\": {\n        \"$month\": \"$$NOW\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.agrupacion\": true, \n      \"captacionesBdv.captacionesTotales.varMensual\": {\n        \"$round\": [\n          {\n            \"$subtract\": [\n              \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.anterior\"\n            ]\n          }, 4\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$subtract\": [\n                  \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }, \n      \"captacionesBdv.captacionesTotales.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$captacionesBdv.captacionesTotales.actual\", \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$group\": {\n      \"_id\": {\n        \"mesAgrupado\": \"$captacionesBdv.captacionesTotales.agrupacion\"\n      }, \n      \"captDataArray\": {\n        \"$push\": {\n          \"fechaProceso\": \"$captacionesBdv.captacionesTotales.fechaProceso\", \n          \"fecha_valor\": \"$captacionesBdv.captacionesTotales.fecha_odate\", \n          \"name\": \"$captacionesBdv.captacionesTotales.name\", \n          \"actual\": \"$captacionesBdv.captacionesTotales.actual\", \n          \"anterior\": \"$captacionesBdv.captacionesTotales.anterior\", \n          \"netoActual\": \"$captacionesBdv.captacionesTotales.netoActual\", \n          \"totalCaptacionesDicBs\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDicBs\", \n          \"totalCaptacionesDicUsd\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDicUsd\", \n          \"mensual\": \"$captacionesBdv.captacionesTotales.mensual\", \n          \"tasaDolar\": \"$captacionesBdv.captacionesTotales.tasaDolar\", \n          \"varMensual\": \"$captacionesBdv.captacionesTotales.varMensual\", \n          \"varAnual\": \"$captacionesBdv.captacionesTotales.varAnual\", \n          \"creAnual\": \"$captacionesBdv.captacionesTotales.creAnual\"\n        }\n      }\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$captDataArray\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$captDataArray\"\n    }\n  }, {\n    \"$facet\": {\n      \"resultados\": [\n        {\n          \"$match\": {\n            \"name\": \"total\"\n          }\n        }\n      ], \n      \"resultadoNulo\": [\n        {\n          \"$match\": {\n            \"mensual\": {\n              \"$eq\": null\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"fecha_valor\": -1\n          }\n        }, {\n          \"$project\": {\n            \"fechaProceso\": 1, \n            \"fecha_valor\": 1, \n            \"actual\": 1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"actualNulo\": {\n        \"$slice\": [\n          \"$resultadoNulo\", 1\n        ]\n      }, \n      \"resultadoNulo\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$resultados\"\n    }\n  }, {\n    \"$addFields\": {\n      \"resultados.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$resultados.fechaProceso\", {\n                \"$arrayElemAt\": [\n                  \"$actualNulo.fechaProceso\", 0\n                ]\n              }\n            ]\n          }, {\n            \"$arrayElemAt\": [\n              \"$actualNulo.actual\", 0\n            ]\n          }, \"$resultados.mensual\"\n        ]\n      }, \n      \"actualNulo\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$resultados\"\n    }\n  }, {\n    \"$project\": {\n      \"fechaProceso\": 1, \n      \"fecha_valor\": 1, \n      \"captacionesBs.libreConv\": {\n        \"actual\": \"$actual\", \n        \"anterior\": \"$anterior\", \n        \"netoActual\": \"$netoActual\", \n        \"mensual\": \"$mensual\", \n        \"varMensual\": \"$varMensual\", \n        \"varAnual\": \"$varAnual\", \n        \"creAnual\": \"$creAnual\"\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"result.captacionesBs.libreConv\": \"$captacionesBs.libreConv\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$result\"\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captaciones\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0,\n      \"ingresosCartera\":0,\n      \"ingresosCarteraBs\":0\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "3f0772bc-f259-4cde-a434-0d971313d9fd",
        "name": "CaptacionesLibreConvVersionFinalBs1",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1340,
          8460
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"file_date\": \"$$REMOVE\",\n      \"prod_alt\": \"$$REMOVE\",\n      \"rel_linea\": \"$$REMOVE\",\n      \"sub_prod_alt\": \"$$REMOVE\",\n      \"desc_nucta\": \"$$REMOVE\",\n      \"haber\": \"$$REMOVE\",\n      \"debe\": \"$$REMOVE\",\n      \"_id\": \"$$REMOVE\",\n      \"sal_act\": {\n        \"$multiply\": [\n          \"$sal_act\",\n          -1\n        ]\n      },\n      \"sal_ant\": {\n        \"$multiply\": [\n          \"$sal_ant\",\n          -1\n        ]\n      },\n      \"sal_net_act\": {\n        \"$multiply\": [\n          \"$sal_net_act\",\n          -1\n        ]\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\",\n      \"localField\": \"fecha_odate\",\n      \"foreignField\": \"Fecha\",\n      \"as\": \"result\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"tasaDolar\": {\n        \"$arrayElemAt\": [\n          \"$result.Tasa_DOL\",\n          0\n        ]\n      },\n      \"result\": \"$$REMOVE\",\n      \"fecha_odate_mes_anterior\": {\n        \"$dateFromString\": {\n          \"dateString\": {\n            \"$dateToString\": {\n              \"date\": {\n                \"$subtract\": [\n                  {\n                    \"$toDate\": \"$fecha_odate\"\n                  },\n                  2592000000\n                ]\n              },\n              \"format\": \"%Y-%m-01\"\n            }\n          }\n        }\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"fechaProcesoAnt\": {\n        \"$dateFromParts\": {\n          \"year\": {\n            \"$year\": \"$fecha_odate_mes_anterior\"\n          },\n          \"month\": {\n            \"$add\": [\n              {\n                \"$month\": \"$fecha_odate_mes_anterior\"\n              },\n              1\n            ]\n          },\n          \"day\": {\n            \"$subtract\": [\n              {\n                \"$dayOfMonth\": {\n                  \"$dateFromParts\": {\n                    \"year\": {\n                      \"$year\": \"$fecha_odate_mes_anterior\"\n                    },\n                    \"month\": {\n                      \"$add\": [\n                        {\n                          \"$month\": \"$fecha_odate_mes_anterior\"\n                        },\n                        1\n                      ]\n                    },\n                    \"day\": 1\n                  }\n                }\n              },\n              1\n            ]\n          },\n          \"hour\": 0,\n          \"minute\": 0,\n          \"second\": 0,\n          \"millisecond\": 0\n        }\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\",\n      \"localField\": \"fechaProcesoAnt\",\n      \"foreignField\": \"Fecha\",\n      \"as\": \"resultTasaAnt\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"tasaDolarAnt\": {\n        \"$arrayElemAt\": [\n          \"$resultTasaAnt.Tasa_DOL\",\n          0\n        ]\n      },\n      \"resultTasaAnt\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_act\",\n              \"$tasaDolar\"\n            ]\n          },\n          4\n        ]\n      },\n      \"anterior\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_ant\",\n              \"$tasaDolarAnt\"\n            ]\n          },\n          4\n        ]\n      },\n      \"netoActual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_act\",\n              \"$tasaDolar\"\n            ]\n          },\n          4\n        ]\n      },\n      \"sal_ant\": \"$$REMOVE\",\n      \"sal_net_act\": \"$$REMOVE\",\n      \"sal_act\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$facet\": {\n      \"captacionesTotales\": [\n        {\n          \"$match\": {\n            \"nucta\": \"21105\"\n          }\n        }\n      ],\n      \"captTotalMes\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\",\n                    \"$fechaProceso\"\n                  ]\n                }\n              },\n              {\n                \"nucta\": \"21105\"\n              }\n            ]\n          }\n        },\n        {\n          \"$project\": {\n            \"fechaProceso\": 1,\n            \"actual\": 1,\n            \"tasaDolar\": 1\n          }\n        }\n      ],\n      \"captTotalMesDic\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\",\n                    \"$fechaProceso\"\n                  ]\n                }\n              },\n              {\n                \"nucta\": \"21105\"\n              },\n              {\n                \"$expr\": {\n                  \"$ne\": [\n                    {\n                      \"$year\": \"$fechaProceso\"\n                    },\n                    {\n                      \"$year\": \"$$NOW\"\n                    }\n                  ]\n                }\n              },\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    {\n                      \"$month\": \"$fechaProceso\"\n                    },\n                    12\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv\": {\n        \"captacionesTotales\": \"$captacionesTotales\",\n        \"captTotalMesDic\": \"$captTotalMesDic\",\n        \"captTotalMes\": \"$captTotalMes\"\n      },\n      \"captTotalMes\": \"$$REMOVE\",\n      \"captTotalMesDic\": \"$$REMOVE\",\n      \"captacionesTotales\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$captacionesBdv.captacionesTotales\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.totalCaptacionesDic\": {\n        \"$arrayElemAt\": [\n          \"$captacionesBdv.captTotalMesDic.actual\",\n          0\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$captacionesBdv.captTotalMes\",\n      \"captacionesBdv.captTotalMesDic\": \"$$REMOVE\",\n      \"captacionesBdv.captTotalMes\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$captacionesBdv.captacionesTotales.captTotalMes\",\n              \"as\": \"mes\",\n              \"cond\": {\n                \"$eq\": [\n                  \"$$mes.fechaProceso\",\n                  \"$captacionesBdv.captacionesTotales.fechaProceso\"\n                ]\n              }\n            }\n          },\n          0\n        ]\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.mensual\": \"$captacionesBdv.captacionesTotales.mensual.actual\",\n      \"captacionesBdv.captacionesTotales.captTotalMes\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"captacionesBdv.captacionesTotales.agrupacion\": true,\n      \"captacionesBdv.captacionesTotales.varMensual\": {\n        \"$round\": [\n          {\n            \"$subtract\": [\n              \"$captacionesBdv.captacionesTotales.actual\",\n              \"$captacionesBdv.captacionesTotales.anterior\"\n            ]\n          },\n          4\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              },\n              {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          },\n          {\n            \"$round\": [\n              {\n                \"$subtract\": [\n                  \"$captacionesBdv.captacionesTotales.actual\",\n                  \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                ]\n              },\n              4\n            ]\n          },\n          0\n        ]\n      },\n      \"captacionesBdv.captacionesTotales.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$captacionesBdv.captacionesTotales.fechaProceso\"\n              },\n              {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          },\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$captacionesBdv.captacionesTotales.actual\",\n                          \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                        ]\n                      },\n                      100\n                    ]\n                  },\n                  \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\"\n                ]\n              },\n              4\n            ]\n          },\n          0\n        ]\n      }\n    }\n  },\n  {\n    \"$group\": {\n      \"_id\": {\n        \"mesAgrupado\": \"$captacionesBdv.captacionesTotales.agrupacion\"\n      },\n      \"captDataArray\": {\n        \"$push\": {\n          \"fechaProceso\": \"$captacionesBdv.captacionesTotales.fechaProceso\",\n          \"fecha_valor\": \"$captacionesBdv.captacionesTotales.fecha_odate\",\n          \"actual\": \"$captacionesBdv.captacionesTotales.actual\",\n          \"anterior\": \"$captacionesBdv.captacionesTotales.anterior\",\n          \"netoActual\": \"$captacionesBdv.captacionesTotales.netoActual\",\n          \"totalCaptacionesDic\": \"$captacionesBdv.captacionesTotales.totalCaptacionesDic\",\n          \"mensual\": \"$captacionesBdv.captacionesTotales.mensual\",\n          \"tasaDolar\": \"$captacionesBdv.captacionesTotales.tasaDolar\",\n          \"varMensual\": \"$captacionesBdv.captacionesTotales.varMensual\",\n          \"varAnual\": \"$captacionesBdv.captacionesTotales.varAnual\",\n          \"creAnual\": \"$captacionesBdv.captacionesTotales.creAnual\"\n        }\n      }\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$captDataArray\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$captDataArray\"\n    }\n  },\n  {\n    \"$facet\": {\n      \"resultados\": [\n        {\n          \"$match\": {\n            \"fecha_valor\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ],\n      \"resultadoNulo\": [\n        {\n          \"$match\": {\n            \"mensual\": {\n              \"$eq\": null\n            }\n          }\n        },\n        {\n          \"$sort\": {\n            \"fecha_valor\": -1\n          }\n        },\n        {\n          \"$project\": {\n            \"fechaProceso\": 1,\n            \"fecha_valor\": 1,\n            \"actual\": 1,\n            \"tasaDolar\": 1\n          }\n        }\n      ]\n    }\n  },\n  {\n    \"$addFields\": {\n      \"actualNulo\": {\n        \"$slice\": [\n          \"$resultadoNulo\",\n          1\n        ]\n      },\n      \"resultadoNulo\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$resultados\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"resultados.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$resultados.fechaProceso\",\n              {\n                \"$arrayElemAt\": [\n                  \"$actualNulo.fechaProceso\",\n                  0\n                ]\n              }\n            ]\n          },\n          {\n            \"$arrayElemAt\": [\n              \"$actualNulo.actual\",\n              0\n            ]\n          },\n          \"$resultados.mensual\"\n        ]\n      },\n      \"actualNulo\": \"$$REMOVE\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$resultados\"\n    }\n  },\n  {\n    \"$project\": {\n      \"fechaProceso\": 1,\n      \"fecha_valor\": 1,\n      \"captaciones.libreConv\": {\n        \"actual\": \"$actual\",\n        \"anterior\": \"$anterior\",\n        \"netoActual\": \"$netoActual\",\n        \"mensual\": \"$mensual\",\n        \"varMensual\": \"$varMensual\",\n        \"varAnual\": \"$varAnual\",\n        \"creAnual\": \"$creAnual\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\",\n      \"localField\": \"fecha_valor\",\n      \"foreignField\": \"fecha_valor\",\n      \"as\": \"result\"\n    }\n  },\n  {\n    \"$unwind\": {\n      \"path\": \"$result\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"result.captaciones.libreConv\": \"$captaciones.libreConv\"\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$result\"\n    }\n  },\n  {\n    \"$project\": {\n      \"_id\": 0,\n      \"captacionesBs\": 0,\n      \"cobranzaMora\": 0,\n      \"cobranzaMoraUVC\": 0,\n      \"liquidaciones\": 0,\n      \"liquidacionesUVC\": 0,\n      \"cobranzaMoraBs\": 0,\n      \"cobranzaMoraUVCBs\": 0,\n      \"liquidacionesBs\": 0,\n      \"liquidacionesUVCBs\": 0,\n      \"carteraCredito\": 0,\n      \"carteraCreditoBs\": 0,\n      \"ingresosComisiones\": 0,\n      \"ingresosComisionesBs\": 0,\n      \"ingresosCartera\": 0,\n      \"ingresosCarteraBs\": 0\n    }\n  },\n  {\n    \"$merge\": {\n      \"into\": \"Balancemetric\",\n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "56bb00f1-71c8-40b8-8abd-5be14b45dd5d",
        "name": "CaptacionesLibreConvVersionFinalUsd1",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1340,
          8680
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"captaciones.sinConv20.actual\": {\n        \"$subtract\": [\n          \"$captaciones.total.actual\", \"$captaciones.conv20.actual\"\n        ]\n      }, \n      \"captaciones.sinConv20.anterior\": {\n        \"$subtract\": [\n          \"$captaciones.total.anterior\", \"$captaciones.conv20.anterior\"\n        ]\n      }, \n      \"captaciones.sinConv20.netoActual\": {\n        \"$subtract\": [\n          \"$captaciones.total.netoActual\", \"$captaciones.conv20.netoActual\"\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captacionesBs\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0\n    }\n  }, {\n    \"$facet\": {\n      \"corteMes\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$fecha_valor\", \"$fechaProceso\"\n              ]\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"captaciones.sinConv20.mensual\": \"$captaciones.sinConv20.actual\"\n          }\n        }, {\n          \"$project\": {\n            \"captaciones.sinConv20.mensual\": 1, \n            \"fechaProceso\": 1\n          }\n        }\n      ], \n      \"data\": []\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinConv20.corteMes\": \"$corteMes\", \n      \"corteMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinConv20.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captaciones.sinConv20.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$fecha.fechaProceso\", \"$data.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }, \n      \"data.captaciones.sinConv20.captacionesDic\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captaciones.sinConv20.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$$fecha.fechaProceso\"\n                      }, 12\n                    ]\n                  }, {\n                    \"$ne\": [\n                      {\n                        \"$year\": \"$data.fechaProces\"\n                      }, {\n                        \"$year\": \"$$fecha.fechaProceso\"\n                      }\n                    ]\n                  }\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinConv20.mensual\": \"$data.captaciones.sinConv20.mensual.captaciones.sinConv20.mensual\", \n      \"data.captaciones.sinConv20.corteMes\": \"$$REMOVE\", \n      \"data.captaciones.sinConv20.captacionesDic\": \"$data.captaciones.sinConv20.captacionesDic.captaciones.sinConv20.mensual\", \n      \"data.captaciones.sinConv20.varMensual\": {\n        \"$subtract\": [\n          \"$data.captaciones.sinConv20.actual\", \"$data.captaciones.sinConv20.anterior\"\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinConv20.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$subtract\": [\n              \"$data.captaciones.sinConv20.actual\", \"$data.captaciones.sinConv20.captacionesDic\"\n            ]\n          }, 0\n        ]\n      }, \n      \"data.captaciones.sinConv20.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$data.captaciones.sinConv20.actual\", \"$data.captaciones.sinConv20.captacionesDic\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$data.captaciones.sinConv20.captacionesDic\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$facet\": {\n      \"data\": [\n        {\n          \"$match\": {\n            \"data.captaciones.sinConv20.actual\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ], \n      \"dataNotNull\": [\n        {\n          \"$match\": {\n            \"data.captaciones.sinConv20.actual\": {\n              \"$ne\": null\n            }\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$data.fechaProceso\", \n              \"fechaValor\": \"$data.fecha_valor\"\n            }, \n            \"maxFechaValor\": {\n              \"$max\": \"$data.fecha_valor\"\n            }, \n            \"maxMensual\": {\n              \"$max\": \"$data.captaciones.sinConv20.actual\"\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"_id.fechaValor\": -1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"ultimoActual\": {\n        \"$slice\": [\n          \"$dataNotNull\", 1\n        ]\n      }, \n      \"dataNotNull\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$ultimoActual\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.data.captaciones.sinConv20.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$data.data.fechaProceso\", \"$ultimoActual._id.fechaProceso\"\n            ]\n          }, \"$ultimoActual.maxMensual\", \"$data.data.captaciones.sinConv20.mensual\"\n        ]\n      }, \n      \"ultimoActual\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$data.data\"\n    }\n  }, {\n    \"$project\": {\n      \"mensualAnt\": 0\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "086dbe86-4383-4c3b-8039-d2de6f881c2c",
        "name": "CaptacionesSinConv20VersionFinalUsd",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2280,
          8440
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"captacionesBs.sinDivisa.actual\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.actual\", {\n            \"$add\": [\n              \"$captacionesBs.conv20.actual\", \"$captacionesBs.libreConv.actual\"\n            ]\n          }\n        ]\n      }, \n      \"captacionesBs.sinDivisa.anterior\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.anterior\", {\n            \"$add\": [\n              \"$captacionesBs.conv20.anterior\", \"$captacionesBs.libreConv.anterior\"\n            ]\n          }\n        ]\n      }, \n      \"captacionesBs.sinDivisa.netoActual\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.netoActual\", {\n            \"$add\": [\n              \"$captacionesBs.conv20.netoActual\", \"$captacionesBs.libreConv.netoActual\"\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captaciones\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0\n    }\n  }, {\n    \"$facet\": {\n      \"corteMes\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$fecha_valor\", \"$fechaProceso\"\n              ]\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"captacionesBs.sinDivisa.mensual\": \"$captacionesBs.sinDivisa.actual\"\n          }\n        }, {\n          \"$project\": {\n            \"captacionesBs.sinDivisa.mensual\": 1, \n            \"fechaProceso\": 1\n          }\n        }\n      ], \n      \"data\": []\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinDivisa.corteMes\": \"$corteMes\", \n      \"corteMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinDivisa.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captacionesBs.sinDivisa.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$fecha.fechaProceso\", \"$data.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }, \n      \"data.captacionesBs.sinDivisa.captacionesDic\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captacionesBs.sinDivisa.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$$fecha.fechaProceso\"\n                      }, 12\n                    ]\n                  }, {\n                    \"$ne\": [\n                      {\n                        \"$year\": \"$data.fechaProces\"\n                      }, {\n                        \"$year\": \"$$fecha.fechaProceso\"\n                      }\n                    ]\n                  }\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinDivisa.mensual\": \"$data.captacionesBs.sinDivisa.mensual.captacionesBs.sinDivisa.mensual\", \n      \"data.captacionesBs.sinDivisa.corteMes\": \"$$REMOVE\", \n      \"data.captacionesBs.sinDivisa.captacionesDic\": \"$data.captacionesBs.sinDivisa.captacionesDic.captacionesBs.sinDivisa.mensual\", \n      \"data.captacionesBs.sinDivisa.varMensual\": {\n        \"$subtract\": [\n          \"$data.captacionesBs.sinDivisa.actual\", \"$data.captacionesBs.sinDivisa.anterior\"\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinDivisa.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$subtract\": [\n              \"$data.captacionesBs.sinDivisa.actual\", \"$data.captacionesBs.sinDivisa.captacionesDic\"\n            ]\n          }, 0\n        ]\n      }, \n      \"data.captacionesBs.sinDivisa.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$data.captacionesBs.sinDivisa.actual\", \"$data.captacionesBs.sinDivisa.captacionesDic\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$data.captacionesBs.sinDivisa.captacionesDic\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$facet\": {\n      \"data\": [\n        {\n          \"$match\": {\n            \"data.captacionesBs.sinDivisa.actual\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ], \n      \"dataNotNull\": [\n        {\n          \"$match\": {\n            \"data.captacionesBs.sinDivisa.actual\": {\n              \"$ne\": null\n            }\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$data.fechaProceso\", \n              \"fechaValor\": \"$data.fecha_valor\"\n            }, \n            \"maxFechaValor\": {\n              \"$max\": \"$data.fecha_valor\"\n            }, \n            \"maxMensual\": {\n              \"$max\": \"$data.captacionesBs.sinDivisa.actual\"\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"_id.fechaValor\": -1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"ultimoActual\": {\n        \"$slice\": [\n          \"$dataNotNull\", 1\n        ]\n      }, \n      \"dataNotNull\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$ultimoActual\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.data.captacionesBs.sinDivisa.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$data.data.fechaProceso\", \"$ultimoActual._id.fechaProceso\"\n            ]\n          }, \"$ultimoActual.maxMensual\", \"$data.data.captacionesBs.sinDivisa.mensual\"\n        ]\n      }, \n      \"ultimoActual\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$data.data\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "709095d7-cfbe-4fce-9f13-f5739a34c665",
        "name": "CaptacionesSinDivisaVersionFinalBs",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2100,
          8760
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"captaciones.sinDivisa.actual\": {\n        \"$subtract\": [\n          \"$captaciones.total.actual\", {\n            \"$add\": [\n              \"$captaciones.conv20.actual\", \"$captaciones.libreConv.actual\"\n            ]\n          }\n        ]\n      }, \n      \"captaciones.sinDivisa.anterior\": {\n        \"$subtract\": [\n          \"$captaciones.total.anterior\", {\n            \"$add\": [\n              \"$captaciones.conv20.anterior\", \"$captaciones.libreConv.anterior\"\n            ]\n          }\n        ]\n      }, \n      \"captaciones.sinDivisa.netoActual\": {\n        \"$subtract\": [\n          \"$captaciones.total.netoActual\", {\n            \"$add\": [\n              \"$captaciones.conv20.netoActual\", \"$captaciones.libreConv.netoActual\"\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captacionesBs\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0\n    }\n  }, {\n    \"$facet\": {\n      \"corteMes\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$fecha_valor\", \"$fechaProceso\"\n              ]\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"captaciones.sinDivisa.mensual\": \"$captaciones.sinDivisa.actual\"\n          }\n        }, {\n          \"$project\": {\n            \"captaciones.sinDivisa.mensual\": 1, \n            \"fechaProceso\": 1\n          }\n        }\n      ], \n      \"data\": []\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinDivisa.corteMes\": \"$corteMes\", \n      \"corteMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinDivisa.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captaciones.sinDivisa.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$fecha.fechaProceso\", \"$data.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }, \n      \"data.captaciones.sinDivisa.captacionesDic\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captaciones.sinDivisa.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$$fecha.fechaProceso\"\n                      }, 12\n                    ]\n                  }, {\n                    \"$ne\": [\n                      {\n                        \"$year\": \"$data.fechaProces\"\n                      }, {\n                        \"$year\": \"$$fecha.fechaProceso\"\n                      }\n                    ]\n                  }\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinDivisa.mensual\": \"$data.captaciones.sinDivisa.mensual.captaciones.sinDivisa.mensual\", \n      \"data.captaciones.sinDivisa.corteMes\": \"$$REMOVE\", \n      \"data.captaciones.sinDivisa.captacionesDic\": \"$data.captaciones.sinDivisa.captacionesDic.captaciones.sinDivisa.mensual\", \n      \"data.captaciones.sinDivisa.varMensual\": {\n        \"$subtract\": [\n          \"$data.captaciones.sinDivisa.actual\", \"$data.captaciones.sinDivisa.anterior\"\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinDivisa.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$subtract\": [\n              \"$data.captaciones.sinDivisa.actual\", \"$data.captaciones.sinDivisa.captacionesDic\"\n            ]\n          }, 0\n        ]\n      }, \n      \"data.captaciones.sinDivisa.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$data.captaciones.sinDivisa.actual\", \"$data.captaciones.sinDivisa.captacionesDic\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$data.captaciones.sinDivisa.captacionesDic\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$facet\": {\n      \"data\": [\n        {\n          \"$match\": {\n            \"data.captaciones.sinDivisa.actual\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ], \n      \"dataNotNull\": [\n        {\n          \"$match\": {\n            \"data.captaciones.sinDivisa.actual\": {\n              \"$ne\": null\n            }\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$data.fechaProceso\", \n              \"fechaValor\": \"$data.fecha_valor\"\n            }, \n            \"maxFechaValor\": {\n              \"$max\": \"$data.fecha_valor\"\n            }, \n            \"maxMensual\": {\n              \"$max\": \"$data.captaciones.sinDivisa.actual\"\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"_id.fechaValor\": -1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"ultimoActual\": {\n        \"$slice\": [\n          \"$dataNotNull\", 1\n        ]\n      }, \n      \"dataNotNull\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$ultimoActual\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.data.captaciones.sinDivisa.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$data.data.fechaProceso\", \"$ultimoActual._id.fechaProceso\"\n            ]\n          }, \"$ultimoActual.maxMensual\", \"$data.data.captaciones.sinDivisa.mensual\"\n        ]\n      }, \n      \"ultimoActual\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$data.data\"\n    }\n  }, {\n    \"$project\": {\n      \"mensualAnt\": 0\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "803e2889-d7bf-46b5-ab46-09bac20e2d8b",
        "name": "CaptacionesSinDivisaVersionFinalUsd",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2300,
          8760
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"captacionesBs.sinLibreConv.actual\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.actual\", \"$captacionesBs.libreConv.actual\"\n        ]\n      }, \n      \"captacionesBs.sinLibreConv.anterior\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.anterior\", \"$captacionesBs.libreConv.anterior\"\n        ]\n      }, \n      \"captacionesBs.sinLibreConv.netoActual\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.netoActual\", \"$captacionesBs.libreConv.netoActual\"\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captaciones\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0\n    }\n  }, {\n    \"$facet\": {\n      \"corteMes\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$fecha_valor\", \"$fechaProceso\"\n              ]\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"captacionesBs.sinLibreConv.mensual\": \"$captacionesBs.sinLibreConv.actual\"\n          }\n        }, {\n          \"$project\": {\n            \"captacionesBs.sinLibreConv.mensual\": 1, \n            \"fechaProceso\": 1\n          }\n        }\n      ], \n      \"data\": []\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinLibreConv.corteMes\": \"$corteMes\", \n      \"corteMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinLibreConv.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captacionesBs.sinLibreConv.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$fecha.fechaProceso\", \"$data.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }, \n      \"data.captacionesBs.sinLibreConv.captacionesDic\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captacionesBs.sinLibreConv.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$$fecha.fechaProceso\"\n                      }, 12\n                    ]\n                  }, {\n                    \"$ne\": [\n                      {\n                        \"$year\": \"$data.fechaProces\"\n                      }, {\n                        \"$year\": \"$$fecha.fechaProceso\"\n                      }\n                    ]\n                  }\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinLibreConv.mensual\": \"$data.captacionesBs.sinLibreConv.mensual.captacionesBs.sinLibreConv.mensual\", \n      \"data.captacionesBs.sinLibreConv.corteMes\": \"$$REMOVE\", \n      \"data.captacionesBs.sinLibreConv.captacionesDic\": \"$data.captacionesBs.sinLibreConv.captacionesDic.captacionesBs.sinLibreConv.mensual\", \n      \"data.captacionesBs.sinLibreConv.varMensual\": {\n        \"$subtract\": [\n          \"$data.captacionesBs.sinLibreConv.actual\", \"$data.captacionesBs.sinLibreConv.anterior\"\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinLibreConv.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$subtract\": [\n              \"$data.captacionesBs.sinLibreConv.actual\", \"$data.captacionesBs.sinLibreConv.captacionesDic\"\n            ]\n          }, 0\n        ]\n      }, \n      \"data.captacionesBs.sinLibreConv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$data.captacionesBs.sinLibreConv.actual\", \"$data.captacionesBs.sinLibreConv.captacionesDic\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$data.captacionesBs.sinLibreConv.captacionesDic\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$facet\": {\n      \"data\": [\n        {\n          \"$match\": {\n            \"data.captacionesBs.sinLibreConv.actual\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ], \n      \"dataNotNull\": [\n        {\n          \"$match\": {\n            \"data.captacionesBs.sinLibreConv.actual\": {\n              \"$ne\": null\n            }\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$data.fechaProceso\", \n              \"fechaValor\": \"$data.fecha_valor\"\n            }, \n            \"maxFechaValor\": {\n              \"$max\": \"$data.fecha_valor\"\n            }, \n            \"maxMensual\": {\n              \"$max\": \"$data.captacionesBs.sinLibreConv.actual\"\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"_id.fechaValor\": -1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"ultimoActual\": {\n        \"$slice\": [\n          \"$dataNotNull\", 1\n        ]\n      }, \n      \"dataNotNull\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$ultimoActual\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.data.captacionesBs.sinLibreConv.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$data.data.fechaProceso\", \"$ultimoActual._id.fechaProceso\"\n            ]\n          }, \"$ultimoActual.maxMensual\", \"$data.data.captacionesBs.sinLibreConv.mensual\"\n        ]\n      }, \n      \"ultimoActual\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$data.data\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "d1bd17fd-4ae8-4223-bf43-eab7f938b2e8",
        "name": "CaptacionesSinLibreConvVersionFinalBs",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2100,
          8980
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"captaciones.sinLibreConv.actual\": {\n        \"$subtract\": [\n          \"$captaciones.total.actual\", \"$captaciones.libreConv.actual\"\n        ]\n      }, \n      \"captaciones.sinLibreConv.anterior\": {\n        \"$subtract\": [\n          \"$captaciones.total.anterior\", \"$captaciones.libreConv.anterior\"\n        ]\n      }, \n      \"captaciones.sinLibreConv.netoActual\": {\n        \"$subtract\": [\n          \"$captaciones.total.netoActual\", \"$captaciones.libreConv.netoActual\"\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captacionesBs\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0\n    }\n  }, {\n    \"$facet\": {\n      \"corteMes\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$fecha_valor\", \"$fechaProceso\"\n              ]\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"captaciones.sinLibreConv.mensual\": \"$captaciones.sinLibreConv.actual\"\n          }\n        }, {\n          \"$project\": {\n            \"captaciones.sinLibreConv.mensual\": 1, \n            \"fechaProceso\": 1\n          }\n        }\n      ], \n      \"data\": []\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinLibreConv.corteMes\": \"$corteMes\", \n      \"corteMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinLibreConv.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captaciones.sinLibreConv.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$fecha.fechaProceso\", \"$data.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }, \n      \"data.captaciones.sinLibreConv.captacionesDic\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captaciones.sinLibreConv.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$$fecha.fechaProceso\"\n                      }, 12\n                    ]\n                  }, {\n                    \"$ne\": [\n                      {\n                        \"$year\": \"$data.fechaProces\"\n                      }, {\n                        \"$year\": \"$$fecha.fechaProceso\"\n                      }\n                    ]\n                  }\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinLibreConv.mensual\": \"$data.captaciones.sinLibreConv.mensual.captaciones.sinLibreConv.mensual\", \n      \"data.captaciones.sinLibreConv.corteMes\": \"$$REMOVE\", \n      \"data.captaciones.sinLibreConv.captacionesDic\": \"$data.captaciones.sinLibreConv.captacionesDic.captaciones.sinLibreConv.mensual\", \n      \"data.captaciones.sinLibreConv.varMensual\": {\n        \"$subtract\": [\n          \"$data.captaciones.sinLibreConv.actual\", \"$data.captaciones.sinLibreConv.anterior\"\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captaciones.sinLibreConv.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$subtract\": [\n              \"$data.captaciones.sinLibreConv.actual\", \"$data.captaciones.sinLibreConv.captacionesDic\"\n            ]\n          }, 0\n        ]\n      }, \n      \"data.captaciones.sinLibreConv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$data.captaciones.sinLibreConv.actual\", \"$data.captaciones.sinLibreConv.captacionesDic\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$data.captaciones.sinLibreConv.captacionesDic\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$facet\": {\n      \"data\": [\n        {\n          \"$match\": {\n            \"data.captaciones.sinLibreConv.actual\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ], \n      \"dataNotNull\": [\n        {\n          \"$match\": {\n            \"data.captaciones.sinLibreConv.actual\": {\n              \"$ne\": null\n            }\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$data.fechaProceso\", \n              \"fechaValor\": \"$data.fecha_valor\"\n            }, \n            \"maxFechaValor\": {\n              \"$max\": \"$data.fecha_valor\"\n            }, \n            \"maxMensual\": {\n              \"$max\": \"$data.captaciones.sinLibreConv.actual\"\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"_id.fechaValor\": -1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"ultimoActual\": {\n        \"$slice\": [\n          \"$dataNotNull\", 1\n        ]\n      }, \n      \"dataNotNull\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$ultimoActual\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.data.captaciones.sinLibreConv.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$data.data.fechaProceso\", \"$ultimoActual._id.fechaProceso\"\n            ]\n          }, \"$ultimoActual.maxMensual\", \"$data.data.captaciones.sinLibreConv.mensual\"\n        ]\n      }, \n      \"ultimoActual\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$data.data\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "f8b1ac60-8df0-49c3-892f-9a958419641e",
        "name": "CaptacionesSinLibreConvVersionFinalUsd",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2300,
          8980
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "brm_ajustado",
          "query": "=[\n  {\n    \"$match\": {\n      \"processed\": {\n        \"$exists\": false\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"processed\": false\n    }\n  }, {\n    \"$project\": {\n      \"processed\": 1\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"brm_ajustado\", \n      \"on\": \"_id\", \n      \"whenMatched\": \"merge\"\n    }\n  }\n]\n"
        },
        "id": "ec6d2465-c72d-4604-ba75-9bb39c540a3d",
        "name": "1_marcadoProcesamiento",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -2260,
          7800
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "brm_ajustado",
          "query": "=[\n  {\n    \"$match\": {\n      \"processed\": false\n    }\n  }, {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"dias\": {\n        \"$divide\": [\n          {\n            \"$subtract\": [\n              {\n                \"$dateFromParts\": {\n                  \"year\": {\n                    \"$year\": \"$$NOW\"\n                  }, \n                  \"month\": {\n                    \"$month\": \"$$NOW\"\n                  }, \n                  \"day\": {\n                    \"$dayOfMonth\": \"$$NOW\"\n                  }\n                }\n              }, \"$file_date\"\n            ]\n          }, 86400000\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"dias\": 1\n    }\n  }\n]"
        },
        "id": "b6e52b10-ce14-48b0-879b-465dddb71ecb",
        "name": "2_procesadosDias",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -1880,
          7800
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "brm_ajustado",
          "query": "=[\n  {\n    \"$match\": {\n      \"processed\": false\n    }\n  }, {\n    \"$addFields\": {\n      \"fecha_odate\": \"$file_date\", \n      \"fecha_odateAnt\": \"$fecha_odate\", \n      \"updatedAt\": {\n        \"$dateFromParts\": {\n          \"year\": {\n            \"$year\": \"$$NOW\"\n          }, \n          \"month\": {\n            \"$month\": \"$$NOW\"\n          }, \n          \"day\": {\n            \"$dayOfMonth\": \"$$NOW\"\n          }\n        }\n      }, \n      \"fechaProceso\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$file_date\"\n              }, \n              \"month\": {\n                \"$sum\": [\n                  1, {\n                    \"$month\": \"$file_date\"\n                  }\n                ]\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"debe\": {\n        \"$round\": [\n          \"$debe\", 4\n        ]\n      }, \n      \"haber\": {\n        \"$round\": [\n          \"$haber\", 4\n        ]\n      }, \n      \"sal_net_act\": {\n        \"$round\": [\n          \"$sal_net_act\", 4\n        ]\n      }, \n      \"sal_ant\": {\n        \"$round\": [\n          \"$sal_ant\", 4\n        ]\n      }, \n      \"sal_act\": {\n        \"$round\": [\n          \"$sal_act\", 4\n        ]\n      }, \n      \"processed\": \"$$REMOVE\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_brm_ajustado\", \n      \"on\": \"_id\"\n    }\n  }\n]"
        },
        "id": "fd58d80f-3d6f-4175-83a2-16c631979ebd",
        "name": "3_FormateoBrmAjustado_SidisBrmAjustado",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -2080,
          8000
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "brm_ajustado",
          "query": "=[\n  {\n    \"$match\": {\n      \"processed\": false\n    }\n  }, {\n    \"$addFields\": {\n      \"processed\": true\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"brm_ajustado\", \n      \"on\": \"_id\"\n    }\n  }\n]"
        },
        "id": "0aaf9e7a-a419-4c23-9c37-b06707479012",
        "name": "4_marcadoProcesados",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -1880,
          8000
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "=append",
          "mergeByFields": {
            "values": [
              {}
            ]
          },
          "options": {}
        },
        "id": "afbfc44e-d550-4a4e-863b-e5e559ac7771",
        "name": "Merge8",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          -1280,
          7680
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/VentanaCalculosBalancemetric_TK32",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "dcbc6b36-6264-4821-b7c3-c662bb098212",
        "name": "HTTP Request1",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          780,
          6780
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/Balancemetric_TK32_IngresosComision",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "75273786-14d4-46c7-8492-7bba0b5df49f",
        "name": "HTTP Request2",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          760,
          7800
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/Balancemetric_TK32_Captaciones",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "5deec027-a268-406d-80c1-e565252fa04a",
        "name": "HTTP Request3",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          820,
          8680
        ]
      },
      {
        "parameters": {
          "functionCode": " // Inicializa un objeto con la estructura deseada\nlet offSet = 1;\n\n// Si la variable 'dias' existe en la entrada\nif ($json.dias !== undefined) {\n  // ObtÃ©n el valor de la variable 'dias' desde la entrada\n  const dias = $json.dias;\n\n  // Verifica si 'dias' es nulo, 0 o vacÃ­o\n  if (dias === null || dias === 0 || dias === \"\") {\n    offSet = 1; // Modifica el valor de \"offSet\" a 1\n  } else if (Number.isInteger(dias) && dias >= 1) {\n    offSet =  dias; // Modifica el valor de \"offSet\" si 'dias' es vÃ¡lido\n  }\n}\n\nconst jsonOutput = {\n  offSet: offSet // Nombre del campo y valor deseado\n};\nreturn jsonOutput;"
        },
        "name": "FunctionItem",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          -1680,
          7800
        ],
        "id": "3b5d72e3-4538-4ba8-9531-e5003236f2bf",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "VentanaCalculosBalancemetric_TK32",
          "options": {}
        },
        "id": "42935166-d1c0-42ed-abff-4adcfeaefe42",
        "name": "Webhook1",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          1000,
          6780
        ],
        "webhookId": "f838e5be-b88e-47f4-9d7d-8eeeae4f3803"
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n {\n \"$addFields\": {\n \"fechaOffset\": {\n \"$subtract\": [\n {\n \"$toDate\": {\n \"$dateFromString\": {\n \"dateString\": {\n \"$dateToString\": {\n \"format\": \"%Y-%m-%dT00:00:00%z\",\n \"date\": {\n \"$toDate\": \"$$NOW\"\n }\n }\n }\n }\n }\n },\n {\n \"$multiply\": [\n {\n \"$toInt\": {\n                  \"$cond\":[\n                    {\"$eq\":[\"{{$json.offSet}}\",\"1\"]},\"2\",\"{{$json.offSet}}\"\n                  ]\n                }\n },\n 86400000\n ]\n }\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"fecha_odate_mes_anterior\": {\n \"$dateFromString\": {\n \"dateString\": {\n \"$dateToString\": {\n \"date\": {\n \"$subtract\": [\n {\n \"$toDate\": \"$fecha_odate\"\n },\n 2592000000\n ]\n },\n \"format\": \"%Y-%m-01\"\n }\n }\n }\n },\n \"fechaOffsetEnd\": {\n \"$add\": [\n {\n \"$toDate\": {\n \"$dateFromString\": {\n \"dateString\": {\n \"$dateToString\": {\n \"format\": \"%Y-%m-%dT00:00:00%z\",\n \"date\": {\n \"$toDate\": \"$fechaOffset\"\n }\n }\n }\n }\n }\n },\n {\n \"$multiply\": [\n {\n \"$toInt\": \"1\"\n },\n 86400000\n ]\n }\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"fechaProcesoAnt\": {\n \"$dateFromParts\": {\n \"year\": {\n \"$year\": \"$fecha_odate_mes_anterior\"\n },\n \"month\": {\n \"$add\": [\n {\n \"$month\": \"$fecha_odate_mes_anterior\"\n },\n 1\n ]\n },\n \"day\": {\n \"$subtract\": [\n {\n \"$dayOfMonth\": {\n \"$dateFromParts\": {\n \"year\": {\n \"$year\": \"$fecha_odate_mes_anterior\"\n },\n \"month\": {\n \"$add\": [\n {\n \"$month\": \"$fecha_odate_mes_anterior\"\n },\n 1\n ]\n },\n \"day\": 1\n }\n }\n },\n 1\n ]\n },\n \"hour\": 0,\n \"minute\": 0,\n \"second\": 0,\n \"millisecond\": 0\n }\n }\n }\n },\n {\n \"$match\": {\n \"$and\": [\n {\n \"$expr\": {\n \"$gt\": [\"$fecha_odate\", \"$fechaOffset\"]\n }\n },\n {\n \"$expr\": {\n \"$lte\": [\"$fecha_odate\", \"$fechaOffsetEnd\"]\n }\n },\n {\n \"nucta\": {\n \"$in\": [\"211\", \"214\", \"215\", \"212\", \"21103\", \"21105\"]\n }\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"file_date\": \"$$REMOVE\",\n \"prod_alt\": \"$$REMOVE\",\n \"rel_linea\": \"$$REMOVE\",\n \"sub_prod_alt\": \"$$REMOVE\",\n \"desc_nucta\": \"$$REMOVE\",\n \"_id\": \"$$REMOVE\",\n \"sal_act\": {\n \"$multiply\": [\"$sal_act\", -1]\n },\n \"sal_ant\": {\n \"$multiply\": [\"$sal_ant\", -1]\n }\n }\n },\n {\n \"$lookup\": {\n \"from\": \"Balancemetric\",\n \"localField\": \"fecha_odate\",\n \"foreignField\": \"fecha_valor\",\n \"as\": \"result\"\n }\n },\n {\n \"$addFields\": {\n \"data.captacionesBs\": {\n \"$arrayElemAt\": [\"$result.captacionesBs\", 0]\n },\n \"data.captaciones\": {\n \"$arrayElemAt\": [\"$result.captaciones\", 0]\n },\n \"result\": \"$$REMOVE\"\n }\n },\n {\n \"$lookup\": {\n \"from\": \"sidis_tasaconversion\",\n \"localField\": \"fecha_odate\",\n \"foreignField\": \"Fecha\",\n \"as\": \"resultTasa\"\n }\n },\n {\n \"$lookup\": {\n \"from\": \"sidis_tasaconversion\",\n \"localField\": \"fechaProcesoAnt\",\n \"foreignField\": \"Fecha\",\n \"as\": \"resultTasaAnt\"\n }\n },\n {\n \"$addFields\": {\n \"tasaDolar\": {\n \"$arrayElemAt\": [\"$resultTasa.Tasa_DOL\", 0]\n },\n \"tasaDolarAnt\": {\n \"$arrayElemAt\": [\"$resultTasaAnt.Tasa_DOL\", 0]\n },\n \"resultTasa\": \"$$REMOVE\",\n \"resultTasaAnt\": \"$$REMOVE\",\n \"data.captacionesBs.saldoProd\": \"$$REMOVE\",\n \"data.captaciones.saldoProd\": \"$$REMOVE\"\n }\n },\n {\n \"$facet\": {\n \"vista\": [\n {\n \"$match\": {\n \"nucta\": \"211\",\n \"$and\": [\n {\n \"$expr\": {\n \"$gt\": [\n \"$fecha_odate\",\n {\n \"$toDate\": \"$fechaOffSet\"\n }\n ]\n }\n },\n {\n \"$expr\": {\n \"$lte\": [\n \"$fecha_odate\",\n {\n \"$toDate\": \"$fechaOffsetEnd\"\n }\n ]\n }\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"anteriorBs\": \"$sal_ant\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n },\n \"anteriorUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_ant\", \"$tasaDolarAnt\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"anteriorBs\": 1,\n \"actualUsd\": 1,\n \"anteriorUsd\": 1,\n \"tasaDolar\": 1,\n \"data\": 1\n }\n },\n {\n \"$addFields\": {\n \"data.captacionesBs.saldoProd.vista.actual\": {\n \"$subtract\": [\n \"$actualBs\",\n {\n \"$add\": [\n \"$data.captacionesBs.conv20.actual\",\n \"$data.captacionesBs.libreConv.actual\"\n ]\n }\n ]\n },\n \"data.captacionesBs.saldoProd.vista.anterior\": {\n \"$subtract\": [\n \"$anteriorBs\",\n {\n \"$add\": [\n \"$data.captacionesBs.conv20.anterior\",\n \"$data.captacionesBs.libreConv.anterior\"\n ]\n }\n ]\n },\n \"data.captacionesBs.saldoProd.vista.varMensual\": {\n \"$subtract\": [\n {\n \"$subtract\": [\n \"$actualBs\",\n {\n \"$add\": [\n \"$data.captacionesBs.conv20.actual\",\n \"$data.captacionesBs.libreConv.actual\"\n ]\n }\n ]\n },\n {\n \"$subtract\": [\n \"$anteriorBs\",\n {\n \"$add\": [\n \"$data.captacionesBs.conv20.anterior\",\n \"$data.captacionesBs.libreConv.anterior\"\n ]\n }\n ]\n }\n ]\n },\n \"data.captaciones.saldoProd.vista.actual\": {\n \"$subtract\": [\n \"$actualUsd\",\n {\n \"$add\": [\n \"$data.captaciones.conv20.actual\",\n \"$data.captaciones.libreConv.actual\"\n ]\n }\n ]\n },\n \"data.captaciones.saldoProd.vista.anterior\": {\n \"$subtract\": [\n \"$anteriorUsd\",\n {\n \"$add\": [\n \"$data.captaciones.conv20.anterior\",\n \"$data.captaciones.libreConv.anterior\"\n ]\n }\n ]\n },\n \"data.captaciones.saldoProd.vista.varMensual\": {\n \"$subtract\": [\n {\n \"$subtract\": [\n \"$actualUsd\",\n {\n \"$add\": [\n \"$data.captaciones.conv20.actual\",\n \"$data.captaciones.libreConv.actual\"\n ]\n }\n ]\n },\n {\n \"$subtract\": [\n \"$anteriorUsd\",\n {\n \"$add\": [\n \"$data.captaciones.conv20.anterior\",\n \"$data.captaciones.libreConv.anterior\"\n ]\n }\n ]\n }\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$$REMOVE\",\n \"anteriorBs\": \"$$REMOVE\",\n \"actualUsd\": \"$$REMOVE\",\n \"anteriorUsd\": \"$$REMOVE\",\n \"tasaDolar\": \"$$REMOVE\"\n }\n }\n ],\n \"ahorro\": [\n {\n \"$match\": {\n \"nucta\": \"214\",\n \"$and\": [\n {\n \"$expr\": {\n \"$gt\": [\n \"$fecha_odate\",\n {\n \"$toDate\": \"$fechaOffSet\"\n }\n ]\n }\n },\n {\n \"$expr\": {\n \"$lte\": [\n \"$fecha_odate\",\n {\n \"$toDate\": \"$fechaOffsetEnd\"\n }\n ]\n }\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"anteriorBs\": \"$sal_ant\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n },\n \"anteriorUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_ant\", \"$tasaDolarAnt\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"anteriorBs\": 1,\n \"actualUsd\": 1,\n \"anteriorUsd\": 1,\n \"tasaDolar\": 1,\n \"data\": 1\n }\n },\n {\n \"$addFields\": {\n \"data.captacionesBs.saldoProd.ahorro.actual\": \"$actualBs\",\n \"data.captacionesBs.saldoProd.ahorro.anterior\": \"$anteriorBs\",\n \"data.captacionesBs.saldoProd.ahorro.varMensual\": {\n \"$subtract\": [\"$actualBs\", \"$anteriorBs\"]\n },\n \"data.captaciones.saldoProd.ahorro.actual\": \"$actualUsd\",\n \"data.captaciones.saldoProd.ahorro.anterior\": \"$anteriorUsd\",\n \"data.captaciones.saldoProd.ahorro.varMensual\": {\n \"$subtract\": [\"$actualUsd\", \"$anteriorUsd\"]\n }\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$$REMOVE\",\n \"anteriorBs\": \"$$REMOVE\",\n \"actualUsd\": \"$$REMOVE\",\n \"anteriorUsd\": \"$$REMOVE\",\n \"tasaDolar\": \"$$REMOVE\"\n }\n }\n ],\n \"plazo\": [\n {\n \"$match\": {\n \"nucta\": \"215\",\n \"$and\": [\n {\n \"$expr\": {\n \"$gt\": [\n \"$fecha_odate\",\n {\n \"$toDate\": \"$fechaOffSet\"\n }\n ]\n }\n },\n {\n \"$expr\": {\n \"$lte\": [\n \"$fecha_odate\",\n {\n \"$toDate\": \"$fechaOffsetEnd\"\n }\n ]\n }\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"anteriorBs\": \"$sal_ant\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n },\n \"anteriorUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_ant\", \"$tasaDolarAnt\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"anteriorBs\": 1,\n \"actualUsd\": 1,\n \"anteriorUsd\": 1,\n \"tasaDolar\": 1,\n \"data\": 1\n }\n },\n {\n \"$addFields\": {\n \"data.captacionesBs.saldoProd.plazo.actual\": \"$actualBs\",\n \"data.captacionesBs.saldoProd.plazo.anterior\": \"$anteriorBs\",\n \"data.captacionesBs.saldoProd.plazo.varMensual\": {\n \"$subtract\": [\"$actualBs\", \"$anteriorBs\"]\n },\n \"data.captaciones.saldoProd.plazo.actual\": \"$actualUsd\",\n \"data.captaciones.saldoProd.plazo.anterior\": \"$anteriorUsd\",\n \"data.captaciones.saldoProd.plazo.varMensual\": {\n \"$subtract\": [\"$actualBs\", \"$anteriorBs\"]\n }\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$$REMOVE\",\n \"anteriorBs\": \"$$REMOVE\",\n \"actualUsd\": \"$$REMOVE\",\n \"anteriorUsd\": \"$$REMOVE\",\n \"tasaDolar\": \"$$REMOVE\"\n }\n }\n ],\n \"otros\": [\n {\n \"$match\": {\n \"nucta\": \"212\",\n \"$and\": [\n {\n \"$expr\": {\n \"$gt\": [\n \"$fecha_odate\",\n {\n \"$toDate\": \"$fechaOffSet\"\n }\n ]\n }\n },\n {\n \"$expr\": {\n \"$lte\": [\n \"$fecha_odate\",\n {\n \"$toDate\": \"$fechaOffsetEnd\"\n }\n ]\n }\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"anteriorBs\": \"$sal_ant\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n },\n \"anteriorUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_ant\", \"$tasaDolarAnt\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"anteriorBs\": 1,\n \"actualUsd\": 1,\n \"anteriorUsd\": 1,\n \"tasaDolar\": 1,\n \"data\": 1\n }\n },\n {\n \"$addFields\": {\n \"data.captacionesBs.saldoProd.otros.actual\": \"$actualBs\",\n \"data.captacionesBs.saldoProd.otros.anterior\": \"$anteriorBs\",\n \"data.captacionesBs.saldoProd.otros.varMensual\": {\n \"$subtract\": [\"$actualBs\", \"$anteriorBs\"]\n },\n \"data.captaciones.saldoProd.otros.actual\": \"$actualUsd\",\n \"data.captaciones.saldoProd.otros.anterior\": \"$anteriorUsd\",\n \"data.captaciones.saldoProd.otros.varMensual\": {\n \"$subtract\": [\"$actualUsd\", \"$anteriorUsd\"]\n }\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$$REMOVE\",\n \"anteriorBs\": \"$$REMOVE\",\n \"actualUsd\": \"$$REMOVE\",\n \"anteriorUsd\": \"$$REMOVE\",\n \"tasaDolar\": \"$$REMOVE\"\n }\n }\n ],\n \"vistaTotalMes\": [\n {\n \"$match\": {\n \"$and\": [\n {\n \"$expr\": {\n \"$eq\": [\"$fecha_odate\", \"$fechaProceso\"]\n }\n },\n {\n \"nucta\": \"211\"\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": {\n \"$subtract\": [\n \"$actualBs\",\n {\n \"$add\": [\n \"$data.captacionesBs.conv20.actual\",\n \"$data.captacionesBs.libreConv.actual\"\n ]\n }\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n }\n ],\n \"vistaNulo\": [\n {\n \"$match\": {\n \"mensual\": {\n \"$eq\": null\n },\n \"nucta\": \"211\"\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": {\n \"$subtract\": [\n \"$actualBs\",\n {\n \"$add\": [\n \"$data.captacionesBs.conv20.actual\",\n \"$data.captacionesBs.libreConv.actual\"\n ]\n }\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n }\n ],\n \"ahorroTotalMes\": [\n {\n \"$match\": {\n \"$and\": [\n {\n \"$expr\": {\n \"$eq\": [\"$fecha_odate\", \"$fechaProceso\"]\n }\n },\n {\n \"nucta\": \"214\"\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n }\n ],\n \"ahorroNulo\": [\n {\n \"$match\": {\n \"mensual\": {\n \"$eq\": null\n },\n \"nucta\": \"214\"\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n }\n ],\n \"plazoTotalMes\": [\n {\n \"$match\": {\n \"$and\": [\n {\n \"$expr\": {\n \"$eq\": [\"$fecha_odate\", \"$fechaProceso\"]\n }\n },\n {\n \"nucta\": \"215\"\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n }\n ],\n \"plazoNulo\": [\n {\n \"$match\": {\n \"mensual\": {\n \"$eq\": null\n },\n \"nucta\": \"215\"\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n }\n ],\n \"otrosTotalMes\": [\n {\n \"$match\": {\n \"$and\": [\n {\n \"$expr\": {\n \"$eq\": [\"$fecha_odate\", \"$fechaProceso\"]\n }\n },\n {\n \"nucta\": \"212\"\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n }\n ],\n \"otrosNulo\": [\n {\n \"$match\": {\n \"mensual\": {\n \"$eq\": null\n },\n \"nucta\": \"212\"\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n }\n ],\n \"conv20TotalMes\": [\n {\n \"$match\": {\n \"$and\": [\n {\n \"$expr\": {\n \"$eq\": [\"$fecha_odate\", \"$fechaProceso\"]\n }\n },\n {\n \"nucta\": \"21103\"\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n }\n ],\n \"conv20Nulo\": [\n {\n \"$match\": {\n \"mensual\": {\n \"$eq\": null\n },\n \"nucta\": \"21103\"\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n }\n ],\n \"libreConvTotalMes\": [\n {\n \"$match\": {\n \"$and\": [\n {\n \"$expr\": {\n \"$eq\": [\"$fecha_odate\", \"$fechaProceso\"]\n }\n },\n {\n \"nucta\": \"21105\"\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n }\n ],\n \"libreConvNulo\": [\n {\n \"$match\": {\n \"mensual\": {\n \"$eq\": null\n },\n \"nucta\": \"21105\"\n }\n },\n {\n \"$sort\": {\n \"fecha_odate\": -1\n }\n },\n {\n \"$addFields\": {\n \"actualBs\": \"$sal_act\",\n \"actualUsd\": {\n \"$round\": [\n {\n \"$divide\": [\"$sal_act\", \"$tasaDolar\"]\n },\n 4\n ]\n }\n }\n },\n {\n \"$project\": {\n \"fecha_odate\": 1,\n \"fechaProceso\": 1,\n \"actualBs\": 1,\n \"actualUsd\": 1,\n \"tasaDolar\": 1\n }\n }\n ]\n }\n },\n {\n \"$addFields\": {\n \"vistaMes\": {\n \"$filter\": {\n \"input\": \"$vistaTotalMes\",\n \"as\": \"fecha\",\n \"cond\": {\n \"$and\": [\n {\n \"$eq\": [\n \"$$fecha.fecha_odate\",\n {\n \"$toDate\": \"$fecha\"\n }\n ]\n }\n ]\n }\n }\n },\n \"vistaElemento\": {\n \"$arrayElemAt\": [\n \"$vista\",\n {\n \"$subtract\": [\n {\n \"$size\": \"$vista\"\n },\n 1\n ]\n }\n ]\n },\n \"ahorroMes\": {\n \"$filter\": {\n \"input\": \"$ahorroTotalMes\",\n \"as\": \"fecha\",\n \"cond\": {\n \"$and\": [\n {\n \"$eq\": [\n \"$ahorro.fechaProceso\",\n {\n \"$toDate\": \"$fecha\"\n }\n ]\n }\n ]\n }\n }\n },\n \"ahorroElemento\": {\n \"$arrayElemAt\": [\n \"$ahorro\",\n {\n \"$subtract\": [\n {\n \"$size\": \"$ahorro\"\n },\n 1\n ]\n }\n ]\n },\n \"plazoMes\": {\n \"$filter\": {\n \"input\": \"$plazoTotalMes\",\n \"as\": \"fecha\",\n \"cond\": {\n \"$and\": [\n {\n \"$eq\": [\n \"$plazo.fechaProceso\",\n {\n \"$toDate\": \"$fecha\"\n }\n ]\n }\n ]\n }\n }\n },\n \"plazoElemento\": {\n \"$arrayElemAt\": [\n \"$plazo\",\n {\n \"$subtract\": [\n {\n \"$size\": \"$plazo\"\n },\n 1\n ]\n }\n ]\n },\n \"otrosMes\": {\n \"$filter\": {\n \"input\": \"$otrosTotalMes\",\n \"as\": \"fecha\",\n \"cond\": {\n \"$and\": [\n {\n \"$eq\": [\n \"$otros.fechaProceso\",\n {\n \"$toDate\": \"$fecha\"\n }\n ]\n }\n ]\n }\n }\n },\n \"otrosElemento\": {\n \"$arrayElemAt\": [\n \"$otros\",\n {\n \"$subtract\": [\n {\n \"$size\": \"$otros\"\n },\n 1\n ]\n }\n ]\n }\n }\n },\n {\n \"$unwind\": {\n \"path\": \"$vista\"\n }\n },\n {\n \"$addFields\": {\n \"vistaMes\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$vistaMes\"\n },\n false\n ]\n },\n \"$vistaElemento\",\n \"$vistaTotalMes\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"vistaTotalMes\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$size\": \"$vistaMes\"\n },\n 0\n ]\n },\n \"$vistaElemento\",\n \"$vistaTotalMes\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"vista.data.captacionesBs.saldoProd.vista.mensual\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$vistaMes\"\n },\n true\n ]\n },\n {\n \"$arrayElemAt\": [\"$vistaMes.actualBs\", 0]\n },\n \"$vistaMes.data.captacionesBs.saldoProd.vista.actual\"\n ]\n },\n \"vista.data.captaciones.saldoProd.vista.mensual\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$vistaMes\"\n },\n true\n ]\n },\n {\n \"$arrayElemAt\": [\"$vistaMes.actualUsd\", 0]\n },\n \"$vistaMes.data.captaciones.saldoProd.vista.actual\"\n ]\n }\n }\n },\n {\n \"$group\": {\n \"_id\": {\n \"fechaProceso\": \"$vista.fechaProceso\"\n },\n \"vista\": {\n \"$push\": {\n \"data\": \"$vista.data\",\n \"fechaProceso\": \"$vista.fechaProceso\",\n \"fecha_odate\": \"$vista.fecha_odate\"\n }\n },\n \"ahorro\": {\n \"$first\": \"$ahorro\"\n },\n \"plazo\": {\n \"$first\": \"$plazo\"\n },\n \"otros\": {\n \"$first\": \"$otros\"\n },\n \"ahorroTotalMes\": {\n \"$first\": \"$ahorroTotalMes\"\n },\n \"ahorroNulo\": {\n \"$first\": \"$ahorroNulo\"\n },\n \"plazoTotalMes\": {\n \"$first\": \"$plazoTotalMes\"\n },\n \"plazoNulo\": {\n \"$first\": \"$plazoNulo\"\n },\n \"otrosTotalMes\": {\n \"$first\": \"$otrosTotalMes\"\n },\n \"otrosNulo\": {\n \"$first\": \"$otrosNulo\"\n },\n \"conv20TotalMes\": {\n \"$first\": \"$conv20TotalMes\"\n },\n \"conv20Nulo\": {\n \"$first\": \"$conv20Nulo\"\n },\n \"libreConvTotalMes\": {\n \"$first\": \"$libreConvTotalMes\"\n },\n \"libreConvNulo\": {\n \"$first\": \"$libreConvNulo\"\n },\n \"ahorroMes\": {\n \"$first\": \"$ahorroMes\"\n },\n \"ahorroElemento\": {\n \"$first\": \"$ahorroElemento\"\n },\n \"plazoMes\": {\n \"$first\": \"$plazoMes\"\n },\n \"plazoElemento\": {\n \"$first\": \"$plazoElemento\"\n },\n \"otrosMes\": {\n \"$first\": \"$otrosMes\"\n },\n \"otrosElemento\": {\n \"$first\": \"$otrosElemento\"\n }\n }\n },\n {\n \"$unwind\": {\n \"path\": \"$ahorro\"\n }\n },\n {\n \"$addFields\": {\n \"ahorroMes\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$ahorroMes\"\n },\n false\n ]\n },\n \"$ahorroElemento\",\n \"$ahorroTotalMes\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"ahorroTotalMes\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$size\": \"$ahorroMes\"\n },\n 0\n ]\n },\n \"$ahorroElemento\",\n \"$ahorroTotalMes\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"ahorro.data.captacionesBs.saldoProd.ahorro.mensual\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$ahorroMes\"\n },\n true\n ]\n },\n {\n \"$arrayElemAt\": [\"$ahorroMes.actualBs\", 0]\n },\n \"$ahorroMes.data.captacionesBs.saldoProd.ahorro.actual\"\n ]\n },\n \"ahorro.data.captaciones.saldoProd.ahorro.mensual\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$ahorroMes\"\n },\n true\n ]\n },\n {\n \"$arrayElemAt\": [\"$ahorroMes.actualUsd\", 0]\n },\n \"$ahorroMes.data.captaciones.saldoProd.ahorro.actual\"\n ]\n }\n }\n },\n {\n \"$group\": {\n \"_id\": {\n \"fechaProceso\": \"$ahorro.fechaProceso\"\n },\n \"ahorro\": {\n \"$push\": {\n \"data\": \"$ahorro.data\",\n \"fechaProceso\": \"$ahorro.fechaProceso\",\n \"fecha_odate\": \"$ahorro.fecha_odate\"\n }\n },\n \"vista\": {\n \"$first\": \"$vista\"\n },\n \"plazo\": {\n \"$first\": \"$plazo\"\n },\n \"otros\": {\n \"$first\": \"$otros\"\n },\n \"plazoTotalMes\": {\n \"$first\": \"$plazoTotalMes\"\n },\n \"plazoNulo\": {\n \"$first\": \"$plazoNulo\"\n },\n \"otrosTotalMes\": {\n \"$first\": \"$otrosTotalMes\"\n },\n \"otrosNulo\": {\n \"$first\": \"$otrosNulo\"\n },\n \"conv20TotalMes\": {\n \"$first\": \"$conv20TotalMes\"\n },\n \"conv20Nulo\": {\n \"$first\": \"$conv20Nulo\"\n },\n \"libreConvTotalMes\": {\n \"$first\": \"$libreConvTotalMes\"\n },\n \"libreConvNulo\": {\n \"$first\": \"$libreConvNulo\"\n },\n \"plazoMes\": {\n \"$first\": \"$plazoMes\"\n },\n \"plazoElemento\": {\n \"$first\": \"$plazoElemento\"\n },\n \"otrosMes\": {\n \"$first\": \"$otrosMes\"\n },\n \"otrosElemento\": {\n \"$first\": \"$otrosElemento\"\n }\n }\n },\n {\n \"$unwind\": {\n \"path\": \"$plazo\"\n }\n },\n {\n \"$addFields\": {\n \"plazoMes\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$plazoMes\"\n },\n false\n ]\n },\n \"$plazoElemento\",\n \"$plazoTotalMes\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"plazoTotalMes\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$size\": \"$plazoMes\"\n },\n 0\n ]\n },\n \"$plazoElemento\",\n \"$plazoTotalMes\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"plazo.data.captacionesBs.saldoProd.plazo.mensual\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$plazoMes\"\n },\n true\n ]\n },\n {\n \"$arrayElemAt\": [\"$plazoMes.actualBs\", 0]\n },\n \"$plazoMes.data.captacionesBs.saldoProd.plazo.actual\"\n ]\n },\n \"plazo.data.captaciones.saldoProd.plazo.mensual\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$plazoMes\"\n },\n true\n ]\n },\n {\n \"$arrayElemAt\": [\"$plazoMes.actualUsd\", 0]\n },\n \"$plazoMes.data.captaciones.saldoProd.plazo.actual\"\n ]\n }\n }\n },\n {\n \"$group\": {\n \"_id\": {\n \"fechaProceso\": \"$plazo.fechaProceso\"\n },\n \"plazo\": {\n \"$push\": {\n \"data\": \"$plazo.data\",\n \"fechaProceso\": \"$plazo.fechaProceso\",\n \"fecha_odate\": \"$plazo.fecha_odate\"\n }\n },\n \"ahorro\": {\n \"$first\": \"$ahorro\"\n },\n \"vista\": {\n \"$first\": \"$vista\"\n },\n \"otros\": {\n \"$first\": \"$otros\"\n },\n \"otrosTotalMes\": {\n \"$first\": \"$otrosTotalMes\"\n },\n \"otrosNulo\": {\n \"$first\": \"$otrosNulo\"\n },\n \"conv20TotalMes\": {\n \"$first\": \"$conv20TotalMes\"\n },\n \"conv20Nulo\": {\n \"$first\": \"$conv20Nulo\"\n },\n \"libreConvTotalMes\": {\n \"$first\": \"$libreConvTotalMes\"\n },\n \"libreConvNulo\": {\n \"$first\": \"$libreConvNulo\"\n },\n \"otrosMes\": {\n \"$first\": \"$otrosMes\"\n },\n \"otrosElemento\": {\n \"$first\": \"$otrosElemento\"\n }\n }\n },\n {\n \"$unwind\": {\n \"path\": \"$otros\"\n }\n },\n {\n \"$addFields\": {\n \"otrosMes\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$otrosMes\"\n },\n false\n ]\n },\n \"$otrosElemento\",\n \"$otrosTotalMes\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"otrosTotalMes\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$size\": \"$otrosMes\"\n },\n 0\n ]\n },\n \"$otrosElemento\",\n \"$otrosTotalMes\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"otros.data.captacionesBs.saldoProd.otros.mensual\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$otrosMes\"\n },\n true\n ]\n },\n {\n \"$arrayElemAt\": [\"$otrosMes.actualBs\", 0]\n },\n \"$otrosMes.data.captacionesBs.saldoProd.otros.actual\"\n ]\n },\n \"otros.data.captaciones.saldoProd.otros.mensual\": {\n \"$cond\": [\n {\n \"$eq\": [\n {\n \"$isArray\": \"$otrosMes\"\n },\n true\n ]\n },\n {\n \"$arrayElemAt\": [\"$otrosMes.actualUsd\", 0]\n },\n \"$otrosMes.data.captaciones.saldoProd.otros.actual\"\n ]\n }\n }\n },\n {\n \"$group\": {\n \"_id\": {\n \"fechaProceso\": \"$otros.fechaProceso\"\n },\n \"otros\": {\n \"$push\": {\n \"data\": \"$otros.data\",\n \"fechaProceso\": \"$otros.fechaProceso\",\n \"fecha_odate\": \"$otros.fecha_odate\"\n }\n },\n \"ahorro\": {\n \"$first\": \"$ahorro\"\n },\n \"vista\": {\n \"$first\": \"$vista\"\n },\n \"plazo\": {\n \"$first\": \"$plazo\"\n }\n }\n },\n {\n \"$unwind\": {\n \"path\": \"$vista\"\n }\n },\n {\n \"$addFields\": {\n \"conv20.data.captacionesBs.saldoProd.conv20\": \"$vista.data.captacionesBs.conv20\",\n \"conv20.fechaProceso\": \"$vista.fechaProceso\",\n \"conv20.fecha_odate\": \"$vista.fecha_odate\",\n \"conv20.data.captaciones.saldoProd.conv20\": \"$vista.data.captaciones.conv20\",\n \"libreConv.data.captacionesBs.saldoProd.libreConv\": \"$vista.data.captacionesBs.libreConv\",\n \"libreConv.fechaProceso\": \"$vista.fechaProceso\",\n \"libreConv.data.captaciones.saldoProd.libreConv\": \"$vista.data.captaciones.libreConv\",\n \"libreConv.fecha_odate\": \"$vista.fecha_odate\"\n }\n },\n {\n \"$addFields\": {\n \"conv20.data.captacionesBs.saldoProd.conv20.creAnual\": \"$$REMOVE\",\n \"conv20.data.captacionesBs.saldoProd.conv20.netoActual\": \"$$REMOVE\",\n \"conv20.data.captacionesBs.saldoProd.conv20.varAnual\": \"$$REMOVE\",\n \"conv20.data.captaciones.saldoProd.conv20.creAnual\": \"$$REMOVE\",\n \"conv20.data.captaciones.saldoProd.conv20.netoActual\": \"$$REMOVE\",\n \"conv20.data.captaciones.saldoProd.conv20.varAnual\": \"$$REMOVE\",\n \"libreConv.data.captacionesBs.saldoProd.libreConv.creAnual\": \"$$REMOVE\",\n \"libreConv.data.captacionesBs.saldoProd.libreConv.netoActual\": \"$$REMOVE\",\n \"libreConv.data.captacionesBs.saldoProd.libreConv.varAnual\": \"$$REMOVE\",\n \"libreConv.data.captaciones.saldoProd.libreConv.creAnual\": \"$$REMOVE\",\n \"libreConv.data.captaciones.saldoProd.libreConv.netoActual\": \"$$REMOVE\",\n \"libreConv.data.captaciones.saldoProd.libreConv.varAnual\": \"$$REMOVE\"\n }\n },\n {\n \"$group\": {\n \"_id\": {\n \"fechaProceso\": \"$vista.fechaProceso\",\n \"fecha_odate\": \"$vista.fecha_odate\"\n },\n \"vista\": {\n \"$push\": {\n \"data\": \"$vista.data\",\n \"fechaProceso\": \"$vista.fechaProceso\",\n \"fecha_odate\": \"$vista.fecha_odate\"\n }\n },\n \"conv20\": {\n \"$push\": {\n \"data\": \"$conv20.data\",\n \"fechaProceso\": \"$conv20.fechaProceso\",\n \"fecha_odate\": \"$conv20.fecha_odate\"\n }\n },\n \"libreConv\": {\n \"$push\": {\n \"data\": \"$libreConv.data\",\n \"fechaProceso\": \"$libreConv.fechaProceso\",\n \"fecha_odate\": \"$libreConv.fecha_odate\"\n }\n },\n \"ahorro\": {\n \"$first\": \"$ahorro\"\n },\n \"otros\": {\n \"$first\": \"$otros\"\n },\n \"plazo\": {\n \"$first\": \"$plazo\"\n }\n }\n },\n {\n \"$addFields\": {\n \"ahorro\": {\n \"$filter\": {\n \"input\": \"$ahorro\",\n \"as\": \"item\",\n \"cond\": {\n \"$and\": [\n {\n \"$eq\": [\"$_id.fecha_odate\", \"$$item.fecha_odate\"]\n }\n ]\n }\n }\n },\n \"otros\": {\n \"$filter\": {\n \"input\": \"$otros\",\n \"as\": \"item\",\n \"cond\": {\n \"$and\": [\n {\n \"$eq\": [\"$_id.fecha_odate\", \"$$item.fecha_odate\"]\n }\n ]\n }\n }\n },\n \"plazo\": {\n \"$filter\": {\n \"input\": \"$plazo\",\n \"as\": \"item\",\n \"cond\": {\n \"$and\": [\n {\n \"$eq\": [\"$_id.fecha_odate\", \"$$item.fecha_odate\"]\n }\n ]\n }\n }\n }\n }\n },\n {\n \"$addFields\": {\n \"data.fechaProceso\": \"$_id.fechaProceso\",\n \"data.fecha_valor\": \"$_id.fecha_odate\",\n \"data.captacionesBs\": {\n \"$arrayElemAt\": [\"$vista.data.captacionesBs\", 0]\n },\n \"data.captaciones\": {\n \"$arrayElemAt\": [\"$vista.data.captaciones\", 0]\n }\n }\n },\n {\n \"$addFields\": {\n \"data.captacionesBs.saldoProd.ahorro\": {\n \"$arrayElemAt\": [\"$ahorro.data.captacionesBs.saldoProd.ahorro\", 0]\n },\n \"data.captacionesBs.saldoProd.plazo\": {\n \"$arrayElemAt\": [\"$plazo.data.captacionesBs.saldoProd.plazo\", 0]\n },\n \"data.captacionesBs.saldoProd.otros\": {\n \"$arrayElemAt\": [\"$otros.data.captacionesBs.saldoProd.otros\", 0]\n },\n \"data.captacionesBs.saldoProd.conv20\": {\n \"$arrayElemAt\": [\"$conv20.data.captacionesBs.saldoProd.conv20\", 0]\n },\n \"data.captacionesBs.saldoProd.libreConv\": {\n \"$arrayElemAt\": [\"$libreConv.data.captacionesBs.saldoProd.libreConv\", 0]\n },\n \"data.captaciones.saldoProd.ahorro\": {\n \"$arrayElemAt\": [\"$ahorro.data.captaciones.saldoProd.ahorro\", 0]\n },\n \"data.captaciones.saldoProd.plazo\": {\n \"$arrayElemAt\": [\"$plazo.data.captaciones.saldoProd.plazo\", 0]\n },\n \"data.captaciones.saldoProd.otros\": {\n \"$arrayElemAt\": [\"$otros.data.captaciones.saldoProd.otros\", 0]\n },\n \"data.captaciones.saldoProd.conv20\": {\n \"$arrayElemAt\": [\"$conv20.data.captaciones.saldoProd.conv20\", 0]\n },\n \"data.captaciones.saldoProd.libreConv\": {\n \"$arrayElemAt\": [\"$libreConv.data.captaciones.saldoProd.libreConv\", 0]\n }\n }\n },\n {\n \"$replaceRoot\": {\n \"newRoot\": \"$data\"\n }\n },\n {\n \"$addFields\": {\n \"captacionesBs.saldoProd.totalBdv.actual\": {\n \"$add\": [\n \"$captacionesBs.saldoProd.vista.actual\",\n \"$captacionesBs.saldoProd.ahorro.actual\",\n \"$captacionesBs.saldoProd.plazo.actual\",\n \"$captacionesBs.saldoProd.otros.actual\",\n \"$captacionesBs.saldoProd.conv20.actual\",\n \"$captacionesBs.saldoProd.libreConv.actual\"\n ]\n },\n \"captacionesBs.saldoProd.totalBdv.anterior\": {\n \"$add\": [\n \"$captacionesBs.saldoProd.vista.anterior\",\n \"$captacionesBs.saldoProd.ahorro.anterior\",\n \"$captacionesBs.saldoProd.plazo.anterior\",\n \"$captacionesBs.saldoProd.otros.anterior\",\n \"$captacionesBs.saldoProd.conv20.anterior\",\n \"$captacionesBs.saldoProd.libreConv.anterior\"\n ]\n },\n \"captacionesBs.saldoProd.totalBdv.mensual\": \"$captacionesBs.total.mensual\",\n \"captaciones.saldoProd.totalBdv.actual\": {\n \"$add\": [\n \"$captaciones.saldoProd.vista.actual\",\n \"$captaciones.saldoProd.ahorro.actual\",\n \"$captaciones.saldoProd.plazo.actual\",\n \"$captaciones.saldoProd.otros.actual\",\n \"$captaciones.saldoProd.conv20.actual\",\n \"$captaciones.saldoProd.libreConv.actual\"\n ]\n },\n \"captaciones.saldoProd.totalBdv.anterior\": {\n \"$add\": [\n \"$captaciones.saldoProd.vista.anterior\",\n \"$captaciones.saldoProd.ahorro.anterior\",\n \"$captaciones.saldoProd.plazo.anterior\",\n \"$captaciones.saldoProd.otros.anterior\",\n \"$captaciones.saldoProd.conv20.anterior\",\n \"$captaciones.saldoProd.libreConv.anterior\"\n ]\n },\n \"captaciones.saldoProd.totalBdv.mensual\": \"$captaciones.total.mensual\"\n }\n },\n {\n \"$addFields\": {\n \"captacionesBs.saldoProd.totalBdv.varMensual\": {\n \"$subtract\": [\n \"$captacionesBs.saldoProd.totalBdv.actual\",\n \"$captacionesBs.saldoProd.totalBdv.mensual\"\n ]\n },\n \"captaciones.saldoProd.totalBdv.varMensual\": {\n \"$subtract\": [\n \"$captaciones.saldoProd.totalBdv.actual\",\n \"$captaciones.saldoProd.totalBdv.mensual\"\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"captacionesBs.saldoProd.vista.name\": \"Vista\",\n \"captaciones.saldoProd.vista.name\": \"Vista\",\n \"captacionesBs.saldoProd.ahorro.name\": \"Ahorro\",\n \"captaciones.saldoProd.ahorro.name\": \"Ahorro\",\n \"captacionesBs.saldoProd.plazo.name\": \"Plazo\",\n \"captaciones.saldoProd.plazo.name\": \"Plazo\",\n \"captacionesBs.saldoProd.libreConv.name\": \"Libre Convertibilidad\",\n \"captaciones.saldoProd.libreConv.name\": \"Libre Convertibilidad\",\n \"captacionesBs.saldoProd.conv20.name\": \"Convenio 20\",\n \"captaciones.saldoProd.conv20.name\": \"Convenio 20\",\n \"captacionesBs.saldoProd.otros.name\": \"Otros\",\n \"captaciones.saldoProd.otros.name\": \"Otros\",\n \"captacionesBs.saldoProd.totalBdv.name\": \"TOTAL\",\n \"captaciones.saldoProd.totalBdv.name\": \"TOTAL\",\n \"captacionesBs.saldoProd.totalBdv.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captacionesBs.saldoProd.totalBdv.actual\", 100]\n },\n \"$captacionesBs.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captaciones.saldoProd.totalBdv.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captaciones.saldoProd.totalBdv.actual\", 100]\n },\n \"$captaciones.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captacionesBs.saldoProd.vista.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captacionesBs.saldoProd.vista.actual\", 100]\n },\n \"$captacionesBs.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captacionesBs.saldoProd.ahorro.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captacionesBs.saldoProd.ahorro.actual\", 100]\n },\n \"$captacionesBs.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captacionesBs.saldoProd.plazo.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captacionesBs.saldoProd.plazo.actual\", 100]\n },\n \"$captacionesBs.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captacionesBs.saldoProd.otros.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captacionesBs.saldoProd.otros.actual\", 100]\n },\n \"$captacionesBs.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captacionesBs.saldoProd.conv20.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captacionesBs.saldoProd.conv20.actual\", 100]\n },\n \"$captacionesBs.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captacionesBs.saldoProd.libreConv.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captacionesBs.saldoProd.libreConv.actual\", 100]\n },\n \"$captacionesBs.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captaciones.saldoProd.vista.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captaciones.saldoProd.vista.actual\", 100]\n },\n \"$captaciones.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captaciones.saldoProd.ahorro.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captaciones.saldoProd.ahorro.actual\", 100]\n },\n \"$captaciones.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captaciones.saldoProd.plazo.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captaciones.saldoProd.plazo.actual\", 100]\n },\n \"$captaciones.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captaciones.saldoProd.otros.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captaciones.saldoProd.otros.actual\", 100]\n },\n \"$captaciones.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captaciones.saldoProd.conv20.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captaciones.saldoProd.conv20.actual\", 100]\n },\n \"$captaciones.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n },\n \"captaciones.saldoProd.libreConv.pesoPrctMens\": {\n \"$round\": [\n {\n \"$divide\": [\n {\n \"$multiply\": [\"$captaciones.saldoProd.libreConv.actual\", 100]\n },\n \"$captaciones.saldoProd.totalBdv.actual\"\n ]\n },\n 4\n ]\n }\n }\n },\n {\n \"$addFields\": {\n \"captacionesBs.saldoProd.plazoME\": \"$captacionesBs.saldoProd.plazo\",\n \"captaciones.saldoProd.plazoME\": \"$captaciones.saldoProd.plazo\",\n \"captacionesBs.saldoProd.plazo\": \"$$REMOVE\",\n \"captaciones.saldoProd.plazo\": \"$$REMOVE\"\n }\n },\n {\n \"$merge\": {\n \"into\": \"Balancemetric\",\n \"on\": \"fecha_valor\"\n }\n }\n]"
        },
        "id": "bee27447-8599-4c37-a4b2-c1f6ad94ea77",
        "name": "CaptacionesProducto",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          3600,
          9120
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"captacionesBs.sinConv20.actual\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.actual\", \"$captacionesBs.conv20.actual\"\n        ]\n      }, \n      \"captacionesBs.sinConv20.anterior\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.anterior\", \"$captacionesBs.conv20.anterior\"\n        ]\n      }, \n      \"captacionesBs.sinConv20.netoActual\": {\n        \"$subtract\": [\n          \"$captacionesBs.total.netoActual\", \"$captacionesBs.conv20.netoActual\"\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"captaciones\": 0, \n      \"cobranzaMora\": 0, \n      \"cobranzaMoraUVC\": 0, \n      \"liquidaciones\": 0, \n      \"liquidacionesUVC\": 0, \n      \"cobranzaMoraBs\": 0, \n      \"cobranzaMoraUVCBs\": 0, \n      \"liquidacionesBs\": 0, \n      \"liquidacionesUVCBs\": 0, \n      \"carteraCredito\": 0, \n      \"carteraCreditoBs\": 0, \n      \"ingresosComisiones\": 0, \n      \"ingresosComisionesBs\": 0\n    }\n  }, {\n    \"$facet\": {\n      \"corteMes\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$fecha_valor\", \"$fechaProceso\"\n              ]\n            }\n          }\n        }, {\n          \"$addFields\": {\n            \"captacionesBs.sinConv20.mensual\": \"$captacionesBs.sinConv20.actual\"\n          }\n        }, {\n          \"$project\": {\n            \"captacionesBs.sinConv20.mensual\": 1, \n            \"fechaProceso\": 1\n          }\n        }\n      ], \n      \"data\": []\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinConv20.corteMes\": \"$corteMes\", \n      \"corteMes\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinConv20.mensual\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captacionesBs.sinConv20.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$fecha.fechaProceso\", \"$data.fechaProceso\"\n                ]\n              }\n            }\n          }, 0\n        ]\n      }, \n      \"data.captacionesBs.sinConv20.captacionesDic\": {\n        \"$arrayElemAt\": [\n          {\n            \"$filter\": {\n              \"input\": \"$data.captacionesBs.sinConv20.corteMes\", \n              \"as\": \"fecha\", \n              \"cond\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$$fecha.fechaProceso\"\n                      }, 12\n                    ]\n                  }, {\n                    \"$ne\": [\n                      {\n                        \"$year\": \"$data.fechaProces\"\n                      }, {\n                        \"$year\": \"$$fecha.fechaProceso\"\n                      }\n                    ]\n                  }\n                ]\n              }\n            }\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinConv20.mensual\": \"$data.captacionesBs.sinConv20.mensual.captacionesBs.sinConv20.mensual\", \n      \"data.captacionesBs.sinConv20.corteMes\": \"$$REMOVE\", \n      \"data.captacionesBs.sinConv20.captacionesDic\": \"$data.captacionesBs.sinConv20.captacionesDic.captacionesBs.sinConv20.mensual\", \n      \"data.captacionesBs.sinConv20.varMensual\": {\n        \"$subtract\": [\n          \"$data.captacionesBs.sinConv20.actual\", \"$data.captacionesBs.sinConv20.anterior\"\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"data.captacionesBs.sinConv20.varAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$subtract\": [\n              \"$data.captacionesBs.sinConv20.actual\", \"$data.captacionesBs.sinConv20.captacionesDic\"\n            ]\n          }, 0\n        ]\n      }, \n      \"data.captacionesBs.sinConv20.creAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              {\n                \"$year\": \"$data.fechaProceso\"\n              }, {\n                \"$year\": \"$$NOW\"\n              }\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$multiply\": [\n                      {\n                        \"$subtract\": [\n                          \"$data.captacionesBs.sinConv20.actual\", \"$data.captacionesBs.sinConv20.captacionesDic\"\n                        ]\n                      }, 100\n                    ]\n                  }, \"$data.captacionesBs.sinConv20.captacionesDic\"\n                ]\n              }, 4\n            ]\n          }, 0\n        ]\n      }\n    }\n  }, {\n    \"$facet\": {\n      \"data\": [\n        {\n          \"$match\": {\n            \"data.captacionesBs.sinConv20.actual\": {\n              \"$ne\": null\n            }\n          }\n        }\n      ], \n      \"dataNotNull\": [\n        {\n          \"$match\": {\n            \"data.captacionesBs.sinConv20.actual\": {\n              \"$ne\": null\n            }\n          }\n        }, {\n          \"$group\": {\n            \"_id\": {\n              \"fechaProceso\": \"$data.fechaProceso\", \n              \"fechaValor\": \"$data.fecha_valor\"\n            }, \n            \"maxFechaValor\": {\n              \"$max\": \"$data.fecha_valor\"\n            }, \n            \"maxMensual\": {\n              \"$max\": \"$data.captacionesBs.sinConv20.actual\"\n            }\n          }\n        }, {\n          \"$sort\": {\n            \"_id.fechaValor\": -1\n          }\n        }\n      ]\n    }\n  }, {\n    \"$addFields\": {\n      \"ultimoActual\": {\n        \"$slice\": [\n          \"$dataNotNull\", 1\n        ]\n      }, \n      \"dataNotNull\": \"$$REMOVE\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$ultimoActual\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$data\"\n    }\n  }, {\n    \"$addFields\": {\n      \"data.data.captacionesBs.sinConv20.mensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$data.data.fechaProceso\", \"$ultimoActual._id.fechaProceso\"\n            ]\n          }, \"$ultimoActual.maxMensual\", \"$data.data.captacionesBs.sinConv20.mensual\"\n        ]\n      }, \n      \"ultimoActual\": \"$$REMOVE\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$data.data\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "c0314a98-4eb2-4ef5-8218-dcb1ab7170d7",
        "name": "CaptacionesSinConv20VersionFinalBs",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2100,
          8440
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "empty"
        },
        "id": "f32f05fd-1586-49c7-a5c4-b65669b3458f",
        "name": "Merge4",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1540,
          8580
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "empty"
        },
        "id": "8969c0ad-dc1c-4326-891a-f7373ef6a662",
        "name": "Merge6",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1680,
          8780
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_activos_liq_uvc",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$lookup\": {\n      \"from\": \"Parametricliquidacion\", \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$condicion\", \"VIGENTE\"\n                  ]\n                }\n              }, {\n                \"$or\": [\n                  {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"COMERCIAL\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"PRODUCTIVO\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"EMPRENDEBDV\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"MICROCREDITO\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"HIPOTECARIO\"\n                      ]\n                    }\n                  }\n                ]\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"_id\": 0\n          }\n        }\n      ], \n      \"as\": \"Parametricliquidacion\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Parametricliquidacion\", \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$condicion\", \"VIGENTE\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    {\n                      \"$substrCP\": [\n                        \"$cuentaContable\", 0, 3\n                      ]\n                    }, \"131\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"_id\": 0\n          }\n        }\n      ], \n      \"as\": \"Parametricliquidacion131\"\n    }\n  }, {\n    \"$project\": {\n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }, \n      \"cuentasContable\": \"$Parametricliquidacion.cuentaContable\", \n      \"accntngAccnts131\": \"$Parametricliquidacion131.cuentaContable\", \n      \"Parametricliquidacion\": 1, \n      \"Parametricliquidacion131\": 1\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_activos_liq_uvc\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\", \n        \"currentMonth\": {\n          \"$month\": \"$todayDate\"\n        }, \n        \"currentYear\": {\n          \"$year\": \"$todayDate\"\n        }\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$todayDate\", \"$fecha_valor\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$currentMonth\", {\n                      \"$month\": \"$formalizacion\"\n                    }\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$currentYear\", {\n                      \"$year\": \"$formalizacion\"\n                    }\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"_id\": 0, \n            \"cuenta_contable\": 1, \n            \"mto_credito\": 1, \n            \"fecha_vencimiento\": 1, \n            \"formalizacion\": 1\n          }\n        }\n      ], \n      \"as\": \"sidis_activos_liq_uvc\"\n    }\n  }, {\n    \"$addFields\": {\n      \"avaiableData\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_activos_liq_uvc\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"firstDayMonth\": {\n        \"$eq\": [\n          {\n            \"$dayOfMonth\": \"$todayDate\"\n          }, 1\n        ]\n      }, \n      \"firstDayYear\": {\n        \"$and\": [\n          {\n            \"$eq\": [\n              {\n                \"$dayOfMonth\": \"$todayDate\"\n              }, 1\n            ]\n          }, {\n            \"$eq\": [\n              {\n                \"$month\": \"$todayDate\"\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"yesterdayDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"tomorrowDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": 1\n        }\n      }, \n      \"previusMonthDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"previusMonthlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$month\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"previusYearDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }, \n      \"previusYearlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"sidis_activos_liq_uvc\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$in\": [\n              \"$$item.cuenta_contable\", \"$cuentasContable\"\n            ]\n          }\n        }\n      }, \n      \"sidis_activos_liq_uvc131\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$in\": [\n              \"$$item.cuenta_contable\", \"$accntngAccnts131\"\n            ]\n          }\n        }\n      }, \n      \"cuentasContable\": \"$$REMOVE\", \n      \"accntngAccnts131\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_activos_liq_uvc\": {\n        \"$map\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"items\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$items\", {\n                \"$first\": {\n                  \"$filter\": {\n                    \"input\": \"$Parametricliquidacion\", \n                    \"as\": \"item\", \n                    \"cond\": {\n                      \"$eq\": [\n                        \"$$item.cuentaContable\", \"$$items.cuenta_contable\"\n                      ]\n                    }\n                  }\n                }\n              }\n            ]\n          }\n        }\n      }, \n      \"sidis_activos_liq_uvc131\": {\n        \"$map\": {\n          \"input\": \"$sidis_activos_liq_uvc131\", \n          \"as\": \"items\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$items\", {\n                \"$first\": {\n                  \"$filter\": {\n                    \"input\": \"$Parametricliquidacion131\", \n                    \"as\": \"item\", \n                    \"cond\": {\n                      \"$eq\": [\n                        \"$$item.cuentaContable\", \"$$items.cuenta_contable\"\n                      ]\n                    }\n                  }\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_activos_liq_uvc\": {\n        \"$map\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$item\", {\n                \"plazo\": {\n                  \"$divide\": [\n                    {\n                      \"$subtract\": [\n                        \"$$item.fecha_vencimiento\", \"$$item.formalizacion\"\n                      ]\n                    }, 86400000\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      }, \n      \"sidis_activos_liq_uvc131\": {\n        \"$map\": {\n          \"input\": \"$sidis_activos_liq_uvc131\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$item\", {\n                \"plazo\": {\n                  \"$divide\": [\n                    {\n                      \"$subtract\": [\n                        \"$$item.fecha_vencimiento\", \"$$item.formalizacion\"\n                      ]\n                    }, 86400000\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"montoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.condicion\", \"VIGENTE\"\n            ]\n          }\n        }\n      }, \n      \"numLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.condicion\", \"VIGENTE\"\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$lte\": [\n                  \"$$item.plazo\", 46\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$gt\": [\n                  \"$$item.plazo\", 46\n                ]\n              }, {\n                \"$lte\": [\n                  \"$$item.plazo\", 186\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$gt\": [\n                  \"$$item.plazo\", 186\n                ]\n              }, {\n                \"$lte\": [\n                  \"$$item.plazo\", 280\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$gt\": [\n                  \"$$item.plazo\", 280\n                ]\n              }, {\n                \"$lte\": [\n                  \"$$item.plazo\", 360\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_uvc\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$gt\": [\n                  \"$$item.plazo\", 360\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"settlmntAmount\": {\n        \"$sum\": [\n          \"$sidis_activos_liq_uvc131.mto_credito\"\n        ]\n      }, \n      \"settlmntCount\": {\n        \"$size\": \"$sidis_activos_liq_uvc131.mto_credito\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"montoLiqProdVigente\": {\n        \"$sum\": \"$montoLiqProdVigente.mto_credito\"\n      }, \n      \"numLiqProdVigente\": {\n        \"$size\": \"$numLiqProdVigente\"\n      }, \n      \"montoLiqProdVigente45d\": {\n        \"$sum\": \"$montoLiqProdVigente45d.mto_credito\"\n      }, \n      \"montoLiqProdVigente6m\": {\n        \"$sum\": \"$montoLiqProdVigente6m.mto_credito\"\n      }, \n      \"montoLiqProdVigente9m\": {\n        \"$sum\": \"$montoLiqProdVigente9m.mto_credito\"\n      }, \n      \"montoLiqProdVigente1a\": {\n        \"$sum\": \"$montoLiqProdVigente1a.mto_credito\"\n      }, \n      \"montoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$montoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialnumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivonumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecarionumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvnumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCrednumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"Parametricliquidacion\": \"$$REMOVE\", \n      \"Parametricliquidacion131\": \"$$REMOVE\", \n      \"sidis_activos_liq_uvc\": \"$$REMOVE\", \n      \"sidis_activos_liq_uvc131\": \"$$REMOVE\", \n      \"todayDate\": \"$$REMOVE\", \n      \"fecha_valor\": \"$todayDate\", \n      \"comercialmontoLiqProdVigente\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente.mto_credito\"\n      }, \n      \"comercialnumLiqProdVigente\": {\n        \"$size\": \"$comercialnumLiqProdVigente.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente45d\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente6m\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente9m\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente1a\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$comercialmontoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente\": {\n        \"$sum\": \"$productivomontoLiqProdVigente.mto_credito\"\n      }, \n      \"productivonumLiqProdVigente\": {\n        \"$size\": \"$productivonumLiqProdVigente.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente45d\": {\n        \"$sum\": \"$productivomontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente6m\": {\n        \"$sum\": \"$productivomontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente9m\": {\n        \"$sum\": \"$productivomontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente1a\": {\n        \"$sum\": \"$productivomontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$productivomontoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente.mto_credito\"\n      }, \n      \"hipotecarionumLiqProdVigente\": {\n        \"$size\": \"$hipotecarionumLiqProdVigente.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente45d\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente6m\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente9m\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente1a\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente.mto_credito\"\n      }, \n      \"emprendeBdvnumLiqProdVigente\": {\n        \"$size\": \"$emprendeBdvnumLiqProdVigente.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente45d\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente6m\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente9m\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente1a\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente.mto_credito\"\n      }, \n      \"microCrednumLiqProdVigente\": {\n        \"$size\": \"$microCrednumLiqProdVigente.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente45d\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente6m\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente9m\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente1a\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$microCredmontoLiqProdVigenteMas1a.mto_credito\"\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Liquidacionmetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"replace\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "7aa0b13f-83b0-4325-bb91-963d1b54486e",
        "name": "1_activosliqUvcToLiquidacionesmetricUVC",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2260,
          5480
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "4aa71b7d-f164-40b4-9bc2-1d63ed64c3cd",
        "name": "Merge23",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2420,
          5580
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_activos_liq_bs",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$lookup\": {\n      \"from\": \"Parametricliquidacion\", \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$condicion\", \"VIGENTE\"\n                  ]\n                }\n              }, {\n                \"$or\": [\n                  {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"COMERCIAL\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"PRODUCTIVO\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"EMPRENDEBDV\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"MICROCREDITO\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$productoControlGestion\", \"HIPOTECARIO\"\n                      ]\n                    }\n                  }\n                ]\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"_id\": 0\n          }\n        }\n      ], \n      \"as\": \"Parametricliquidacion\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Parametricliquidacion\", \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$condicion\", \"VIGENTE\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    {\n                      \"$substrCP\": [\n                        \"$cuentaContable\", 0, 3\n                      ]\n                    }, \"131\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"_id\": 0\n          }\n        }\n      ], \n      \"as\": \"Parametricliquidacion131\"\n    }\n  }, {\n    \"$project\": {\n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }, \n      \"cuentasContable\": \"$Parametricliquidacion.cuentaContable\", \n      \"accntngAccnts131\": \"$Parametricliquidacion131.cuentaContable\", \n      \"Parametricliquidacion\": 1, \n      \"Parametricliquidacion131\": 1\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_activos_liq_bs\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\", \n        \"currentMonth\": {\n          \"$month\": \"$todayDate\"\n        }, \n        \"currentYear\": {\n          \"$year\": \"$todayDate\"\n        }\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$todayDate\", \"$fecha_valor\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$currentMonth\", {\n                      \"$month\": \"$fecha_formalizacion\"\n                    }\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$currentYear\", {\n                      \"$year\": \"$fecha_formalizacion\"\n                    }\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"_id\": 0, \n            \"cuenta_contable\": 1, \n            \"mto_credito\": \"$monto_credito\", \n            \"fecha_vencimiento\": 1, \n            \"formalizacion\": \"$fecha_formalizacion\"\n          }\n        }\n      ], \n      \"as\": \"sidis_activos_liq_bs\"\n    }\n  }, {\n    \"$addFields\": {\n      \"avaiableData\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_activos_liq_bs\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"firstDayMonth\": {\n        \"$eq\": [\n          {\n            \"$dayOfMonth\": \"$todayDate\"\n          }, 1\n        ]\n      }, \n      \"firstDayYear\": {\n        \"$and\": [\n          {\n            \"$eq\": [\n              {\n                \"$dayOfMonth\": \"$todayDate\"\n              }, 1\n            ]\n          }, {\n            \"$eq\": [\n              {\n                \"$month\": \"$todayDate\"\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"yesterdayDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"tomorrowDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": 1\n        }\n      }, \n      \"previusMonthDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"previusMonthlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$month\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"previusYearDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }, \n      \"previusYearlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"sidis_activos_liq_bs\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$in\": [\n              \"$$item.cuenta_contable\", \"$cuentasContable\"\n            ]\n          }\n        }\n      }, \n      \"sidis_activos_liq_bs131\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$in\": [\n              \"$$item.cuenta_contable\", \"$accntngAccnts131\"\n            ]\n          }\n        }\n      }, \n      \"cuentasContable\": \"$$REMOVE\", \n      \"accntngAccnts131\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_activos_liq_bs\": {\n        \"$map\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"items\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$items\", {\n                \"$first\": {\n                  \"$filter\": {\n                    \"input\": \"$Parametricliquidacion\", \n                    \"as\": \"item\", \n                    \"cond\": {\n                      \"$eq\": [\n                        \"$$item.cuentaContable\", \"$$items.cuenta_contable\"\n                      ]\n                    }\n                  }\n                }\n              }\n            ]\n          }\n        }\n      }, \n      \"sidis_activos_liq_bs131\": {\n        \"$map\": {\n          \"input\": \"$sidis_activos_liq_bs131\", \n          \"as\": \"items\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$items\", {\n                \"$first\": {\n                  \"$filter\": {\n                    \"input\": \"$Parametricliquidacion131\", \n                    \"as\": \"item\", \n                    \"cond\": {\n                      \"$eq\": [\n                        \"$$item.cuentaContable\", \"$$items.cuenta_contable\"\n                      ]\n                    }\n                  }\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_activos_liq_bs\": {\n        \"$map\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$item\", {\n                \"plazo\": {\n                  \"$divide\": [\n                    {\n                      \"$subtract\": [\n                        \"$$item.fecha_vencimiento\", \"$$item.formalizacion\"\n                      ]\n                    }, 86400000\n                  ]\n                }\n              }, {\n                \"condicion\": \"VIGENTE\"\n              }\n            ]\n          }\n        }\n      }, \n      \"sidis_activos_liq_bs131\": {\n        \"$map\": {\n          \"input\": \"$sidis_activos_liq_bs131\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$item\", {\n                \"plazo\": {\n                  \"$divide\": [\n                    {\n                      \"$subtract\": [\n                        \"$$item.fecha_vencimiento\", \"$$item.formalizacion\"\n                      ]\n                    }, 86400000\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"montoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.condicion\", \"VIGENTE\"\n            ]\n          }\n        }\n      }, \n      \"numLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.condicion\", \"VIGENTE\"\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$lte\": [\n                  \"$$item.plazo\", 46\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$gt\": [\n                  \"$$item.plazo\", 46\n                ]\n              }, {\n                \"$lte\": [\n                  \"$$item.plazo\", 186\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$gt\": [\n                  \"$$item.plazo\", 186\n                ]\n              }, {\n                \"$lte\": [\n                  \"$$item.plazo\", 280\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$gt\": [\n                  \"$$item.plazo\", 280\n                ]\n              }, {\n                \"$lte\": [\n                  \"$$item.plazo\", 360\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"montoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$sidis_activos_liq_bs\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$and\": [\n              {\n                \"$eq\": [\n                  \"$$item.condicion\", \"VIGENTE\"\n                ]\n              }, {\n                \"$gt\": [\n                  \"$$item.plazo\", 360\n                ]\n              }\n            ]\n          }\n        }\n      }, \n      \"settlmntAmount\": {\n        \"$sum\": [\n          \"$sidis_activos_liq_bs131.mto_credito\"\n        ]\n      }, \n      \"settlmntCount\": {\n        \"$size\": \"$sidis_activos_liq_bs131.mto_credito\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"montoLiqProdVigente\": {\n        \"$sum\": \"$montoLiqProdVigente.mto_credito\"\n      }, \n      \"numLiqProdVigente\": {\n        \"$size\": \"$numLiqProdVigente\"\n      }, \n      \"montoLiqProdVigente45d\": {\n        \"$sum\": \"$montoLiqProdVigente45d.mto_credito\"\n      }, \n      \"montoLiqProdVigente6m\": {\n        \"$sum\": \"$montoLiqProdVigente6m.mto_credito\"\n      }, \n      \"montoLiqProdVigente9m\": {\n        \"$sum\": \"$montoLiqProdVigente9m.mto_credito\"\n      }, \n      \"montoLiqProdVigente1a\": {\n        \"$sum\": \"$montoLiqProdVigente1a.mto_credito\"\n      }, \n      \"montoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$montoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialnumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"comercialmontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"COMERCIAL\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivonumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"productivomontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"PRODUCTIVO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecarionumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"hipotecariomontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"HIPOTECARIO\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvnumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"EMPRENDEBDV\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCrednumLiqProdVigente\": {\n        \"$filter\": {\n          \"input\": \"$numLiqProdVigente\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente45d\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente45d\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente6m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente6m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente9m\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente9m\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigente1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigente1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }, \n      \"microCredmontoLiqProdVigenteMas1a\": {\n        \"$filter\": {\n          \"input\": \"$montoLiqProdVigenteMas1a\", \n          \"as\": \"item\", \n          \"cond\": {\n            \"$eq\": [\n              \"$$item.productoControlGestion\", \"MICROCREDITO\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"Parametricliquidacion\": \"$$REMOVE\", \n      \"Parametricliquidacion131\": \"$$REMOVE\", \n      \"sidis_activos_liq_bs\": \"$$REMOVE\", \n      \"sidis_activos_liq_bs131\": \"$$REMOVE\", \n      \"todayDate\": \"$$REMOVE\", \n      \"fecha_valor\": \"$todayDate\", \n      \"comercialmontoLiqProdVigente\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente.mto_credito\"\n      }, \n      \"comercialnumLiqProdVigente\": {\n        \"$size\": \"$comercialnumLiqProdVigente.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente45d\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente6m\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente9m\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigente1a\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"comercialmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$comercialmontoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente\": {\n        \"$sum\": \"$productivomontoLiqProdVigente.mto_credito\"\n      }, \n      \"productivonumLiqProdVigente\": {\n        \"$size\": \"$productivonumLiqProdVigente.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente45d\": {\n        \"$sum\": \"$productivomontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente6m\": {\n        \"$sum\": \"$productivomontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente9m\": {\n        \"$sum\": \"$productivomontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigente1a\": {\n        \"$sum\": \"$productivomontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"productivomontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$productivomontoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente.mto_credito\"\n      }, \n      \"hipotecarionumLiqProdVigente\": {\n        \"$size\": \"$hipotecarionumLiqProdVigente.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente45d\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente6m\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente9m\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigente1a\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"hipotecariomontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente.mto_credito\"\n      }, \n      \"emprendeBdvnumLiqProdVigente\": {\n        \"$size\": \"$emprendeBdvnumLiqProdVigente.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente45d\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente6m\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente9m\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente1a\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigenteMas1a.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente.mto_credito\"\n      }, \n      \"microCrednumLiqProdVigente\": {\n        \"$size\": \"$microCrednumLiqProdVigente.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente45d\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente45d.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente6m\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente6m.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente9m\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente9m.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigente1a\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente1a.mto_credito\"\n      }, \n      \"microCredmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$microCredmontoLiqProdVigenteMas1a.mto_credito\"\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Liquidacionmetric\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"Liquidacionmetric\"\n    }\n  }, {\n    \"$addFields\": {\n      \"Liquidacionmetric\": \"$$REMOVE\", \n      \"settlmntAmount\": {\n        \"$sum\": [\n          \"$settlmntAmount\", {\n            \"$first\": \"$Liquidacionmetric.settlmntAmount\"\n          }\n        ]\n      }, \n      \"settlmntCount\": {\n        \"$sum\": [\n          \"$settlmntCount\", {\n            \"$first\": \"$Liquidacionmetric.settlmntCount\"\n          }\n        ]\n      }, \n      \"montoLiqProdVigente\": {\n        \"$sum\": [\n          \"$montoLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.montoLiqProdVigente\"\n          }\n        ]\n      }, \n      \"numLiqProdVigente\": {\n        \"$sum\": [\n          \"$numLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.numLiqProdVigente\"\n          }\n        ]\n      }, \n      \"montoLiqProdVigente45d\": {\n        \"$sum\": [\n          \"$montoLiqProdVigente45d\", {\n            \"$first\": \"$Liquidacionmetric.montoLiqProdVigente45d\"\n          }\n        ]\n      }, \n      \"montoLiqProdVigente6m\": {\n        \"$sum\": [\n          \"$montoLiqProdVigente6m\", {\n            \"$first\": \"$Liquidacionmetric.montoLiqProdVigente6m\"\n          }\n        ]\n      }, \n      \"montoLiqProdVigente9m\": {\n        \"$sum\": [\n          \"$montoLiqProdVigente9m\", {\n            \"$first\": \"$Liquidacionmetric.montoLiqProdVigente9m\"\n          }\n        ]\n      }, \n      \"montoLiqProdVigente1a\": {\n        \"$sum\": [\n          \"$montoLiqProdVigente1a\", {\n            \"$first\": \"$Liquidacionmetric.montoLiqProdVigente1a\"\n          }\n        ]\n      }, \n      \"montoLiqProdVigenteMas1a\": {\n        \"$sum\": [\n          \"$montoLiqProdVigenteMas1a\", {\n            \"$first\": \"$Liquidacionmetric.montoLiqProdVigenteMas1a\"\n          }\n        ]\n      }, \n      \"comercialmontoLiqProdVigente\": {\n        \"$sum\": [\n          \"$comercialmontoLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.comercialmontoLiqProdVigente\"\n          }\n        ]\n      }, \n      \"comercialnumLiqProdVigente\": {\n        \"$sum\": [\n          \"$comercialnumLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.comercialnumLiqProdVigente\"\n          }\n        ]\n      }, \n      \"comercialmontoLiqProdVigente45d\": {\n        \"$sum\": [\n          \"$comercialmontoLiqProdVigente45d\", {\n            \"$first\": \"$Liquidacionmetric.comercialmontoLiqProdVigente45d\"\n          }\n        ]\n      }, \n      \"comercialmontoLiqProdVigente6m\": {\n        \"$sum\": [\n          \"$comercialmontoLiqProdVigente6m\", {\n            \"$first\": \"$Liquidacionmetric.comercialmontoLiqProdVigente6m\"\n          }\n        ]\n      }, \n      \"comercialmontoLiqProdVigente9m\": {\n        \"$sum\": [\n          \"$comercialmontoLiqProdVigente9m\", {\n            \"$first\": \"$Liquidacionmetric.comercialmontoLiqProdVigente9m\"\n          }\n        ]\n      }, \n      \"comercialmontoLiqProdVigente1a\": {\n        \"$sum\": [\n          \"$comercialmontoLiqProdVigente1a\", {\n            \"$first\": \"$Liquidacionmetric.comercialmontoLiqProdVigente1a\"\n          }\n        ]\n      }, \n      \"comercialmontoLiqProdVigenteMas1a\": {\n        \"$sum\": [\n          \"$comercialmontoLiqProdVigenteMas1a\", {\n            \"$first\": \"$Liquidacionmetric.comercialmontoLiqProdVigenteMas1a\"\n          }\n        ]\n      }, \n      \"productivomontoLiqProdVigente\": {\n        \"$sum\": [\n          \"$productivomontoLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.productivomontoLiqProdVigente\"\n          }\n        ]\n      }, \n      \"productivonumLiqProdVigente\": {\n        \"$sum\": [\n          \"$productivonumLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.productivonumLiqProdVigente\"\n          }\n        ]\n      }, \n      \"productivomontoLiqProdVigente45d\": {\n        \"$sum\": [\n          \"$productivomontoLiqProdVigente45d\", {\n            \"$first\": \"$Liquidacionmetric.productivomontoLiqProdVigente45d\"\n          }\n        ]\n      }, \n      \"productivomontoLiqProdVigente6m\": {\n        \"$sum\": [\n          \"$productivomontoLiqProdVigente6m\", {\n            \"$first\": \"$Liquidacionmetric.productivomontoLiqProdVigente6m\"\n          }\n        ]\n      }, \n      \"productivomontoLiqProdVigente9m\": {\n        \"$sum\": [\n          \"$productivomontoLiqProdVigente9m\", {\n            \"$first\": \"$Liquidacionmetric.productivomontoLiqProdVigente9m\"\n          }\n        ]\n      }, \n      \"productivomontoLiqProdVigente1a\": {\n        \"$sum\": [\n          \"$productivomontoLiqProdVigente1a\", {\n            \"$first\": \"$Liquidacionmetric.productivomontoLiqProdVigente1a\"\n          }\n        ]\n      }, \n      \"productivomontoLiqProdVigenteMas1a\": {\n        \"$sum\": [\n          \"$productivomontoLiqProdVigenteMas1a\", {\n            \"$first\": \"$Liquidacionmetric.productivomontoLiqProdVigenteMas1a\"\n          }\n        ]\n      }, \n      \"hipotecariomontoLiqProdVigente\": {\n        \"$sum\": [\n          \"$hipotecariomontoLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.hipotecariomontoLiqProdVigente\"\n          }\n        ]\n      }, \n      \"hipotecarionumLiqProdVigente\": {\n        \"$sum\": [\n          \"$hipotecarionumLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.hipotecarionumLiqProdVigente\"\n          }\n        ]\n      }, \n      \"hipotecariomontoLiqProdVigente45d\": {\n        \"$sum\": [\n          \"$hipotecariomontoLiqProdVigente45d\", {\n            \"$first\": \"$Liquidacionmetric.hipotecariomontoLiqProdVigente45d\"\n          }\n        ]\n      }, \n      \"hipotecariomontoLiqProdVigente6m\": {\n        \"$sum\": [\n          \"$hipotecariomontoLiqProdVigente6m\", {\n            \"$first\": \"$Liquidacionmetric.hipotecariomontoLiqProdVigente6m\"\n          }\n        ]\n      }, \n      \"hipotecariomontoLiqProdVigente9m\": {\n        \"$sum\": [\n          \"$hipotecariomontoLiqProdVigente9m\", {\n            \"$first\": \"$Liquidacionmetric.hipotecariomontoLiqProdVigente9m\"\n          }\n        ]\n      }, \n      \"hipotecariomontoLiqProdVigente1a\": {\n        \"$sum\": [\n          \"$hipotecariomontoLiqProdVigente1a\", {\n            \"$first\": \"$Liquidacionmetric.hipotecariomontoLiqProdVigente1a\"\n          }\n        ]\n      }, \n      \"hipotecariomontoLiqProdVigenteMas1a\": {\n        \"$sum\": [\n          \"$hipotecariomontoLiqProdVigenteMas1a\", {\n            \"$first\": \"$Liquidacionmetric.hipotecariomontoLiqProdVigenteMas1a\"\n          }\n        ]\n      }, \n      \"emprendeBdvmontoLiqProdVigente\": {\n        \"$sum\": [\n          \"$emprendeBdvmontoLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.emprendeBdvmontoLiqProdVigente\"\n          }\n        ]\n      }, \n      \"emprendeBdvnumLiqProdVigente\": {\n        \"$sum\": [\n          \"$emprendeBdvnumLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.emprendeBdvnumLiqProdVigente\"\n          }\n        ]\n      }, \n      \"emprendeBdvmontoLiqProdVigente45d\": {\n        \"$sum\": [\n          \"$emprendeBdvmontoLiqProdVigente45d\", {\n            \"$first\": \"$Liquidacionmetric.emprendeBdvmontoLiqProdVigente45d\"\n          }\n        ]\n      }, \n      \"emprendeBdvmontoLiqProdVigente6m\": {\n        \"$sum\": [\n          \"$emprendeBdvmontoLiqProdVigente6m\", {\n            \"$first\": \"$Liquidacionmetric.emprendeBdvmontoLiqProdVigente6m\"\n          }\n        ]\n      }, \n      \"emprendeBdvmontoLiqProdVigente9m\": {\n        \"$sum\": [\n          \"$emprendeBdvmontoLiqProdVigente9m\", {\n            \"$first\": \"$Liquidacionmetric.emprendeBdvmontoLiqProdVigente9m\"\n          }\n        ]\n      }, \n      \"emprendeBdvmontoLiqProdVigente1a\": {\n        \"$sum\": [\n          \"$emprendeBdvmontoLiqProdVigente1a\", {\n            \"$first\": \"$Liquidacionmetric.emprendeBdvmontoLiqProdVigente1a\"\n          }\n        ]\n      }, \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": {\n        \"$sum\": [\n          \"$emprendeBdvmontoLiqProdVigenteMas1a\", {\n            \"$first\": \"$Liquidacionmetric.emprendeBdvmontoLiqProdVigenteMas1a\"\n          }\n        ]\n      }, \n      \"microCredmontoLiqProdVigente\": {\n        \"$sum\": [\n          \"$microCredmontoLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.microCredmontoLiqProdVigente\"\n          }\n        ]\n      }, \n      \"microCrednumLiqProdVigente\": {\n        \"$sum\": [\n          \"$microCrednumLiqProdVigente\", {\n            \"$first\": \"$Liquidacionmetric.microCrednumLiqProdVigente\"\n          }\n        ]\n      }, \n      \"microCredmontoLiqProdVigente45d\": {\n        \"$sum\": [\n          \"$microCredmontoLiqProdVigente45d\", {\n            \"$first\": \"$Liquidacionmetric.microCredmontoLiqProdVigente45d\"\n          }\n        ]\n      }, \n      \"microCredmontoLiqProdVigente6m\": {\n        \"$sum\": [\n          \"$microCredmontoLiqProdVigente6m\", {\n            \"$first\": \"$Liquidacionmetric.microCredmontoLiqProdVigente6m\"\n          }\n        ]\n      }, \n      \"microCredmontoLiqProdVigente9m\": {\n        \"$sum\": [\n          \"$microCredmontoLiqProdVigente9m\", {\n            \"$first\": \"$Liquidacionmetric.microCredmontoLiqProdVigente9m\"\n          }\n        ]\n      }, \n      \"microCredmontoLiqProdVigente1a\": {\n        \"$sum\": [\n          \"$microCredmontoLiqProdVigente1a\", {\n            \"$first\": \"$Liquidacionmetric.microCredmontoLiqProdVigente1a\"\n          }\n        ]\n      }, \n      \"microCredmontoLiqProdVigenteMas1a\": {\n        \"$sum\": [\n          \"$microCredmontoLiqProdVigenteMas1a\", {\n            \"$first\": \"$Liquidacionmetric.microCredmontoLiqProdVigenteMas1a\"\n          }\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Liquidacionmetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]A"
        },
        "id": "4dd03ea1-e7a0-494c-b171-836ab50b0d82",
        "name": "2_activosliqbsToLiquidacionesmetricBS",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2600,
          5460
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {},
        "id": "25c2dca6-0f5f-492a-ab29-16ee68ea8e8c",
        "name": "NoOp4",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          2100,
          5600
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "ecbfa679-e558-4feb-8a9a-28b950c3f5b7",
        "name": "Merge24",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2760,
          5560
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "6221d902-a978-4339-b67b-cd6303197747",
        "name": "Merge33",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          3820,
          5520
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "72280bdb-0fc0-4826-b9b1-24b8ba4cbc7d",
        "name": "Merge34",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          4160,
          5500
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"today\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          \"$fecha_valor\", \"$today\"\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"todayLastMonth\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$today\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"todayLastYear\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$today\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"todayLastMonth\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"mensualAnt\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"todayLastYear\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"anualAnt\"\n    }\n  }, {\n    \"$addFields\": {\n      \"mensualAnt\": {\n        \"$first\": \"$mensualAnt\"\n      }, \n      \"anualAnt\": {\n        \"$first\": \"$anualAnt\"\n      }, \n      \"today\": \"$$REMOVE\", \n      \"todayLastMonth\": \"$$REMOVE\", \n      \"todayLastYear\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"mensualAnt\": \"$$REMOVE\", \n      \"anualAnt\": \"$$REMOVE\", \n      \"liquidaciones.montoLiqProd.comercial.acMensualAnt\": \"$mensualAnt.liquidaciones.montoLiqProd.comercial.acMensual\", \n      \"liquidaciones.montoLiqProd.comercial.acAnualAnt\": \"$anualAnt.liquidaciones.montoLiqProd.comercial.acAnual\", \n      \"liquidaciones.montoLiqProd.emprendeBdv.acMensualAnt\": \"$mensualAnt.liquidaciones.montoLiqProd.emprendeBdv.acMensual\", \n      \"liquidaciones.montoLiqProd.emprendeBdv.acAnualAnt\": \"$anualAnt.liquidaciones.montoLiqProd.emprendeBdv.acAnual\", \n      \"liquidaciones.montoLiqProd.hipotecario.acMensualAnt\": \"$mensualAnt.liquidaciones.montoLiqProd.hipotecario.acMensual\", \n      \"liquidaciones.montoLiqProd.hipotecario.acAnualAnt\": \"$anualAnt.liquidaciones.montoLiqProd.hipotecario.acAnual\", \n      \"liquidaciones.montoLiqProd.productivo.acMensualAnt\": \"$mensualAnt.liquidaciones.montoLiqProd.productivo.acMensual\", \n      \"liquidaciones.montoLiqProd.productivo.acAnualAnt\": \"$anualAnt.liquidaciones.montoLiqProd.productivo.acAnual\", \n      \"liquidaciones.montoLiqProd.totalBdv.acMensualAnt\": \"$mensualAnt.liquidaciones.montoLiqProd.totalBdv.acMensual\", \n      \"liquidaciones.montoLiqProd.totalBdv.acAnualAnt\": \"$anualAnt.liquidaciones.montoLiqProd.totalBdv.acAnual\", \n      \"liquidaciones.montoLiqProd.microCred.acMensualAnt\": \"$mensualAnt.liquidaciones.montoLiqProd.microCred.acMensual\", \n      \"liquidaciones.montoLiqProd.microCred.acAnualAnt\": \"$anualAnt.liquidaciones.montoLiqProd.microCred.acAnual\", \n      \"liquidaciones.numLiqProd.comercial.acMensualAnt\": \"$mensualAnt.liquidaciones.numLiqProd.comercial.acMensual\", \n      \"liquidaciones.numLiqProd.comercial.acAnualAnt\": \"$anualAnt.liquidaciones.numLiqProd.comercial.acAnual\", \n      \"liquidaciones.numLiqProd.emprendeBdv.acMensualAnt\": \"$mensualAnt.liquidaciones.numLiqProd.emprendeBdv.acMensual\", \n      \"liquidaciones.numLiqProd.emprendeBdv.acAnualAnt\": \"$anualAnt.liquidaciones.numLiqProd.emprendeBdv.acAnual\", \n      \"liquidaciones.numLiqProd.hipotecario.acMensualAnt\": \"$mensualAnt.liquidaciones.numLiqProd.hipotecario.acMensual\", \n      \"liquidaciones.numLiqProd.hipotecario.acAnualAnt\": \"$anualAnt.liquidaciones.numLiqProd.hipotecario.acAnual\", \n      \"liquidaciones.numLiqProd.productivo.acMensualAnt\": \"$mensualAnt.liquidaciones.numLiqProd.productivo.acMensual\", \n      \"liquidaciones.numLiqProd.productivo.acAnualAnt\": \"$anualAnt.liquidaciones.numLiqProd.productivo.acAnual\", \n      \"liquidaciones.numLiqProd.totalBdv.acMensualAnt\": \"$mensualAnt.liquidaciones.numLiqProd.totalBdv.acMensual\", \n      \"liquidaciones.numLiqProd.totalBdv.acAnualAnt\": \"$anualAnt.liquidaciones.numLiqProd.totalBdv.acAnual\", \n      \"liquidaciones.numLiqProd.microCred.acMensualAnt\": \"$mensualAnt.liquidaciones.numLiqProd.microCred.acMensual\", \n      \"liquidaciones.numLiqProd.microCred.acAnualAnt\": \"$anualAnt.liquidaciones.numLiqProd.microCred.acAnual\", \n      \"liquidacionesBs.montoLiqProd.comercial.acMensualAnt\": \"$mensualAnt.liquidacionesBs.montoLiqProd.comercial.acMensual\", \n      \"liquidacionesBs.montoLiqProd.comercial.acAnualAnt\": \"$anualAnt.liquidacionesBs.montoLiqProd.comercial.acAnual\", \n      \"liquidacionesBs.montoLiqProd.emprendeBdv.acMensualAnt\": \"$mensualAnt.liquidacionesBs.montoLiqProd.emprendeBdv.acMensual\", \n      \"liquidacionesBs.montoLiqProd.emprendeBdv.acAnualAnt\": \"$anualAnt.liquidacionesBs.montoLiqProd.emprendeBdv.acAnual\", \n      \"liquidacionesBs.montoLiqProd.hipotecario.acMensualAnt\": \"$mensualAnt.liquidacionesBs.montoLiqProd.hipotecario.acMensual\", \n      \"liquidacionesBs.montoLiqProd.hipotecario.acAnualAnt\": \"$anualAnt.liquidacionesBs.montoLiqProd.hipotecario.acAnual\", \n      \"liquidacionesBs.montoLiqProd.productivo.acMensualAnt\": \"$mensualAnt.liquidacionesBs.montoLiqProd.productivo.acMensual\", \n      \"liquidacionesBs.montoLiqProd.productivo.acAnualAnt\": \"$anualAnt.liquidacionesBs.montoLiqProd.productivo.acAnual\", \n      \"liquidacionesBs.montoLiqProd.totalBdv.acMensualAnt\": \"$mensualAnt.liquidacionesBs.montoLiqProd.totalBdv.acMensual\", \n      \"liquidacionesBs.montoLiqProd.totalBdv.acAnualAnt\": \"$anualAnt.liquidacionesBs.montoLiqProd.totalBdv.acAnual\", \n      \"liquidacionesBs.montoLiqProd.microCred.acMensualAnt\": \"$mensualAnt.liquidacionesBs.montoLiqProd.microCred.acMensual\", \n      \"liquidacionesBs.montoLiqProd.microCred.acAnualAnt\": \"$anualAnt.liquidacionesBs.montoLiqProd.microCred.acAnual\", \n      \"liquidacionesBs.numLiqProd.comercial.acMensualAnt\": \"$mensualAnt.liquidacionesBs.numLiqProd.comercial.acMensual\", \n      \"liquidacionesBs.numLiqProd.comercial.acAnualAnt\": \"$anualAnt.liquidacionesBs.numLiqProd.comercial.acAnual\", \n      \"liquidacionesBs.numLiqProd.emprendeBdv.acMensualAnt\": \"$mensualAnt.liquidacionesBs.numLiqProd.emprendeBdv.acMensual\", \n      \"liquidacionesBs.numLiqProd.emprendeBdv.acAnualAnt\": \"$anualAnt.liquidacionesBs.numLiqProd.emprendeBdv.acAnual\", \n      \"liquidacionesBs.numLiqProd.hipotecario.acMensualAnt\": \"$mensualAnt.liquidacionesBs.numLiqProd.hipotecario.acMensual\", \n      \"liquidacionesBs.numLiqProd.hipotecario.acAnualAnt\": \"$anualAnt.liquidacionesBs.numLiqProd.hipotecario.acAnual\", \n      \"liquidacionesBs.numLiqProd.productivo.acMensualAnt\": \"$mensualAnt.liquidacionesBs.numLiqProd.productivo.acMensual\", \n      \"liquidacionesBs.numLiqProd.productivo.acAnualAnt\": \"$anualAnt.liquidacionesBs.numLiqProd.productivo.acAnual\", \n      \"liquidacionesBs.numLiqProd.totalBdv.acMensualAnt\": \"$mensualAnt.liquidacionesBs.numLiqProd.totalBdv.acMensual\", \n      \"liquidacionesBs.numLiqProd.totalBdv.acAnualAnt\": \"$anualAnt.liquidacionesBs.numLiqProd.totalBdv.acAnual\", \n      \"liquidacionesBs.numLiqProd.microCred.acMensualAnt\": \"$mensualAnt.liquidacionesBs.numLiqProd.microCred.acMensual\", \n      \"liquidacionesBs.numLiqProd.microCred.acAnualAnt\": \"$anualAnt.liquidacionesBs.numLiqProd.microCred.acAnual\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"_id\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"discard\"\n    }\n  }\n]"
        },
        "id": "492891cb-bce3-4da2-8b2a-3a57e340f869",
        "name": "8_indicadoresMesAnoAnteriorBalancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          3980,
          5400
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/VentanaCalculosBalancemetric_TK32",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "1f8008ab-c25a-4760-aeb3-8501cbb11dda",
        "name": "HTTP Request13",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          2660,
          6700
        ]
      },
      {
        "parameters": {
          "content": "Ajusta la venta de dÃ­as para liquidaciones",
          "height": 237.29801055895746,
          "width": 1121.633826047121
        },
        "id": "10be89eb-56e3-47cb-81d5-ba1cc66ba8ca",
        "name": "Note",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          720,
          5280
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/TK32_LiquidacionesVentana",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "84c13c8e-f5b5-4a6a-bb0e-36eca5b5dbef",
        "name": "HTTP Request14",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          4620,
          5480
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/TK32_LiquidacionesVentana",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "1c89e330-a35b-43a8-aedb-6bd701a6863d",
        "name": "HTTP Request16",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          1620,
          5340
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "TK32_LiquidacionesVentana",
          "options": {}
        },
        "id": "58ca1cfb-db51-48f5-8040-704c2af13d1c",
        "name": "Webhook2",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          1620,
          5620
        ],
        "webhookId": "f9993361-60ee-4532-a6b5-91d5f5a04a39"
      },
      {
        "parameters": {
          "functionCode": "\n  // Obtener el dÃ­a de la semana actual (0 = Domingo, 1 = Lunes, ..., 6 = SÃ¡bado)\nconst today = new Date().getDay();\nvar window =1;\n\nif (today === 1) {\n    // Si es lunes, ventana se establece en 3\n  window = 3;\n} \n\nconst jsonOutput = {\n  offSet: window // Nombre del campo y valor deseado\n};\nreturn jsonOutput"
        },
        "name": "AjustaVentanaFinSemana",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          780,
          5320
        ],
        "id": "f43c3752-bf67-46f6-82a0-bcb1ef878c79",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "functionCode": "var body\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\n\n//asigna la variable offSet a offSet1\nlet offSet1 = body.offSet;\noffSet1 = parseInt(offSet1);\n\n//Arma el arreglo con los tres campos\nconst jsonOutput = {\n  offSet: offSet1 // Nombre del campo y valor deseado\n};\n\nreturn jsonOutput;"
        },
        "name": "FunctionItem2",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          -1500,
          7580
        ],
        "id": "86306681-5786-4af4-b3d1-02ada073fef1",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "mode": "chooseBranch"
        },
        "id": "7dbf6003-d76b-43de-805f-8f14f8e32b26",
        "name": "Merge9",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          -1480,
          7820
        ]
      },
      {
        "parameters": {
          "operation": "sort",
          "sortFieldsUi": {
            "sortField": [
              {
                "fieldName": "offSet",
                "order": "descending"
              }
            ]
          },
          "options": {}
        },
        "id": "feec2588-eb8b-40b7-90a5-3ae0e782a884",
        "name": "Item Lists",
        "type": "n8n-nodes-base.itemLists",
        "typeVersion": 1,
        "position": [
          -1120,
          7680
        ]
      },
      {
        "parameters": {
          "operation": "limit"
        },
        "id": "12f60be1-938f-45f4-b001-6becac71ae97",
        "name": "Item Lists1",
        "type": "n8n-nodes-base.itemLists",
        "typeVersion": 1,
        "position": [
          -980,
          7680
        ]
      },
      {
        "parameters": {
          "mode": "=append",
          "mergeByFields": {
            "values": [
              {}
            ]
          },
          "options": {}
        },
        "id": "59b76cf3-e5fb-417d-9e0d-12d8ab52c456",
        "name": "Merge10",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          960,
          5340
        ]
      },
      {
        "parameters": {
          "operation": "sort",
          "sortFieldsUi": {
            "sortField": [
              {
                "fieldName": "offSet",
                "order": "descending"
              }
            ]
          },
          "options": {}
        },
        "id": "07bd77fb-83f2-4b40-b84b-8d41a753f112",
        "name": "Item Lists2",
        "type": "n8n-nodes-base.itemLists",
        "typeVersion": 1,
        "position": [
          1100,
          5340
        ]
      },
      {
        "parameters": {
          "operation": "limit"
        },
        "id": "ef542d15-ad48-45e8-bac4-9931ae053a51",
        "name": "Item Lists3",
        "type": "n8n-nodes-base.itemLists",
        "typeVersion": 1,
        "position": [
          1260,
          5340
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm_ajustado",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          \"$updatedAt\", {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$$NOW\"\n              }, \n              \"month\": {\n                \"$month\": \"$$NOW\"\n              }, \n              \"day\": {\n                \"$dayOfMonth\": \"$$NOW\"\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"fecha_odate\": \"$fecha_odate\", \n        \"nucta\": \"$nucta\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$fecha_odate\", \"$fecha_odate\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$nucta\", \"$nucta\"\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"sidis_brm_ajustado\": {\n        \"debe\": \"$debe\", \n        \"haber\": \"$haber\", \n        \"sal_act\": \"$sal_act\", \n        \"sal_ant\": \"$sal_ant\", \n        \"sal_net_act\": \"$sal_net_act\", \n        \"fecha_odateAnt\": \"$fecha_odateAnt\", \n        \"fechaProceso\": \"$fechaProceso\"\n      }, \n      \"sidis_brm\": {\n        \"$first\": \"$sidis_brm\"\n      }, \n      \"fecha_odate\": 1, \n      \"nucta\": 1, \n      \"updatedAt\": {\n        \"$dateFromParts\": {\n          \"year\": {\n            \"$year\": \"$$NOW\"\n          }, \n          \"month\": {\n            \"$month\": \"$$NOW\"\n          }, \n          \"day\": {\n            \"$dayOfMonth\": \"$$NOW\"\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_brm_ajustado\": \"$$REMOVE\", \n      \"sidis_brm\": \"$$REMOVE\", \n      \"valAntAjuste.debe\": \"$sidis_brm.debe\", \n      \"valAntAjuste.haber\": \"$sidis_brm.haber\", \n      \"valAntAjuste.sal_ant\": \"$sidis_brm.sal_ant\", \n      \"valAntAjuste.sal_net_act\": \"$sidis_brm.sal_net_act\", \n      \"valAntAjuste.sal_act\": \"$sidis_brm.sal_act\", \n      \"valAntAjuste.fecha_odate\": \"$sidis_brm.fecha_odate\", \n      \"valAntAjuste.fechaProceso\": \"$sidis_brm.fechaProceso\", \n      \"debe\": \"$sidis_brm_ajustado.debe\", \n      \"haber\": \"$sidis_brm_ajustado.debe\", \n      \"sal_ant\": \"$sidis_brm_ajustado.sal_ant\", \n      \"sal_net_act\": \"$sidis_brm_ajustado.sal_net_act\", \n      \"sal_act\": \"$sidis_brm_ajustado.sal_act\", \n      \"fechaProceso\": \"$sidis_brm_ajustado.fechaProceso\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_brm\", \n      \"on\": [\n        \"fecha_odate\", \"nucta\"\n      ], \n      \"whenMatched\": \"merge\"\n    }\n  }\n]"
        },
        "id": "21a2a4fe-56ac-4664-b6b9-bfb3fac0356f",
        "name": "5_AjusteBrm_SidisBRMx",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -1680,
          8000
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "functionCode": "// Obtener el dÃ­a de la semana actual (0 = Domingo, 1 = Lunes, ..., 6 = SÃ¡bado)\nconst today = new Date().getDay();\nvar window\n\nfor (const item of $input.all()) {\n  window=item.json.offSet;\n}\n\nif (today === 0 || today === 6) {\n    // Si es domingo o sÃ¡bado, ventana se establece en 0\n   window = 1;\n} \n\nconst jsonOutput = {\n  offSet: window // Nombre del campo y valor deseado\n};\nreturn jsonOutput"
        },
        "name": "AjustaVentanaFinSemana1",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1420,
          5340
        ],
        "id": "ec3df38b-769a-4bcd-8621-3deafb49c71d",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "3d7bcfbe-70b5-4853-895f-c544c5665c5a",
        "name": "Merge11",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2760,
          9240
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "c5421e8f-8935-429f-ac24-8ba1c8cb072b",
        "name": "Merge29",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          3320,
          5180
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Liquidacionmetric",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          \"$fecha_valor\", {\n            \"$subtract\": [\n              {\n                \"$toDate\": {\n                  \"$dateFromString\": {\n                    \"dateString\": {\n                      \"$dateToString\": {\n                        \"format\": \"%Y-%m-%dT00:00:00%z\", \n                        \"date\": {\n                          \"$toDate\": \"$$NOW\"\n                        }\n                      }\n                    }\n                  }\n                }\n              }, {\n                \"$multiply\": [\n                  {\n                    \"$toInt\": \"{{$json.offSet}}\"\n                  }, 86400000\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"liquidaciones\": {\n        \"$first\": \"$result.liquidaciones\"\n      }, \n      \"liquidacionesBs\": {\n        \"$first\": \"$result.liquidacionesBs\"\n      }, \n      \"result\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"montoLiqProdVigente\": \"$$REMOVE\", \n      \"numLiqProdVigente\": \"$$REMOVE\", \n      \"montoLiqProdVigente45d\": \"$$REMOVE\", \n      \"montoLiqProdVigente6m\": \"$$REMOVE\", \n      \"montoLiqProdVigente9m\": \"$$REMOVE\", \n      \"montoLiqProdVigente1a\": \"$$REMOVE\", \n      \"montoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente\": \"$$REMOVE\", \n      \"comercialnumLiqProdVigente\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente\": \"$$REMOVE\", \n      \"productivonumLiqProdVigente\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente\": \"$$REMOVE\", \n      \"hipotecarionumLiqProdVigente\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente\": \"$$REMOVE\", \n      \"emprendeBdvnumLiqProdVigente\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente\": \"$$REMOVE\", \n      \"microCrednumLiqProdVigente\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"liquidaciones.montoLiqProd.totalBdv.actual\": \"$montoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.totalBdv.actual\": \"$numLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.dia45d\": \"$montoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.dia6m\": \"$montoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.dia9m\": \"$montoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.dia1a\": \"$montoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.diaMas1a\": \"$montoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.comercial.actual\": \"$comercialmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.comercial.actual\": \"$comercialnumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.dia45d\": \"$comercialmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.dia6m\": \"$comercialmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.dia9m\": \"$comercialmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.dia1a\": \"$comercialmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.diaMas1a\": \"$comercialmontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.productivo.actual\": \"$productivomontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.productivo.actual\": \"$productivonumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.dia45d\": \"$productivomontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.dia6m\": \"$productivomontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.dia9m\": \"$productivomontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.dia1a\": \"$productivomontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.diaMas1a\": \"$productivomontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.hipotecario.actual\": \"$hipotecariomontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.hipotecario.actual\": \"$hipotecarionumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.dia45d\": \"$hipotecariomontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.dia6m\": \"$hipotecariomontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.dia9m\": \"$hipotecariomontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.dia1a\": \"$hipotecariomontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.diaMas1a\": \"$hipotecariomontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.emprendeBdv.actual\": \"$emprendeBdvmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.emprendeBdv.actual\": \"$emprendeBdvnumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.dia45d\": \"$emprendeBdvmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.dia6m\": \"$emprendeBdvmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.dia9m\": \"$emprendeBdvmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.dia1a\": \"$emprendeBdvmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.diaMas1a\": \"$emprendeBdvmontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.microCred.actual\": \"$microCredmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.microCred.actual\": \"$microCrednumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.dia45d\": \"$microCredmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.dia6m\": \"$microCredmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.dia9m\": \"$microCredmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.dia1a\": \"$microCredmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.diaMas1a\": \"$microCredmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.totalBdv.actual\": \"$montoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.totalBdv.actual\": \"$numLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.dia45d\": \"$montoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.dia6m\": \"$montoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.dia9m\": \"$montoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.dia1a\": \"$montoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.diaMas1a\": \"$montoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.comercial.actual\": \"$comercialmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.comercial.actual\": \"$comercialnumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.dia45d\": \"$comercialmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.dia6m\": \"$comercialmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.dia9m\": \"$comercialmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.dia1a\": \"$comercialmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.diaMas1a\": \"$comercialmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.productivo.actual\": \"$productivomontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.productivo.actual\": \"$productivonumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.dia45d\": \"$productivomontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.dia6m\": \"$productivomontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.dia9m\": \"$productivomontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.dia1a\": \"$productivomontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.diaMas1a\": \"$productivomontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.hipotecario.actual\": \"$hipotecariomontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.hipotecario.actual\": \"$hipotecarionumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.dia45d\": \"$hipotecariomontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.dia6m\": \"$hipotecariomontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.dia9m\": \"$hipotecariomontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.dia1a\": \"$hipotecariomontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.diaMas1a\": \"$hipotecariomontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.emprendeBdv.actual\": \"$emprendeBdvmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.emprendeBdv.actual\": \"$emprendeBdvnumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.dia45d\": \"$emprendeBdvmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.dia6m\": \"$emprendeBdvmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.dia9m\": \"$emprendeBdvmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.dia1a\": \"$emprendeBdvmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.diaMas1a\": \"$emprendeBdvmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.microCred.actual\": \"$microCredmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.microCred.actual\": \"$microCrednumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.dia45d\": \"$microCredmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.dia6m\": \"$microCredmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.dia9m\": \"$microCredmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.dia1a\": \"$microCredmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.diaMas1a\": \"$microCredmontoLiqProdVigenteMas1a\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"result\": \"$$REMOVE\", \n      \"liquidaciones.montoLiqProd.totalBdv.actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.totalBdv.actual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.dia45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.dia45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.dia6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.dia6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.dia9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.dia9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.dia1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.dia1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.diaMas1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.diaMas1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.comercial.actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.comercial.actual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.dia45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.dia45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.dia6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.dia6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.dia9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.dia9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.dia1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.dia1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.diaMas1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.diaMas1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.productivo.actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.productivo.actual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.dia45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.dia45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.dia6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.dia6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.dia9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.dia9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.dia1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.dia1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.diaMas1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.diaMas1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.hipotecario.actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.hipotecario.actual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.dia45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.dia45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.dia6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.dia6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.dia9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.dia9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.dia1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.dia1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.diaMas1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.diaMas1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.emprendeBdv.actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.emprendeBdv.actual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.dia45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.dia45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.dia6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.dia6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.dia9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.dia9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.dia1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.dia1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.diaMas1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.diaMas1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.microCred.actual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.microCred.actual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.dia45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.dia45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.dia6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.dia6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.dia9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.dia9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.dia1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.dia1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.diaMas1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.diaMas1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"liquidaciones.montoLiqProd.totalBdv.nombre\": \"Total\", \n      \"liquidaciones.montoLiqProd.comercial.nombre\": \"Comercial\", \n      \"liquidaciones.montoLiqProd.productivo.nombre\": \"Productivo\", \n      \"liquidaciones.montoLiqProd.hipotecario.nombre\": \"Hipotecario\", \n      \"liquidaciones.montoLiqProd.emprendeBdv.nombre\": \"Emprende BDV\", \n      \"liquidaciones.montoLiqProd.microCred.nombre\": \"MicrocrÃ©dito\", \n      \"liquidaciones.numLiqProd.totalBdv.nombre\": \"Total\", \n      \"liquidaciones.numLiqProd.comercial.nombre\": \"Comercial\", \n      \"liquidaciones.numLiqProd.productivo.nombre\": \"Productivo\", \n      \"liquidaciones.numLiqProd.hipotecario.nombre\": \"Hipotecario\", \n      \"liquidaciones.numLiqProd.emprendeBdv.nombre\": \"Emprende BDV\", \n      \"liquidaciones.numLiqProd.microCred.nombre\": \"MicrocrÃ©dito\", \n      \"liquidacionesBs.montoLiqProd.totalBdv.nombre\": \"Total\", \n      \"liquidacionesBs.montoLiqProd.comercial.nombre\": \"Comercial\", \n      \"liquidacionesBs.montoLiqProd.productivo.nombre\": \"Productivo\", \n      \"liquidacionesBs.montoLiqProd.hipotecario.nombre\": \"Hipotecario\", \n      \"liquidacionesBs.montoLiqProd.emprendeBdv.nombre\": \"Emprende BDV\", \n      \"liquidacionesBs.montoLiqProd.microCred.nombre\": \"MicrocrÃ©dito\", \n      \"liquidacionesBs.numLiqProd.totalBdv.nombre\": \"Total\", \n      \"liquidacionesBs.numLiqProd.comercial.nombre\": \"Comercial\", \n      \"liquidacionesBs.numLiqProd.productivo.nombre\": \"Productivo\", \n      \"liquidacionesBs.numLiqProd.hipotecario.nombre\": \"Hipotecario\", \n      \"liquidacionesBs.numLiqProd.emprendeBdv.nombre\": \"Emprende BDV\", \n      \"liquidacionesBs.numLiqProd.microCred.nombre\": \"MicrocrÃ©dito\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "52d40fb0-8302-480e-8c64-b6609dfd0f6e",
        "name": "4_IndicadoresDiariosBalancemetric1",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2960,
          5080
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Liquidacionmetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"today\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"firstDayMonth\": {\n        \"$dateFromParts\": {\n          \"year\": {\n            \"$year\": \"$today\"\n          }, \n          \"month\": {\n            \"$month\": \"$today\"\n          }\n        }\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$and\": [\n        {\n          \"$expr\": {\n            \"$gte\": [\n              \"$fecha_valor\", \"$firstDayMonth\"\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$lte\": [\n              \"$fecha_valor\", \"$today\"\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"liquidaciones\": {\n        \"$first\": \"$result.liquidaciones\"\n      }, \n      \"liquidacionesBs\": {\n        \"$first\": \"$result.liquidacionesBs\"\n      }, \n      \"firstDayMonth\": \"$$REMOVE\"\n    }\n  }, {\n    \"$sort\": {\n      \"fecha_valor\": -1\n    }\n  }, {\n    \"$group\": {\n      \"_id\": \"$today\", \n      \"fecha_valor\": {\n        \"$first\": \"$today\"\n      }, \n      \"liquidaciones\": {\n        \"$first\": \"$liquidaciones\"\n      }, \n      \"liquidacionesBs\": {\n        \"$first\": \"$liquidacionesBs\"\n      }, \n      \"montoLiqProdVigente\": {\n        \"$sum\": \"$montoLiqProdVigente\"\n      }, \n      \"numLiqProdVigente\": {\n        \"$sum\": \"$numLiqProdVigente\"\n      }, \n      \"montoLiqProdVigente45d\": {\n        \"$sum\": \"$montoLiqProdVigente45d\"\n      }, \n      \"montoLiqProdVigente6m\": {\n        \"$sum\": \"$montoLiqProdVigente6m\"\n      }, \n      \"montoLiqProdVigente9m\": {\n        \"$sum\": \"$montoLiqProdVigente9m\"\n      }, \n      \"montoLiqProdVigente1a\": {\n        \"$sum\": \"$montoLiqProdVigente1a\"\n      }, \n      \"montoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$montoLiqProdVigenteMas1a\"\n      }, \n      \"comercialmontoLiqProdVigente\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente\"\n      }, \n      \"comercialnumLiqProdVigente\": {\n        \"$sum\": \"$comercialnumLiqProdVigente\"\n      }, \n      \"comercialmontoLiqProdVigente45d\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente45d\"\n      }, \n      \"comercialmontoLiqProdVigente6m\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente6m\"\n      }, \n      \"comercialmontoLiqProdVigente9m\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente9m\"\n      }, \n      \"comercialmontoLiqProdVigente1a\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente1a\"\n      }, \n      \"comercialmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$comercialmontoLiqProdVigenteMas1a\"\n      }, \n      \"productivomontoLiqProdVigente\": {\n        \"$sum\": \"$productivomontoLiqProdVigente\"\n      }, \n      \"productivonumLiqProdVigente\": {\n        \"$sum\": \"$productivonumLiqProdVigente\"\n      }, \n      \"productivomontoLiqProdVigente45d\": {\n        \"$sum\": \"$productivomontoLiqProdVigente45d\"\n      }, \n      \"productivomontoLiqProdVigente6m\": {\n        \"$sum\": \"$productivomontoLiqProdVigente6m\"\n      }, \n      \"productivomontoLiqProdVigente9m\": {\n        \"$sum\": \"$productivomontoLiqProdVigente9m\"\n      }, \n      \"productivomontoLiqProdVigente1a\": {\n        \"$sum\": \"$productivomontoLiqProdVigente1a\"\n      }, \n      \"productivomontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$productivomontoLiqProdVigenteMas1a\"\n      }, \n      \"hipotecariomontoLiqProdVigente\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente\"\n      }, \n      \"hipotecarionumLiqProdVigente\": {\n        \"$sum\": \"$hipotecarionumLiqProdVigente\"\n      }, \n      \"hipotecariomontoLiqProdVigente45d\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente45d\"\n      }, \n      \"hipotecariomontoLiqProdVigente6m\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente6m\"\n      }, \n      \"hipotecariomontoLiqProdVigente9m\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente9m\"\n      }, \n      \"hipotecariomontoLiqProdVigente1a\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente1a\"\n      }, \n      \"hipotecariomontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigenteMas1a\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente\"\n      }, \n      \"emprendeBdvnumLiqProdVigente\": {\n        \"$sum\": \"$emprendeBdvnumLiqProdVigente\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente45d\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente45d\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente6m\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente6m\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente9m\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente9m\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente1a\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente1a\"\n      }, \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigenteMas1a\"\n      }, \n      \"microCredmontoLiqProdVigente\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente\"\n      }, \n      \"microCrednumLiqProdVigente\": {\n        \"$sum\": \"$microCrednumLiqProdVigente\"\n      }, \n      \"microCredmontoLiqProdVigente45d\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente45d\"\n      }, \n      \"microCredmontoLiqProdVigente6m\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente6m\"\n      }, \n      \"microCredmontoLiqProdVigente9m\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente9m\"\n      }, \n      \"microCredmontoLiqProdVigente1a\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente1a\"\n      }, \n      \"microCredmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$microCredmontoLiqProdVigenteMas1a\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"montoLiqProdVigente\": \"$$REMOVE\", \n      \"numLiqProdVigente\": \"$$REMOVE\", \n      \"montoLiqProdVigente45d\": \"$$REMOVE\", \n      \"montoLiqProdVigente6m\": \"$$REMOVE\", \n      \"montoLiqProdVigente9m\": \"$$REMOVE\", \n      \"montoLiqProdVigente1a\": \"$$REMOVE\", \n      \"montoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente\": \"$$REMOVE\", \n      \"comercialnumLiqProdVigente\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente\": \"$$REMOVE\", \n      \"productivonumLiqProdVigente\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente\": \"$$REMOVE\", \n      \"hipotecarionumLiqProdVigente\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente\": \"$$REMOVE\", \n      \"emprendeBdvnumLiqProdVigente\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente\": \"$$REMOVE\", \n      \"microCrednumLiqProdVigente\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"liquidaciones.montoLiqProd.totalBdv.acMensual\": \"$montoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.totalBdv.acMensual\": \"$numLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acm45d\": \"$montoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acm6m\": \"$montoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acm9m\": \"$montoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acm1a\": \"$montoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acmMas\": \"$montoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.comercial.acMensual\": \"$comercialmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.comercial.acMensual\": \"$comercialnumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.acm45d\": \"$comercialmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.acm6m\": \"$comercialmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.acm9m\": \"$comercialmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.acm1a\": \"$comercialmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.acmMas\": \"$comercialmontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.productivo.acMensual\": \"$productivomontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.productivo.acMensual\": \"$productivonumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.acm45d\": \"$productivomontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.acm6m\": \"$productivomontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.acm9m\": \"$productivomontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.acm1a\": \"$productivomontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.acmMas\": \"$productivomontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.hipotecario.acMensual\": \"$hipotecariomontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.hipotecario.acMensual\": \"$hipotecarionumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acm45d\": \"$hipotecariomontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acm6m\": \"$hipotecariomontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acm9m\": \"$hipotecariomontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acm1a\": \"$hipotecariomontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acmMas\": \"$hipotecariomontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.emprendeBdv.acMensual\": \"$emprendeBdvmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.emprendeBdv.acMensual\": \"$emprendeBdvnumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acm45d\": \"$emprendeBdvmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acm6m\": \"$emprendeBdvmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acm9m\": \"$emprendeBdvmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acm1a\": \"$emprendeBdvmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acmMas\": \"$emprendeBdvmontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.microCred.acMensual\": \"$microCredmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.microCred.acMensual\": \"$microCrednumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.acm45d\": \"$microCredmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.acm6m\": \"$microCredmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.acm9m\": \"$microCredmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.acm1a\": \"$microCredmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.acmMas\": \"$microCredmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.totalBdv.acMensual\": \"$montoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.totalBdv.acMensual\": \"$numLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.acm45d\": \"$montoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.acm6m\": \"$montoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.acm9m\": \"$montoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.acm1a\": \"$montoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.acmMas\": \"$montoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.comercial.acMensual\": \"$comercialmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.comercial.acMensual\": \"$comercialnumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.acm45d\": \"$comercialmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.acm6m\": \"$comercialmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.acm9m\": \"$comercialmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.acm1a\": \"$comercialmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.acmMas\": \"$comercialmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.productivo.acMensual\": \"$productivomontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.productivo.acMensual\": \"$productivonumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.acm45d\": \"$productivomontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.acm6m\": \"$productivomontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.acm9m\": \"$productivomontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.acm1a\": \"$productivomontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.acmMas\": \"$productivomontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.hipotecario.acMensual\": \"$hipotecariomontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.hipotecario.acMensual\": \"$hipotecarionumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.acm45d\": \"$hipotecariomontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.acm6m\": \"$hipotecariomontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.acm9m\": \"$hipotecariomontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.acm1a\": \"$hipotecariomontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.acmMas\": \"$hipotecariomontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.emprendeBdv.acMensual\": \"$emprendeBdvmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.emprendeBdv.acMensual\": \"$emprendeBdvnumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.acm45d\": \"$emprendeBdvmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.acm6m\": \"$emprendeBdvmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.acm9m\": \"$emprendeBdvmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.acm1a\": \"$emprendeBdvmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.acmMas\": \"$emprendeBdvmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.microCred.acMensual\": \"$microCredmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.microCred.acMensual\": \"$microCrednumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.acm45d\": \"$microCredmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.acm6m\": \"$microCredmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.acm9m\": \"$microCredmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.acm1a\": \"$microCredmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.acmMas\": \"$microCredmontoLiqProdVigenteMas1a\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"result\": \"$$REMOVE\", \n      \"liquidaciones.montoLiqProd.totalBdv.acMensual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.totalBdv.acMensual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acm45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.acm45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acm6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.acm6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acm9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.acm9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acm1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.acm1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acmMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.acmMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.comercial.acMensual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.comercial.acMensual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.acm45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.acm45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.acm6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.acm6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.acm9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.acm9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.acm1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.acm1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.acmMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.acmMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.productivo.acMensual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.productivo.acMensual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.acm45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.acm45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.acm6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.acm6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.acm9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.acm9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.acm1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.acm1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.acmMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.acmMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.hipotecario.acMensual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.hipotecario.acMensual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acm45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.acm45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acm6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.acm6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acm9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.acm9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acm1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.acm1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acmMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.acmMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.emprendeBdv.acMensual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.emprendeBdv.acMensual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acm45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.acm45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acm6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.acm6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acm9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.acm9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acm1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.acm1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acmMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.acmMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.microCred.acMensual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.microCred.acMensual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.acm45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.acm45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.acm6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.acm6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.acm9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.acm9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.acm1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.acm1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.acmMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.acmMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "3bbae056-5434-460f-b2e3-4b98633ff010",
        "name": "5_IndicadoresMensualBalancemetric1",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2960,
          5260
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Liquidacionmetric",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"today\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"firstDayYear\": {\n        \"$dateFromParts\": {\n          \"year\": {\n            \"$year\": \"$today\"\n          }\n        }\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$and\": [\n        {\n          \"$expr\": {\n            \"$gte\": [\n              \"$fecha_valor\", \"$firstDayYear\"\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$lte\": [\n              \"$fecha_valor\", \"$today\"\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"liquidaciones\": {\n        \"$first\": \"$result.liquidaciones\"\n      }, \n      \"liquidacionesBs\": {\n        \"$first\": \"$result.liquidacionesBs\"\n      }, \n      \"result\": \"$$REMOVE\", \n      \"firstDayYear\": \"$$REMOVE\"\n    }\n  }, {\n    \"$sort\": {\n      \"fecha_valor\": -1\n    }\n  }, {\n    \"$group\": {\n      \"_id\": \"$today\", \n      \"fecha_valor\": {\n        \"$first\": \"$today\"\n      }, \n      \"liquidaciones\": {\n        \"$first\": \"$liquidaciones\"\n      }, \n      \"liquidacionesBs\": {\n        \"$first\": \"$liquidacionesBs\"\n      }, \n      \"montoLiqProdVigente\": {\n        \"$sum\": \"$montoLiqProdVigente\"\n      }, \n      \"numLiqProdVigente\": {\n        \"$sum\": \"$numLiqProdVigente\"\n      }, \n      \"montoLiqProdVigente45d\": {\n        \"$sum\": \"$montoLiqProdVigente45d\"\n      }, \n      \"montoLiqProdVigente6m\": {\n        \"$sum\": \"$montoLiqProdVigente6m\"\n      }, \n      \"montoLiqProdVigente9m\": {\n        \"$sum\": \"$montoLiqProdVigente9m\"\n      }, \n      \"montoLiqProdVigente1a\": {\n        \"$sum\": \"$montoLiqProdVigente1a\"\n      }, \n      \"montoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$montoLiqProdVigenteMas1a\"\n      }, \n      \"comercialmontoLiqProdVigente\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente\"\n      }, \n      \"comercialnumLiqProdVigente\": {\n        \"$sum\": \"$comercialnumLiqProdVigente\"\n      }, \n      \"comercialmontoLiqProdVigente45d\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente45d\"\n      }, \n      \"comercialmontoLiqProdVigente6m\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente6m\"\n      }, \n      \"comercialmontoLiqProdVigente9m\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente9m\"\n      }, \n      \"comercialmontoLiqProdVigente1a\": {\n        \"$sum\": \"$comercialmontoLiqProdVigente1a\"\n      }, \n      \"comercialmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$comercialmontoLiqProdVigenteMas1a\"\n      }, \n      \"productivomontoLiqProdVigente\": {\n        \"$sum\": \"$productivomontoLiqProdVigente\"\n      }, \n      \"productivonumLiqProdVigente\": {\n        \"$sum\": \"$productivonumLiqProdVigente\"\n      }, \n      \"productivomontoLiqProdVigente45d\": {\n        \"$sum\": \"$productivomontoLiqProdVigente45d\"\n      }, \n      \"productivomontoLiqProdVigente6m\": {\n        \"$sum\": \"$productivomontoLiqProdVigente6m\"\n      }, \n      \"productivomontoLiqProdVigente9m\": {\n        \"$sum\": \"$productivomontoLiqProdVigente9m\"\n      }, \n      \"productivomontoLiqProdVigente1a\": {\n        \"$sum\": \"$productivomontoLiqProdVigente1a\"\n      }, \n      \"productivomontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$productivomontoLiqProdVigenteMas1a\"\n      }, \n      \"hipotecariomontoLiqProdVigente\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente\"\n      }, \n      \"hipotecarionumLiqProdVigente\": {\n        \"$sum\": \"$hipotecarionumLiqProdVigente\"\n      }, \n      \"hipotecariomontoLiqProdVigente45d\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente45d\"\n      }, \n      \"hipotecariomontoLiqProdVigente6m\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente6m\"\n      }, \n      \"hipotecariomontoLiqProdVigente9m\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente9m\"\n      }, \n      \"hipotecariomontoLiqProdVigente1a\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigente1a\"\n      }, \n      \"hipotecariomontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$hipotecariomontoLiqProdVigenteMas1a\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente\"\n      }, \n      \"emprendeBdvnumLiqProdVigente\": {\n        \"$sum\": \"$emprendeBdvnumLiqProdVigente\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente45d\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente45d\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente6m\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente6m\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente9m\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente9m\"\n      }, \n      \"emprendeBdvmontoLiqProdVigente1a\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigente1a\"\n      }, \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$emprendeBdvmontoLiqProdVigenteMas1a\"\n      }, \n      \"microCredmontoLiqProdVigente\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente\"\n      }, \n      \"microCrednumLiqProdVigente\": {\n        \"$sum\": \"$microCrednumLiqProdVigente\"\n      }, \n      \"microCredmontoLiqProdVigente45d\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente45d\"\n      }, \n      \"microCredmontoLiqProdVigente6m\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente6m\"\n      }, \n      \"microCredmontoLiqProdVigente9m\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente9m\"\n      }, \n      \"microCredmontoLiqProdVigente1a\": {\n        \"$sum\": \"$microCredmontoLiqProdVigente1a\"\n      }, \n      \"microCredmontoLiqProdVigenteMas1a\": {\n        \"$sum\": \"$microCredmontoLiqProdVigenteMas1a\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"montoLiqProdVigente\": \"$$REMOVE\", \n      \"numLiqProdVigente\": \"$$REMOVE\", \n      \"montoLiqProdVigente45d\": \"$$REMOVE\", \n      \"montoLiqProdVigente6m\": \"$$REMOVE\", \n      \"montoLiqProdVigente9m\": \"$$REMOVE\", \n      \"montoLiqProdVigente1a\": \"$$REMOVE\", \n      \"montoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente\": \"$$REMOVE\", \n      \"comercialnumLiqProdVigente\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"comercialmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente\": \"$$REMOVE\", \n      \"productivonumLiqProdVigente\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"productivomontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente\": \"$$REMOVE\", \n      \"hipotecarionumLiqProdVigente\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"hipotecariomontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente\": \"$$REMOVE\", \n      \"emprendeBdvnumLiqProdVigente\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"emprendeBdvmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente\": \"$$REMOVE\", \n      \"microCrednumLiqProdVigente\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente45d\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente6m\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente9m\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigente1a\": \"$$REMOVE\", \n      \"microCredmontoLiqProdVigenteMas1a\": \"$$REMOVE\", \n      \"liquidaciones.montoLiqProd.totalBdv.acAnual\": \"$montoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.totalBdv.acAnual\": \"$numLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.aca45d\": \"$montoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.aca6m\": \"$montoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.aca9m\": \"$montoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.aca1a\": \"$montoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acaMas\": \"$montoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.comercial.acAnual\": \"$comercialmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.comercial.acAnual\": \"$comercialnumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.aca45d\": \"$comercialmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.aca6m\": \"$comercialmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.aca9m\": \"$comercialmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.aca1a\": \"$comercialmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.comercial.acaMas\": \"$comercialmontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.productivo.acAnual\": \"$productivomontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.productivo.acAnual\": \"$productivonumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.aca45d\": \"$productivomontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.aca6m\": \"$productivomontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.aca9m\": \"$productivomontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.aca1a\": \"$productivomontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.productivo.acaMas\": \"$productivomontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.hipotecario.acAnual\": \"$hipotecariomontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.hipotecario.acAnual\": \"$hipotecarionumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.aca45d\": \"$hipotecariomontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.aca6m\": \"$hipotecariomontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.aca9m\": \"$hipotecariomontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.aca1a\": \"$hipotecariomontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acaMas\": \"$hipotecariomontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.emprendeBdv.acAnual\": \"$emprendeBdvmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.emprendeBdv.acAnual\": \"$emprendeBdvnumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.aca45d\": \"$emprendeBdvmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.aca6m\": \"$emprendeBdvmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.aca9m\": \"$emprendeBdvmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.aca1a\": \"$emprendeBdvmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acaMas\": \"$emprendeBdvmontoLiqProdVigenteMas1a\", \n      \"liquidaciones.montoLiqProd.microCred.acAnual\": \"$microCredmontoLiqProdVigente\", \n      \"liquidaciones.numLiqProd.microCred.acAnual\": \"$microCrednumLiqProdVigente\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.aca45d\": \"$microCredmontoLiqProdVigente45d\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.aca6m\": \"$microCredmontoLiqProdVigente6m\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.aca9m\": \"$microCredmontoLiqProdVigente9m\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.aca1a\": \"$microCredmontoLiqProdVigente1a\", \n      \"liquidaciones.montLiquidadoPlazo.microCred.acaMas\": \"$microCredmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.totalBdv.acAnual\": \"$montoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.totalBdv.acAnual\": \"$numLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.aca45d\": \"$montoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.aca6m\": \"$montoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.aca9m\": \"$montoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.aca1a\": \"$montoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.totalBdv.acaMas\": \"$montoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.comercial.acAnual\": \"$comercialmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.comercial.acAnual\": \"$comercialnumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.aca45d\": \"$comercialmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.aca6m\": \"$comercialmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.aca9m\": \"$comercialmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.aca1a\": \"$comercialmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.comercial.acaMas\": \"$comercialmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.productivo.acAnual\": \"$productivomontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.productivo.acAnual\": \"$productivonumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.aca45d\": \"$productivomontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.aca6m\": \"$productivomontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.aca9m\": \"$productivomontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.aca1a\": \"$productivomontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.productivo.acaMas\": \"$productivomontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.hipotecario.acAnual\": \"$hipotecariomontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.hipotecario.acAnual\": \"$hipotecarionumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.aca45d\": \"$hipotecariomontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.aca6m\": \"$hipotecariomontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.aca9m\": \"$hipotecariomontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.aca1a\": \"$hipotecariomontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.hipotecario.acaMas\": \"$hipotecariomontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.emprendeBdv.acAnual\": \"$emprendeBdvmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.emprendeBdv.acAnual\": \"$emprendeBdvnumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.aca45d\": \"$emprendeBdvmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.aca6m\": \"$emprendeBdvmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.aca9m\": \"$emprendeBdvmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.aca1a\": \"$emprendeBdvmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.emprendeBdv.acaMas\": \"$emprendeBdvmontoLiqProdVigenteMas1a\", \n      \"liquidacionesBs.montoLiqProd.microCred.acAnual\": \"$microCredmontoLiqProdVigente\", \n      \"liquidacionesBs.numLiqProd.microCred.acAnual\": \"$microCrednumLiqProdVigente\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.aca45d\": \"$microCredmontoLiqProdVigente45d\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.aca6m\": \"$microCredmontoLiqProdVigente6m\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.aca9m\": \"$microCredmontoLiqProdVigente9m\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.aca1a\": \"$microCredmontoLiqProdVigente1a\", \n      \"liquidacionesBs.montLiquidadoPlazo.microCred.acaMas\": \"$microCredmontoLiqProdVigenteMas1a\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"result\": \"$$REMOVE\", \n      \"liquidaciones.montoLiqProd.totalBdv.acAnual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.totalBdv.acAnual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.aca45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.aca45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.aca6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.aca6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.aca9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.aca9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.aca1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.aca1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.totalBdv.acaMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.totalBdv.acaMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.comercial.acAnual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.comercial.acAnual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.aca45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.aca45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.aca6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.aca6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.aca9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.aca9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.aca1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.aca1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.comercial.acaMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.comercial.acaMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.productivo.acAnual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.productivo.acAnual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.aca45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.aca45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.aca6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.aca6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.aca9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.aca9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.aca1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.aca1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.productivo.acaMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.productivo.acaMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.hipotecario.acAnual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.hipotecario.acAnual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.aca45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.aca45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.aca6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.aca6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.aca9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.aca9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.aca1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.aca1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.hipotecario.acaMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.hipotecario.acaMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.emprendeBdv.acAnual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.emprendeBdv.acAnual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.aca45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.aca45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.aca6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.aca6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.aca9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.aca9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.aca1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.aca1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.emprendeBdv.acaMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.emprendeBdv.acaMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.microCred.acAnual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montoLiqProd.microCred.acAnual\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.aca45d\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.aca45d\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.aca6m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.aca6m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.aca9m\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.aca9m\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.aca1a\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.aca1a\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"liquidaciones.montLiquidadoPlazo.microCred.acaMas\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$liquidaciones.montLiquidadoPlazo.microCred.acaMas\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "196188f0-553c-40a0-a7a7-ee6218ccf4ab",
        "name": "6_IndicadoresAnualBalancemetric1",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2960,
          5440
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "23005fd3-67e1-4a0b-8589-91294a3be289",
        "name": "Merge35",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          3160,
          5000
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "6834380a-39df-4dca-a896-c4eff783ddbb",
        "name": "Merge37",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          3480,
          5540
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/TK32Balancemetric",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=1"
              }
            ]
          },
          "options": {}
        },
        "id": "a1e12461-5fa1-460d-b7b8-4812a40ac3d4",
        "name": "HTTP Request",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          -2980,
          7580
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"8_Procesamiento_IngresosComision\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem8",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1360,
          7800
        ],
        "id": "d455809b-0b8b-418c-93f8-8270b0e6a143",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "7bcb55ec-956c-40cc-9ea4-0ea15066fdcc",
        "name": "IF1",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1340,
          6780
        ]
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "2cfceefc-cac3-45cb-835a-af0d596cc4d1",
        "name": "IF2",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1540,
          7800
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "7614a376-d558-4a09-b902-95fd5beed74b",
        "name": "Merge14",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1960,
          7760
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$lookup\": {\n      \"from\": \"Parametricingresocomisiones\", \n      \"pipeline\": [\n        {\n          \"$project\": {\n            \"cuentaContable\": 1, \n            \"productoControlGestion\": 1, \n            \"_id\": 0\n          }\n        }\n      ], \n      \"as\": \"Parametricingresocomisiones\"\n    }\n  }, {\n    \"$project\": {\n      \"Parametricingresocomisiones\": 1, \n      \"cuentasContable\": \"$Parametricingresocomisiones.cuentaContable\", \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$$todayDate\", \"$fecha_odate\"\n              ]\n            }\n          }\n        }, {\n          \"$project\": {\n            \"nucta\": 1, \n            \"sal_act\": {\n              \"$multiply\": [\n                \"$sal_act\", -1\n              ]\n            }, \n            \"sal_ant\": {\n              \"$multiply\": [\n                \"$sal_ant\", -1\n              ]\n            }, \n            \"sal_net_act\": {\n              \"$multiply\": [\n                \"$sal_net_act\", -1\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$addFields\": {\n      \"avaiableData\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_brm\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"firstDayMonth\": {\n        \"$eq\": [\n          {\n            \"$dayOfMonth\": \"$todayDate\"\n          }, 1\n        ]\n      }, \n      \"firstDayYear\": {\n        \"$and\": [\n          {\n            \"$eq\": [\n              {\n                \"$dayOfMonth\": \"$todayDate\"\n              }, 1\n            ]\n          }, {\n            \"$eq\": [\n              {\n                \"$month\": \"$todayDate\"\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"sidis_brm\": {\n        \"$filter\": {\n          \"input\": \"$sidis_brm\", \n          \"as\": \"brm\", \n          \"cond\": {\n            \"$in\": [\n              \"$$brm.nucta\", \"$cuentasContable\"\n            ]\n          }\n        }\n      }, \n      \"cuentasContable\": \"$$REMOVE\", \n      \"yesterdayDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"tomorrowDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": 1\n        }\n      }, \n      \"previusMonthDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"PreviusMonthlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$month\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"previusYearDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }, \n      \"PreviusYearlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_brm\": {\n        \"$map\": {\n          \"input\": \"$sidis_brm\", \n          \"as\": \"brm\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$brm\", {\n                \"producto\": {\n                  \"$arrayElemAt\": [\n                    {\n                      \"$filter\": {\n                        \"input\": {\n                          \"$map\": {\n                            \"input\": \"$Parametricingresocomisiones\", \n                            \"as\": \"liquidaciones\", \n                            \"in\": {\n                              \"$cond\": [\n                                {\n                                  \"$eq\": [\n                                    \"$$liquidaciones.cuentaContable\", \"$$brm.nucta\"\n                                  ]\n                                }, \"$$liquidaciones.productoControlGestion\", null\n                              ]\n                            }\n                          }\n                        }, \n                        \"as\": \"filtered\", \n                        \"cond\": {\n                          \"$ne\": [\n                            \"$$filtered\", null\n                          ]\n                        }\n                      }\n                    }, 0\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"Parametricingresocomisiones\": \"$$REMOVE\", \n      \"sidis_brm\": \"$REMOVE\", \n      \"sal_actTotalBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": \"$$brm.sal_act\"\n          }\n        }\n      }, \n      \"sal_antTotalBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": \"$$brm.sal_ant\"\n          }\n        }\n      }, \n      \"sal_net_actTotalBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": \"$$brm.sal_net_act\"\n          }\n        }\n      }, \n      \"sal_actPOSBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"POS\"\n                  ]\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antPOSBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"POS\"\n                  ]\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actPOSBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"POS\"\n                  ]\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_actOperacionesCambiariasBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Operaciones Cambiarias\"\n                  ]\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antOperacionesCambiariasBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Operaciones Cambiarias\"\n                  ]\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actOperacionesCambiariasBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Operaciones Cambiarias\"\n                  ]\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_actMediosdePagoBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Medios de Pago\"\n                  ]\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antMediosdePagoBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Medios de Pago\"\n                  ]\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actMediosdePagoBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Medios de Pago\"\n                  ]\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_actPagoProveedoresBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Pago Proveedores\"\n                  ]\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antPagoProveedoresBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Pago Proveedores\"\n                  ]\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actPagoProveedoresBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Pago Proveedores\"\n                  ]\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_actConsultadeSaldoBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Consulta de Saldo\"\n                  ]\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antConsultadeSaldoBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Consulta de Saldo\"\n                  ]\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actConsultadeSaldoBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Consulta de Saldo\"\n                  ]\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_actRecaudacionBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"RecaudaciÃ³n\"\n                  ]\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antRecaudacionBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"RecaudaciÃ³n\"\n                  ]\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actRecaudacionBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"RecaudaciÃ³n\"\n                  ]\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_actNominaBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"NÃ³mina\"\n                  ]\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antNominaBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"NÃ³mina\"\n                  ]\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actNominaBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"NÃ³mina\"\n                  ]\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_actPagoMovilBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Pago MÃ³vil\"\n                  ]\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antPagoMovilBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Pago MÃ³vil\"\n                  ]\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actPagoMovilBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$eq\": [\n                    \"$$brm.producto\", \"Pago MÃ³vil\"\n                  ]\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_actOtrosBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$not\": {\n                    \"$in\": [\n                      \"$$brm.producto\", [\n                        \"POS\", \"Operaciones Cambiarias\", \"Medios de Pago\", \"Pago Proveedores\", \"Consulta de Saldo\", \"RecaudaciÃ³n\", \"NÃ³mina\", \"Pago MÃ³vil\"\n                      ]\n                    ]\n                  }\n                }, \"$$brm.sal_act\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_antOtrosBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$not\": {\n                    \"$in\": [\n                      \"$$brm.producto\", [\n                        \"POS\", \"Operaciones Cambiarias\", \"Medios de Pago\", \"Pago Proveedores\", \"Consulta de Saldo\", \"RecaudaciÃ³n\", \"NÃ³mina\", \"Pago MÃ³vil\"\n                      ]\n                    ]\n                  }\n                }, \"$$brm.sal_ant\", 0\n              ]\n            }\n          }\n        }\n      }, \n      \"sal_net_actOtrosBs\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$not\": {\n                    \"$in\": [\n                      \"$$brm.producto\", [\n                        \"POS\", \"Operaciones Cambiarias\", \"Medios de Pago\", \"Pago Proveedores\", \"Consulta de Saldo\", \"RecaudaciÃ³n\", \"NÃ³mina\", \"Pago MÃ³vil\"\n                      ]\n                    ]\n                  }\n                }, \"$$brm.sal_net_act\", 0\n              ]\n            }\n          }\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"IngresosComisionesMetric\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"IngresosComisionesMetricYesterday\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"IngresosComisionesMetric\", \n      \"localField\": \"PreviusMonthlastDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"IngresosComisionesMetricPreviusMonthlastDate\"\n    }\n  }, {\n    \"$addFields\": {\n      \"fecha_valor\": \"$todayDate\", \n      \"todayDate\": \"$$REMOVE\", \n      \"sal_actTotalBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actTotalBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actTotalBs\"\n          }\n        ]\n      }, \n      \"sal_antTotalBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antTotalBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antTotalBs\"\n          }\n        ]\n      }, \n      \"sal_net_actTotalBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actTotalBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actTotalBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antTotalBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actPOSBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actPOSBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPOSBs\"\n          }\n        ]\n      }, \n      \"sal_antPOSBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antPOSBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antPOSBs\"\n          }\n        ]\n      }, \n      \"sal_net_actPOSBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actPOSBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPOSBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antPOSBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actOperacionesCambiariasBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actOperacionesCambiariasBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actOperacionesCambiariasBs\"\n          }\n        ]\n      }, \n      \"sal_antOperacionesCambiariasBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antOperacionesCambiariasBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antOperacionesCambiariasBs\"\n          }\n        ]\n      }, \n      \"sal_net_actOperacionesCambiariasBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actOperacionesCambiariasBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actOperacionesCambiariasBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antOperacionesCambiariasBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actMediosdePagoBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actMediosdePagoBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actMediosdePagoBs\"\n          }\n        ]\n      }, \n      \"sal_antMediosdePagoBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antMediosdePagoBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antMediosdePagoBs\"\n          }\n        ]\n      }, \n      \"sal_net_actMediosdePagoBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actMediosdePagoBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actMediosdePagoBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antMediosdePagoBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actPagoProveedoresBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actPagoProveedoresBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPagoProveedoresBs\"\n          }\n        ]\n      }, \n      \"sal_antPagoProveedoresBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antPagoProveedoresBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antPagoProveedoresBs\"\n          }\n        ]\n      }, \n      \"sal_net_actPagoProveedoresBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actPagoProveedoresBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPagoProveedoresBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antPagoProveedoresBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actConsultadeSaldoBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actConsultadeSaldoBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actConsultadeSaldoBs\"\n          }\n        ]\n      }, \n      \"sal_antConsultadeSaldoBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antConsultadeSaldoBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antConsultadeSaldoBs\"\n          }\n        ]\n      }, \n      \"sal_net_actConsultadeSaldoBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actConsultadeSaldoBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actConsultadeSaldoBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antConsultadeSaldoBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actRecaudacionBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actRecaudacionBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actRecaudacionBs\"\n          }\n        ]\n      }, \n      \"sal_antRecaudacionBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antRecaudacionBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antRecaudacionBs\"\n          }\n        ]\n      }, \n      \"sal_net_actRecaudacionBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actRecaudacionBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actRecaudacionBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antRecaudacionBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actNominaBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actNominaBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actNominaBs\"\n          }\n        ]\n      }, \n      \"sal_antNominaBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antNominaBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antNominaBs\"\n          }\n        ]\n      }, \n      \"sal_net_actNominaBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actNominaBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actNominaBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antNominaBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actPagoMovilBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actPagoMovilBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPagoMovilBs\"\n          }\n        ]\n      }, \n      \"sal_antPagoMovilBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antPagoMovilBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antPagoMovilBs\"\n          }\n        ]\n      }, \n      \"sal_net_actPagoMovilBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actPagoMovilBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPagoMovilBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antPagoMovilBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actOtrosBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_actOtrosBs\", {\n            \"$first\": \"$IngresosComisionesMetricYesterday.sal_actOtrosBs\"\n          }\n        ]\n      }, \n      \"sal_antOtrosBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_antOtrosBs\", {\n            \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antOtrosBs\"\n          }\n        ]\n      }, \n      \"sal_net_actOtrosBs\": {\n        \"$cond\": [\n          \"$avaiableData\", \"$sal_net_actOtrosBs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actOtrosBs\"\n              }, {\n                \"$first\": \"$IngresosComisionesMetricPreviusMonthlastDate.sal_antOtrosBs\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"sal_actTotal\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actTotalBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotal\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antTotalBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotal\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actTotalBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actPOS\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actPOSBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antPOS\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antPOSBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actPOS\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actPOSBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actOperacionesCambiarias\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actOperacionesCambiariasBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antOperacionesCambiarias\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antOperacionesCambiariasBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actOperacionesCambiarias\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actOperacionesCambiariasBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actMediosdePago\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actMediosdePagoBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antMediosdePago\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antMediosdePagoBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actMediosdePago\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actMediosdePagoBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actPagoProveedores\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actPagoProveedoresBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antPagoProveedores\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antPagoProveedoresBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actPagoProveedores\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actPagoProveedoresBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actConsultadeSaldo\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actConsultadeSaldoBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antConsultadeSaldo\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antConsultadeSaldoBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actConsultadeSaldo\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actConsultadeSaldoBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actRecaudacion\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actRecaudacionBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antRecaudacion\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antRecaudacionBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actRecaudacion\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actRecaudacionBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actNomina\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actNominaBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antNomina\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antNominaBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actNomina\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actNominaBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actPagoMovil\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actPagoMovilBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antPagoMovil\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antPagoMovilBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actPagoMovil\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actPagoMovilBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actOtros\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actOtrosBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antOtros\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antOtrosBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actOtros\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_actOtrosBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"IngresosComisionesMetricYesterday\": \"$$REMOVE\", \n      \"IngresosComisionesMetricPreviusMonthlastDate\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"adjustmentCond\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$IngresosComisionesMetricYesterday.adjustmentCond\"\n                      }, true\n                    ]\n                  }, {\n                    \"$in\": [\n                      {\n                        \"$month\": \"$fecha_valor\"\n                      }, [\n                        7, 8, 9, 10, 11, 12\n                      ]\n                    ]\n                  }\n                ]\n              }, \n              \"then\": true\n            }, {\n              \"case\": {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$IngresosComisionesMetricYesterday.adjustmentCond\"\n                      }, false\n                    ]\n                  }, {\n                    \"$lte\": [\n                      {\n                        \"$first\": \"$IngresosComisionesMetricYesterday.adjustmentCond\"\n                      }, null\n                    ]\n                  }\n                ]\n              }, \n              \"then\": {\n                \"$cond\": [\n                  {\n                    \"$and\": [\n                      {\n                        \"$lte\": [\n                          {\n                            \"$ifNull\": [\n                              {\n                                \"$divide\": [\n                                  \"$sal_actTotal\", {\n                                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actTotal\"\n                                  }\n                                ]\n                              }, 1\n                            ]\n                          }, 0.5\n                        ]\n                      }, {\n                        \"$eq\": [\n                          {\n                            \"$month\": \"$fecha_valor\"\n                          }, 7\n                        ]\n                      }\n                    ]\n                  }, true, false\n                ]\n              }\n            }\n          ], \n          \"default\": false\n        }\n      }, \n      \"adjustmenrCondJanuary\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$firstDayYear\", \n              \"then\": true\n            }, {\n              \"case\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$fecha_valor\"\n                      }, 1\n                    ]\n                  }, {\n                    \"$lte\": [\n                      {\n                        \"$ifNull\": [\n                          {\n                            \"$divide\": [\n                              {\n                                \"$first\": \"$IngresosComisionesMetricYesterday.sal_actTotal\"\n                              }, \"$sal_actTotal\"\n                            ]\n                          }, 1\n                        ]\n                      }, 2\n                    ]\n                  }, {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$IngresosComisionesMetricYesterday.adjustmenrCondJanuary\"\n                      }, true\n                    ]\n                  }\n                ]\n              }, \n              \"then\": true\n            }, {\n              \"case\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$fecha_valor\"\n                      }, 1\n                    ]\n                  }, {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$IngresosComisionesMetricYesterday.adjustmenrCondJanuary\"\n                      }, false\n                    ]\n                  }\n                ]\n              }, \n              \"then\": false\n            }\n          ], \n          \"default\": false\n        }\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"IngresosComisionesMetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "195302b7-08a5-42b6-b569-db3d688804f2",
        "name": "01_IngresosPorComisionDiario_ingresosComisionMetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1740,
          7640
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "IngresosComisionesMetric",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          \"$fecha_valor\", {\n            \"$subtract\": [\n              {\n                \"$toDate\": {\n                  \"$dateFromString\": {\n                    \"dateString\": {\n                      \"$dateToString\": {\n                        \"format\": \"%Y-%m-%dT00:00:00%z\", \n                        \"date\": {\n                          \"$toDate\": \"$$NOW\"\n                        }\n                      }\n                    }\n                  }\n                }\n              }, {\n                \"$multiply\": [\n                  {\n                    \"$toInt\": \"{{$json.offSet}}\"\n                  }, 86400000\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"IngresosComisionesMetric\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"IngresosComisionesMetricYesterday\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"IngresosComisionesMetric\", \n      \"localField\": \"previusMonthDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"IngresosComisionesMetricpreviusMonth\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"IngresosComisionesMetric\", \n      \"localField\": \"previusYearDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"IngresosComisionesMetricpreviusYear\"\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"fecha_valor\": 1, \n      \"icActualBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actTotalBs\", {\n            \"$subtract\": [\n              \"$sal_net_actTotalBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actTotalBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualBs\": \"$sal_net_actTotalBs\", \n      \"icAcMensualAntBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actTotalBs\"\n      }, \n      \"icVarMensualBs\": {\n        \"$subtract\": [\n          \"$sal_net_actTotalBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actTotalBs\"\n          }\n        ]\n      }, \n      \"icAcAnualBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actTotalBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actTotalBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actTotalBs\"\n        }\n      }, \n      \"icAcAnualAntBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actTotalBs\"\n      }, \n      \"icActualPOSBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actPOSBs\", {\n            \"$subtract\": [\n              \"$sal_net_actPOSBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actPOSBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualPOSBs\": \"$sal_net_actPOSBs\", \n      \"icAcMensualAntPOSBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPOSBs\"\n      }, \n      \"icVarMensualPOSBs\": {\n        \"$subtract\": [\n          \"$sal_net_actPOSBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPOSBs\"\n          }\n        ]\n      }, \n      \"icAcAnualPOSBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actPOSBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPOSBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actPOSBs\"\n        }\n      }, \n      \"icAcAnualAntPOSBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actPOSBs\"\n      }, \n      \"icActualOperacionesCambiariasBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actOperacionesCambiariasBs\", {\n            \"$subtract\": [\n              \"$sal_net_actOperacionesCambiariasBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actOperacionesCambiariasBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualOperacionesCambiariasBs\": \"$sal_net_actOperacionesCambiariasBs\", \n      \"icAcMensualAntOperacionesCambiariasBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actOperacionesCambiariasBs\"\n      }, \n      \"icVarMensualOperacionesCambiariasBs\": {\n        \"$subtract\": [\n          \"$sal_net_actOperacionesCambiariasBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actOperacionesCambiariasBs\"\n          }\n        ]\n      }, \n      \"icAcAnualOperacionesCambiariasBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actOperacionesCambiariasBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actOperacionesCambiariasBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actOperacionesCambiariasBs\"\n        }\n      }, \n      \"icAcAnualAntOperacionesCambiariasBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actOperacionesCambiariasBs\"\n      }, \n      \"icActualMediosdePagoBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actMediosdePagoBs\", {\n            \"$subtract\": [\n              \"$sal_net_actMediosdePagoBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actMediosdePagoBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualMediosdePagoBs\": \"$sal_net_actMediosdePagoBs\", \n      \"icAcMensualAntMediosdePagoBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actMediosdePagoBs\"\n      }, \n      \"icVarMensualMediosdePagoBs\": {\n        \"$subtract\": [\n          \"$sal_net_actMediosdePagoBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actMediosdePagoBs\"\n          }\n        ]\n      }, \n      \"icAcAnualMediosdePagoBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actMediosdePagoBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actMediosdePagoBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actMediosdePagoBs\"\n        }\n      }, \n      \"icAcAnualAntMediosdePagoBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actMediosdePagoBs\"\n      }, \n      \"icActualPagoProveedoresBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actPagoProveedoresBs\", {\n            \"$subtract\": [\n              \"$sal_net_actPagoProveedoresBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actPagoProveedoresBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualPagoProveedoresBs\": \"$sal_net_actPagoProveedoresBs\", \n      \"icAcMensualAntPagoProveedoresBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPagoProveedoresBs\"\n      }, \n      \"icVarMensualPagoProveedoresBs\": {\n        \"$subtract\": [\n          \"$sal_net_actPagoProveedoresBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPagoProveedoresBs\"\n          }\n        ]\n      }, \n      \"icAcAnualPagoProveedoresBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actPagoProveedoresBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPagoProveedoresBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actPagoProveedoresBs\"\n        }\n      }, \n      \"icAcAnualAntPagoProveedoresBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actPagoProveedoresBs\"\n      }, \n      \"icActualConsultadeSaldoBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actConsultadeSaldoBs\", {\n            \"$subtract\": [\n              \"$sal_net_actConsultadeSaldoBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actConsultadeSaldoBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualConsultadeSaldoBs\": \"$sal_net_actConsultadeSaldoBs\", \n      \"icAcMensualAntConsultadeSaldoBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actConsultadeSaldoBs\"\n      }, \n      \"icVarMensualConsultadeSaldoBs\": {\n        \"$subtract\": [\n          \"$sal_net_actConsultadeSaldoBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actConsultadeSaldoBs\"\n          }\n        ]\n      }, \n      \"icAcAnualConsultadeSaldoBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actConsultadeSaldoBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actConsultadeSaldoBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actConsultadeSaldoBs\"\n        }\n      }, \n      \"icAcAnualAntConsultadeSaldoBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actConsultadeSaldoBs\"\n      }, \n      \"icActualRecaudacionBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actRecaudacionBs\", {\n            \"$subtract\": [\n              \"$sal_net_actRecaudacionBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actRecaudacionBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualRecaudacionBs\": \"$sal_net_actRecaudacionBs\", \n      \"icAcMensualAntRecaudacionBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actRecaudacionBs\"\n      }, \n      \"icVarMensualRecaudacionBs\": {\n        \"$subtract\": [\n          \"$sal_net_actRecaudacionBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actRecaudacionBs\"\n          }\n        ]\n      }, \n      \"icAcAnualRecaudacionBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actRecaudacionBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actRecaudacionBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actRecaudacionBs\"\n        }\n      }, \n      \"icAcAnualAntRecaudacionBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actRecaudacionBs\"\n      }, \n      \"icActualNominaBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actNominaBs\", {\n            \"$subtract\": [\n              \"$sal_net_actNominaBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actNominaBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualNominaBs\": \"$sal_net_actNominaBs\", \n      \"icAcMensualAntNominaBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actNominaBs\"\n      }, \n      \"icVarMensualNominaBs\": {\n        \"$subtract\": [\n          \"$sal_net_actNominaBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actNominaBs\"\n          }\n        ]\n      }, \n      \"icAcAnualNominaBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actNominaBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actNominaBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actNominaBs\"\n        }\n      }, \n      \"icAcAnualAntNominaBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actNominaBs\"\n      }, \n      \"icActualPagoMovilBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actPagoMovilBs\", {\n            \"$subtract\": [\n              \"$sal_net_actPagoMovilBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actPagoMovilBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualPagoMovilBs\": \"$sal_net_actPagoMovilBs\", \n      \"icAcMensualAntPagoMovilBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPagoMovilBs\"\n      }, \n      \"icVarMensualPagoMovilBs\": {\n        \"$subtract\": [\n          \"$sal_net_actPagoMovilBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPagoMovilBs\"\n          }\n        ]\n      }, \n      \"icAcAnualPagoMovilBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actPagoMovilBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPagoMovilBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actPagoMovilBs\"\n        }\n      }, \n      \"icAcAnualAntPagoMovilBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actPagoMovilBs\"\n      }, \n      \"icActualOtrosBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actOtrosBs\", {\n            \"$subtract\": [\n              \"$sal_net_actOtrosBs\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actOtrosBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualOtrosBs\": \"$sal_net_actOtrosBs\", \n      \"icAcMensualAntOtrosBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actOtrosBs\"\n      }, \n      \"icVarMensualOtrosBs\": {\n        \"$subtract\": [\n          \"$sal_net_actOtrosBs\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actOtrosBs\"\n          }\n        ]\n      }, \n      \"icAcAnualOtrosBs\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actOtrosBs\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actOtrosBs\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actOtrosBs\"\n        }\n      }, \n      \"icAcAnualAntOtrosBs\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actOtrosBs\"\n      }, \n      \"icActual\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actTotal\", {\n            \"$subtract\": [\n              \"$sal_net_actTotal\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actTotal\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensual\": \"$sal_net_actTotal\", \n      \"icAcMensualAnt\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actTotal\"\n      }, \n      \"icVarMensual\": {\n        \"$subtract\": [\n          \"$sal_net_actTotal\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actTotal\"\n          }\n        ]\n      }, \n      \"icAcAnual\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actTotal\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actTotal\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actTotal\"\n        }\n      }, \n      \"icAcAnualAnt\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actTotal\"\n      }, \n      \"icActualPOS\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actPOS\", {\n            \"$subtract\": [\n              \"$sal_net_actPOS\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actPOS\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualPOS\": \"$sal_net_actPOS\", \n      \"icAcMensualAntPOS\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPOS\"\n      }, \n      \"icVarMensualPOS\": {\n        \"$subtract\": [\n          \"$sal_net_actPOS\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPOS\"\n          }\n        ]\n      }, \n      \"icAcAnualPOS\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actPOS\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPOS\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actPOS\"\n        }\n      }, \n      \"icAcAnualAntPOS\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actPOS\"\n      }, \n      \"icActualOperacionesCambiarias\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actOperacionesCambiarias\", {\n            \"$subtract\": [\n              \"$sal_net_actOperacionesCambiarias\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actOperacionesCambiarias\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualOperacionesCambiarias\": \"$sal_net_actOperacionesCambiarias\", \n      \"icAcMensualAntOperacionesCambiarias\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actOperacionesCambiarias\"\n      }, \n      \"icVarMensualOperacionesCambiarias\": {\n        \"$subtract\": [\n          \"$sal_net_actOperacionesCambiarias\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actOperacionesCambiarias\"\n          }\n        ]\n      }, \n      \"icAcAnualOperacionesCambiarias\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actOperacionesCambiarias\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actOperacionesCambiarias\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actOperacionesCambiarias\"\n        }\n      }, \n      \"icAcAnualAntOperacionesCambiarias\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actOperacionesCambiarias\"\n      }, \n      \"icActualMediosdePago\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actMediosdePago\", {\n            \"$subtract\": [\n              \"$sal_net_actMediosdePago\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actMediosdePago\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualMediosdePago\": \"$sal_net_actMediosdePago\", \n      \"icAcMensualAntMediosdePago\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actMediosdePago\"\n      }, \n      \"icVarMensualMediosdePago\": {\n        \"$subtract\": [\n          \"$sal_net_actMediosdePago\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actMediosdePago\"\n          }\n        ]\n      }, \n      \"icAcAnualMediosdePago\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actMediosdePago\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actMediosdePago\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actMediosdePago\"\n        }\n      }, \n      \"icAcAnualAntMediosdePago\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actMediosdePago\"\n      }, \n      \"icActualPagoProveedores\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actPagoProveedores\", {\n            \"$subtract\": [\n              \"$sal_net_actPagoProveedores\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actPagoProveedores\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualPagoProveedores\": \"$sal_net_actPagoProveedores\", \n      \"icAcMensualAntPagoProveedores\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPagoProveedores\"\n      }, \n      \"icVarMensualPagoProveedores\": {\n        \"$subtract\": [\n          \"$sal_net_actPagoProveedores\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPagoProveedores\"\n          }\n        ]\n      }, \n      \"icAcAnualPagoProveedores\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actPagoProveedores\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPagoProveedores\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actPagoProveedores\"\n        }\n      }, \n      \"icAcAnualAntPagoProveedores\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actPagoProveedores\"\n      }, \n      \"icActualConsultadeSaldo\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actConsultadeSaldo\", {\n            \"$subtract\": [\n              \"$sal_net_actConsultadeSaldo\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actConsultadeSaldo\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualConsultadeSaldo\": \"$sal_net_actConsultadeSaldo\", \n      \"icAcMensualAntConsultadeSaldo\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actConsultadeSaldo\"\n      }, \n      \"icVarMensualConsultadeSaldo\": {\n        \"$subtract\": [\n          \"$sal_net_actConsultadeSaldo\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actConsultadeSaldo\"\n          }\n        ]\n      }, \n      \"icAcAnualConsultadeSaldo\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actConsultadeSaldo\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actConsultadeSaldo\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actConsultadeSaldo\"\n        }\n      }, \n      \"icAcAnualAntConsultadeSaldo\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actConsultadeSaldo\"\n      }, \n      \"icActualRecaudacion\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actRecaudacion\", {\n            \"$subtract\": [\n              \"$sal_net_actRecaudacion\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actRecaudacion\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualRecaudacion\": \"$sal_net_actRecaudacion\", \n      \"icAcMensualAntRecaudacion\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actRecaudacion\"\n      }, \n      \"icVarMensualRecaudacion\": {\n        \"$subtract\": [\n          \"$sal_net_actRecaudacion\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actRecaudacion\"\n          }\n        ]\n      }, \n      \"icAcAnualRecaudacion\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actRecaudacion\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actRecaudacion\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actRecaudacion\"\n        }\n      }, \n      \"icAcAnualAntRecaudacion\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actRecaudacion\"\n      }, \n      \"icActualNomina\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actNomina\", {\n            \"$subtract\": [\n              \"$sal_net_actNomina\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actNomina\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualNomina\": \"$sal_net_actNomina\", \n      \"icAcMensualAntNomina\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actNomina\"\n      }, \n      \"icVarMensualNomina\": {\n        \"$subtract\": [\n          \"$sal_net_actNomina\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actNomina\"\n          }\n        ]\n      }, \n      \"icAcAnualNomina\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actNomina\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actNomina\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actNomina\"\n        }\n      }, \n      \"icAcAnualAntNomina\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actNomina\"\n      }, \n      \"icActualPagoMovil\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actPagoMovil\", {\n            \"$subtract\": [\n              \"$sal_net_actPagoMovil\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actPagoMovil\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualPagoMovil\": \"$sal_net_actPagoMovil\", \n      \"icAcMensualAntPagoMovil\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPagoMovil\"\n      }, \n      \"icVarMensualPagoMovil\": {\n        \"$subtract\": [\n          \"$sal_net_actPagoMovil\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actPagoMovil\"\n          }\n        ]\n      }, \n      \"icAcAnualPagoMovil\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actPagoMovil\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actPagoMovil\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actPagoMovil\"\n        }\n      }, \n      \"icAcAnualAntPagoMovil\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actPagoMovil\"\n      }, \n      \"icActualOtros\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actOtros\", {\n            \"$subtract\": [\n              \"$sal_net_actOtros\", {\n                \"$first\": \"$IngresosComisionesMetricYesterday.sal_net_actOtros\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"icAcMensualOtros\": \"$sal_net_actOtros\", \n      \"icAcMensualAntOtros\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actOtros\"\n      }, \n      \"icVarMensualOtros\": {\n        \"$subtract\": [\n          \"$sal_net_actOtros\", {\n            \"$first\": \"$IngresosComisionesMetricpreviusMonth.sal_net_actOtros\"\n          }\n        ]\n      }, \n      \"icAcAnualOtros\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$adjustmentCond\", \n              \"then\": {\n                \"$sum\": [\n                  \"$sal_actOtros\", {\n                    \"$first\": \"$IngresosComisionesMetricYesterday.sal_actOtros\"\n                  }\n                ]\n              }\n            }\n          ], \n          \"default\": \"$sal_actOtros\"\n        }\n      }, \n      \"icAcAnualAntOtros\": {\n        \"$first\": \"$IngresosComisionesMetricpreviusYear.sal_actOtros\"\n      }\n    }\n  }, {\n    \"$project\": {\n      \"fecha_valor\": 1, \n      \"ingresosComisionesBs.icActual\": \"$icActualBs\", \n      \"ingresosComisionesBs.icAcMensual\": \"$icAcMensualBs\", \n      \"ingresosComisionesBs.icAcMensualAnt\": \"$icAcMensualAntBs\", \n      \"ingresosComisionesBs.icVarMensual\": \"$icVarMensualBs\", \n      \"ingresosComisionesBs.icAcAnual\": \"$icAcAnualBs\", \n      \"ingresosComisionesBs.icAcAnualAnt\": \"$icAcAnualAntBs\", \n      \"ingresosComisionesBs.icProd.bdvTotal.actual\": \"$icActualBs\", \n      \"ingresosComisionesBs.icProd.bdvTotal.acMensual\": \"$icAcMensualBs\", \n      \"ingresosComisionesBs.icProd.bdvTotal.acMensualAnt\": \"$icAcMensualAntBs\", \n      \"ingresosComisionesBs.icProd.bdvTotal.varMensual\": \"$icVarMensualBs\", \n      \"ingresosComisionesBs.icProd.bdvTotal.acAnual\": \"$icAcAnualBs\", \n      \"ingresosComisionesBs.icProd.bdvTotal.acMesAnhoAnt\": \"$icAcAnualAntBs\", \n      \"ingresosComisionesBs.icProd.pos.actual\": \"$icActualPOSBs\", \n      \"ingresosComisionesBs.icProd.pos.acMensual\": \"$icAcMensualPOSBs\", \n      \"ingresosComisionesBs.icProd.pos.acMensualAnt\": \"$icAcMensualAntPOSBs\", \n      \"ingresosComisionesBs.icProd.pos.varMensual\": \"$icVarMensualPOSBs\", \n      \"ingresosComisionesBs.icProd.pos.acAnual\": \"$icAcAnualPOSBs\", \n      \"ingresosComisionesBs.icProd.pos.acMesAnhoAnt\": \"$icAcAnualAntPOSBs\", \n      \"ingresosComisionesBs.icProd.opCambiaria.actual\": \"$icActualOperacionesCambiariasBs\", \n      \"ingresosComisionesBs.icProd.opCambiaria.acMensual\": \"$icAcMensualOperacionesCambiariasBs\", \n      \"ingresosComisionesBs.icProd.opCambiaria.acMensualAnt\": \"$icAcMensualAntOperacionesCambiariasBs\", \n      \"ingresosComisionesBs.icProd.opCambiaria.varMensual\": \"$icVarMensualOperacionesCambiariasBs\", \n      \"ingresosComisionesBs.icProd.opCambiaria.acAnual\": \"$icAcAnualOperacionesCambiariasBs\", \n      \"ingresosComisionesBs.icProd.opCambiaria.acMesAnhoAnt\": \"$icAcAnualAntOperacionesCambiariasBs\", \n      \"ingresosComisionesBs.icProd.mediosDePago.actual\": \"$icActualMediosdePagoBs\", \n      \"ingresosComisionesBs.icProd.mediosDePago.acMensual\": \"$icAcMensualMediosdePagoBs\", \n      \"ingresosComisionesBs.icProd.mediosDePago.acMensualAnt\": \"$icAcMensualAntMediosdePagoBs\", \n      \"ingresosComisionesBs.icProd.mediosDePago.varMensual\": \"$icVarMensualMediosdePagoBs\", \n      \"ingresosComisionesBs.icProd.mediosDePago.acAnual\": \"$icAcAnualMediosdePagoBs\", \n      \"ingresosComisionesBs.icProd.mediosDePago.acMesAnhoAnt\": \"$icAcAnualAntMediosdePagoBs\", \n      \"ingresosComisionesBs.icProd.pagosproveedores.actual\": \"$icActualPagoProveedoresBs\", \n      \"ingresosComisionesBs.icProd.pagosproveedores.acMensual\": \"$icAcMensualPagoProveedoresBs\", \n      \"ingresosComisionesBs.icProd.pagosproveedores.acMensualAnt\": \"$icAcMensualAntPagoProveedoresBs\", \n      \"ingresosComisionesBs.icProd.pagosproveedores.varMensual\": \"$icVarMensualPagoProveedoresBs\", \n      \"ingresosComisionesBs.icProd.pagosproveedores.acAnual\": \"$icAcAnualPagoProveedoresBs\", \n      \"ingresosComisionesBs.icProd.pagosproveedores.acMesAnhoAnt\": \"$icAcAnualAntPagoProveedoresBs\", \n      \"ingresosComisionesBs.icProd.consultaSaldo.actual\": \"$icActualConsultadeSaldoBs\", \n      \"ingresosComisionesBs.icProd.consultaSaldo.acMensual\": \"$icAcMensualConsultadeSaldoBs\", \n      \"ingresosComisionesBs.icProd.consultaSaldo.acMensualAnt\": \"$icAcMensualAntConsultadeSaldoBs\", \n      \"ingresosComisionesBs.icProd.consultaSaldo.varMensual\": \"$icVarMensualConsultadeSaldoBs\", \n      \"ingresosComisionesBs.icProd.consultaSaldo.acAnual\": \"$icAcAnualConsultadeSaldoBs\", \n      \"ingresosComisionesBs.icProd.consultaSaldo.acMesAnhoAnt\": \"$icAcAnualAntConsultadeSaldoBs\", \n      \"ingresosComisionesBs.icProd.recaudacion.actual\": \"$icActualRecaudacionBs\", \n      \"ingresosComisionesBs.icProd.recaudacion.acMensual\": \"$icAcMensualRecaudacionBs\", \n      \"ingresosComisionesBs.icProd.recaudacion.acMensualAnt\": \"$icAcMensualAntRecaudacionBs\", \n      \"ingresosComisionesBs.icProd.recaudacion.varMensual\": \"$icVarMensualRecaudacionBs\", \n      \"ingresosComisionesBs.icProd.recaudacion.acAnual\": \"$icAcAnualRecaudacionBs\", \n      \"ingresosComisionesBs.icProd.recaudacion.acMesAnhoAnt\": \"$icAcAnualAntRecaudacionBs\", \n      \"ingresosComisionesBs.icProd.nomina.actual\": \"$icActualNominaBs\", \n      \"ingresosComisionesBs.icProd.nomina.acMensual\": \"$icAcMensualNominaBs\", \n      \"ingresosComisionesBs.icProd.nomina.acMensualAnt\": \"$icAcMensualAntNominaBs\", \n      \"ingresosComisionesBs.icProd.nomina.varMensual\": \"$icVarMensualNominaBs\", \n      \"ingresosComisionesBs.icProd.nomina.acAnual\": \"$icAcAnualNominaBs\", \n      \"ingresosComisionesBs.icProd.nomina.acMesAnhoAnt\": \"$icAcAnualAntNominaBs\", \n      \"ingresosComisionesBs.icProd.pagoMovil.actual\": \"$icActualPagoMovilBs\", \n      \"ingresosComisionesBs.icProd.pagoMovil.acMensual\": \"$icAcMensualPagoMovilBs\", \n      \"ingresosComisionesBs.icProd.pagoMovil.acMensualAnt\": \"$icAcMensualAntPagoMovilBs\", \n      \"ingresosComisionesBs.icProd.pagoMovil.varMensual\": \"$icVarMensualPagoMovilBs\", \n      \"ingresosComisionesBs.icProd.pagoMovil.acAnual\": \"$icAcAnualPagoMovilBs\", \n      \"ingresosComisionesBs.icProd.pagoMovil.acMesAnhoAnt\": \"$icAcAnualAntPagoMovilBs\", \n      \"ingresosComisionesBs.icProd.otros.actual\": \"$icActualOtrosBs\", \n      \"ingresosComisionesBs.icProd.otros.acMensual\": \"$icAcMensualOtrosBs\", \n      \"ingresosComisionesBs.icProd.otros.acMensualAnt\": \"$icAcMensualAntOtrosBs\", \n      \"ingresosComisionesBs.icProd.otros.varMensual\": \"$icVarMensualOtrosBs\", \n      \"ingresosComisionesBs.icProd.otros.acAnual\": \"$icAcAnualOtrosBs\", \n      \"ingresosComisionesBs.icProd.otros.acMesAnhoAnt\": \"$icAcAnualAntOtrosBs\", \n      \"ingresosComisiones.icActual\": \"$icActual\", \n      \"ingresosComisiones.icAcMensual\": \"$icAcMensual\", \n      \"ingresosComisiones.icAcMensualAnt\": \"$icAcMensualAnt\", \n      \"ingresosComisiones.icVarMensual\": \"$icVarMensual\", \n      \"ingresosComisiones.icAcAnual\": \"$icAcAnual\", \n      \"ingresosComisiones.icAcAnualAnt\": \"$icAcAnualAnt\", \n      \"ingresosComisiones.icProd.bdvTotal.actual\": \"$icActual\", \n      \"ingresosComisiones.icProd.bdvTotal.acMensual\": \"$icAcMensual\", \n      \"ingresosComisiones.icProd.bdvTotal.acMensualAnt\": \"$icAcMensualAnt\", \n      \"ingresosComisiones.icProd.bdvTotal.varMensual\": \"$icVarMensual\", \n      \"ingresosComisiones.icProd.bdvTotal.acAnual\": \"$icAcAnual\", \n      \"ingresosComisiones.icProd.bdvTotal.acMesAnhoAnt\": \"$icAcAnualAnt\", \n      \"ingresosComisiones.icProd.pos.actual\": \"$icActualPOS\", \n      \"ingresosComisiones.icProd.pos.acMensual\": \"$icAcMensualPOS\", \n      \"ingresosComisiones.icProd.pos.acMensualAnt\": \"$icAcMensualAntPOS\", \n      \"ingresosComisiones.icProd.pos.varMensual\": \"$icVarMensualPOS\", \n      \"ingresosComisiones.icProd.pos.acAnual\": \"$icAcAnualPOS\", \n      \"ingresosComisiones.icProd.pos.acMesAnhoAnt\": \"$icAcAnualAntPOS\", \n      \"ingresosComisiones.icProd.opCambiaria.actual\": \"$icActualOperacionesCambiarias\", \n      \"ingresosComisiones.icProd.opCambiaria.acMensual\": \"$icAcMensualOperacionesCambiarias\", \n      \"ingresosComisiones.icProd.opCambiaria.acMensualAnt\": \"$icAcMensualAntOperacionesCambiarias\", \n      \"ingresosComisiones.icProd.opCambiaria.varMensual\": \"$icVarMensualOperacionesCambiarias\", \n      \"ingresosComisiones.icProd.opCambiaria.acAnual\": \"$icAcAnualOperacionesCambiarias\", \n      \"ingresosComisiones.icProd.opCambiaria.acMesAnhoAnt\": \"$icAcAnualAntOperacionesCambiarias\", \n      \"ingresosComisiones.icProd.mediosDePago.actual\": \"$icActualMediosdePago\", \n      \"ingresosComisiones.icProd.mediosDePago.acMensual\": \"$icAcMensualMediosdePago\", \n      \"ingresosComisiones.icProd.mediosDePago.acMensualAnt\": \"$icAcMensualAntMediosdePago\", \n      \"ingresosComisiones.icProd.mediosDePago.varMensual\": \"$icVarMensualMediosdePago\", \n      \"ingresosComisiones.icProd.mediosDePago.acAnual\": \"$icAcAnualMediosdePago\", \n      \"ingresosComisiones.icProd.mediosDePago.acMesAnhoAnt\": \"$icAcAnualAntMediosdePago\", \n      \"ingresosComisiones.icProd.pagosproveedores.actual\": \"$icActualPagoProveedores\", \n      \"ingresosComisiones.icProd.pagosproveedores.acMensual\": \"$icAcMensualPagoProveedores\", \n      \"ingresosComisiones.icProd.pagosproveedores.acMensualAnt\": \"$icAcMensualAntPagoProveedores\", \n      \"ingresosComisiones.icProd.pagosproveedores.varMensual\": \"$icVarMensualPagoProveedores\", \n      \"ingresosComisiones.icProd.pagosproveedores.acAnual\": \"$icAcAnualPagoProveedores\", \n      \"ingresosComisiones.icProd.pagosproveedores.acMesAnhoAnt\": \"$icAcAnualAntPagoProveedores\", \n      \"ingresosComisiones.icProd.consultaSaldo.actual\": \"$icActualConsultadeSaldo\", \n      \"ingresosComisiones.icProd.consultaSaldo.acMensual\": \"$icAcMensualConsultadeSaldo\", \n      \"ingresosComisiones.icProd.consultaSaldo.acMensualAnt\": \"$icAcMensualAntConsultadeSaldo\", \n      \"ingresosComisiones.icProd.consultaSaldo.varMensual\": \"$icVarMensualConsultadeSaldo\", \n      \"ingresosComisiones.icProd.consultaSaldo.acAnual\": \"$icAcAnualConsultadeSaldo\", \n      \"ingresosComisiones.icProd.consultaSaldo.acMesAnhoAnt\": \"$icAcAnualAntConsultadeSaldo\", \n      \"ingresosComisiones.icProd.recaudacion.actual\": \"$icActualRecaudacion\", \n      \"ingresosComisiones.icProd.recaudacion.acMensual\": \"$icAcMensualRecaudacion\", \n      \"ingresosComisiones.icProd.recaudacion.acMensualAnt\": \"$icAcMensualAntRecaudacion\", \n      \"ingresosComisiones.icProd.recaudacion.varMensual\": \"$icVarMensualRecaudacion\", \n      \"ingresosComisiones.icProd.recaudacion.acAnual\": \"$icAcAnualRecaudacion\", \n      \"ingresosComisiones.icProd.recaudacion.acMesAnhoAnt\": \"$icAcAnualAntRecaudacion\", \n      \"ingresosComisiones.icProd.nomina.actual\": \"$icActualNomina\", \n      \"ingresosComisiones.icProd.nomina.acMensual\": \"$icAcMensualNomina\", \n      \"ingresosComisiones.icProd.nomina.acMensualAnt\": \"$icAcMensualAntNomina\", \n      \"ingresosComisiones.icProd.nomina.varMensual\": \"$icVarMensualNomina\", \n      \"ingresosComisiones.icProd.nomina.acAnual\": \"$icAcAnualNomina\", \n      \"ingresosComisiones.icProd.nomina.acMesAnhoAnt\": \"$icAcAnualAntNomina\", \n      \"ingresosComisiones.icProd.pagoMovil.actual\": \"$icActualPagoMovil\", \n      \"ingresosComisiones.icProd.pagoMovil.acMensual\": \"$icAcMensualPagoMovil\", \n      \"ingresosComisiones.icProd.pagoMovil.acMensualAnt\": \"$icAcMensualAntPagoMovil\", \n      \"ingresosComisiones.icProd.pagoMovil.varMensual\": \"$icVarMensualPagoMovil\", \n      \"ingresosComisiones.icProd.pagoMovil.acAnual\": \"$icAcAnualPagoMovil\", \n      \"ingresosComisiones.icProd.pagoMovil.acMesAnhoAnt\": \"$icAcAnualAntPagoMovil\", \n      \"ingresosComisiones.icProd.otros.actual\": \"$icActualOtros\", \n      \"ingresosComisiones.icProd.otros.acMensual\": \"$icAcMensualOtros\", \n      \"ingresosComisiones.icProd.otros.acMensualAnt\": \"$icAcMensualAntOtros\", \n      \"ingresosComisiones.icProd.otros.varMensual\": \"$icVarMensualOtros\", \n      \"ingresosComisiones.icProd.otros.acAnual\": \"$icAcAnualOtros\", \n      \"ingresosComisiones.icProd.otros.acMesAnhoAnt\": \"$icAcAnualAntOtros\", \n      \"ingresosComisionesBs.icProd.mediosDePago.nombre\": \"Medios de Pago\", \n      \"ingresosComisionesBs.icProd.nomina.nombre\": \"NÃ³mina\", \n      \"ingresosComisionesBs.icProd.otros.nombre\": \"Otros\", \n      \"ingresosComisionesBs.icProd.pagoMovil.nombre\": \"Pago MÃ³vil\", \n      \"ingresosComisionesBs.icProd.pos.nombre\": \"Punto de venta (POS)\", \n      \"ingresosComisionesBs.icProd.recaudacion.nombre\": \"RecaudaciÃ³n\", \n      \"ingresosComisionesBs.icProd.bdvTotal.nombre\": \"TOTAL\", \n      \"ingresosComisionesBs.icProd.opCambiaria.nombre\": \"Operaciones Cambiarias\", \n      \"ingresosComisionesBs.icProd.pagosproveedores.nombre\": \"Pago Proveedores\", \n      \"ingresosComisionesBs.icProd.consultaSaldo.nombre\": \"Consulta de Saldo\", \n      \"ingresosComisiones.icProd.mediosDePago.nombre\": \"Medios de Pago\", \n      \"ingresosComisiones.icProd.nomina.nombre\": \"NÃ³mina\", \n      \"ingresosComisiones.icProd.otros.nombre\": \"Otros\", \n      \"ingresosComisiones.icProd.pagoMovil.nombre\": \"Pago MÃ³vil\", \n      \"ingresosComisiones.icProd.pos.nombre\": \"Punto de venta (POS)\", \n      \"ingresosComisiones.icProd.recaudacion.nombre\": \"RecaudaciÃ³n\", \n      \"ingresosComisiones.icProd.bdvTotal.nombre\": \"TOTAL\", \n      \"ingresosComisiones.icProd.opCambiaria.nombre\": \"Operaciones Cambiarias\", \n      \"ingresosComisiones.icProd.pagosproveedores.nombre\": \"Pago Proveedores\", \n      \"ingresosComisiones.icProd.consultaSaldo.nombre\": \"Consulta de Saldo\"\n    }\n  }, {\n    \"$addFields\": {\n      \"ingresosComisionesBs.icProd.mediosDePago.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.mediosDePago.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.nomina.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.nomina.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.otros.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.otros.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.pagoMovil.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.pagoMovil.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.pos.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.pos.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.recaudacion.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.recaudacion.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.bdvTotal.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.opCambiaria.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.opCambiaria.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.pagosproveedores.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.pagosproveedores.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisionesBs.icProd.consultaSaldo.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.consultaSaldo.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.mediosDePago.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.mediosDePago.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.nomina.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.nomina.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.otros.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.otros.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.pagoMovil.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.pagoMovil.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.pos.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.pos.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.recaudacion.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.recaudacion.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.bdvTotal.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.opCambiaria.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.opCambiaria.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.pagosproveedores.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.pagosproveedores.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"ingresosComisiones.icProd.consultaSaldo.pesoPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$ingresosComisionesBs.icProd.consultaSaldo.acMensual\", \"$ingresosComisionesBs.icProd.bdvTotal.acMensual\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "7129d692-c96a-426b-bdbf-74d867f3c769",
        "name": "02_IngresosPorComisionIndicadores_Balancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2160,
          7620
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "323713a4-0ce7-4c70-9fe3-4aa699fbdc71",
        "name": "Merge15",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2380,
          7740
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/Balancemetric_TK32_IngresosComision",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "cd90a0e2-3229-4903-9587-5c86ed392ddf",
        "name": "HTTP Request17",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          4580,
          7720
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "Balancemetric_TK32_IngresosCartera",
          "options": {}
        },
        "id": "cd514faf-8fb4-4969-8efb-79f29de5f341",
        "name": "Webhook7",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          980,
          7280
        ],
        "webhookId": "68586f1d-4a45-4457-b6a2-0778e3fec06c"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/Balancemetric_TK32_IngresosCartera",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "945b3670-07aa-4813-9fef-acca4d343d33",
        "name": "HTTP Request6",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          780,
          7280
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Balancemetric",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$gte\": [\n          \"$fecha_valor\", {\n            \"$toDate\": \"2022-12-31\"\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"today\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"dateMonthbefore\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$today\"\n              }\n            }\n          }, 86400000\n        ]\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$or\": [\n        {\n          \"$expr\": {\n            \"$eq\": [\n              \"$fecha_valor\", \"$dateMonthbefore\"\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$eq\": [\n              \"$fecha_valor\", \"$today\"\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$sort\": {\n      \"fecha_valor\": -1\n    }\n  }, {\n    \"$group\": {\n      \"_id\": \"$today\", \n      \"fecha_valor\": {\n        \"$first\": \"$today\"\n      }, \n      \"liquidaciones\": {\n        \"$first\": \"$liquidaciones\"\n      }, \n      \"liquidacionesBs\": {\n        \"$first\": \"$liquidacionesBs\"\n      }, \n      \"liquidacionesmontoLiqProdtotalBdvacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.totalBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdproductivoacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.productivo.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdhipotecarioacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.hipotecario.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdemprendeBdvacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.emprendeBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdcomercialacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.comercial.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdmicroCredacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.microCred.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdtotalBdvacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.numLiqProd.totalBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdproductivoacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.numLiqProd.productivo.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdhipotecarioacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.numLiqProd.hipotecario.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdemprendeBdvacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.numLiqProd.emprendeBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdcomercialacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.numLiqProd.comercial.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdmicroCredacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidaciones.numLiqProd.microCred.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdtotalBdvacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.totalBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdproductivoacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.productivo.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdhipotecarioacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.hipotecario.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdemprendeBdvacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.emprendeBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdcomercialacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.comercial.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesmontoLiqProdmicroCredacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.montoLiqProd.microCred.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdtotalBdvacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.numLiqProd.totalBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdproductivoacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.numLiqProd.productivo.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdhipotecarioacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.numLiqProd.hipotecario.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdemprendeBdvacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.numLiqProd.emprendeBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdcomercialacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.numLiqProd.comercial.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesnumLiqProdmicroCredacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidaciones.numLiqProd.microCred.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdtotalBdvacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.totalBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdproductivoacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.productivo.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdhipotecarioacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.hipotecario.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdemprendeBdvacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.emprendeBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdcomercialacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.comercial.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdmicroCredacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.microCred.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdtotalBdvacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.totalBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdproductivoacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.productivo.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdhipotecarioacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.hipotecario.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdemprendeBdvacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.emprendeBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdcomercialacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.comercial.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdmicroCredacAnual\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$today\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.microCred.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdtotalBdvacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.totalBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdproductivoacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.productivo.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdhipotecarioacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.hipotecario.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdemprendeBdvacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.emprendeBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdcomercialacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.comercial.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsmontoLiqProdmicroCredacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.montoLiqProd.microCred.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdtotalBdvacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.totalBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdproductivoacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.productivo.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdhipotecarioacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.hipotecario.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdemprendeBdvacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.emprendeBdv.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdcomercialacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.comercial.acAnual\", 0\n          ]\n        }\n      }, \n      \"liquidacionesBsnumLiqProdmicroCredacAnualAnterior\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$fecha_valor\", \"$dateMonthbefore\"\n              ]\n            }, \"$liquidacionesBs.numLiqProd.microCred.acAnual\", 0\n          ]\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"liquidaciones.montoLiqProd.totalBdv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesmontoLiqProdtotalBdvacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesmontoLiqProdtotalBdvacAnual\", \"$liquidacionesmontoLiqProdtotalBdvacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesmontoLiqProdtotalBdvacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.productivo.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesmontoLiqProdproductivoacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesmontoLiqProdproductivoacAnual\", \"$liquidacionesmontoLiqProdproductivoacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesmontoLiqProdproductivoacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.hipotecario.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesmontoLiqProdhipotecarioacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesmontoLiqProdhipotecarioacAnual\", \"$liquidacionesmontoLiqProdhipotecarioacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesmontoLiqProdhipotecarioacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.emprendeBdv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesmontoLiqProdemprendeBdvacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesmontoLiqProdemprendeBdvacAnual\", \"$liquidacionesmontoLiqProdemprendeBdvacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesmontoLiqProdemprendeBdvacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.comercial.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesmontoLiqProdcomercialacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesmontoLiqProdcomercialacAnual\", \"$liquidacionesmontoLiqProdcomercialacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesmontoLiqProdcomercialacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.montoLiqProd.microCred.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesmontoLiqProdmicroCredacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesmontoLiqProdmicroCredacAnual\", \"$liquidacionesmontoLiqProdmicroCredacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesmontoLiqProdmicroCredacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.numLiqProd.totalBdv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesnumLiqProdtotalBdvacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesnumLiqProdtotalBdvacAnual\", \"$liquidacionesnumLiqProdtotalBdvacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesnumLiqProdtotalBdvacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.numLiqProd.productivo.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesnumLiqProdproductivoacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesnumLiqProdproductivoacAnual\", \"$liquidacionesnumLiqProdproductivoacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesnumLiqProdproductivoacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.numLiqProd.hipotecario.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesnumLiqProdhipotecarioacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesnumLiqProdhipotecarioacAnual\", \"$liquidacionesnumLiqProdhipotecarioacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesnumLiqProdhipotecarioacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.numLiqProd.emprendeBdv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesnumLiqProdemprendeBdvacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesnumLiqProdemprendeBdvacAnual\", \"$liquidacionesnumLiqProdemprendeBdvacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesnumLiqProdemprendeBdvacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.numLiqProd.comercial.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesnumLiqProdcomercialacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesnumLiqProdcomercialacAnual\", \"$liquidacionesnumLiqProdcomercialacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesnumLiqProdcomercialacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidaciones.numLiqProd.microCred.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesnumLiqProdmicroCredacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesnumLiqProdmicroCredacAnual\", \"$liquidacionesnumLiqProdmicroCredacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesnumLiqProdmicroCredacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.montoLiqProd.totalBdv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsmontoLiqProdtotalBdvacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsmontoLiqProdtotalBdvacAnual\", \"$liquidacionesBsmontoLiqProdtotalBdvacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsmontoLiqProdtotalBdvacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.montoLiqProd.productivo.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsmontoLiqProdproductivoacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsmontoLiqProdproductivoacAnual\", \"$liquidacionesBsmontoLiqProdproductivoacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsmontoLiqProdproductivoacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.montoLiqProd.hipotecario.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsmontoLiqProdhipotecarioacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsmontoLiqProdhipotecarioacAnual\", \"$liquidacionesBsmontoLiqProdhipotecarioacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsmontoLiqProdhipotecarioacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.montoLiqProd.emprendeBdv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsmontoLiqProdemprendeBdvacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsmontoLiqProdemprendeBdvacAnual\", \"$liquidacionesBsmontoLiqProdemprendeBdvacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsmontoLiqProdemprendeBdvacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.montoLiqProd.comercial.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsmontoLiqProdcomercialacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsmontoLiqProdcomercialacAnual\", \"$liquidacionesBsmontoLiqProdcomercialacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsmontoLiqProdcomercialacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.montoLiqProd.microCred.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsmontoLiqProdmicroCredacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsmontoLiqProdmicroCredacAnual\", \"$liquidacionesBsmontoLiqProdmicroCredacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsmontoLiqProdmicroCredacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.numLiqProd.totalBdv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsnumLiqProdtotalBdvacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsnumLiqProdtotalBdvacAnual\", \"$liquidacionesBsnumLiqProdtotalBdvacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsnumLiqProdtotalBdvacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.numLiqProd.productivo.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsnumLiqProdproductivoacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsnumLiqProdproductivoacAnual\", \"$liquidacionesBsnumLiqProdproductivoacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsnumLiqProdproductivoacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.numLiqProd.hipotecario.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsnumLiqProdhipotecarioacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsnumLiqProdhipotecarioacAnual\", \"$liquidacionesBsnumLiqProdhipotecarioacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsnumLiqProdhipotecarioacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.numLiqProd.emprendeBdv.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsnumLiqProdemprendeBdvacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsnumLiqProdemprendeBdvacAnual\", \"$liquidacionesBsnumLiqProdemprendeBdvacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsnumLiqProdemprendeBdvacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.numLiqProd.comercial.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsnumLiqProdcomercialacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsnumLiqProdcomercialacAnual\", \"$liquidacionesBsnumLiqProdcomercialacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsnumLiqProdcomercialacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesBs.numLiqProd.microCred.creAnual\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              \"$liquidacionesBsnumLiqProdmicroCredacAnualAnterior\", 0\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$multiply\": [\n                  {\n                    \"$divide\": [\n                      {\n                        \"$subtract\": [\n                          \"$liquidacionesBsnumLiqProdmicroCredacAnual\", \"$liquidacionesBsnumLiqProdmicroCredacAnualAnterior\"\n                        ]\n                      }, \"$liquidacionesBsnumLiqProdmicroCredacAnualAnterior\"\n                    ]\n                  }, 100\n                ]\n              }, 2\n            ]\n          }, \"$$REMOVE\"\n        ]\n      }, \n      \"liquidacionesmontoLiqProdtotalBdvacAnual\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdproductivoacAnual\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdhipotecarioacAnual\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdemprendeBdvacAnual\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdcomercialacAnual\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdmicroCredacAnual\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdtotalBdvacAnual\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdproductivoacAnual\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdhipotecarioacAnual\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdemprendeBdvacAnual\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdcomercialacAnual\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdmicroCredacAnual\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdtotalBdvacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdproductivoacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdhipotecarioacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdemprendeBdvacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdcomercialacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesmontoLiqProdmicroCredacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdtotalBdvacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdproductivoacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdhipotecarioacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdemprendeBdvacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdcomercialacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesnumLiqProdmicroCredacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdtotalBdvacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdproductivoacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdhipotecarioacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdemprendeBdvacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdcomercialacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdmicroCredacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdtotalBdvacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdproductivoacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdhipotecarioacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdemprendeBdvacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdcomercialacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdmicroCredacAnual\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdtotalBdvacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdproductivoacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdhipotecarioacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdemprendeBdvacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdcomercialacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsmontoLiqProdmicroCredacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdtotalBdvacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdproductivoacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdhipotecarioacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdemprendeBdvacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdcomercialacAnualAnterior\": \"$$REMOVE\", \n      \"liquidacionesBsnumLiqProdmicroCredacAnualAnterior\": \"$$REMOVE\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "54be0e9f-6030-4326-9ae7-625e2e00f07e",
        "name": "7_CrecimientoAnualLiquidacionBalancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          3640,
          5420
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"7_Procesamiento_carteraCredito\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem9",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1380,
          7280
        ],
        "id": "2de8518b-a914-4382-a063-2df9f284389f",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "b857da2f-44f7-4f93-8bc2-2eb67350551d",
        "name": "IF4",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1540,
          7280
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "fe614cc7-6cf0-456e-a760-684c5427d1aa",
        "name": "Merge17",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1920,
          7240
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "9abe2874-6706-441f-9a7c-f0ff3c6cbdc4",
        "name": "Merge18",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2280,
          7220
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "86f98595-ea57-49ea-aa18-2298765a34c0",
        "name": "Merge19",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2680,
          7200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/Balancemetric_TK32_IngresosCartera",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "fa1b5733-7f5d-4405-aec8-a2d6eb791899",
        "name": "HTTP Request19",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          4580,
          7180
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "CarteraCreditometric",
          "query": "=[\n    {\n      \"$match\": {\n        \"$expr\": {\n          \"$eq\": [\n            \"$fecha_valor\", {\n              \"$subtract\": [\n                {\n                  \"$toDate\": {\n                    \"$dateFromString\": {\n                      \"dateString\": {\n                        \"$dateToString\": {\n                          \"format\": \"%Y-%m-%dT00:00:00%z\", \n                          \"date\": {\n                            \"$toDate\": \"$$NOW\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }, {\n                  \"$multiply\": [\n                    {\n                      \"$toInt\": \"{{$json.offSet}}\"\n                    }, 86400000\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }, {\n      \"$project\": {\n        \"fecha_valor\": 1, \n        \"sal_acttotalBs\": 1, \n        \"sal_acttotalBdvBs\": 1, \n        \"sal_actcartTradicionalBs\": 1, \n        \"sal_actcomercialUVCBs\": 1, \n        \"sal_actmicroCredUVCBs\": 1, \n        \"sal_actproductivaUVCBs\": 1, \n        \"sal_actemprendBdvBs\": 1, \n        \"sal_actotrosBs\": 1, \n        \"sal_acttotal\": 1, \n        \"sal_acttotalBdv\": 1, \n        \"sal_actcartTradicional\": 1, \n        \"sal_actcomercialUVC\": 1, \n        \"sal_actmicroCredUVC\": 1, \n        \"sal_actproductivaUVC\": 1, \n        \"sal_actemprendBdv\": 1, \n        \"sal_actotros\": 1\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"Balancemetric\", \n        \"let\": {\n          \"monthDate\": {\n            \"$month\": \"$fecha_valor\"\n          }, \n          \"yearDate\": {\n            \"$year\": \"$fecha_valor\"\n          }\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$and\": [\n                {\n                  \"$expr\": {\n                    \"$eq\": [\n                      {\n                        \"$year\": \"$fecha_valor\"\n                      }, \"$$yearDate\"\n                    ]\n                  }\n                }, {\n                  \"$expr\": {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$fecha_valor\"\n                      }, \"$$monthDate\"\n                    ]\n                  }\n                }\n              ]\n            }\n          }, {\n            \"$project\": {\n              \"fecha_valor\": 1, \n              \"carteraCreditoBs\": 1, \n              \"carteraCredito\": 1\n            }\n          }\n        ], \n        \"as\": \"Balancemetric\"\n      }\n    }, {\n      \"$unwind\": {\n        \"path\": \"$Balancemetric\", \n        \"preserveNullAndEmptyArrays\": true\n      }\n    }, {\n      \"$replaceRoot\": {\n        \"newRoot\": {\n          \"$mergeObjects\": [\n            \"$$ROOT\", \"$Balancemetric\"\n          ]\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"sal_acttotalBs\": \"$$REMOVE\", \n        \"sal_acttotalBdvBs\": \"$$REMOVE\", \n        \"sal_actcartTradicionalBs\": \"$$REMOVE\", \n        \"sal_actcomercialUVCBs\": \"$$REMOVE\", \n        \"sal_actmicroCredUVCBs\": \"$$REMOVE\", \n        \"sal_actproductivaUVCBs\": \"$$REMOVE\", \n        \"sal_actemprendBdvBs\": \"$$REMOVE\", \n        \"sal_actotrosBs\": \"$$REMOVE\", \n        \"sal_acttotal\": \"$$REMOVE\", \n        \"sal_acttotalBdv\": \"$$REMOVE\", \n        \"sal_actcartTradicional\": \"$$REMOVE\", \n        \"sal_actcomercialUVC\": \"$$REMOVE\", \n        \"sal_actmicroCredUVC\": \"$$REMOVE\", \n        \"sal_actproductivaUVC\": \"$$REMOVE\", \n        \"sal_actemprendBdv\": \"$$REMOVE\", \n        \"sal_actotros\": \"$$REMOVE\", \n        \"Balancemetric\": \"$$REMOVE\", \n        \"_id\": \"$$REMOVE\", \n        \"carteraCreditoBs.total.mensual\": \"$sal_acttotalBs\", \n        \"carteraCreditoBs.saldoProd.totalBdv.mensual\": \"$sal_acttotalBdvBs\", \n        \"carteraCreditoBs.saldoProd.cartTradicional.mensual\": \"$sal_actcartTradicionalBs\", \n        \"carteraCreditoBs.saldoProd.comercialUVC.mensual\": \"$sal_actcomercialUVCBs\", \n        \"carteraCreditoBs.saldoProd.microCredUVC.mensual\": \"$sal_actmicroCredUVCBs\", \n        \"carteraCreditoBs.saldoProd.productivaUVC.mensual\": \"$sal_actproductivaUVCBs\", \n        \"carteraCreditoBs.saldoProd.emprendBdv.mensual\": \"$sal_actemprendBdvBs\", \n        \"carteraCreditoBs.saldoProd.otros.mensual\": \"$sal_actotrosBs\", \n        \"carteraCredito.total.mensual\": \"$sal_acttotal\", \n        \"carteraCredito.saldoProd.totalBdv.mensual\": \"$sal_acttotalBdv\", \n        \"carteraCredito.saldoProd.cartTradicional.mensual\": \"$sal_actcartTradicional\", \n        \"carteraCredito.saldoProd.comercialUVC.mensual\": \"$sal_actcomercialUVC\", \n        \"carteraCredito.saldoProd.microCredUVC.mensual\": \"$sal_actmicroCredUVC\", \n        \"carteraCredito.saldoProd.productivaUVC.mensual\": \"$sal_actproductivaUVC\", \n        \"carteraCredito.saldoProd.emprendBdv.mensual\": \"$sal_actemprendBdv\", \n        \"carteraCredito.saldoProd.otros.mensual\": \"$sal_actotros\"\n      }\n    }, {\n      \"$merge\": {\n        \"into\": \"Balancemetric\", \n        \"on\": \"fecha_valor\"\n      }\n    }\n  ]"
        },
        "id": "72028f94-711c-49a1-959f-f88980fb57b7",
        "name": "3_IndicarorMensualCarteraCreditoMetric_Balancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2460,
          7060
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "CarteraCreditometric",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          \"$fecha_valor\", {\n            \"$subtract\": [\n              {\n                \"$toDate\": {\n                  \"$dateFromString\": {\n                    \"dateString\": {\n                      \"$dateToString\": {\n                        \"format\": \"%Y-%m-%dT00:00:00%z\", \n                        \"date\": {\n                          \"$toDate\": \"$$NOW\"\n                        }\n                      }\n                    }\n                  }\n                }\n              }, {\n                \"$multiply\": [\n                  {\n                    \"$toInt\": \"{{$json.offSet}}\"\n                  }, 86400000\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"CarteraCreditometric\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CarteraCreditometricYesterday\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"CarteraCreditometric\", \n      \"localField\": \"previusMonthDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CarteraCreditometricpreviusMonth\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"CarteraCreditometric\", \n      \"localField\": \"previusMonthLastDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CarteraCreditometricpreviusMonthLastDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"CarteraCreditometric\", \n      \"localField\": \"previusYearDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CarteraCreditometricpreviusYear\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"CarteraCreditometric\", \n      \"localField\": \"PreviusYearlastDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CarteraCreditometricPreviusYearlastDate\"\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"fecha_valor\": 1, \n      \"carteraCreditoBs.total.actual\": \"$sal_acttotalBs\", \n      \"carteraCreditoBs.total.anterior\": \"$sal_anttotalBs\", \n      \"carteraCreditoBs.total.varMensual\": {\n        \"$subtract\": [\n          \"$sal_acttotalBs\", \"$sal_anttotalBs\"\n        ]\n      }, \n      \"carteraCreditoBs.total.netoActual\": \"$sal_net_acttotalBs\", \n      \"carteraCreditoBs.total.varAnual\": {\n        \"$subtract\": [\n          \"$sal_acttotalBs\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBs\"\n          }\n        ]\n      }, \n      \"carteraCreditoBs.total.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_acttotalBs\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBs\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBs\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.totalBdv.actual\": \"$sal_acttotalBdvBs\", \n      \"carteraCreditoBs.saldoProd.totalBdv.anterior\": \"$sal_anttotalBdvBs\", \n      \"carteraCreditoBs.saldoProd.totalBdv.varMensual\": {\n        \"$subtract\": [\n          \"$sal_acttotalBdvBs\", \"$sal_anttotalBdvBs\"\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.totalBdv.netoActual\": \"$sal_net_acttotalBdvBs\", \n      \"carteraCreditoBs.saldoProd.totalBdv.varAnual\": {\n        \"$subtract\": [\n          \"$sal_acttotalBdvBs\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBdvBs\"\n          }\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.totalBdv.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_acttotalBdvBs\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBdvBs\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBdvBs\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.totalBdv.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_acttotalBdvBs\", \"$sal_acttotalBs\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.totalBdv.nombre\": \"Total\", \n      \"carteraCreditoBs.saldoProd.cartTradicional.actual\": \"$sal_actcartTradicionalBs\", \n      \"carteraCreditoBs.saldoProd.cartTradicional.anterior\": \"$sal_antcartTradicionalBs\", \n      \"carteraCreditoBs.saldoProd.cartTradicional.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actcartTradicionalBs\", \"$sal_antcartTradicionalBs\"\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.cartTradicional.netoActual\": \"$sal_net_actcartTradicionalBs\", \n      \"carteraCreditoBs.saldoProd.cartTradicional.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actcartTradicionalBs\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcartTradicionalBs\"\n          }\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.cartTradicional.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actcartTradicionalBs\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcartTradicionalBs\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcartTradicionalBs\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.cartTradicional.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actcartTradicionalBs\", \"$sal_acttotalBs\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.cartTradicional.nombre\": \"Cartera Tradicional\", \n      \"carteraCreditoBs.saldoProd.comercialUVC.actual\": \"$sal_actcomercialUVCBs\", \n      \"carteraCreditoBs.saldoProd.comercialUVC.anterior\": \"$sal_antcomercialUVCBs\", \n      \"carteraCreditoBs.saldoProd.comercialUVC.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actcomercialUVCBs\", \"$sal_antcomercialUVCBs\"\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.comercialUVC.netoActual\": \"$sal_net_actcomercialUVCBs\", \n      \"carteraCreditoBs.saldoProd.comercialUVC.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actcomercialUVCBs\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcomercialUVCBs\"\n          }\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.comercialUVC.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actcomercialUVCBs\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcomercialUVCBs\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcomercialUVCBs\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.comercialUVC.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actcomercialUVCBs\", \"$sal_acttotalBs\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.comercialUVC.nombre\": \"COMERCIAL\", \n      \"carteraCreditoBs.saldoProd.microCredUVC.actual\": \"$sal_actmicroCredUVCBs\", \n      \"carteraCreditoBs.saldoProd.microCredUVC.anterior\": \"$sal_antmicroCredUVCBs\", \n      \"carteraCreditoBs.saldoProd.microCredUVC.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actmicroCredUVCBs\", \"$sal_antmicroCredUVCBs\"\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.microCredUVC.netoActual\": \"$sal_net_actmicroCredUVCBs\", \n      \"carteraCreditoBs.saldoProd.microCredUVC.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actmicroCredUVCBs\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actmicroCredUVCBs\"\n          }\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.microCredUVC.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actmicroCredUVCBs\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actmicroCredUVCBs\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actmicroCredUVCBs\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.microCredUVC.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actmicroCredUVCBs\", \"$sal_acttotalBs\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.microCredUVC.nombre\": \"MICROCREDITO\", \n      \"carteraCreditoBs.saldoProd.productivaUVC.actual\": \"$sal_actproductivaUVCBs\", \n      \"carteraCreditoBs.saldoProd.productivaUVC.anterior\": \"$sal_antproductivaUVCBs\", \n      \"carteraCreditoBs.saldoProd.productivaUVC.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actproductivaUVCBs\", \"$sal_antproductivaUVCBs\"\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.productivaUVC.netoActual\": \"$sal_net_actproductivaUVCBs\", \n      \"carteraCreditoBs.saldoProd.productivaUVC.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actproductivaUVCBs\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actproductivaUVCBs\"\n          }\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.productivaUVC.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actproductivaUVCBs\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actproductivaUVCBs\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actproductivaUVCBs\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.productivaUVC.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actproductivaUVCBs\", \"$sal_acttotalBs\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.productivaUVC.nombre\": \"PRODUCTIVO\", \n      \"carteraCreditoBs.saldoProd.emprendBdv.actual\": \"$sal_actemprendBdvBs\", \n      \"carteraCreditoBs.saldoProd.emprendBdv.anterior\": \"$sal_antemprendBdvBs\", \n      \"carteraCreditoBs.saldoProd.emprendBdv.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actemprendBdvBs\", \"$sal_antemprendBdvBs\"\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.emprendBdv.netoActual\": \"$sal_net_actemprendBdvBs\", \n      \"carteraCreditoBs.saldoProd.emprendBdv.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actemprendBdvBs\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actemprendBdvBs\"\n          }\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.emprendBdv.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actemprendBdvBs\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actemprendBdvBs\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actemprendBdvBs\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.emprendBdv.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actemprendBdvBs\", \"$sal_acttotalBs\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.emprendBdv.nombre\": \"EMPRENDEBDV\", \n      \"carteraCreditoBs.saldoProd.otros.actual\": \"$sal_actotrosBs\", \n      \"carteraCreditoBs.saldoProd.otros.anterior\": \"$sal_antotrosBs\", \n      \"carteraCreditoBs.saldoProd.otros.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actotrosBs\", \"$sal_antotrosBs\"\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.otros.netoActual\": \"$sal_net_actotrosBs\", \n      \"carteraCreditoBs.saldoProd.otros.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actotrosBs\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actotrosBs\"\n          }\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.otros.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actotrosBs\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actotrosBs\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actotrosBs\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.otros.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actotrosBs\", \"$sal_acttotalBs\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCreditoBs.saldoProd.otros.nombre\": \"OTROS\", \n      \"carteraCredito.total.actual\": \"$sal_acttotal\", \n      \"carteraCredito.total.anterior\": \"$sal_anttotal\", \n      \"carteraCredito.total.varMensual\": {\n        \"$subtract\": [\n          \"$sal_acttotal\", \"$sal_anttotal\"\n        ]\n      }, \n      \"carteraCredito.total.netoActual\": \"$sal_net_acttotal\", \n      \"carteraCredito.total.varAnual\": {\n        \"$subtract\": [\n          \"$sal_acttotal\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotal\"\n          }\n        ]\n      }, \n      \"carteraCredito.total.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_acttotal\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotal\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotal\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCredito.saldoProd.totalBdv.actual\": \"$sal_acttotalBdv\", \n      \"carteraCredito.saldoProd.totalBdv.anterior\": \"$sal_anttotalBdv\", \n      \"carteraCredito.saldoProd.totalBdv.varMensual\": {\n        \"$subtract\": [\n          \"$sal_acttotalBdv\", \"$sal_anttotalBdv\"\n        ]\n      }, \n      \"carteraCredito.saldoProd.totalBdv.netoActual\": \"$sal_net_acttotalBdv\", \n      \"carteraCredito.saldoProd.totalBdv.varAnual\": {\n        \"$subtract\": [\n          \"$sal_acttotalBdv\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBdv\"\n          }\n        ]\n      }, \n      \"carteraCredito.saldoProd.totalBdv.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_acttotalBdv\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBdv\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_acttotalBdv\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCredito.saldoProd.totalBdv.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_acttotalBdv\", \"$sal_acttotal\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCredito.saldoProd.totalBdv.nombre\": \"Total\", \n      \"carteraCredito.saldoProd.cartTradicional.actual\": \"$sal_actcartTradicional\", \n      \"carteraCredito.saldoProd.cartTradicional.anterior\": \"$sal_antcartTradicional\", \n      \"carteraCredito.saldoProd.cartTradicional.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actcartTradicional\", \"$sal_antcartTradicional\"\n        ]\n      }, \n      \"carteraCredito.saldoProd.cartTradicional.netoActual\": \"$sal_net_actcartTradicional\", \n      \"carteraCredito.saldoProd.cartTradicional.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actcartTradicional\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcartTradicional\"\n          }\n        ]\n      }, \n      \"carteraCredito.saldoProd.cartTradicional.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actcartTradicional\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcartTradicional\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcartTradicional\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCredito.saldoProd.cartTradicional.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actcartTradicional\", \"$sal_acttotal\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCredito.saldoProd.cartTradicional.nombre\": \"Cartera Tradicional\", \n      \"carteraCredito.saldoProd.comercialUVC.actual\": \"$sal_actcomercialUVC\", \n      \"carteraCredito.saldoProd.comercialUVC.anterior\": \"$sal_antcomercialUVC\", \n      \"carteraCredito.saldoProd.comercialUVC.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actcomercialUVC\", \"$sal_antcomercialUVC\"\n        ]\n      }, \n      \"carteraCredito.saldoProd.comercialUVC.netoActual\": \"$sal_net_actcomercialUVC\", \n      \"carteraCredito.saldoProd.comercialUVC.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actcomercialUVC\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcomercialUVC\"\n          }\n        ]\n      }, \n      \"carteraCredito.saldoProd.comercialUVC.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actcomercialUVC\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcomercialUVC\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actcomercialUVC\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCredito.saldoProd.comercialUVC.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actcomercialUVC\", \"$sal_acttotal\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCredito.saldoProd.comercialUVC.nombre\": \"COMERCIAL\", \n      \"carteraCredito.saldoProd.microCredUVC.actual\": \"$sal_actmicroCredUVC\", \n      \"carteraCredito.saldoProd.microCredUVC.anterior\": \"$sal_antmicroCredUVC\", \n      \"carteraCredito.saldoProd.microCredUVC.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actmicroCredUVC\", \"$sal_antmicroCredUVC\"\n        ]\n      }, \n      \"carteraCredito.saldoProd.microCredUVC.netoActual\": \"$sal_net_actmicroCredUVC\", \n      \"carteraCredito.saldoProd.microCredUVC.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actmicroCredUVC\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actmicroCredUVC\"\n          }\n        ]\n      }, \n      \"carteraCredito.saldoProd.microCredUVC.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actmicroCredUVC\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actmicroCredUVC\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actmicroCredUVC\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCredito.saldoProd.microCredUVC.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actmicroCredUVC\", \"$sal_acttotal\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCredito.saldoProd.microCredUVC.nombre\": \"MICROCREDITO\", \n      \"carteraCredito.saldoProd.productivaUVC.actual\": \"$sal_actproductivaUVC\", \n      \"carteraCredito.saldoProd.productivaUVC.anterior\": \"$sal_antproductivaUVC\", \n      \"carteraCredito.saldoProd.productivaUVC.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actproductivaUVC\", \"$sal_antproductivaUVC\"\n        ]\n      }, \n      \"carteraCredito.saldoProd.productivaUVC.netoActual\": \"$sal_net_actproductivaUVC\", \n      \"carteraCredito.saldoProd.productivaUVC.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actproductivaUVC\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actproductivaUVC\"\n          }\n        ]\n      }, \n      \"carteraCredito.saldoProd.productivaUVC.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actproductivaUVC\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actproductivaUVC\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actproductivaUVC\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCredito.saldoProd.productivaUVC.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actproductivaUVC\", \"$sal_acttotal\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCredito.saldoProd.productivaUVC.nombre\": \"PRODUCTIVO\", \n      \"carteraCredito.saldoProd.emprendBdv.actual\": \"$sal_actemprendBdv\", \n      \"carteraCredito.saldoProd.emprendBdv.anterior\": \"$sal_antemprendBdv\", \n      \"carteraCredito.saldoProd.emprendBdv.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actemprendBdv\", \"$sal_antemprendBdv\"\n        ]\n      }, \n      \"carteraCredito.saldoProd.emprendBdv.netoActual\": \"$sal_net_actemprendBdv\", \n      \"carteraCredito.saldoProd.emprendBdv.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actemprendBdv\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actemprendBdv\"\n          }\n        ]\n      }, \n      \"carteraCredito.saldoProd.emprendBdv.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actemprendBdv\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actemprendBdv\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actemprendBdv\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCredito.saldoProd.emprendBdv.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actemprendBdv\", \"$sal_acttotal\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCredito.saldoProd.emprendBdv.nombre\": \"EMPRENDEBDV\", \n      \"carteraCredito.saldoProd.otros.actual\": \"$sal_actotros\", \n      \"carteraCredito.saldoProd.otros.anterior\": \"$sal_antotros\", \n      \"carteraCredito.saldoProd.otros.varMensual\": {\n        \"$subtract\": [\n          \"$sal_actotros\", \"$sal_antotros\"\n        ]\n      }, \n      \"carteraCredito.saldoProd.otros.netoActual\": \"$sal_net_actotros\", \n      \"carteraCredito.saldoProd.otros.varAnual\": {\n        \"$subtract\": [\n          \"$sal_actotros\", {\n            \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actotros\"\n          }\n        ]\n      }, \n      \"carteraCredito.saldoProd.otros.creAnual\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$sal_actotros\", {\n                        \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actotros\"\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$CarteraCreditometricPreviusYearlastDate.sal_actotros\"\n                  }\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"carteraCredito.saldoProd.otros.pesoPcrtMens\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  \"$sal_actotros\", \"$sal_acttotal\"\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"carteraCredito.saldoProd.otros.nombre\": \"OTROS\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "de466427-e27e-4ef5-b9b9-a2f84f20b09a",
        "name": "2_CalculoIndicadoresCarteraCreditoMetric_Balancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2100,
          7080
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$lookup\": {\n      \"from\": \"Parametricliquidacion\", \n      \"pipeline\": [\n        {\n          \"$project\": {\n            \"_id\": 0\n          }\n        }\n      ], \n      \"as\": \"Parametricliquidacion\"\n    }\n  }, {\n    \"$project\": {\n      \"Parametricliquidacion\": 1, \n      \"cuentasContable\": \"$Parametricliquidacion.cuentaContable\", \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$$todayDate\", \"$fecha_odate\"\n              ]\n            }\n          }\n        }, {\n          \"$project\": {\n            \"nucta\": 1, \n            \"sal_act\": {\n              \"$multiply\": [\n                \"$sal_act\", -1\n              ]\n            }, \n            \"sal_ant\": {\n              \"$multiply\": [\n                \"$sal_ant\", -1\n              ]\n            }, \n            \"sal_net_act\": {\n              \"$multiply\": [\n                \"$sal_net_act\", -1\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$addFields\": {\n      \"avaiableDate\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_brm\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"firstDayMonth\": {\n        \"$eq\": [\n          {\n            \"$dayOfMonth\": \"$todayDate\"\n          }, 1\n        ]\n      }, \n      \"yesterdayDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"previusMonthDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"previusMonthLastDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$month\": \"$todayDate\"\n              }\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"previusYearDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }, \n      \"PreviusYearlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"sidis_brm\": {\n        \"$filter\": {\n          \"input\": \"$sidis_brm\", \n          \"as\": \"brm\", \n          \"cond\": {\n            \"$in\": [\n              \"$$brm.nucta\", \"$cuentasContable\"\n            ]\n          }\n        }\n      }, \n      \"cuentasContable\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_brm\": {\n        \"$map\": {\n          \"input\": \"$sidis_brm\", \n          \"as\": \"brm\", \n          \"in\": {\n            \"$mergeObjects\": [\n              \"$$brm\", {\n                \"producto\": {\n                  \"$arrayElemAt\": [\n                    {\n                      \"$filter\": {\n                        \"input\": {\n                          \"$map\": {\n                            \"input\": \"$Parametricliquidacion\", \n                            \"as\": \"liquidaciones\", \n                            \"in\": {\n                              \"$cond\": [\n                                {\n                                  \"$eq\": [\n                                    \"$$liquidaciones.cuentaContable\", \"$$brm.nucta\"\n                                  ]\n                                }, \"$$liquidaciones.productoControlGestion\", null\n                              ]\n                            }\n                          }\n                        }, \n                        \"as\": \"filtered\", \n                        \"cond\": {\n                          \"$ne\": [\n                            \"$$filtered\", null\n                          ]\n                        }\n                      }\n                    }, 0\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"Parametricliquidacion\": \"$$REMOVE\", \n      \"sidis_brm\": \"$REMOVE\", \n      \"sal_acttotalBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    true, \"$$brm.sal_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_anttotalBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    true, \"$$brm.sal_ant\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_net_acttotalBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    true, \"$$brm.sal_net_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_acttotalBdvBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$in\": [\n                        \"$$brm.producto\", [\n                          \"COMERCIAL\", \"MICROCREDITO\", \"PRODUCTIVO\", \"EMPRENDEBDV\", \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                        ]\n                      ]\n                    }, \"$$brm.sal_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_anttotalBdvBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$in\": [\n                        \"$$brm.producto\", [\n                          \"COMERCIAL\", \"MICROCREDITO\", \"PRODUCTIVO\", \"EMPRENDEBDV\", \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                        ]\n                      ]\n                    }, \"$$brm.sal_ant\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_net_acttotalBdvBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$in\": [\n                        \"$$brm.producto\", [\n                          \"COMERCIAL\", \"MICROCREDITO\", \"PRODUCTIVO\", \"EMPRENDEBDV\", \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                        ]\n                      ]\n                    }, \"$$brm.sal_net_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_actcartTradicionalBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$in\": [\n                        \"$$brm.producto\", [\n                          \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                        ]\n                      ]\n                    }, \"$$brm.sal_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_antcartTradicionalBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$in\": [\n                        \"$$brm.producto\", [\n                          \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                        ]\n                      ]\n                    }, \"$$brm.sal_ant\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_net_actcartTradicionalBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$in\": [\n                        \"$$brm.producto\", [\n                          \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                        ]\n                      ]\n                    }, \"$$brm.sal_net_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_actcomercialUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"COMERCIAL\"\n                      ]\n                    }, \"$$brm.sal_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_antcomercialUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"COMERCIAL\"\n                      ]\n                    }, \"$$brm.sal_ant\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_net_actcomercialUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"COMERCIAL\"\n                      ]\n                    }, \"$$brm.sal_net_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_actmicroCredUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"MICROCREDITO\"\n                      ]\n                    }, \"$$brm.sal_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_antmicroCredUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"MICROCREDITO\"\n                      ]\n                    }, \"$$brm.sal_ant\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_net_actmicroCredUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"MICROCREDITO\"\n                      ]\n                    }, \"$$brm.sal_net_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_actproductivaUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"PRODUCTIVO\"\n                      ]\n                    }, \"$$brm.sal_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_antproductivaUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"PRODUCTIVO\"\n                      ]\n                    }, \"$$brm.sal_ant\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_net_actproductivaUVCBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"PRODUCTIVO\"\n                      ]\n                    }, \"$$brm.sal_net_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_actemprendBdvBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"EMPRENDEBDV\"\n                      ]\n                    }, \"$$brm.sal_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_antemprendBdvBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"EMPRENDEBDV\"\n                      ]\n                    }, \"$$brm.sal_ant\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_net_actemprendBdvBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$eq\": [\n                        \"$$brm.producto\", \"EMPRENDEBDV\"\n                      ]\n                    }, \"$$brm.sal_net_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_actotrosBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$not\": {\n                        \"$in\": [\n                          \"$$brm.producto\", [\n                            \"COMERCIAL\", \"MICROCREDITO\", \"PRODUCTIVO\", \"EMPRENDEBDV\", \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                          ]\n                        ]\n                      }\n                    }, \"$$brm.sal_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_antotrosBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$not\": {\n                        \"$in\": [\n                          \"$$brm.producto\", [\n                            \"COMERCIAL\", \"MICROCREDITO\", \"PRODUCTIVO\", \"EMPRENDEBDV\", \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                          ]\n                        ]\n                      }\n                    }, \"$$brm.sal_ant\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }, \n      \"sal_net_actotrosBs\": {\n        \"$multiply\": [\n          {\n            \"$sum\": {\n              \"$map\": {\n                \"input\": \"$sidis_brm\", \n                \"as\": \"brm\", \n                \"in\": {\n                  \"$cond\": [\n                    {\n                      \"$not\": {\n                        \"$in\": [\n                          \"$$brm.producto\", [\n                            \"COMERCIAL\", \"MICROCREDITO\", \"PRODUCTIVO\", \"EMPRENDEBDV\", \"TDC MC\", \"TDC VISA\", \"CREDINOMINA\", \"CREDITO EN CC\"\n                          ]\n                        ]\n                      }\n                    }, \"$$brm.sal_net_act\", 0\n                  ]\n                }\n              }\n            }\n          }, -1\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"todayDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"previusMonthLastDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversionpreviusMonthLastDate\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"sidis_tasaconversionpreviusMonthLastDate\": \"$$REMOVE\", \n      \"fecha_valor\": \"$todayDate\", \n      \"sal_acttotal\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_acttotalBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_anttotal\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_anttotalBs\", {\n                \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_acttotal\": {\n        \"$subtract\": [\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_acttotalBs\", {\n                    \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_anttotalBs\", {\n                    \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }\n        ]\n      }, \n      \"sal_acttotalBdv\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_acttotalBdvBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_anttotalBdv\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_anttotalBdvBs\", {\n                \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_acttotalBdv\": {\n        \"$subtract\": [\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_acttotalBdvBs\", {\n                    \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_anttotalBdvBs\", {\n                    \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }\n        ]\n      }, \n      \"sal_actcartTradicional\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actcartTradicionalBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antcartTradicional\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antcartTradicionalBs\", {\n                \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actcartTradicional\": {\n        \"$subtract\": [\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_actcartTradicionalBs\", {\n                    \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_antcartTradicionalBs\", {\n                    \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }\n        ]\n      }, \n      \"sal_actcomercialUVC\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actcomercialUVCBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antcomercialUVC\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antcomercialUVCBs\", {\n                \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actcomercialUVC\": {\n        \"$subtract\": [\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_actcomercialUVCBs\", {\n                    \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_antcomercialUVCBs\", {\n                    \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }\n        ]\n      }, \n      \"sal_actmicroCredUVC\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actmicroCredUVCBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antmicroCredUVC\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antmicroCredUVCBs\", {\n                \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actmicroCredUVC\": {\n        \"$subtract\": [\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_actmicroCredUVCBs\", {\n                    \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_antmicroCredUVCBs\", {\n                    \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }\n        ]\n      }, \n      \"sal_actproductivaUVC\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actproductivaUVCBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antproductivaUVC\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antproductivaUVCBs\", {\n                \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actproductivaUVC\": {\n        \"$subtract\": [\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_actproductivaUVCBs\", {\n                    \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_antproductivaUVCBs\", {\n                    \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }\n        ]\n      }, \n      \"sal_actemprendBdv\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actemprendBdvBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antemprendBdv\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antemprendBdvBs\", {\n                \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actemprendBdv\": {\n        \"$subtract\": [\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_actemprendBdvBs\", {\n                    \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_antemprendBdvBs\", {\n                    \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }\n        ]\n      }, \n      \"sal_actotros\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_actotrosBs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antotros\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_antotrosBs\", {\n                \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actotros\": {\n        \"$subtract\": [\n          {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_actotrosBs\", {\n                    \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }, {\n            \"$round\": [\n              {\n                \"$divide\": [\n                  \"$sal_antotrosBs\", {\n                    \"$first\": \"$sidis_tasaconversionpreviusMonthLastDate.Tasa_DOL\"\n                  }\n                ]\n              }, 4\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"CarteraCreditometric\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CarteraCreditometricYesterday\"\n    }\n  }, {\n    \"$addFields\": {\n      \"fecha_valor\": \"$todayDate\", \n      \"todayDate\": \"$$REMOVE\", \n      \"sal_acttotalBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_acttotalBs\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBs\"\n          }\n        ]\n      }, \n      \"sal_anttotalBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_anttotalBs\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBs\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_anttotalBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_acttotalBs\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_acttotalBs\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBs\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_anttotalBs\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBs\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_anttotalBs\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_acttotalBdvBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_acttotalBdvBs\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdvBs\"\n          }\n        ]\n      }, \n      \"sal_anttotalBdvBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_anttotalBdvBs\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdvBs\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_anttotalBdvBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_acttotalBdvBs\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_acttotalBdvBs\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdvBs\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_anttotalBdvBs\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdvBs\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_anttotalBdvBs\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actcartTradicionalBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actcartTradicionalBs\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actcartTradicionalBs\"\n          }\n        ]\n      }, \n      \"sal_antcartTradicionalBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antcartTradicionalBs\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actcartTradicionalBs\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antcartTradicionalBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actcartTradicionalBs\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actcartTradicionalBs\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actcartTradicionalBs\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antcartTradicionalBs\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actcartTradicionalBs\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antcartTradicionalBs\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actcomercialUVCBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actcomercialUVCBs\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actcomercialUVCBs\"\n          }\n        ]\n      }, \n      \"sal_antcomercialUVCBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antcomercialUVCBs\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actcomercialUVCBs\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antcomercialUVCBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actcomercialUVCBs\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actcomercialUVCBs\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actcomercialUVCBs\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antcomercialUVCBs\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actcomercialUVCBs\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antcomercialUVCBs\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actmicroCredUVCBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actmicroCredUVCBs\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actmicroCredUVCBs\"\n          }\n        ]\n      }, \n      \"sal_antmicroCredUVCBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antmicroCredUVCBs\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actmicroCredUVCBs\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antmicroCredUVCBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actmicroCredUVCBs\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actmicroCredUVCBs\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actmicroCredUVCBs\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antmicroCredUVCBs\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actmicroCredUVCBs\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antmicroCredUVCBs\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actproductivaUVCBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actproductivaUVCBs\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actproductivaUVCBs\"\n          }\n        ]\n      }, \n      \"sal_antproductivaUVCBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antproductivaUVCBs\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actproductivaUVCBs\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antproductivaUVCBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actproductivaUVCBs\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actproductivaUVCBs\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actproductivaUVCBs\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antproductivaUVCBs\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actproductivaUVCBs\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antproductivaUVCBs\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actemprendBdvBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actemprendBdvBs\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actemprendBdvBs\"\n          }\n        ]\n      }, \n      \"sal_antemprendBdvBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antemprendBdvBs\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actemprendBdvBs\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antemprendBdvBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actemprendBdvBs\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actemprendBdvBs\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actemprendBdvBs\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antemprendBdvBs\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actemprendBdvBs\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antemprendBdvBs\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actotrosBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actotrosBs\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actotrosBs\"\n          }\n        ]\n      }, \n      \"sal_antotrosBs\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antotrosBs\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actotrosBs\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antotrosBs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actotrosBs\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actotrosBs\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actotrosBs\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antotrosBs\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actotrosBs\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antotrosBs\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_acttotal\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_acttotal\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_acttotal\"\n          }\n        ]\n      }, \n      \"sal_anttotal\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_anttotal\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_acttotal\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_anttotal\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_acttotal\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_acttotal\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_acttotal\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_anttotal\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_acttotal\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_anttotal\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_acttotalBdv\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_acttotalBdv\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdv\"\n          }\n        ]\n      }, \n      \"sal_anttotalBdv\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_anttotalBdv\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdv\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_anttotalBdv\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_acttotalBdv\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_acttotalBdv\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdv\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_anttotalBdv\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdv\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_anttotalBdv\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actcartTradicional\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actcartTradicional\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actcartTradicional\"\n          }\n        ]\n      }, \n      \"sal_antcartTradicional\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antcartTradicional\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actcartTradicional\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antcartTradicional\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actcartTradicional\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actcartTradicional\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actcartTradicional\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antcartTradicional\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actcartTradicional\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antcartTradicional\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actcomercialUVC\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actcomercialUVC\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actcomercialUVC\"\n          }\n        ]\n      }, \n      \"sal_antcomercialUVC\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antcomercialUVC\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actcomercialUVC\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antcomercialUVC\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actcomercialUVC\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actcomercialUVC\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actcomercialUVC\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antcomercialUVC\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actcomercialUVC\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antcomercialUVC\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actmicroCredUVC\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actmicroCredUVC\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actmicroCredUVC\"\n          }\n        ]\n      }, \n      \"sal_antmicroCredUVC\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antmicroCredUVC\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actmicroCredUVC\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antmicroCredUVC\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actmicroCredUVC\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actmicroCredUVC\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actmicroCredUVC\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antmicroCredUVC\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actmicroCredUVC\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antmicroCredUVC\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actproductivaUVC\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actproductivaUVC\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actproductivaUVC\"\n          }\n        ]\n      }, \n      \"sal_antproductivaUVC\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antproductivaUVC\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actproductivaUVC\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antproductivaUVC\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actproductivaUVC\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actproductivaUVC\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actproductivaUVC\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antproductivaUVC\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actproductivaUVC\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antproductivaUVC\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actemprendBdv\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actemprendBdv\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actemprendBdv\"\n          }\n        ]\n      }, \n      \"sal_antemprendBdv\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antemprendBdv\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actemprendBdv\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antemprendBdv\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actemprendBdv\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actemprendBdv\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actemprendBdv\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antemprendBdv\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actemprendBdv\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antemprendBdv\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_actotros\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_actotros\", {\n            \"$first\": \"$CarteraCreditometricYesterday.sal_actotros\"\n          }\n        ]\n      }, \n      \"sal_antotros\": {\n        \"$cond\": [\n          \"$avaiableDate\", \"$sal_antotros\", {\n            \"$cond\": [\n              \"$firstDayMonth\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actotros\"\n              }, {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_antotros\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_actotros\": {\n        \"$subtract\": [\n          {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_actotros\", {\n                \"$first\": \"$CarteraCreditometricYesterday.sal_actotros\"\n              }\n            ]\n          }, {\n            \"$cond\": [\n              \"$avaiableDate\", \"$sal_antotros\", {\n                \"$cond\": [\n                  \"$firstDayMonth\", {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_actotros\"\n                  }, {\n                    \"$first\": \"$CarteraCreditometricYesterday.sal_antotros\"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"CarteraCreditometricYesterday\": \"$$REMOVE\", \n      \"adjustmentCond\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$CarteraCreditometricYesterday.adjustmentCond\"\n                      }, true\n                    ]\n                  }, {\n                    \"$in\": [\n                      {\n                        \"$month\": \"$fecha_valor\"\n                      }, [\n                        7, 8, 9, 10, 11, 12\n                      ]\n                    ]\n                  }\n                ]\n              }, \n              \"then\": true\n            }, {\n              \"case\": {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$CarteraCreditometricYesterday.adjustmentCond\"\n                      }, false\n                    ]\n                  }, {\n                    \"$lte\": [\n                      {\n                        \"$first\": \"$CarteraCreditometricYesterday.adjustmentCond\"\n                      }, null\n                    ]\n                  }\n                ]\n              }, \n              \"then\": {\n                \"$cond\": [\n                  {\n                    \"$and\": [\n                      {\n                        \"$lte\": [\n                          {\n                            \"$ifNull\": [\n                              {\n                                \"$divide\": [\n                                  \"$sal_acttotalBdvBs\", {\n                                    \"$first\": \"$CarteraCreditometricYesterday.sal_acttotalBdvBs\"\n                                  }\n                                ]\n                              }, 1\n                            ]\n                          }, 0.5\n                        ]\n                      }, {\n                        \"$eq\": [\n                          {\n                            \"$month\": \"$fecha_valor\"\n                          }, 7\n                        ]\n                      }\n                    ]\n                  }, true, false\n                ]\n              }\n            }\n          ], \n          \"default\": false\n        }\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"CarteraCreditometric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "0f5bfed4-a56e-4006-aa19-b8df3e5f879c",
        "name": "1_agrupacionDiaSidisBrm_carteraCreditometric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1720,
          7100
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "content": "cartera de crÃ©dito",
          "height": 517.8778879737748,
          "width": 4097.220895419057
        },
        "id": "0ab5be57-af20-4deb-ad37-3d52676dfbca",
        "name": "Note5",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          750,
          6820
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"5_Procesamiento_CobranzaMora\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem7",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1400,
          6120
        ],
        "id": "9d325e5f-5017-4f35-af4a-b126206f6284",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/2ed79e6e-2e8d-49b1-bb0b-fd811b5d78d4",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "65952da3-ad94-4308-9fbc-6b67f293e317",
        "name": "HTTP Request4",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          800,
          6120
        ]
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "5b8f3f7b-a0c1-4c2b-86a0-bc39ca76fa84",
        "name": "IF3",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1580,
          6120
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/2ed79e6e-2e8d-49b1-bb0b-fd811b5d78d4",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "19106449-8ffa-44ab-97ae-20c7db7a2b61",
        "name": "HTTP Request15",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          4580,
          6040
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_activosIa",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_activosIa\", \n      \"let\": {\n        \"date\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$date\", \"$fevalor\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"fevalor\": 1, \n            \"cta_contable\": 1, \n            \"monto_paguvc\": 1\n          }\n        }\n      ], \n      \"as\": \"sidis_activosIa\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"date\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$date\", \"$fecha_odate\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$in\": [\n                    \"$nucta\", [\n                      \"131\", \"132\", \"133\", \"134\"\n                    ]\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"nucta\": 1, \n            \"fecha_odate\": 1, \n            \"sal_act\": 1, \n            \"sal_ant\": 1, \n            \"sal_net_act\": 1\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$addFields\": {\n      \"avaiableDataBRM\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_brm\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"avaiableDataActivosIa\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_activosIa\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"firstDayMonth\": {\n        \"$eq\": [\n          {\n            \"$dayOfMonth\": \"$todayDate\"\n          }, 1\n        ]\n      }, \n      \"firstDayYear\": {\n        \"$and\": [\n          {\n            \"$eq\": [\n              {\n                \"$dayOfMonth\": \"$todayDate\"\n              }, 1\n            ]\n          }, {\n            \"$eq\": [\n              {\n                \"$month\": \"$todayDate\"\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"yesterdayDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"tomorrowDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": 1\n        }\n      }, \n      \"previusMonthDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"PreviusMonthlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$month\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"previusYearDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }, \n      \"PreviusYearlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"monto_paguvc\": {\n        \"$sum\": {\n          \"$map\": {\n            \"input\": \"$sidis_activosIa\", \n            \"as\": \"item\", \n            \"in\": \"$$item.monto_paguvc\"\n          }\n        }\n      }, \n      \"sal_act131Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"131\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.sal_act\"\n            }\n          }\n        }\n      }, \n      \"sal_act132Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"132\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.sal_act\"\n            }\n          }\n        }\n      }, \n      \"sal_act133Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"133\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.sal_act\"\n            }\n          }\n        }\n      }, \n      \"sal_act134Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"134\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.sal_act\"\n            }\n          }\n        }\n      }, \n      \"sal_ant131Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"131\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.sal_ant\"\n            }\n          }\n        }\n      }, \n      \"sal_ant132Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"132\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.sal_ant\"\n            }\n          }\n        }\n      }, \n      \"sal_ant133Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"133\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.sal_ant\"\n            }\n          }\n        }\n      }, \n      \"sal_ant134Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"134\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": \"$$item.sal_ant\"\n            }\n          }\n        }\n      }, \n      \"sal_net_act131Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"131\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": {\n                \"$multiply\": [\n                  \"$$item.sal_net_act\", 1\n                ]\n              }\n            }\n          }\n        }\n      }, \n      \"sal_net_act132Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"132\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": {\n                \"$multiply\": [\n                  \"$$item.sal_net_act\", 1\n                ]\n              }\n            }\n          }\n        }\n      }, \n      \"sal_net_act133Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"133\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": {\n                \"$multiply\": [\n                  \"$$item.sal_net_act\", 1\n                ]\n              }\n            }\n          }\n        }\n      }, \n      \"sal_net_act134Bs\": {\n        \"$sum\": {\n          \"$first\": {\n            \"$map\": {\n              \"input\": {\n                \"$filter\": {\n                  \"input\": \"$sidis_brm\", \n                  \"as\": \"item\", \n                  \"cond\": {\n                    \"$eq\": [\n                      \"$$item.nucta\", \"134\"\n                    ]\n                  }\n                }\n              }, \n              \"as\": \"item\", \n              \"in\": {\n                \"$multiply\": [\n                  \"$$item.sal_net_act\", 1\n                ]\n              }\n            }\n          }\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Cobranzamorametric\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CobranzamorametricYesterday\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Cobranzamorametric\", \n      \"localField\": \"PreviusMonthlastDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CobranzamorametricPreviusMonthlastDate\"\n    }\n  }, {\n    \"$addFields\": {\n      \"fecha_valor\": \"$todayDate\", \n      \"todayDate\": \"$$REMOVE\", \n      \"sidis_activosIa\": \"$$REMOVE\", \n      \"sidis_brm\": \"$$REMOVE\", \n      \"CobranzamorametricYesterday\": \"$$REMOVE\", \n      \"CobranzamorametricPreviusMonthlastDate\": \"$$REMOVE\", \n      \"monto_paguvc\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$monto_paguvc\", {\n            \"$first\": \"$CobranzamorametricYesterday.monto_paguvc\"\n          }\n        ]\n      }, \n      \"sal_act131Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_act131Bs\", {\n            \"$first\": \"$CobranzamorametricYesterday.sal_act131Bs\"\n          }\n        ]\n      }, \n      \"sal_act132Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_act132Bs\", {\n            \"$first\": \"$CobranzamorametricYesterday.sal_act132Bs\"\n          }\n        ]\n      }, \n      \"sal_act133Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_act133Bs\", {\n            \"$first\": \"$CobranzamorametricYesterday.sal_act133Bs\"\n          }\n        ]\n      }, \n      \"sal_act134Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_act134Bs\", {\n            \"$first\": \"$CobranzamorametricYesterday.sal_act134Bs\"\n          }\n        ]\n      }, \n      \"sal_ant131Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_ant131Bs\", {\n            \"$first\": \"$CobranzamorametricPreviusMonthlastDate.sal_ant131Bs\"\n          }\n        ]\n      }, \n      \"sal_ant132Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_ant132Bs\", {\n            \"$first\": \"$CobranzamorametricPreviusMonthlastDate.sal_ant132Bs\"\n          }\n        ]\n      }, \n      \"sal_ant133Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_ant133Bs\", {\n            \"$first\": \"$CobranzamorametricPreviusMonthlastDate.sal_ant133Bs\"\n          }\n        ]\n      }, \n      \"sal_ant134Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_ant134Bs\", {\n            \"$first\": \"$CobranzamorametricPreviusMonthlastDate.sal_ant134Bs\"\n          }\n        ]\n      }, \n      \"sal_net_act131Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_net_act131Bs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$CobranzamorametricYesterday.sal_act131Bs\"\n              }, {\n                \"$first\": \"$CobranzamorametricPreviusMonthlastDate.sal_ant131Bs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_act132Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_net_act132Bs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$CobranzamorametricYesterday.sal_act132Bs\"\n              }, {\n                \"$first\": \"$CobranzamorametricPreviusMonthlastDate.sal_ant132Bs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_act133Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_net_act133Bs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$CobranzamorametricYesterday.sal_act133Bs\"\n              }, {\n                \"$first\": \"$CobranzamorametricPreviusMonthlastDate.sal_ant133Bs\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"sal_net_act134Bs\": {\n        \"$cond\": [\n          \"$avaiableDataBRM\", \"$sal_net_act134Bs\", {\n            \"$subtract\": [\n              {\n                \"$first\": \"$CobranzamorametricYesterday.sal_act134Bs\"\n              }, {\n                \"$first\": \"$CobranzamorametricPreviusMonthlastDate.sal_ant134Bs\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"monto_pag\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$monto_paguvc\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_act131\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_act131Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_act132\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_act132Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_act133\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_act133Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_act134\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_act134Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_ant131\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_ant131Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_ant132\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_ant132Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_ant133\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_ant133Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_ant134\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_ant134Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_act131\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_act131Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_act132\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_act132Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_act133\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_act133Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_act134\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$sal_net_act134Bs\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Cobranzamorametric\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CobranzamorametricYesterday\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Cobranzamorametric\", \n      \"localField\": \"PreviusMonthlastDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"CobranzamorametricPreviusMonthlastDate\"\n    }\n  }, {\n    \"$addFields\": {\n      \"CobranzamorametricYesterday\": \"$$REMOVE\", \n      \"CobranzamorametricPreviusMonthlastDate\": \"$$REMOVE\", \n      \"adjustmentCond\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$CobranzamorametricYesterday.adjustmentCond\"\n                      }, true\n                    ]\n                  }, {\n                    \"$in\": [\n                      {\n                        \"$month\": \"$fecha_valor\"\n                      }, [\n                        7, 8, 9, 10, 11, 12\n                      ]\n                    ]\n                  }\n                ]\n              }, \n              \"then\": true\n            }, {\n              \"case\": {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$CobranzamorametricYesterday.adjustmentCond\"\n                      }, false\n                    ]\n                  }, {\n                    \"$lte\": [\n                      {\n                        \"$first\": \"$CobranzamorametricYesterday.adjustmentCond\"\n                      }, null\n                    ]\n                  }\n                ]\n              }, \n              \"then\": {\n                \"$cond\": [\n                  {\n                    \"$and\": [\n                      {\n                        \"$lte\": [\n                          {\n                            \"$ifNull\": [\n                              {\n                                \"$divide\": [\n                                  \"$sal_act131Bs\", {\n                                    \"$first\": \"$CobranzamorametricYesterday.sal_act131Bs\"\n                                  }\n                                ]\n                              }, 1\n                            ]\n                          }, 0.5\n                        ]\n                      }, {\n                        \"$eq\": [\n                          {\n                            \"$month\": \"$fecha_valor\"\n                          }, 7\n                        ]\n                      }\n                    ]\n                  }, true, false\n                ]\n              }\n            }\n          ], \n          \"default\": false\n        }\n      }, \n      \"adjustmentCondJanuary\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$firstDayYear\", \n              \"then\": true\n            }, {\n              \"case\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$fecha_valor\"\n                      }, 1\n                    ]\n                  }, {\n                    \"$lte\": [\n                      {\n                        \"$ifNull\": [\n                          {\n                            \"$divide\": [\n                              {\n                                \"$first\": \"$CobranzamorametricYesterday.sal_act131Bs\"\n                              }, \"$sal_act131Bs\"\n                            ]\n                          }, 1\n                        ]\n                      }, 2\n                    ]\n                  }, {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$CobranzamorametricYesterday.adjustmentCondJanuary\"\n                      }, true\n                    ]\n                  }\n                ]\n              }, \n              \"then\": true\n            }, {\n              \"case\": {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$fecha_valor\"\n                      }, 1\n                    ]\n                  }, {\n                    \"$eq\": [\n                      {\n                        \"$first\": \"$CobranzamorametricYesterday.adjustmentCondJanuary\"\n                      }, false\n                    ]\n                  }\n                ]\n              }, \n              \"then\": false\n            }\n          ], \n          \"default\": false\n        }\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Cobranzamorametric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"replace\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "66c205cc-855c-499f-a681-5563eb42171c",
        "name": "1_agrupacionDiaSidisIaToCobranzamorametric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1800,
          5920
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Cobranzamorametric",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          \"$fecha_valor\", {\n            \"$subtract\": [\n              {\n                \"$toDate\": {\n                  \"$dateFromString\": {\n                    \"dateString\": {\n                      \"$dateToString\": {\n                        \"format\": \"%Y-%m-%dT00:00:00%z\", \n                        \"date\": {\n                          \"$toDate\": \"$$NOW\"\n                        }\n                      }\n                    }\n                  }\n                }\n              }, {\n                \"$multiply\": [\n                  {\n                    \"$toInt\": \"{{$json.offSet}}\"\n                  }, 86400000\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"BalancemetricYesterday\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Objectiveformat\", \n      \"let\": {\n        \"mes\": {\n          \"$month\": \"$fecha_valor\"\n        }, \n        \"ano\": {\n          \"$year\": \"$fecha_valor\"\n        }\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$mes\", {\n                      \"$month\": \"$fecha\"\n                    }\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$ano\", {\n                      \"$year\": \"$fecha\"\n                    }\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"cmCobAct\": 1, \n            \"cmCobRet\": 1\n          }\n        }\n      ], \n      \"as\": \"Objectiveformat\"\n    }\n  }, {\n    \"$project\": {\n      \"fecha_valor\": 1, \n      \"cobranzaMoraUVC.cobranza.actual\": \"$monto_paguvc\", \n      \"cobranzaMoraUVC.cobranza.acMensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$firstDayMonth\", true\n            ]\n          }, \"$monto_paguvc\", {\n            \"$sum\": [\n              \"$monto_paguvc\", {\n                \"$first\": \"$BalancemetricYesterday.cobranzaMoraUVC.cobranza.acMensual\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"cobranzaMoraUVC.cobranza.acAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$firstDayYear\", true\n            ]\n          }, \"$monto_paguvc\", {\n            \"$sum\": [\n              \"$monto_paguvc\", {\n                \"$first\": \"$BalancemetricYesterday.cobranzaMoraUVC.cobranza.acAnual\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"cobranzaMoraUVC.cobranza.cumpMensPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$firstDayMonth\", true\n                        ]\n                      }, \"$monto_paguvc\", {\n                        \"$sum\": [\n                          \"$monto_paguvc\", {\n                            \"$first\": \"$BalancemetricYesterday.cobranzaMoraUVC.cobranza.acMensual\"\n                          }\n                        ]\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$Objectiveformat.cmCobAct\"\n                  }\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"cobranzaMoraUVC.cobranza.cumpMensRetPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$firstDayMonth\", true\n                        ]\n                      }, \"$monto_paguvc\", {\n                        \"$sum\": [\n                          \"$monto_paguvc\", {\n                            \"$first\": \"$BalancemetricYesterday.cobranzaMoraUVC.cobranza.acMensual\"\n                          }\n                        ]\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$Objectiveformat.cmCobRet\"\n                  }\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"cobranzaMora.cobranza.actual\": \"$monto_pag\", \n      \"cobranzaMora.cobranza.acMensual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$firstDayMonth\", true\n            ]\n          }, \"$monto_pag\", {\n            \"$sum\": [\n              \"$monto_pag\", {\n                \"$first\": \"$BalancemetricYesterday.cobranzaMora.cobranza.acMensual\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"cobranzaMora.cobranza.acAnual\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$firstDayYear\", true\n            ]\n          }, \"$monto_pag\", {\n            \"$sum\": [\n              \"$monto_pag\", {\n                \"$first\": \"$BalancemetricYesterday.cobranzaMora.cobranza.acAnual\"\n              }\n            ]\n          }\n        ]\n      }, \n      \"cobranzaMora.cobranza.cumpMensPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$firstDayMonth\", true\n                        ]\n                      }, \"$monto_paguvc\", {\n                        \"$sum\": [\n                          \"$monto_paguvc\", {\n                            \"$first\": \"$BalancemetricYesterday.cobranzaMoraUVC.cobranza.acMensual\"\n                          }\n                        ]\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$Objectiveformat.cmCobAct\"\n                  }\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"cobranzaMora.cobranza.cumpMensRetPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$firstDayMonth\", true\n                        ]\n                      }, \"$monto_paguvc\", {\n                        \"$sum\": [\n                          \"$monto_paguvc\", {\n                            \"$first\": \"$BalancemetricYesterday.cobranzaMoraUVC.cobranza.acMensual\"\n                          }\n                        ]\n                      }\n                    ]\n                  }, {\n                    \"$first\": \"$Objectiveformat.cmCobRet\"\n                  }\n                ]\n              }, 100\n            ]\n          }, 2\n        ]\n      }, \n      \"cobranzaMoraUVC.mora.mtoCartVenActBs\": \"$sal_act133Bs\", \n      \"cobranzaMoraUVC.mora.mtoCartVenAntBs\": \"$sal_ant133Bs\", \n      \"cobranzaMoraUVC.mora.mtoCartVenNetActBs\": \"$sal_net_act133Bs\", \n      \"cobranzaMoraUVC.mora.mtoCartVen2ActBs\": {\n        \"$sum\": [\n          \"$sal_act133Bs\", \"$sal_act132Bs\"\n        ]\n      }, \n      \"cobranzaMoraUVC.mora.mtoCartVen2AntBs\": {\n        \"$sum\": [\n          \"$sal_ant133Bs\", \"$sal_ant132Bs\"\n        ]\n      }, \n      \"cobranzaMoraUVC.mora.mtoCartVen2NetActBs\": {\n        \"$sum\": [\n          \"$sal_net_act133Bs\", \"$sal_net_act132Bs\"\n        ]\n      }, \n      \"cobranzaMoraUVC.mora.mtoCartBrutActBs\": {\n        \"$sum\": [\n          \"$sal_act133Bs\", \"$sal_act132Bs\", \"$sal_act131Bs\", \"$sal_act134Bs\"\n        ]\n      }, \n      \"cobranzaMoraUVC.mora.mtoCartBrutAntBs\": {\n        \"$sum\": [\n          \"$sal_ant133Bs\", \"$sal_ant132Bs\", \"$sal_ant131Bs\", \"$sal_ant134Bs\"\n        ]\n      }, \n      \"cobranzaMoraUVC.mora.mtoCartBrutNetActBs\": {\n        \"$sum\": [\n          \"$sal_net_act133Bs\", \"$sal_net_act132Bs\", \"$sal_net_act131Bs\", \"$sal_net_act134Bs\"\n        ]\n      }, \n      \"cobranzaMora.mora.mtoCartVenAct\": \"$sal_act133\", \n      \"cobranzaMora.mora.mtoCartVenAnt\": \"$sal_ant133\", \n      \"cobranzaMora.mora.mtoCartVenNetAct\": \"$sal_net_act133\", \n      \"cobranzaMora.mora.mtoCartVen2Act\": {\n        \"$sum\": [\n          \"$sal_act133\", \"$sal_act132\"\n        ]\n      }, \n      \"cobranzaMora.mora.mtoCartVen2Ant\": {\n        \"$sum\": [\n          \"$sal_ant133\", \"$sal_ant132\"\n        ]\n      }, \n      \"cobranzaMora.mora.mtoCartVen2NetAct\": {\n        \"$sum\": [\n          \"$sal_net_act133\", \"$sal_net_act132\"\n        ]\n      }, \n      \"cobranzaMora.mora.mtoCartBrutAct\": {\n        \"$sum\": [\n          \"$sal_act133\", \"$sal_act132\", \"$sal_act131\", \"$sal_act134\"\n        ]\n      }, \n      \"cobranzaMora.mora.mtoCartBrutAnt\": {\n        \"$sum\": [\n          \"$sal_ant133\", \"$sal_ant132\", \"$sal_ant131\", \"$sal_ant134\"\n        ]\n      }, \n      \"cobranzaMora.mora.mtoCartBrutNetAct\": {\n        \"$sum\": [\n          \"$sal_net_act133\", \"$sal_net_act132\", \"$sal_net_act131\", \"$sal_net_act134\"\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Financialstatementdashboard\", \n      \"let\": {\n        \"mes\": {\n          \"$month\": \"$fecha_valor\"\n        }, \n        \"ano\": {\n          \"$year\": \"$fecha_valor\"\n        }\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$mes\", {\n                      \"$month\": \"$fechaProceso\"\n                    }\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$ano\", {\n                      \"$year\": \"$fechaProceso\"\n                    }\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ], \n      \"as\": \"Financialstatementdashboard\"\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"Financialstatementdashboard\": \"$$REMOVE\", \n      \"cobranzaMora.indiceMora.actualPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  \"$cobranzaMora.mora.mtoCartVenAct\", \"$cobranzaMora.mora.mtoCartBrutAct\"\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMoraUVC.indiceMora.actualPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  \"$cobranzaMoraUVC.mora.mtoCartVenActBs\", \"$cobranzaMoraUVC.mora.mtoCartBrutActBs\"\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMora.indiceMora.ampliadaPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  \"$cobranzaMora.mora.mtoCartVen2Act\", \"$cobranzaMora.mora.mtoCartBrutAct\"\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMoraUVC.indiceMora.ampliadaPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$divide\": [\n                  \"$cobranzaMoraUVC.mora.mtoCartVen2ActBs\", \"$cobranzaMoraUVC.mora.mtoCartBrutActBs\"\n                ]\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMora.indiceMora.sustemFinancPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$first\": {\n                  \"$first\": \"$Financialstatementdashboard.loanDelincuency.globalValue\"\n                }\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMoraUVC.indiceMora.sustemFinancPcrt\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              100, {\n                \"$first\": {\n                  \"$first\": \"$Financialstatementdashboard.loanDelincuency.globalValue\"\n                }\n              }\n            ]\n          }, 4\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "d7ac0c5d-c989-4db7-9743-add4c001f251",
        "name": "2_IndicadoresConbranzaMora_Balancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2200,
          5920
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "mode": "chooseBranch"
        },
        "id": "dc73b641-0379-4046-8964-1e55cb29c26b",
        "name": "Merge28",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2400,
          6240
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Castigos",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"fecha\": {\n        \"$toDate\": \"$fecha\"\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Sidis_Castigos\", \n      \"on\": \"fecha\"\n    }\n  }\n]"
        },
        "id": "a8e6d8c8-b267-49cf-8060-1d24e272f81e",
        "name": "3_CastigoFormateo",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1820,
          6260
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Sidis_Castigos",
          "query": "=[\n  {\n    \"$addFields\": {\n      \"today\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"dateStart\": {\n        \"$dateFromParts\": {\n          \"year\": {\n            \"$year\": \"$today\"\n          }\n        }\n      }, \n      \"dateFinish\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$today\"\n              }, \n              \"month\": {\n                \"$sum\": [\n                  {\n                    \"$month\": \"$today\"\n                  }, 1\n                ]\n              }\n            }\n          }, 86400000\n        ]\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$and\": [\n        {\n          \"$expr\": {\n            \"$gte\": [\n              \"$fecha\", \"$dateStart\"\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$lte\": [\n              \"$fecha\", \"$dateFinish\"\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$group\": {\n      \"_id\": \"$today\", \n      \"acAnualMonto\": {\n        \"$sum\": \"$castigo\"\n      }, \n      \"acMensualMonto\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$dateFinish\", \"$fecha\"\n              ]\n            }, \"$castigo\", 0\n          ]\n        }\n      }, \n      \"monto\": {\n        \"$sum\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$dateFinish\", \"$fecha\"\n              ]\n            }, \"$castigo\", 0\n          ]\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"_id\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"_id\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"result1\"\n    }\n  }, {\n    \"$addFields\": {\n      \"result\": \"$$REMOVE\", \n      \"result1\": \"$$REMOVE\", \n      \"tasa\": {\n        \"$first\": \"$result1.Tasa_DOL\"\n      }, \n      \"cobranzaMora\": {\n        \"$first\": \"$result.cobranzaMora\"\n      }, \n      \"cobranzaMoraUVC\": {\n        \"$first\": \"$result.cobranzaMoraUVC\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"acAnualMonto\": \"$$REMOVE\", \n      \"acMensualMonto\": \"$$REMOVE\", \n      \"monto\": \"$$REMOVE\", \n      \"tasa\": \"$$REMOVE\", \n      \"fecha_valor\": \"$_id\", \n      \"cobranzaMora.castigo.monto\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              \"$monto\", 1000000\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMora.castigo.acMensualMonto\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              \"$acMensualMonto\", 1000000\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMora.castigo.acAnualMonto\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              \"$acAnualMonto\", 1000000\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMoraUVC.castigo.monto\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$multiply\": [\n                  \"$monto\", \"$tasa\"\n                ]\n              }, 1000000\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMoraUVC.castigo.acMensualMonto\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$multiply\": [\n                  \"$acMensualMonto\", \"$tasa\"\n                ]\n              }, 1000000\n            ]\n          }, 4\n        ]\n      }, \n      \"cobranzaMoraUVC.castigo.acAnualMonto\": {\n        \"$round\": [\n          {\n            \"$multiply\": [\n              {\n                \"$multiply\": [\n                  \"$acAnualMonto\", \"$tasa\"\n                ]\n              }, 1000000\n            ]\n          }, 4\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "e72d78b7-9ca5-4054-8755-3d08cc9d5654",
        "name": "4_CastigoBalancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2600,
          6240
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/2ed79e6e-2e8d-49b1-bb0b-fd811b5d78d4",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=554"
              }
            ]
          },
          "options": {}
        },
        "id": "0c5031a0-4428-4456-b565-ebf6c8f13a31",
        "name": "HTTP Request5",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          800,
          5960
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "2ed79e6e-2e8d-49b1-bb0b-fd811b5d78d4",
          "options": {}
        },
        "id": "364ceb5d-bd38-47a0-a85c-6af108d2732b",
        "name": "Webhook4",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          1000,
          6120
        ],
        "webhookId": "2ed79e6e-2e8d-49b1-bb0b-fd811b5d78d4"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/Balancemetric_TK32_IngresosCartera",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=5"
              }
            ]
          },
          "options": {}
        },
        "id": "59705a72-c34b-4370-b08e-75a9ec60c0bd",
        "name": "HTTP Request7",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          780,
          7100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/8d85f2c4-a2fd-40c5-a7bb-8d579c612567",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{JSON.stringify($json)}}",
          "options": {}
        },
        "id": "82516298-7893-4458-b55f-6be3c070d0b6",
        "name": "HTTP Request10",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          2920,
          9240
        ]
      },
      {
        "parameters": {},
        "id": "6f9d9585-e6de-4caa-950d-08aec7b58394",
        "name": "NoOp",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          1320,
          9260
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "8d85f2c4-a2fd-40c5-a7bb-8d579c612567",
          "options": {}
        },
        "id": "1fb01bd1-9b92-4975-abc3-8e5b1f33086e",
        "name": "Webhook8",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          3140,
          9240
        ],
        "webhookId": "8d85f2c4-a2fd-40c5-a7bb-8d579c612567"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/8d85f2c4-a2fd-40c5-a7bb-8d579c612567",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "b4b297b1-156c-4a5e-8a29-89883de0cc6d",
        "name": "HTTP Request21",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          4260,
          9220
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"9_Procesamiento_Captaciones\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem11",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          3280,
          9240
        ],
        "id": "13302787-8355-4e4e-b5cd-3ee23c3c22d1",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "e8122938-2350-4c0f-bf8f-03b9c3d11a93",
        "name": "IF6",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          3440,
          9240
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/Balancemetric_TK32_Captaciones",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=89"
              }
            ]
          },
          "options": {}
        },
        "id": "99760c51-125e-455e-a5fe-8251a8517986",
        "name": "HTTP Request8",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          820,
          8480
        ]
      },
      {
        "parameters": {
          "functionCode": "return item.body;"
        },
        "name": "FunctionItem13",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          2300,
          9260
        ],
        "id": "e41a10ed-41de-4e62-ac20-f73ba941f660",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/TK32_LiquidacionesVentana",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=5"
              },
              {}
            ]
          },
          "options": {}
        },
        "id": "e1feb613-334d-4c23-bd88-0f963e39cc7c",
        "name": "ActivacionManualLiquidaciones",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          1440,
          5620
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "3a7a5a1d-6e3e-465f-8c46-a2b6b871a8ec",
        "name": "Merge36",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          4460,
          5480
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "6a7273cb-eeaa-4c04-add1-f1d9f9ea4a7d",
        "name": "2_updated_OP",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          4300,
          5400
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "428f6397-7608-4360-8f46-ffef705adde8",
        "name": "IF5",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1920,
          5620
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"4_Procesamiento_Liquidaciones\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem15",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1780,
          5620
        ],
        "id": "87882b4c-216c-4c58-88fa-21517b847a02",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "efc5203b-5e2d-4217-8983-ace8656c0fc6",
        "name": "Merge38",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          4420,
          6040
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "ee608773-c3a6-48c7-ad41-027f664ec161",
        "name": "2_updated_OP1",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          4220,
          5920
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "9c5cc593-ab07-4ca2-a81d-2b17d833c418",
        "name": "Merge39",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2480,
          6700
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "c7bd343b-15d0-4fc7-adbd-f09e857f5cc9",
        "name": "2_updated_OP2",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2300,
          6620
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "8756e89a-5aa9-4a81-ba16-1bb631af5a45",
        "name": "Merge40",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          4380,
          7180
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "3753f635-412c-45cf-a196-c30f049b4cb4",
        "name": "2_updated_OP3",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          4220,
          7040
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "eb29fe57-3229-40c5-bd24-69f2692b67e3",
        "name": "Merge42",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          4100,
          9220
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "19e45b1f-5cee-40fc-aafc-763d65c27dbe",
        "name": "2_updated_OP5",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          3920,
          9140
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "9039f9b8-dc70-4549-b148-dfe98e3651bf",
        "name": "Merge41",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          4380,
          7720
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "99952001-4466-4f0b-98c7-8b36b90fd4f3",
        "name": "2_updated_OP4",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          4220,
          7580
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "functionCode": "\nconst proceso = \"1_FormateoObjetivos\"  //enter process name\n\nconst jsonOutput = {\n  proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem16",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          -2240,
          8260
        ],
        "id": "8b973a16-c48c-4ffe-86f1-6642d3a3d056",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "f42eb620-f2e8-4a6d-9884-8c307142894a",
        "name": "2_updated_OP7",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -2060,
          8260
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "functionCode": "\nconst proceso = \"2_FormateoBRMAJUSTADO\"  //enter process name\n\nconst jsonOutput = {\n  proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem17",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          -1780,
          8260
        ],
        "id": "5d1d8368-6901-4fb7-a47b-31713bef651b",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "01a46fb7-dd43-4dce-b8de-e8e77de6df88",
        "name": "2_updated_OP8",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -1600,
          8260
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "functionCode": "\nconst proceso = \"3_AjusteBRM\"  //enter process name\n\nconst jsonOutput = {\n  proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem18",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          -1260,
          8260
        ],
        "id": "b8a62772-41fb-4fe0-9957-66fa754a4c8a",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "88a1e85a-5fa0-4287-b70e-e8de982a1825",
        "name": "2_updated_OP9",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -1080,
          8260
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/VentanaCalculosBalancemetric_TK32",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=808"
              }
            ]
          },
          "options": {}
        },
        "id": "041ae737-320a-496a-b2a9-3a57aa7ace21",
        "name": "HTTP Request9",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          780,
          6600
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "f4140f19-52ea-46b2-83cd-28a1d972f153",
        "name": "Merge",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2760,
          6040
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Cobranzamorametric",
          "query": "=[\n    {\n      \"$limit\": 1\n    }, {\n      \"$project\": {\n        \"_id\": 0, \n        \"todayDate\": {\n          \"$subtract\": [\n            {\n              \"$dateTrunc\": {\n                \"date\": \"$$NOW\", \n                \"unit\": \"day\"\n              }\n            }, {\n              \"$multiply\": [\n                {\n                  \"$toInt\": \"{{$json.offSet}}\"\n                }, 86400000\n              ]\n            }\n          ]\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"previusMonthFirstDate\": {\n          \"$dateFromParts\": {\n            \"day\": 1, \n            \"month\": {\n              \"$month\": {\n                \"$dateAdd\": {\n                  \"startDate\": \"$todayDate\", \n                  \"unit\": \"month\", \n                  \"amount\": -1\n                }\n              }\n            }, \n            \"year\": {\n              \"$year\": {\n                \"$dateAdd\": {\n                  \"startDate\": \"$todayDate\", \n                  \"unit\": \"month\", \n                  \"amount\": -1\n                }\n              }\n            }\n          }\n        }\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"Balancemetric\", \n        \"let\": {\n          \"todayDate\": \"$todayDate\", \n          \"previusMonthFirstDate\": \"$previusMonthFirstDate\"\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$and\": [\n                {\n                  \"$expr\": {\n                    \"$gte\": [\n                      \"$fecha_valor\", \"$$previusMonthFirstDate\"\n                    ]\n                  }\n                }, {\n                  \"$expr\": {\n                    \"$lte\": [\n                      \"$fecha_valor\", \"$$todayDate\"\n                    ]\n                  }\n                }\n              ]\n            }\n          }, {\n            \"$project\": {\n              \"cobranzaMora\": 1, \n              \"cobranzaMoraUVC\": 1, \n              \"fecha_valor\": 1\n            }\n          }\n        ], \n        \"as\": \"Balancemetric\"\n      }\n    }, {\n      \"$unwind\": {\n        \"path\": \"$Balancemetric\"\n      }\n    }, {\n      \"$replaceRoot\": {\n        \"newRoot\": \"$Balancemetric\"\n      }\n    }, {\n      \"$sort\": {\n        \"fecha_valor\": 1\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"Financialstatementdashboard\", \n        \"let\": {\n          \"mes\": {\n            \"$month\": \"$fecha_valor\"\n          }, \n          \"ano\": {\n            \"$year\": \"$fecha_valor\"\n          }\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$and\": [\n                {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"$$mes\", {\n                        \"$month\": \"$fechaProceso\"\n                      }\n                    ]\n                  }\n                }, {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"$$ano\", {\n                        \"$year\": \"$fechaProceso\"\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          }\n        ], \n        \"as\": \"Financialstatementdashboard\"\n      }\n    }, {\n      \"$set\": {\n        \"Financialstatementdashboard\": \"$$REMOVE\", \n        \"cobranzaMora.indiceMora.sustemFinancPcrt\": {\n          \"$round\": [\n            {\n              \"$multiply\": [\n                100, {\n                  \"$first\": {\n                    \"$first\": \"$Financialstatementdashboard.loanDelincuency.globalValue\"\n                  }\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"cobranzaMoraUVC.indiceMora.sustemFinancPcrt\": {\n          \"$round\": [\n            {\n              \"$multiply\": [\n                100, {\n                  \"$first\": {\n                    \"$first\": \"$Financialstatementdashboard.loanDelincuency.globalValue\"\n                  }\n                }\n              ]\n            }, 4\n          ]\n        }\n      }\n    }, {\n      \"$merge\": {\n        \"into\": \"Balancemetric\", \n        \"on\": \"fecha_valor\"\n      }\n    }\n  ]"
        },
        "id": "f814686f-d921-4119-8d7b-fa7a6ea19ff6",
        "name": "5_sustemFinancPcrt_Balancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2580,
          5900
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "DailyGroupIngresosCarteraCredito",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          {\n            \"$subtract\": [\n              {\n                \"$toDate\": {\n                  \"$dateFromString\": {\n                    \"dateString\": {\n                      \"$dateToString\": {\n                        \"format\": \"%Y-%m-%dT00:00:00%z\", \n                        \"date\": {\n                          \"$toDate\": \"$$NOW\"\n                        }\n                      }\n                    }\n                  }\n                }\n              }, {\n                \"$multiply\": [\n                  {\n                    \"$toInt\": \"{{$json.offSet}}\"\n                  }, 86400000\n                ]\n              }\n            ]\n          }, \"$fecha_valor\"\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosCarteraCredito\", \n      \"localField\": \"previusMonthDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"IngresoscartcredmetricpreviusMonthDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosCarteraCredito\", \n      \"localField\": \"previusYearDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"IngresoscartcredmetricpreviusYearDate\"\n    }\n  }, {\n    \"$set\": {\n      \"capindifTotalBs\": {\n        \"$cond\": [\n          \"$condLastDayOfMonth\", 0, \"$capindifTotalBs\"\n        ]\n      }, \n      \"capindifTotalBsUSD\": {\n        \"$cond\": [\n          \"$condLastDayOfMonth\", 0, \"$capindifTotalBsUSD\"\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"fecha_valor\": 1, \n      \"iccActualBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actTotalBs\", {\n            \"$sum\": [\n              \"$sal_net_actTotalBs\", \"$sal_net_actTotalBsyesterday\"\n            ]\n          }\n        ]\n      }, \n      \"iccActual\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actTotalBsUSD\", {\n            \"$sum\": [\n              \"$sal_net_actTotalBsUSD\", \"$sal_net_actTotalBsUSDyesterday\"\n            ]\n          }\n        ]\n      }, \n      \"iccAcMensualBs\": {\n        \"$sum\": [\n          \"$sal_net_actTotalBs\", \"$capindifTotalBs\"\n        ]\n      }, \n      \"iccAcMensual\": {\n        \"$sum\": [\n          \"$sal_net_actTotalBsUSD\", \"$capindifTotalBsUSD\"\n        ]\n      }, \n      \"iccAcMensualAntBs\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              {\n                \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.sal_net_actTotalBs\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.capindifTotalBs\"\n              }\n            ]\n          }, 1\n        ]\n      }, \n      \"iccAcMensualAnt\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              {\n                \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.sal_net_actTotalBsUSD\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.capindifTotalBsUSD\"\n              }\n            ]\n          }, 1\n        ]\n      }, \n      \"iccAcAnualBs\": {\n        \"$sum\": [\n          \"$sal_actTotalBs\", \"$smnnlAdjstmntValue\"\n        ]\n      }, \n      \"iccAcAnual\": {\n        \"$sum\": [\n          \"$sal_actTotalBsUSD\", \"$smnnlAdjstmntValueUSD\"\n        ]\n      }, \n      \"iccAcAnualAntBs\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$IngresoscartcredmetricpreviusYearDate.smnnlAdjstmntValue\"\n          }, {\n            \"$first\": \"$IngresoscartcredmetricpreviusYearDate.smnnlAdjstmntValue\"\n          }\n        ]\n      }, \n      \"iccAcAnualAnt\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$IngresoscartcredmetricpreviusYearDate.smnnlAdjstmntValueUSD\"\n          }, {\n            \"$first\": \"$IngresoscartcredmetricpreviusYearDate.smnnlAdjstmntValueUSD\"\n          }\n        ]\n      }, \n      \"iccVarMensualBs\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              \"$sal_net_actTotalBs\", \"$capindifTotalBs\"\n            ]\n          }, {\n            \"$subtract\": [\n              {\n                \"$sum\": [\n                  {\n                    \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.sal_net_actTotalBs\"\n                  }, {\n                    \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.capindifTotalBs\"\n                  }\n                ]\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"iccVarMensual\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              \"$sal_net_actTotalBsUSD\", \"$capindifTotalBsUSD\"\n            ]\n          }, {\n            \"$subtract\": [\n              {\n                \"$sum\": [\n                  {\n                    \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.sal_net_actTotalBsUSD\"\n                  }, {\n                    \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.capindifTotalBsUSD\"\n                  }\n                ]\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"capindifTotalBs\": 1, \n      \"capindifTotalBsUSD\": 1, \n      \"iccActualBs513\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actTotalBs513\", {\n            \"$sum\": [\n              \"$sal_net_actTotalBs513\", \"$sal_net_actTotalBsyesterday513\"\n            ]\n          }\n        ]\n      }, \n      \"iccActual513\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actTotalBsUSD513\", {\n            \"$sum\": [\n              \"$sal_net_actTotalBsUSD513\", \"$sal_net_actTotalBsUSDyesterday513\"\n            ]\n          }\n        ]\n      }, \n      \"iccAcMensualBs513\": {\n        \"$sum\": [\n          \"$sal_net_actTotalBs513\", \"$capindifTotalBs\"\n        ]\n      }, \n      \"iccAcMensual513\": {\n        \"$sum\": [\n          \"$sal_net_actTotalBsUSD513\", \"$capindifTotalBsUSD\"\n        ]\n      }, \n      \"iccAcMensualAntBs513\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              {\n                \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.sal_net_actTotalBs513\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.capindifTotalBs\"\n              }\n            ]\n          }, 1\n        ]\n      }, \n      \"iccAcMensualAnt513\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              {\n                \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.sal_net_actTotalBsUSD513\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.capindifTotalBsUSD\"\n              }\n            ]\n          }, 1\n        ]\n      }, \n      \"iccAcAnualBs513\": {\n        \"$sum\": [\n          \"$sal_actTotalBs513\", \"$smnnlAdjstmntValue513\"\n        ]\n      }, \n      \"iccAcAnual513\": {\n        \"$sum\": [\n          \"$sal_actTotalBsUSD513\", \"$smnnlAdjstmntValue513USD\"\n        ]\n      }, \n      \"iccAcAnualAntBs513\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$IngresoscartcredmetricpreviusYearDate.smnnlAdjstmntValue513\"\n          }, {\n            \"$first\": \"$IngresoscartcredmetricpreviusYearDate.smnnlAdjstmntValue513\"\n          }\n        ]\n      }, \n      \"iccAcAnualAnt513\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$IngresoscartcredmetricpreviusYearDate.smnnlAdjstmntValue513USD\"\n          }, {\n            \"$first\": \"$IngresoscartcredmetricpreviusYearDate.smnnlAdjstmntValue513USD\"\n          }\n        ]\n      }, \n      \"iccVarMensualBs513\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              \"$sal_net_actTotalBs513\", \"$capindifTotalBs\"\n            ]\n          }, {\n            \"$subtract\": [\n              {\n                \"$sum\": [\n                  {\n                    \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.sal_net_actTotalBs513\"\n                  }, {\n                    \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.capindifTotalBs\"\n                  }\n                ]\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"iccVarMensual513\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              \"$sal_net_actTotalBsUSD513\", \"$capindifTotalBsUSD\"\n            ]\n          }, {\n            \"$subtract\": [\n              {\n                \"$sum\": [\n                  {\n                    \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.sal_net_actTotalBsUSD513\"\n                  }, {\n                    \"$first\": \"$IngresoscartcredmetricpreviusMonthDate.capindifTotalBsUSD\"\n                  }\n                ]\n              }, 1\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Objectiveformat\", \n      \"let\": {\n        \"mes\": {\n          \"$month\": \"$fecha_valor\"\n        }, \n        \"ano\": {\n          \"$year\": \"$fecha_valor\"\n        }\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$mes\", {\n                      \"$month\": \"$fecha\"\n                    }\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$ano\", {\n                      \"$year\": \"$fecha\"\n                    }\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ], \n      \"as\": \"result\"\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"fecha_valor\": 1, \n      \"ingresosCarteraBs.iccActual\": \"$iccActualBs\", \n      \"ingresosCarteraBs.iccAcMensual\": \"$iccAcMensualBs\", \n      \"ingresosCarteraBs.iccAcAnual\": \"$iccAcAnualBs\", \n      \"ingresosCarteraBs.iccAcMensualAnt\": \"$iccAcMensualAntBs\", \n      \"ingresosCarteraBs.iccAcAnualAnt\": \"$iccAcAnualAntBs\", \n      \"ingresosCarteraBs.iccVarMensual\": \"$iccVarMensualBs\", \n      \"ingresosCarteraBs.capindif\": \"$capindifTotalBs\", \n      \"ingresosCartera.iccActual\": \"$iccActual\", \n      \"ingresosCartera.iccAcMensual\": \"$iccAcMensual\", \n      \"ingresosCartera.iccAcAnual\": \"$iccAcAnual\", \n      \"ingresosCartera.iccAcMensualAnt\": \"$iccAcMensualAnt\", \n      \"ingresosCartera.iccAcAnualAnt\": \"$iccAcAnualAnt\", \n      \"ingresosCartera.iccVarMensual\": \"$iccVarMensual\", \n      \"ingresosCartera.capindif\": \"$capindifTotalBsUSD\", \n      \"ingresosCartera.goalIccMensual\": {\n        \"$first\": \"$result.iccTot\"\n      }, \n      \"ingresosCarteraBs.iccActual513\": \"$iccActualBs513\", \n      \"ingresosCarteraBs.iccAcMensual513\": \"$iccAcMensualBs513\", \n      \"ingresosCarteraBs.iccAcAnual513\": \"$iccAcAnualBs513\", \n      \"ingresosCarteraBs.iccAcMensualAnt513\": \"$iccAcMensualAntBs513\", \n      \"ingresosCarteraBs.iccAcAnualAnt513\": \"$iccAcAnualAntBs513\", \n      \"ingresosCarteraBs.iccVarMensual513\": \"$iccVarMensualBs513\", \n      \"ingresosCarteraBs.capindif\": \"$capindifTotalBs\", \n      \"ingresosCartera.iccActual513\": \"$iccActual513\", \n      \"ingresosCartera.iccAcMensual513\": \"$iccAcMensual513\", \n      \"ingresosCartera.iccAcAnual513\": \"$iccAcAnual513\", \n      \"ingresosCartera.iccAcMensualAnt513\": \"$iccAcMensualAnt513\", \n      \"ingresosCartera.iccAcAnualAnt513\": \"$iccAcAnualAnt513\", \n      \"ingresosCartera.iccVarMensual513\": \"$iccVarMensual513\", \n      \"ingresosCartera.capindif\": \"$capindifTotalBsUSD\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "c77b628b-3bcc-4409-8815-c980ee6c7464",
        "name": "2_Indicadores_Balancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1940,
          6620
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "content": "ingreso otros operativos",
          "height": 467.4350845763071,
          "width": 2028.3473948982733
        },
        "id": "53bbb928-5ce7-4c00-a88e-4b0dca77e199",
        "name": "Note6",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          702.0547415239944,
          9487.022718459863
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/73077656-0b5e-494d-8a83-9dccd2102d05",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "20e41310-e8a5-441d-b14e-49be69cd050d",
        "name": "HTTP Request11",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          820,
          9740
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"10_Ingresos_Otros_Operativos\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem10",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1180,
          9740
        ],
        "id": "8c3674af-aaa2-44a4-9250-0460e01acbde",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "267f3a27-ccb0-4d9c-92dd-0c569c28fc3a",
        "name": "IF",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1340,
          9740
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "bb4c21cc-1716-4953-b900-f857b0055519",
        "name": "Merge16",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1680,
          9700
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "9e09c2b1-584a-48fc-a817-514be2b70049",
        "name": "Merge20",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2040,
          9680
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/73077656-0b5e-494d-8a83-9dccd2102d05",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "ffad7cd9-9c25-49dd-841d-549dffc94bf3",
        "name": "HTTP Request18",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          2500,
          9660
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "653eaf97-37d4-41c2-8544-2e3c42ab4f91",
        "name": "Merge43",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2340,
          9660
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "29cc2a17-4bd7-42df-8dd8-b7e4c55c60ae",
        "name": "2_updated_OP10",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2180,
          9560
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$todayDate\", \"$fecha_odate\"\n                  ]\n                }\n              }, {\n                \"$or\": [\n                  {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"53\", \"$nucta\"\n                      ]\n                    }\n                  }\n                ]\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"nucta\": 1, \n            \"fecha_odate\": 1, \n            \"sal_act\": {\n              \"$multiply\": [\n                \"$sal_act\", -1\n              ]\n            }, \n            \"sal_ant\": {\n              \"$multiply\": [\n                \"$sal_ant\", -1\n              ]\n            }, \n            \"sal_net_act\": {\n              \"$multiply\": [\n                \"$sal_net_act\", -1\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm53\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$todayDate\", \"$fecha_odate\"\n                  ]\n                }\n              }, {\n                \"$or\": [\n                  {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"539\", \"$nucta\"\n                      ]\n                    }\n                  }\n                ]\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"nucta\": 1, \n            \"fecha_odate\": 1, \n            \"sal_act\": {\n              \"$multiply\": [\n                \"$sal_act\", -1\n              ]\n            }, \n            \"sal_ant\": {\n              \"$multiply\": [\n                \"$sal_ant\", -1\n              ]\n            }, \n            \"sal_net_act\": {\n              \"$multiply\": [\n                \"$sal_net_act\", -1\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm539\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_brm\": [\n        {\n          \"sal_act\": {\n            \"$subtract\": [\n              {\n                \"$first\": \"$sidis_brm53.sal_act\"\n              }, {\n                \"$first\": \"$sidis_brm539.sal_act\"\n              }\n            ]\n          }, \n          \"sal_ant\": {\n            \"$subtract\": [\n              {\n                \"$first\": \"$sidis_brm53.sal_ant\"\n              }, {\n                \"$first\": \"$sidis_brm539.sal_ant\"\n              }\n            ]\n          }, \n          \"sal_net_act\": {\n            \"$subtract\": [\n              {\n                \"$first\": \"$sidis_brm53.sal_net_act\"\n              }, {\n                \"$first\": \"$sidis_brm539.sal_net_act\"\n              }\n            ]\n          }\n        }\n      ], \n      \"sidis_brm539\": \"$$REMOVE\", \n      \"sidis_brm53\": \"$$REMOVE\"\n    }\n  }, {\n    \"$addFields\": {\n      \"avaiableData\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_brm\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"firstDayMonth\": {\n        \"$eq\": [\n          {\n            \"$dayOfMonth\": \"$todayDate\"\n          }, 1\n        ]\n      }, \n      \"firstDayYear\": {\n        \"$and\": [\n          {\n            \"$eq\": [\n              {\n                \"$dayOfMonth\": \"$todayDate\"\n              }, 1\n            ]\n          }, {\n            \"$eq\": [\n              {\n                \"$month\": \"$todayDate\"\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"cuentasContable\": \"$$REMOVE\", \n      \"yesterdayDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"tomorrowDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": 1\n        }\n      }, \n      \"previusMonthDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"previusMonthlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$month\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"previusYearDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }, \n      \"previusYearlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosOtrosOperativos\", \n      \"localField\": \"todayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupIngresosOtrosOperativostodayDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosOtrosOperativos\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupIngresosOtrosOperativosyesterdayDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosOtrosOperativos\", \n      \"localField\": \"previusMonthDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupIngresosOtrosOperativospreviusMonthDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosOtrosOperativos\", \n      \"localField\": \"previusYearDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupIngresosOtrosOperativospreviusYearDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"todayDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_brm\": \"$$REMOVE\", \n      \"DailyGroupIngresosOtrosOperativostodayDate\": \"$$REMOVE\", \n      \"DailyGroupIngresosOtrosOperativospreviusMonthDate\": \"$$REMOVE\", \n      \"DailyGroupIngresosOtrosOperativospreviusYearDate\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"fecha_valor\": \"$todayDate\", \n      \"sal_actTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_act\"\n              }, {\n                \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_actTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_ant\"\n              }, {\n                \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_antTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_net_act\"\n              }, {\n                \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_net_actTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_act\"\n                      }, {\n                        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_actTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_ant\"\n                      }, {\n                        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_antTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_net_act\"\n                      }, {\n                        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_net_actTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actTotalBsyesterday\": {\n        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_actTotalBs\"\n      }, \n      \"sal_antTotalBsyesterday\": {\n        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_antTotalBs\"\n      }, \n      \"sal_net_actTotalBsyesterday\": {\n        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_net_actTotalBs\"\n      }, \n      \"sal_actTotalBsUSDyesterday\": {\n        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_actTotalBsUSD\"\n      }, \n      \"sal_antTotalBsUSDyesterday\": {\n        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_antTotalBsUSD\"\n      }, \n      \"sal_net_actTotalBsUSDyesterday\": {\n        \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.sal_net_actTotalBsUSD\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"condVarJuly\": {\n        \"$cond\": [\n          {\n            \"$and\": [\n              {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$todayDate\"\n                      }, 7\n                    ]\n                  }\n                ]\n              }, {\n                \"$gte\": [\n                  {\n                    \"$round\": [\n                      {\n                        \"$divide\": [\n                          {\n                            \"$abs\": {\n                              \"$subtract\": [\n                                \"$sal_actTotalBs\", \"$sal_actTotalBsyesterday\"\n                              ]\n                            }\n                          }, \"$sal_actTotalBs\"\n                        ]\n                      }, 4\n                    ]\n                  }, 3.5\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }, \n      \"condVarJanuary\": {\n        \"$cond\": [\n          {\n            \"$and\": [\n              {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$todayDate\"\n                      }, 1\n                    ]\n                  }\n                ]\n              }, {\n                \"$gte\": [\n                  {\n                    \"$round\": [\n                      {\n                        \"$divide\": [\n                          {\n                            \"$abs\": {\n                              \"$subtract\": [\n                                \"$sal_actTotalBs\", \"$sal_actTotalBsyesterday\"\n                              ]\n                            }\n                          }, \"$sal_actTotalBs\"\n                        ]\n                      }, 4\n                    ]\n                  }, 3.5\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }, \n      \"condLastDayOfMonth\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$todayDate\", {\n                \"$subtract\": [\n                  {\n                    \"$dateFromParts\": {\n                      \"year\": {\n                        \"$year\": \"$todayDate\"\n                      }, \n                      \"month\": {\n                        \"$sum\": [\n                          {\n                            \"$month\": \"$todayDate\"\n                          }, 1\n                        ]\n                      }\n                    }\n                  }, 86400000\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"smnnlAdjstmntValue\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$condVarJuly\", \n              \"then\": \"$sal_actTotalBsyesterday\"\n            }, {\n              \"case\": \"$condVarJanuary\", \n              \"then\": 0\n            }, {\n              \"case\": {\n                \"$lte\": [\n                  \"$DailyGroupIngresosOtrosOperativosyesterdayDate.smnnlAdjstmntValue\", null\n                ]\n              }, \n              \"then\": 0\n            }\n          ], \n          \"default\": {\n            \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.smnnlAdjstmntValue\"\n          }\n        }\n      }, \n      \"smnnlAdjstmntValueUSD\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$condVarJuly\", \n              \"then\": \"$sal_actTotalBsUSDyesterday\"\n            }, {\n              \"case\": \"$condVarJanuary\", \n              \"then\": 0\n            }, {\n              \"case\": {\n                \"$lte\": [\n                  \"$DailyGroupIngresosOtrosOperativosyesterdayDate.smnnlAdjstmntValueUSD\", null\n                ]\n              }, \n              \"then\": 0\n            }\n          ], \n          \"default\": {\n            \"$first\": \"$DailyGroupIngresosOtrosOperativosyesterdayDate.smnnlAdjstmntValueUSD\"\n          }\n        }\n      }, \n      \"DailyGroupIngresosOtrosOperativosyesterdayDate\": \"$$REMOVE\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"DailyGroupIngresosOtrosOperativos\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "941757ea-1e99-4691-a7dd-f9cf25d758b9",
        "name": "01_DailyGroup_IngresosComisionesOtros",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1520,
          9600
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/73077656-0b5e-494d-8a83-9dccd2102d05",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=820"
              }
            ]
          },
          "options": {}
        },
        "id": "9857dfd0-1d6c-4f11-96ba-dad7158c8193",
        "name": "HTTP Request12",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          820,
          9560
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "DailyGroupIngresosOtrosOperativos",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          {\n            \"$subtract\": [\n              {\n                \"$toDate\": {\n                  \"$dateFromString\": {\n                    \"dateString\": {\n                      \"$dateToString\": {\n                        \"format\": \"%Y-%m-%dT00:00:00%z\", \n                        \"date\": {\n                          \"$toDate\": \"$$NOW\"\n                        }\n                      }\n                    }\n                  }\n                }\n              }, {\n                \"$multiply\": [\n                  {\n                    \"$toInt\": \"{{$json.offSet}}\"\n                  }, 86400000\n                ]\n              }\n            ]\n          }, \"$fecha_valor\"\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosOtrosOperativos\", \n      \"localField\": \"previusMonthDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupIngresosOtrosOperativospreviusMonthDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosOtrosOperativos\", \n      \"localField\": \"previusYearDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupIngresosOtrosOperativospreviusYearDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"previusMonthDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"BalancemetricpreviusMonthDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"previusYearDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"BalancemetricpreviusYearDate\"\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"fecha_valor\": 1, \n      \"currentBs\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actTotalBs\", {\n            \"$subtract\": [\n              \"$sal_net_actTotalBs\", \"$sal_net_actTotalBsyesterday\"\n            ]\n          }\n        ]\n      }, \n      \"current\": {\n        \"$cond\": [\n          \"$firstDayMonth\", \"$sal_net_actTotalBsUSD\", {\n            \"$sum\": [\n              \"$sal_net_actTotalBsUSD\", \"$sal_net_actTotalBsUSDyesterday\"\n            ]\n          }\n        ]\n      }, \n      \"monthAccBs\": {\n        \"$sum\": [\n          \"$sal_net_actTotalBs\"\n        ]\n      }, \n      \"monthAcc\": {\n        \"$sum\": [\n          \"$sal_net_actTotalBsUSD\"\n        ]\n      }, \n      \"monthAccPrevBs\": {\n        \"$first\": \"$BalancemetricpreviusMonthDate.ingresosOtrosOperativosBs.monthAcc\"\n      }, \n      \"monthAccPrev\": {\n        \"$first\": \"$BalancemetricpreviusMonthDate.ingresosOtrosOperativos.monthAcc\"\n      }, \n      \"anualAcAnualBs\": {\n        \"$sum\": [\n          \"$sal_actTotalBs\", \"$smnnlAdjstmntValue\"\n        ]\n      }, \n      \"anualAcAnual\": {\n        \"$sum\": [\n          \"$sal_actTotalBsUSD\", \"$smnnlAdjstmntValueUSD\"\n        ]\n      }, \n      \"annualAccPrevBs\": {\n        \"$first\": \"$BalancemetricpreviusMonthDate.ingresosOtrosOperativosBs.annualAccPrev\"\n      }, \n      \"annualAccPrev\": {\n        \"$first\": \"$BalancemetricpreviusMonthDate.ingresosOtrosOperativos.annualAccPrev\"\n      }\n    }\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"fecha_valor\": 1, \n      \"ingresosOtrosOperativosBs.current\": \"$currentBs\", \n      \"ingresosOtrosOperativosBs.monthAcc\": \"$monthAccBs\", \n      \"ingresosOtrosOperativosBs.monthAccPrev\": \"$monthAccPrevBs\", \n      \"ingresosOtrosOperativosBs.anualAcAnual\": \"$anualAcAnualBs\", \n      \"ingresosOtrosOperativosBs.annualAccPrev\": \"$annualAccPrevBs\", \n      \"ingresosOtrosOperativos.current\": \"$current\", \n      \"ingresosOtrosOperativos.monthAcc\": \"$monthAcc\", \n      \"ingresosOtrosOperativos.monthAccPrev\": \"$monthAccPrev\", \n      \"ingresosOtrosOperativos.anualAcAnual\": \"$anualAcAnual\", \n      \"ingresosOtrosOperativos.annualAccPrev\": \"$annualAccPrev\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "21835084-4562-4be0-88e0-b03d47b6e66b",
        "name": "02_IngresosOtrosOperativosIndicadores",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1860,
          9580
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "content": "Net Result",
          "height": 482.6553683640637,
          "width": 2028.3473948982728
        },
        "id": "b8859c8c-5b5b-476c-9e4c-135388204c92",
        "name": "Note7",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          700,
          9994.33914863673
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/0fa9b888-2b1e-4dd5-b626-3b14c67e3a75",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "02aa2e3a-9a16-4a78-ab8b-7cbd1e71a2a6",
        "name": "HTTP Request20",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          820,
          10260
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"8_Procesamiento_IngresosComision\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem12",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1180,
          10260
        ],
        "id": "f62b4d01-6452-4037-ae45-c04c058f0298",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "a842c56e-ec5d-45f5-9003-ab17da3b123e",
        "name": "IF7",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1340,
          10260
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "569f5d31-35a2-4e0f-977c-a0c0aeea2ef8",
        "name": "Merge22",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1680,
          10220
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "1b06c950-0356-4ea3-a728-8864846a4c83",
        "name": "Merge26",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2040,
          10200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/0fa9b888-2b1e-4dd5-b626-3b14c67e3a75",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "cc1ee14b-f636-46b1-ade1-f318492e69e6",
        "name": "HTTP Request22",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          2500,
          10180
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "ab3fc088-bf59-40ce-9bf4-dccc1dce8ec2",
        "name": "Merge44",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2340,
          10180
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$addFields\": {\n      \"_id\": \"$$REMOVE\", \n      \"lastUpdatedAt\": \"$$REMOVE\", \n      \"proceso\": \"$$REMOVE\", \n      \"currentUpdatedDate\": \"$$REMOVE\", \n      \"processName\": \"BALACEMETRIC_OP\", \n      \"processDate\": {\n        \"$dateTrunc\": {\n          \"date\": {\n            \"$dateAdd\": {\n              \"startDate\": {\n                \"$toDate\": \"$$NOW\"\n              }, \n              \"unit\": \"day\", \n              \"amount\": -1\n            }\n          }, \n          \"unit\": \"hour\"\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_statusProcesos\", \n      \"localField\": \"processName\", \n      \"foreignField\": \"processName\", \n      \"as\": \"sidis_statusProcesos\"\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$mergeObjects\": [\n          {\n            \"$filter\": {\n              \"input\": \"$sidis_statusProcesos\", \n              \"as\": \"item\", \n              \"cond\": {\n                \"$eq\": [\n                  \"$$item.processDate\", {\n                    \"$max\": \"$sidis_statusProcesos.processDate\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"subProcess\": {\n        \"$map\": {\n          \"input\": \"$subProcess\", \n          \"as\": \"item\", \n          \"in\": {\n            \"$cond\": [\n              {\n                \"$and\": [\n                  {\n                    \"$eq\": [\n                      \"$$item.processName\", \"{{$json.proceso}}\"\n                    ]\n                  }\n                ]\n              }, {\n                \"$mergeObjects\": [\n                  {\n                    \"processName\": \"$$item.processName\"\n                  }, {\n                    \"processDate\": \"$$item.processDate\"\n                  }, {\n                    \"description\": \"$$item.description\"\n                  }, {\n                    \"processFrequency\": \"$$item.processFrequency\"\n                  }, {\n                    \"fromColletion\": \"$$item.fromColletion\"\n                  }, {\n                    \"toColletion\": \"$$item.toColletion\"\n                  }, {\n                    \"startDate\": \"$$item.startDate\"\n                  }, {\n                    \"endDate\": \"$$NOW\"\n                  }, {\n                    \"runtimeInMinutes\": {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$subtract\": [\n                                \"$$NOW\", \"$$item.startDate\"\n                              ]\n                            }, 60000\n                          ]\n                        }, 2\n                      ]\n                    }\n                  }, {\n                    \"status\": \"Finalizado\"\n                  }\n                ]\n              }, \"$$item\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"status\": {\n        \"$cond\": [\n          {\n            \"$or\": [\n              {\n                \"$in\": [\n                  \"En Proceso\", \"$subProcess.status\"\n                ]\n              }, {\n                \"$in\": [\n                  \"En espera\", \"$subProcess.status\"\n                ]\n              }\n            ]\n          }, \"En Proceso\", \"Finalizado\"\n        ]\n      }, \n      \"endDate\": \"$$NOW\", \n      \"runtimeInMinutes\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$subtract\": [\n                  \"$$NOW\", \"$startDate\"\n                ]\n              }, 60000\n            ]\n          }, 2\n        ]\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_statusProcesos\", \n      \"on\": [\n        \"processName\", \"processDate\"\n      ]\n    }\n  }\n]"
        },
        "id": "1496d0ed-1560-467a-98e5-4c7ec3199a54",
        "name": "2_updated_OP11",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2180,
          10080
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/0fa9b888-2b1e-4dd5-b626-3b14c67e3a75",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=809"
              }
            ]
          },
          "options": {}
        },
        "id": "6269ebf4-790f-4fd7-a992-d78d9b783f31",
        "name": "HTTP Request23",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          820,
          10080
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$$todayDate\", \"$fecha_odate\"\n              ]\n            }, \n            \"nucta\": {\n              \"$in\": [\n                \"511\", \"512\", \"513\", \"514\", \"519\", \"52\", \"531\", \"532\", \"534\", \"536\", \"538\", \"539\", \"54\", \"441\", \"442\", \"443\", \"444\", \"445\", \"446\", \"447\", \"448\", \"449\", \"411\", \"413\", \"414\", \"415\", \"431\", \"434\", \"439\", \"42\", \"45\", \"47\"\n              ]\n            }\n          }\n        }, {\n          \"$project\": {\n            \"nucta\": 1, \n            \"fecha_odate\": 1, \n            \"sal_act\": {\n              \"$multiply\": [\n                \"$sal_act\", -1\n              ]\n            }, \n            \"sal_ant\": {\n              \"$multiply\": [\n                \"$sal_ant\", -1\n              ]\n            }, \n            \"sal_net_act\": {\n              \"$multiply\": [\n                \"$sal_net_act\", -1\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$addFields\": {\n      \"avaiableData\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_brm\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"firstDayMonth\": {\n        \"$eq\": [\n          {\n            \"$dayOfMonth\": \"$todayDate\"\n          }, 1\n        ]\n      }, \n      \"firstDayYear\": {\n        \"$and\": [\n          {\n            \"$eq\": [\n              {\n                \"$dayOfMonth\": \"$todayDate\"\n              }, 1\n            ]\n          }, {\n            \"$eq\": [\n              {\n                \"$month\": \"$todayDate\"\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"cuentasContable\": \"$$REMOVE\", \n      \"yesterdayDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"tomorrowDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": 1\n        }\n      }, \n      \"previusMonthDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"previusMonthlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$month\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"previusYearDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }, \n      \"previusYearlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupNetResult\", \n      \"localField\": \"todayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupNetResulttodayDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupNetResult\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupNetResultyesterdayDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupNetResult\", \n      \"localField\": \"previusMonthDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupNetResultpreviusMonthDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupNetResult\", \n      \"localField\": \"previusYearDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"DailyGroupNetResultpreviusYearDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"todayDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"sidis_brm\": \"$$REMOVE\", \n      \"DailyGroupNetResulttodayDate\": \"$$REMOVE\", \n      \"DailyGroupNetResultpreviusMonthDate\": \"$$REMOVE\", \n      \"DailyGroupNetResultpreviusYearDate\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"fecha_valor\": \"$todayDate\", \n      \"sal_actTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_act\"\n              }, {\n                \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_actTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_ant\"\n              }, {\n                \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_antTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_net_act\"\n              }, {\n                \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_net_actTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_act\"\n                      }, {\n                        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_actTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_ant\"\n                      }, {\n                        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_antTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_net_act\"\n                      }, {\n                        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_net_actTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actTotalBsyesterday\": {\n        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_actTotalBs\"\n      }, \n      \"sal_antTotalBsyesterday\": {\n        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_antTotalBs\"\n      }, \n      \"sal_net_actTotalBsyesterday\": {\n        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_net_actTotalBs\"\n      }, \n      \"sal_actTotalBsUSDyesterday\": {\n        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_actTotalBsUSD\"\n      }, \n      \"sal_antTotalBsUSDyesterday\": {\n        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_antTotalBsUSD\"\n      }, \n      \"sal_net_actTotalBsUSDyesterday\": {\n        \"$first\": \"$DailyGroupNetResultyesterdayDate.sal_net_actTotalBsUSD\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"condVarJuly\": {\n        \"$cond\": [\n          {\n            \"$and\": [\n              {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$todayDate\"\n                      }, 7\n                    ]\n                  }\n                ]\n              }, {\n                \"$gte\": [\n                  {\n                    \"$round\": [\n                      {\n                        \"$divide\": [\n                          {\n                            \"$abs\": {\n                              \"$subtract\": [\n                                \"$sal_actTotalBs\", \"$sal_actTotalBsyesterday\"\n                              ]\n                            }\n                          }, \"$sal_actTotalBs\"\n                        ]\n                      }, 4\n                    ]\n                  }, 3.5\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }, \n      \"condVarJanuary\": {\n        \"$cond\": [\n          {\n            \"$and\": [\n              {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$todayDate\"\n                      }, 1\n                    ]\n                  }\n                ]\n              }, {\n                \"$gte\": [\n                  {\n                    \"$round\": [\n                      {\n                        \"$divide\": [\n                          {\n                            \"$abs\": {\n                              \"$subtract\": [\n                                \"$sal_actTotalBs\", \"$sal_actTotalBsyesterday\"\n                              ]\n                            }\n                          }, \"$sal_actTotalBs\"\n                        ]\n                      }, 4\n                    ]\n                  }, 3.5\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }, \n      \"condLastDayOfMonth\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$todayDate\", {\n                \"$subtract\": [\n                  {\n                    \"$dateFromParts\": {\n                      \"year\": {\n                        \"$year\": \"$todayDate\"\n                      }, \n                      \"month\": {\n                        \"$sum\": [\n                          {\n                            \"$month\": \"$todayDate\"\n                          }, 1\n                        ]\n                      }\n                    }\n                  }, 86400000\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"smnnlAdjstmntValue\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$condVarJuly\", \n              \"then\": \"$sal_actTotalBsyesterday\"\n            }, {\n              \"case\": \"$condVarJanuary\", \n              \"then\": 0\n            }, {\n              \"case\": {\n                \"$lte\": [\n                  \"$DailyGroupNetResultyesterdayDate.smnnlAdjstmntValue\", null\n                ]\n              }, \n              \"then\": 0\n            }\n          ], \n          \"default\": {\n            \"$first\": \"$DailyGroupNetResultyesterdayDate.smnnlAdjstmntValue\"\n          }\n        }\n      }, \n      \"smnnlAdjstmntValueUSD\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$condVarJuly\", \n              \"then\": \"$sal_actTotalBsUSDyesterday\"\n            }, {\n              \"case\": \"$condVarJanuary\", \n              \"then\": 0\n            }, {\n              \"case\": {\n                \"$lte\": [\n                  \"$DailyGroupNetResultyesterdayDate.smnnlAdjstmntValueUSD\", null\n                ]\n              }, \n              \"then\": 0\n            }\n          ], \n          \"default\": {\n            \"$first\": \"$DailyGroupNetResultyesterdayDate.smnnlAdjstmntValueUSD\"\n          }\n        }\n      }, \n      \"DailyGroupNetResultyesterdayDate\": \"$$REMOVE\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"DailyGroupNetResult\", \n      \"on\": \"fecha_valor\"\n    }\n  }\n]"
        },
        "id": "6009030d-22de-4d7f-9cbf-d8cc1eda7fcc",
        "name": "1_DailyGroup_NetResult",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1520,
          10120
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "DailyGroupNetResult",
          "query": "=[\n    {\n      \"$match\": {\n        \"$expr\": {\n          \"$eq\": [\n            {\n              \"$subtract\": [\n                {\n                  \"$toDate\": {\n                    \"$dateFromString\": {\n                      \"dateString\": {\n                        \"$dateToString\": {\n                          \"format\": \"%Y-%m-%dT00:00:00%z\", \n                          \"date\": {\n                            \"$toDate\": \"$$NOW\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }, {\n                  \"$multiply\": [\n                    {\n                      \"$toInt\": \"{{$json.offSet}}\"\n                    }, 86400000\n                  ]\n                }\n              ]\n            }, \"$fecha_valor\"\n          ]\n        }\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"DailyGroupNetResult\", \n        \"localField\": \"previusMonthDate\", \n        \"foreignField\": \"fecha_valor\", \n        \"as\": \"DailyGroupNetResultpreviusMonthDate\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"DailyGroupNetResult\", \n        \"localField\": \"previusYearDate\", \n        \"foreignField\": \"fecha_valor\", \n        \"as\": \"DailyGroupNetResultpreviusYearDate\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"Balancemetric\", \n        \"localField\": \"previusMonthDate\", \n        \"foreignField\": \"fecha_valor\", \n        \"as\": \"BalancemetricpreviusMonthDate\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"Balancemetric\", \n        \"localField\": \"previusYearDate\", \n        \"foreignField\": \"fecha_valor\", \n        \"as\": \"BalancemetricpreviusYearDate\"\n      }\n    }, {\n      \"$project\": {\n        \"_id\": 0, \n        \"fecha_valor\": 1, \n        \"currentBs\": {\n          \"$cond\": [\n            \"$firstDayMonth\", \"$sal_net_actTotalBs\", {\n              \"$subtract\": [\n                \"$sal_net_actTotalBs\", \"$sal_net_actTotalBsyesterday\"\n              ]\n            }\n          ]\n        }, \n        \"current\": {\n          \"$cond\": [\n            \"$firstDayMonth\", \"$sal_net_actTotalBsUSD\", {\n              \"$sum\": [\n                \"$sal_net_actTotalBsUSD\", \"$sal_net_actTotalBsUSDyesterday\"\n              ]\n            }\n          ]\n        }, \n        \"monthAccBs\": {\n          \"$sum\": [\n            \"$sal_net_actTotalBs\"\n          ]\n        }, \n        \"monthAcc\": {\n          \"$sum\": [\n            \"$sal_net_actTotalBsUSD\"\n          ]\n        }, \n        \"monthAccPrevBs\": {\n          \"$first\": \"$BalancemetricpreviusMonthDate.netResult.total.monthAcc\"\n        }, \n        \"monthAccPrev\": {\n          \"$first\": \"$BalancemetricpreviusMonthDate.netResultBs.total.monthAcc\"\n        }, \n        \"anualAcAnualBs\": {\n          \"$sum\": [\n            \"$sal_actTotalBs\", \"$smnnlAdjstmntValue\"\n          ]\n        }, \n        \"anualAcAnual\": {\n          \"$sum\": [\n            \"$sal_actTotalBsUSD\", \"$smnnlAdjstmntValueUSD\"\n          ]\n        }, \n        \"annualAccPrevBs\": {\n          \"$first\": \"$BalancemetricpreviusMonthDate.netResultBs.netResultannualAccPrev\"\n        }, \n        \"annualAccPrev\": {\n          \"$first\": \"$BalancemetricpreviusMonthDate.netResult.total.annualAccPrev\"\n        }\n      }\n    }, {\n      \"$project\": {\n        \"_id\": 0, \n        \"fecha_valor\": 1, \n        \"netResultBs.total.current\": \"$currentBs\", \n        \"netResultBs.total.monthAcc\": \"$monthAccBs\", \n        \"netResultBs.total.monthAccPrev\": \"$monthAccPrevBs\", \n        \"netResultBs.total.anualAcAnual\": \"$anualAcAnualBs\", \n        \"netResultBs.total.annualAccPrev\": \"$annualAccPrevBs\", \n        \"netResult.total.current\": \"$current\", \n        \"netResult.total.monthAcc\": \"$monthAcc\", \n        \"netResult.total.monthAccPrev\": \"$monthAccPrev\", \n        \"netResult.total.anualAcAnual\": \"$anualAcAnual\", \n        \"netResult.total.annualAccPrev\": \"$annualAccPrev\"\n      }\n    }, {\n      \"$merge\": {\n        \"into\": \"Balancemetric\", \n        \"on\": \"fecha_valor\", \n        \"whenMatched\": \"merge\", \n        \"whenNotMatched\": \"insert\"\n      }\n    }\n  ]"
        },
        "id": "44cfb1e6-e901-4123-a2a8-1e349a02efde",
        "name": "02_netResult_IndicadoresBalancemetric",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1860,
          10100
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/f2579d26-28ce-4c1e-9cf1-871d3a3287d4",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "=808"
              }
            ]
          },
          "options": {}
        },
        "id": "9eefc17c-e183-41f0-a74d-0725e9c4fe78",
        "name": "HTTP Request24",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          760,
          4600
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"test\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem14",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1160,
          4600
        ],
        "id": "21e1ef92-91bd-4117-929c-63efe6845477",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "02459711-cc36-4c54-8fd4-09d9fa2b4c5e",
        "name": "IF8",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1320,
          4600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/f2579d26-28ce-4c1e-9cf1-871d3a3287d4",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "6c865263-8b2a-4bab-832e-1febdae016dc",
        "name": "HTTP Request25",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          1840,
          4560
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "f1ed10af-3e14-450d-b860-b53cb195d52f",
        "name": "Merge45",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1680,
          4560
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n    {\n      \"$limit\": 1\n    }, {\n      \"$project\": {\n        \"_id\": 0, \n        \"todayDate\": {\n          \"$subtract\": [\n            {\n              \"$toDate\": {\n                \"$dateFromString\": {\n                  \"dateString\": {\n                    \"$dateToString\": {\n                      \"format\": \"%Y-%m-%dT00:00:00%z\", \n                      \"date\": {\n                        \"$toDate\": \"$$NOW\"\n                      }\n                    }\n                  }\n                }\n              }\n            }, {\n              \"$multiply\": [\n                {\n                  \"$toInt\": \"{{$json.offSet}}\"\n                }, 86400000\n              ]\n            }\n          ]\n        }\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"Parametricingresocarteracredito\", \n        \"pipeline\": [\n          {\n            \"$project\": {\n              \"cuentaContable\": 1, \n              \"productoControlGestion\": 1, \n              \"_id\": 0\n            }\n          }\n        ], \n        \"as\": \"Parametricingresocarteracredito\"\n      }\n    }, {\n      \"$addFields\": {\n        \"cuentasContable\": \"$Parametricingresocarteracredito.cuentaContable\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"sidis_brm\", \n        \"let\": {\n          \"todayDate\": \"$todayDate\"\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$expr\": {\n                \"$eq\": [\n                  \"$$todayDate\", \"$fecha_odate\"\n                ]\n              }\n            }\n          }, {\n            \"$project\": {\n              \"nucta\": 1, \n              \"sal_act\": {\n                \"$multiply\": [\n                  \"$sal_act\", -1\n                ]\n              }, \n              \"sal_ant\": {\n                \"$multiply\": [\n                  \"$sal_ant\", -1\n                ]\n              }, \n              \"sal_net_act\": {\n                \"$multiply\": [\n                  \"$sal_net_act\", -1\n                ]\n              }\n            }\n          }\n        ], \n        \"as\": \"sidis_brm\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"sidis_brm\", \n        \"let\": {\n          \"todayDate\": \"$todayDate\"\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$and\": [\n                {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"$$todayDate\", \"$fecha_odate\"\n                    ]\n                  }\n                }, {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"513\", \"$nucta\"\n                    ]\n                  }\n                }\n              ]\n            }\n          }, {\n            \"$project\": {\n              \"nucta\": 1, \n              \"fecha_odate\": 1, \n              \"sal_act\": {\n                \"$multiply\": [\n                  \"$sal_act\", -1\n                ]\n              }, \n              \"sal_ant\": {\n                \"$multiply\": [\n                  \"$sal_ant\", -1\n                ]\n              }, \n              \"sal_net_act\": {\n                \"$multiply\": [\n                  \"$sal_net_act\", -1\n                ]\n              }\n            }\n          }\n        ], \n        \"as\": \"sidis_brm513\"\n      }\n    }, {\n      \"$addFields\": {\n        \"avaiableData\": {\n          \"$cond\": [\n            {\n              \"$gt\": [\n                {\n                  \"$size\": \"$sidis_brm\"\n                }, 0\n              ]\n            }, true, false\n          ]\n        }, \n        \"firstDayMonth\": {\n          \"$eq\": [\n            {\n              \"$dayOfMonth\": \"$todayDate\"\n            }, 1\n          ]\n        }, \n        \"firstDayYear\": {\n          \"$and\": [\n            {\n              \"$eq\": [\n                {\n                  \"$dayOfMonth\": \"$todayDate\"\n                }, 1\n              ]\n            }, {\n              \"$eq\": [\n                {\n                  \"$month\": \"$todayDate\"\n                }, 1\n              ]\n            }\n          ]\n        }, \n        \"yesterdayDate\": {\n          \"$dateAdd\": {\n            \"startDate\": \"$todayDate\", \n            \"unit\": \"day\", \n            \"amount\": -1\n          }\n        }, \n        \"tomorrowDate\": {\n          \"$dateAdd\": {\n            \"startDate\": \"$todayDate\", \n            \"unit\": \"day\", \n            \"amount\": 1\n          }\n        }, \n        \"previusMonthDate\": {\n          \"$dateAdd\": {\n            \"startDate\": \"$todayDate\", \n            \"unit\": \"month\", \n            \"amount\": -1\n          }\n        }, \n        \"previusMonthlastDate\": {\n          \"$subtract\": [\n            {\n              \"$dateFromParts\": {\n                \"year\": {\n                  \"$year\": \"$todayDate\"\n                }, \n                \"month\": {\n                  \"$month\": \"$todayDate\"\n                }\n              }\n            }, 86400000\n          ]\n        }, \n        \"previusYearDate\": {\n          \"$dateAdd\": {\n            \"startDate\": \"$todayDate\", \n            \"unit\": \"year\", \n            \"amount\": -1\n          }\n        }, \n        \"previusYearlastDate\": {\n          \"$subtract\": [\n            {\n              \"$dateFromParts\": {\n                \"year\": {\n                  \"$year\": \"$todayDate\"\n                }\n              }\n            }, 86400000\n          ]\n        }, \n        \"cuentasContable\": \"$$REMOVE\", \n        \"sidis_brm\": {\n          \"$filter\": {\n            \"input\": \"$sidis_brm\", \n            \"as\": \"brm\", \n            \"cond\": {\n              \"$in\": [\n                \"$$brm.nucta\", \"$cuentasContable\"\n              ]\n            }\n          }\n        }\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"sidis_activosIa\", \n        \"let\": {\n          \"todayDate\": \"$todayDate\"\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$expr\": {\n                \"$eq\": [\n                  \"$$todayDate\", \"$fevalor\"\n                ]\n              }\n            }\n          }, {\n            \"$match\": {\n              \"$nor\": [\n                {\n                  \"sitdeuct\": \"CASTIGO\"\n                }, {\n                  \"indretro\": \"S\"\n                }, {\n                  \"cod_evento\": \"CANCELACION ANTICIPADA\", \n                  \"formpago\": \"EN TELEPROCESO\"\n                }\n              ]\n            }\n          }, {\n            \"$project\": {\n              \"_id\": 0\n            }\n          }\n        ], \n        \"as\": \"sidis_activosIa\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"Ingresoscartcredmetric\", \n        \"localField\": \"yesterdayDate\", \n        \"foreignField\": \"fecha_valor\", \n        \"as\": \"IngresoscartcredmetricyesterdayDate\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"sidis_tasaconversion\", \n        \"localField\": \"todayDate\", \n        \"foreignField\": \"Fecha\", \n        \"as\": \"sidis_tasaconversion\"\n      }\n    }, {\n      \"$addFields\": {\n        \"Parametricingresocarteracredito\": \"$$REMOVE\", \n        \"sidis_brm\": \"$$REMOVE\", \n        \"sidis_brm513\": \"$$REMOVE\", \n        \"sidis_activosIa\": \"$$REMOVE\", \n        \"sidis_tasaconversion\": \"$$REMOVE\", \n        \"fecha_valor\": \"$todayDate\", \n        \"sal_actTotalBs\": {\n          \"$round\": [\n            {\n              \"$cond\": [\n                \"$avaiableData\", {\n                  \"$sum\": \"$sidis_brm.sal_act\"\n                }, {\n                  \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_antTotalBs\": {\n          \"$round\": [\n            {\n              \"$cond\": [\n                \"$avaiableData\", {\n                  \"$sum\": \"$sidis_brm.sal_ant\"\n                }, {\n                  \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_antTotalBs\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_net_actTotalBs\": {\n          \"$round\": [\n            {\n              \"$cond\": [\n                \"$avaiableData\", {\n                  \"$sum\": \"$sidis_brm.sal_net_act\"\n                }, {\n                  \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_net_actTotalBs\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"capindifTotalBs\": {\n          \"$round\": [\n            {\n              \"$cond\": [\n                {\n                  \"$gt\": [\n                    {\n                      \"$size\": \"$sidis_activosIa\"\n                    }, 0\n                  ]\n                }, {\n                  \"$sum\": \"$sidis_activosIa.capindif\"\n                }, {\n                  \"$first\": \"$IngresoscartcredmetricyesterdayDate.capindifBs\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_actTotalBsUSD\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                {\n                  \"$round\": [\n                    {\n                      \"$cond\": [\n                        \"$avaiableData\", {\n                          \"$sum\": \"$sidis_brm.sal_act\"\n                        }, {\n                          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs\"\n                        }\n                      ]\n                    }, 4\n                  ]\n                }, {\n                  \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_antTotalBsUSD\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                {\n                  \"$round\": [\n                    {\n                      \"$cond\": [\n                        \"$avaiableData\", {\n                          \"$sum\": \"$sidis_brm.sal_ant\"\n                        }, {\n                          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_antTotalBs\"\n                        }\n                      ]\n                    }, 4\n                  ]\n                }, {\n                  \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_net_actTotalBsUSD\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                {\n                  \"$round\": [\n                    {\n                      \"$cond\": [\n                        \"$avaiableData\", {\n                          \"$sum\": \"$sidis_brm.sal_net_act\"\n                        }, {\n                          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_net_actTotalBs\"\n                        }\n                      ]\n                    }, 4\n                  ]\n                }, {\n                  \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"capindifTotalBsUSD\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                {\n                  \"$round\": [\n                    {\n                      \"$cond\": [\n                        {\n                          \"$gt\": [\n                            {\n                              \"$size\": \"$sidis_activosIa\"\n                            }, 0\n                          ]\n                        }, {\n                          \"$sum\": \"$sidis_activosIa.capindif\"\n                        }, {\n                          \"$first\": \"$IngresoscartcredmetricyesterdayDate.capindifBs\"\n                        }\n                      ]\n                    }, 4\n                  ]\n                }, {\n                  \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_actTotalBsyesterday\": {\n          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs\"\n        }, \n        \"sal_actTotalBsUSDyesterday\": {\n          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBsUSD\"\n        }, \n        \"sal_actTotalBs513\": {\n          \"$round\": [\n            {\n              \"$cond\": [\n                \"$avaiableData\", {\n                  \"$sum\": \"$sidis_brm513.sal_act\"\n                }, {\n                  \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs513\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_antTotalBs513\": {\n          \"$round\": [\n            {\n              \"$cond\": [\n                \"$avaiableData\", {\n                  \"$sum\": \"$sidis_brm513.sal_ant\"\n                }, {\n                  \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_antTotalBs513\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_net_actTotalBs513\": {\n          \"$round\": [\n            {\n              \"$cond\": [\n                \"$avaiableData\", {\n                  \"$sum\": \"$sidis_brm513.sal_net_act\"\n                }, {\n                  \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_net_actTotalBs513\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_actTotalBsUSD513\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                {\n                  \"$round\": [\n                    {\n                      \"$cond\": [\n                        \"$avaiableData\", {\n                          \"$sum\": \"$sidis_brm513.sal_act\"\n                        }, {\n                          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs513\"\n                        }\n                      ]\n                    }, 4\n                  ]\n                }, {\n                  \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_antTotalBsUSD513\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                {\n                  \"$round\": [\n                    {\n                      \"$cond\": [\n                        \"$avaiableData\", {\n                          \"$sum\": \"$sidis_brm513.sal_ant\"\n                        }, {\n                          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_antTotalBs513\"\n                        }\n                      ]\n                    }, 4\n                  ]\n                }, {\n                  \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_net_actTotalBsUSD513\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                {\n                  \"$round\": [\n                    {\n                      \"$cond\": [\n                        \"$avaiableData\", {\n                          \"$sum\": \"$sidis_brm513.sal_net_act\"\n                        }, {\n                          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_net_actTotalBs513\"\n                        }\n                      ]\n                    }, 4\n                  ]\n                }, {\n                  \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"sal_actTotalBsyesterday513\": {\n          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs513\"\n        }, \n        \"sal_actTotalBsUSDyesterday513\": {\n          \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBsUSD513\"\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"condVarJuly\": {\n          \"$cond\": [\n            {\n              \"$and\": [\n                {\n                  \"$or\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$month\": \"$todayDate\"\n                        }, 7\n                      ]\n                    }\n                  ]\n                }, {\n                  \"$gte\": [\n                    {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$abs\": {\n                                \"$subtract\": [\n                                  \"$sal_actTotalBs\", \"$sal_actTotalBsyesterday\"\n                                ]\n                              }\n                            }, \"$sal_actTotalBs\"\n                          ]\n                        }, 4\n                      ]\n                    }, 3.5\n                  ]\n                }\n              ]\n            }, true, false\n          ]\n        }, \n        \"condVarJanuary\": {\n          \"$cond\": [\n            {\n              \"$and\": [\n                {\n                  \"$or\": [\n                    {\n                      \"$eq\": [\n                        {\n                          \"$month\": \"$todayDate\"\n                        }, 1\n                      ]\n                    }\n                  ]\n                }, {\n                  \"$gte\": [\n                    {\n                      \"$round\": [\n                        {\n                          \"$divide\": [\n                            {\n                              \"$abs\": {\n                                \"$subtract\": [\n                                  \"$sal_actTotalBs\", \"$sal_actTotalBsyesterday\"\n                                ]\n                              }\n                            }, \"$sal_actTotalBs\"\n                          ]\n                        }, 4\n                      ]\n                    }, 3.5\n                  ]\n                }\n              ]\n            }, true, false\n          ]\n        }, \n        \"condLastDayOfMonth\": {\n          \"$cond\": [\n            {\n              \"$eq\": [\n                \"$todayDate\", {\n                  \"$subtract\": [\n                    {\n                      \"$dateFromParts\": {\n                        \"year\": {\n                          \"$year\": \"$todayDate\"\n                        }, \n                        \"month\": {\n                          \"$sum\": [\n                            {\n                              \"$month\": \"$todayDate\"\n                            }, 1\n                          ]\n                        }\n                      }\n                    }, 86400000\n                  ]\n                }\n              ]\n            }, true, false\n          ]\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"smnnlAdjstmntValue\": {\n          \"$switch\": {\n            \"branches\": [\n              {\n                \"case\": \"$condVarJuly\", \n                \"then\": \"$sal_actTotalBsyesterday\"\n              }, {\n                \"case\": \"$condVarJanuary\", \n                \"then\": 0\n              }, {\n                \"case\": {\n                  \"$lte\": [\n                    \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue\", null\n                  ]\n                }, \n                \"then\": 0\n              }\n            ], \n            \"default\": {\n              \"$first\": \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue\"\n            }\n          }\n        }, \n        \"smnnlAdjstmntValueUSD\": {\n          \"$switch\": {\n            \"branches\": [\n              {\n                \"case\": \"$condVarJuly\", \n                \"then\": \"$sal_actTotalBsUSDyesterday\"\n              }, {\n                \"case\": \"$condVarJanuary\", \n                \"then\": 0\n              }, {\n                \"case\": {\n                  \"$lte\": [\n                    \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValueUSD\", null\n                  ]\n                }, \n                \"then\": 0\n              }\n            ], \n            \"default\": {\n              \"$first\": \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValueUSD\"\n            }\n          }\n        }, \n        \"smnnlAdjstmntValue513\": {\n          \"$switch\": {\n            \"branches\": [\n              {\n                \"case\": \"$condVarJuly\", \n                \"then\": \"$sal_actTotalBsyesterday513\"\n              }, {\n                \"case\": \"$condVarJanuary\", \n                \"then\": 0\n              }, {\n                \"case\": {\n                  \"$lte\": [\n                    \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue513\", null\n                  ]\n                }, \n                \"then\": 0\n              }\n            ], \n            \"default\": {\n              \"$first\": \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue513\"\n            }\n          }\n        }, \n        \"smnnlAdjstmntValue513USD\": {\n          \"$switch\": {\n            \"branches\": [\n              {\n                \"case\": \"$condVarJuly\", \n                \"then\": \"$sal_actTotalBsUSDyesterday513\"\n              }, {\n                \"case\": \"$condVarJanuary\", \n                \"then\": 0\n              }, {\n                \"case\": {\n                  \"$lte\": [\n                    \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue513USD\", null\n                  ]\n                }, \n                \"then\": 0\n              }\n            ], \n            \"default\": {\n              \"$first\": \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue513USD\"\n            }\n          }\n        }, \n        \"IngresoscartcredmetricyesterdayDate\": \"$$REMOVE\"\n      }\n    }, {\n      \"$merge\": {\n        \"into\": \"Ingresoscartcredmetric\", \n        \"on\": \"fecha_valor\", \n        \"whenMatched\": \"replace\"\n      }\n    }\n  ]"
        },
        "id": "feae1c48-1669-45a4-bb6d-b65a3fa64145",
        "name": "test",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1500,
          4460
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "f2579d26-28ce-4c1e-9cf1-871d3a3287d4",
          "options": {}
        },
        "id": "cacfa3aa-26c5-45e0-8202-37cafceca2d0",
        "name": "Webhook9",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          980,
          4600
        ],
        "webhookId": "f2579d26-28ce-4c1e-9cf1-871d3a3287d4"
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Parametricingresocarteracredito\", \n      \"pipeline\": [\n        {\n          \"$project\": {\n            \"cuentaContable\": 1, \n            \"productoControlGestion\": 1, \n            \"_id\": 0\n          }\n        }\n      ], \n      \"as\": \"Parametricingresocarteracredito\"\n    }\n  }, {\n    \"$addFields\": {\n      \"cuentasContable\": \"$Parametricingresocarteracredito.cuentaContable\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$$todayDate\", \"$fecha_odate\"\n              ]\n            }\n          }\n        }, {\n          \"$project\": {\n            \"nucta\": 1, \n            \"sal_act\": {\n              \"$multiply\": [\n                \"$sal_act\", -1\n              ]\n            }, \n            \"sal_ant\": {\n              \"$multiply\": [\n                \"$sal_ant\", -1\n              ]\n            }, \n            \"sal_net_act\": {\n              \"$multiply\": [\n                \"$sal_net_act\", -1\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$$todayDate\", \"$fecha_odate\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"513\", \"$nucta\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"nucta\": 1, \n            \"fecha_odate\": 1, \n            \"sal_act\": {\n              \"$multiply\": [\n                \"$sal_act\", -1\n              ]\n            }, \n            \"sal_ant\": {\n              \"$multiply\": [\n                \"$sal_ant\", -1\n              ]\n            }, \n            \"sal_net_act\": {\n              \"$multiply\": [\n                \"$sal_net_act\", -1\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm513\"\n    }\n  }, {\n    \"$addFields\": {\n      \"avaiableData\": {\n        \"$cond\": [\n          {\n            \"$gt\": [\n              {\n                \"$size\": \"$sidis_brm\"\n              }, 0\n            ]\n          }, true, false\n        ]\n      }, \n      \"firstDayMonth\": {\n        \"$eq\": [\n          {\n            \"$dayOfMonth\": \"$todayDate\"\n          }, 1\n        ]\n      }, \n      \"firstDayYear\": {\n        \"$and\": [\n          {\n            \"$eq\": [\n              {\n                \"$dayOfMonth\": \"$todayDate\"\n              }, 1\n            ]\n          }, {\n            \"$eq\": [\n              {\n                \"$month\": \"$todayDate\"\n              }, 1\n            ]\n          }\n        ]\n      }, \n      \"yesterdayDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"tomorrowDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"day\", \n          \"amount\": 1\n        }\n      }, \n      \"previusMonthDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"month\", \n          \"amount\": -1\n        }\n      }, \n      \"previusMonthlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$month\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"previusYearDate\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$todayDate\", \n          \"unit\": \"year\", \n          \"amount\": -1\n        }\n      }, \n      \"previusYearlastDate\": {\n        \"$subtract\": [\n          {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }\n            }\n          }, 86400000\n        ]\n      }, \n      \"cuentasContable\": \"$$REMOVE\", \n      \"sidis_brm\": {\n        \"$filter\": {\n          \"input\": \"$sidis_brm\", \n          \"as\": \"brm\", \n          \"cond\": {\n            \"$in\": [\n              \"$$brm.nucta\", \"$cuentasContable\"\n            ]\n          }\n        }\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_activosIa\", \n      \"let\": {\n        \"todayDate\": \"$todayDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$$todayDate\", \"$fevalor\"\n              ]\n            }\n          }\n        }, {\n          \"$match\": {\n            \"$nor\": [\n              {\n                \"sitdeuct\": \"CASTIGO\"\n              }, {\n                \"indretro\": \"S\"\n              }, {\n                \"cod_evento\": \"CANCELACION ANTICIPADA\", \n                \"formpago\": \"EN TELEPROCESO\"\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"_id\": 0\n          }\n        }\n      ], \n      \"as\": \"sidis_activosIa\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"DailyGroupIngresosCarteraCredito\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"IngresoscartcredmetricyesterdayDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"todayDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"Parametricingresocarteracredito\": \"$$REMOVE\", \n      \"sidis_brm\": \"$$REMOVE\", \n      \"sidis_brm513\": \"$$REMOVE\", \n      \"sidis_activosIa\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"fecha_valor\": \"$todayDate\", \n      \"sal_actTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_act\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_ant\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_antTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm.sal_net_act\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_net_actTotalBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"capindifTotalBs\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              {\n                \"$gt\": [\n                  {\n                    \"$size\": \"$sidis_activosIa\"\n                  }, 0\n                ]\n              }, {\n                \"$sum\": \"$sidis_activosIa.capindif\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricyesterdayDate.capindifBs\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_act\"\n                      }, {\n                        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_ant\"\n                      }, {\n                        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_antTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm.sal_net_act\"\n                      }, {\n                        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_net_actTotalBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"capindifTotalBsUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      {\n                        \"$gt\": [\n                          {\n                            \"$size\": \"$sidis_activosIa\"\n                          }, 0\n                        ]\n                      }, {\n                        \"$sum\": \"$sidis_activosIa.capindif\"\n                      }, {\n                        \"$first\": \"$IngresoscartcredmetricyesterdayDate.capindifBs\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actTotalBsyesterday\": {\n        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs\"\n      }, \n      \"sal_actTotalBsUSDyesterday\": {\n        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBsUSD\"\n      }, \n      \"sal_actTotalBs513\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm513.sal_act\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs513\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotalBs513\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm513.sal_ant\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_antTotalBs513\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotalBs513\": {\n        \"$round\": [\n          {\n            \"$cond\": [\n              \"$avaiableData\", {\n                \"$sum\": \"$sidis_brm513.sal_net_act\"\n              }, {\n                \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_net_actTotalBs513\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actTotalBsUSD513\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm513.sal_act\"\n                      }, {\n                        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs513\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_antTotalBsUSD513\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm513.sal_ant\"\n                      }, {\n                        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_antTotalBs513\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_net_actTotalBsUSD513\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              {\n                \"$round\": [\n                  {\n                    \"$cond\": [\n                      \"$avaiableData\", {\n                        \"$sum\": \"$sidis_brm513.sal_net_act\"\n                      }, {\n                        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_net_actTotalBs513\"\n                      }\n                    ]\n                  }, 4\n                ]\n              }, {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"sal_actTotalBsyesterday513\": {\n        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBs513\"\n      }, \n      \"sal_actTotalBsUSDyesterday513\": {\n        \"$first\": \"$IngresoscartcredmetricyesterdayDate.sal_actTotalBsUSD513\"\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"condVarJuly\": {\n        \"$cond\": [\n          {\n            \"$and\": [\n              {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$todayDate\"\n                      }, 7\n                    ]\n                  }\n                ]\n              }, {\n                \"$gte\": [\n                  {\n                    \"$round\": [\n                      {\n                        \"$divide\": [\n                          {\n                            \"$abs\": {\n                              \"$subtract\": [\n                                \"$sal_actTotalBs\", \"$sal_actTotalBsyesterday\"\n                              ]\n                            }\n                          }, \"$sal_actTotalBs\"\n                        ]\n                      }, 4\n                    ]\n                  }, 3.5\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }, \n      \"condVarJanuary\": {\n        \"$cond\": [\n          {\n            \"$and\": [\n              {\n                \"$or\": [\n                  {\n                    \"$eq\": [\n                      {\n                        \"$month\": \"$todayDate\"\n                      }, 1\n                    ]\n                  }\n                ]\n              }, {\n                \"$gte\": [\n                  {\n                    \"$round\": [\n                      {\n                        \"$divide\": [\n                          {\n                            \"$abs\": {\n                              \"$subtract\": [\n                                \"$sal_actTotalBs\", \"$sal_actTotalBsyesterday\"\n                              ]\n                            }\n                          }, \"$sal_actTotalBs\"\n                        ]\n                      }, 4\n                    ]\n                  }, 3.5\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }, \n      \"condLastDayOfMonth\": {\n        \"$cond\": [\n          {\n            \"$eq\": [\n              \"$todayDate\", {\n                \"$subtract\": [\n                  {\n                    \"$dateFromParts\": {\n                      \"year\": {\n                        \"$year\": \"$todayDate\"\n                      }, \n                      \"month\": {\n                        \"$sum\": [\n                          {\n                            \"$month\": \"$todayDate\"\n                          }, 1\n                        ]\n                      }\n                    }\n                  }, 86400000\n                ]\n              }\n            ]\n          }, true, false\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"smnnlAdjstmntValue\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$condVarJuly\", \n              \"then\": \"$sal_actTotalBsyesterday\"\n            }, {\n              \"case\": \"$condVarJanuary\", \n              \"then\": 0\n            }, {\n              \"case\": {\n                \"$lte\": [\n                  \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue\", null\n                ]\n              }, \n              \"then\": 0\n            }\n          ], \n          \"default\": {\n            \"$first\": \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue\"\n          }\n        }\n      }, \n      \"smnnlAdjstmntValueUSD\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$condVarJuly\", \n              \"then\": \"$sal_actTotalBsUSDyesterday\"\n            }, {\n              \"case\": \"$condVarJanuary\", \n              \"then\": 0\n            }, {\n              \"case\": {\n                \"$lte\": [\n                  \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValueUSD\", null\n                ]\n              }, \n              \"then\": 0\n            }\n          ], \n          \"default\": {\n            \"$first\": \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValueUSD\"\n          }\n        }\n      }, \n      \"smnnlAdjstmntValue513\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$condVarJuly\", \n              \"then\": \"$sal_actTotalBsyesterday513\"\n            }, {\n              \"case\": \"$condVarJanuary\", \n              \"then\": 0\n            }, {\n              \"case\": {\n                \"$lte\": [\n                  \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue513\", null\n                ]\n              }, \n              \"then\": 0\n            }\n          ], \n          \"default\": {\n            \"$first\": \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue513\"\n          }\n        }\n      }, \n      \"smnnlAdjstmntValue513USD\": {\n        \"$switch\": {\n          \"branches\": [\n            {\n              \"case\": \"$condVarJuly\", \n              \"then\": \"$sal_actTotalBsUSDyesterday513\"\n            }, {\n              \"case\": \"$condVarJanuary\", \n              \"then\": 0\n            }, {\n              \"case\": {\n                \"$lte\": [\n                  \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue513USD\", null\n                ]\n              }, \n              \"then\": 0\n            }\n          ], \n          \"default\": {\n            \"$first\": \"$IngresoscartcredmetricyesterdayDate.smnnlAdjstmntValue513USD\"\n          }\n        }\n      }, \n      \"IngresoscartcredmetricyesterdayDate\": \"$$REMOVE\"\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"DailyGroupIngresosCarteraCredito\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"replace\"\n    }\n  }\n]"
        },
        "id": "6aca67de-a8b4-4897-930c-8ffc66e558c0",
        "name": "1_DailyGroup_IngresosCarteraCredito",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1540,
          6640
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_statusProcesos",
          "query": "=[\n    {\n      \"$limit\": 1\n    }, {\n      \"$addFields\": {\n        \"_id\": \"$$REMOVE\", \n        \"lastUpdatedAt\": \"$$REMOVE\", \n        \"proceso\": \"$$REMOVE\", \n        \"currentUpdatedDate\": \"$$REMOVE\", \n        \"processName\": \"BALACEMETRIC_OP\", \n        \"processDate\": {\n          \"$dateTrunc\": {\n            \"date\": {\n              \"$dateAdd\": {\n                \"startDate\": {\n                  \"$toDate\": \"$$NOW\"\n                }, \n                \"unit\": \"day\", \n                \"amount\": -1\n              }\n            }, \n            \"unit\": \"hour\"\n          }\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"processName\": \"$processName\", \n        \"processDate\": \"$processDate\", \n        \"description\": \"Procesamiento de ajusteBRM, liquidaciones, cobranza y mora, ingresos por cartera, cartera de crÃ©dito, ingresos por comisiÃ³n y captaciones\", \n        \"processFrequency\": \"cada 4 horas\", \n        \"fromColletion\": \"sidis_brm,sidis_activos_liq_uvc,sidis_activos_liq_bs,sidis_activosIa,Castigos\", \n        \"toColletion\": \"Balacemetric\", \n        \"startDate\": \"$$NOW\", \n        \"endDate\": \"nda\", \n        \"runtimeInMinutes\": \"nda\", \n        \"status\": \"En Proceso\", \n        \"subProcess\": [\n          {\n            \"processName\": \"1_FormateoObjetivos\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Formatea la colecciÃ³n objetivos\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"Objective\", \n            \"toColletion\": \"Objectiveformat\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"2_FormateoBRMAJUSTADO\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Formatea la brm ajustado, solo si hay nuevos valores\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"brm_ajustado\", \n            \"toColletion\": \"sidis_brm_ajustado\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"3_AjusteBRM\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Obtiene la cantidad de dÃ­as a reprocesar si hay valores en sidis_brm_ajustado\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_brm_ajustado\", \n            \"toColletion\": \"nda\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"4_Procesamiento_Liquidaciones\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Procesamiento de las metricas de liquidaciones\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_activos_liq_uvc,sidis_activos_liq_bs\", \n            \"toColletion\": \"Balacemetric\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"5_Procesamiento_CobranzaMora\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Procesamiento de las metricas de cobranza y mora\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_activosIa\", \n            \"toColletion\": \"Balacemetric\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"6_Procesamiento_IngresosPorCartera\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Procesamiento de las metricas de cobranza y mora\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_brm\", \n            \"toColletion\": \"Balacemetric\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"7_Procesamiento_carteraCredito\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Procesamiento de las metricas de cartera de crÃ©dito\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_brm\", \n            \"toColletion\": \"Balacemetric\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"8_Procesamiento_IngresosComision\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Procesamiento de las metricas de ingresos por comisiÃ³n\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_brm\", \n            \"toColletion\": \"Balacemetric\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"9_Procesamiento_Captaciones\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Procesamiento de las metricas de captaciones\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_brm\", \n            \"toColletion\": \"Balacemetric\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"10_Ingresos_Otros_Operativos\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Procesamiento de las metricas otras comisiones\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_brm\", \n            \"toColletion\": \"Balacemetric\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }, {\n            \"processName\": \"11_Procesamiento_Net_Result\", \n            \"processDate\": \"$processDate\", \n            \"description\": \"Procesamiento de las metricas\", \n            \"processFrequency\": \"cada 4 horas\", \n            \"fromColletion\": \"sidis_brm\", \n            \"toColletion\": \"Balacemetric\", \n            \"startDate\": \"$$NOW\", \n            \"endDate\": \"nda\", \n            \"runtimeInMinutes\": \"nda\", \n            \"status\": \"En Proceso\"\n          }\n        ]\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"sidis_statusProcesos\", \n        \"localField\": \"processName\", \n        \"foreignField\": \"processName\", \n        \"as\": \"sidis_statusProcesos\"\n      }\n    }, {\n      \"$replaceRoot\": {\n        \"newRoot\": {\n          \"$mergeObjects\": [\n            {\n              \"$filter\": {\n                \"input\": \"$sidis_statusProcesos\", \n                \"as\": \"item\", \n                \"cond\": {\n                  \"$eq\": [\n                    \"$$item.processDate\", {\n                      \"$max\": \"$sidis_statusProcesos.processDate\"\n                    }\n                  ]\n                }\n              }\n            }\n          ]\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"subProcess\": {\n          \"$map\": {\n            \"input\": \"$subProcess\", \n            \"as\": \"item\", \n            \"in\": {\n              \"$cond\": [\n                {\n                  \"$and\": [\n                    {\n                      \"$eq\": [\n                        \"$$item.processName\", \"4_Procesamiento_Liquidaciones\"\n                      ]\n                    }\n                  ]\n                }, {\n                  \"$mergeObjects\": [\n                    {\n                      \"processName\": \"$$item.processName\"\n                    }, {\n                      \"processDate\": \"$$item.processDate\"\n                    }, {\n                      \"description\": \"$$item.description\"\n                    }, {\n                      \"processFrequency\": \"$$item.processFrequency\"\n                    }, {\n                      \"fromColletion\": \"$$item.fromColletion\"\n                    }, {\n                      \"toColletion\": \"$$item.toColletion\"\n                    }, {\n                      \"startDate\": \"$$item.startDate\"\n                    }, {\n                      \"endDate\": \"$$NOW\"\n                    }, {\n                      \"runtimeInMinutes\": {\n                        \"$round\": [\n                          {\n                            \"$divide\": [\n                              {\n                                \"$subtract\": [\n                                  \"$$NOW\", \"$$item.startDate\"\n                                ]\n                              }, 60000\n                            ]\n                          }, 2\n                        ]\n                      }\n                    }, {\n                      \"status\": \"Finalizado\"\n                    }\n                  ]\n                }, \"$$item\"\n              ]\n            }\n          }\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"status\": {\n          \"$cond\": [\n            {\n              \"$or\": [\n                {\n                  \"$in\": [\n                    \"En Proceso\", \"$subProcess.status\"\n                  ]\n                }, {\n                  \"$in\": [\n                    \"En espera\", \"$subProcess.status\"\n                  ]\n                }\n              ]\n            }, \"En Proceso\", \"Finalizado\"\n          ]\n        }, \n        \"endDate\": \"$$NOW\", \n        \"runtimeInMinutes\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                {\n                  \"$subtract\": [\n                    \"$$NOW\", \"$startDate\"\n                  ]\n                }, 60000\n              ]\n            }, 2\n          ]\n        }\n      }\n    }, {\n      \"$merge\": {\n        \"into\": \"sidis_statusProcesos\", \n        \"on\": [\n          \"processName\", \"processDate\"\n        ]\n      }\n    }\n  ]"
        },
        "id": "979db412-c134-47fe-baa1-a15786b596d6",
        "name": "Crea la operacion",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -2460,
          7320
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "73077656-0b5e-494d-8a83-9dccd2102d05",
          "options": {}
        },
        "id": "ff8c0169-f7e3-470c-a382-e59e2ce690fe",
        "name": "Webhook3",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          1020,
          9740
        ],
        "webhookId": "73077656-0b5e-494d-8a83-9dccd2102d05"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "0fa9b888-2b1e-4dd5-b626-3b14c67e3a75",
          "options": {}
        },
        "id": "3db0233f-5bf7-4dca-b0dd-8b75639501f0",
        "name": "Webhook10",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          1040,
          10260
        ],
        "webhookId": "0fa9b888-2b1e-4dd5-b626-3b14c67e3a75"
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "558f2f05-291f-4323-8aa6-a7932b2da2ad",
        "name": "Merge46",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          3160,
          5360
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "Liquidacionmetric",
          "query": "=[\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          \"$fecha_valor\", {\n            \"$subtract\": [\n              {\n                \"$toDate\": {\n                  \"$dateFromString\": {\n                    \"dateString\": {\n                      \"$dateToString\": {\n                        \"format\": \"%Y-%m-%dT00:00:00%z\", \n                        \"date\": {\n                          \"$toDate\": \"$$NOW\"\n                        }\n                      }\n                    }\n                  }\n                }\n              }, {\n                \"$multiply\": [\n                  {\n                    \"$toInt\": \"{{$json.offSet}}\"\n                  }, 86400000\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$project\": {\n      \"settlmntAmount\": 1, \n      \"settlmntCount\": 1, \n      \"yesterdayDate\": 1, \n      \"previusMonthDate\": 1, \n      \"previusYearDate\": 1, \n      \"fecha_valor\": 1\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"yesterdayDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"BalancemetricyesterdayDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"previusMonthDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"BalancemetricpreviusMonthDate\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"previusYearDate\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"BalancemetricpreviuspreviusYearDate\"\n    }\n  }, {\n    \"$project\": {\n      \"montoLiq_current\": \"$settlmntAmount\", \n      \"numLiq_current\": \"$settlmntCount\", \n      \"montoLiqTotal_monthAcc\": {\n        \"$first\": \"$BalancemetricyesterdayDate.liquidacionesBs.montoLiqTotal.monthAcc\"\n      }, \n      \"numLiq_monthAcc\": {\n        \"$first\": \"$BalancemetricyesterdayDate.liquidacionesBs.numLiqTotal.monthAcc\"\n      }, \n      \"montoLiqTotal_monthAccPrev\": {\n        \"$first\": \"$BalancemetricpreviusMonthDate.liquidacionesBs.montoLiqTotal.monthAccPrev\"\n      }, \n      \"numLiq_monthAccPrev\": {\n        \"$first\": \"$BalancemetricpreviusMonthDate.liquidacionesBs.numLiqTotal.monthAccPrev\"\n      }, \n      \"montoLiqTotal_annualAcc\": {\n        \"$first\": \"$BalancemetricyesterdayDate.liquidacionesBs.montoLiqTotal.annualAcc\"\n      }, \n      \"numLiq_annualAcc\": {\n        \"$first\": \"$BalancemetricyesterdayDate.liquidacionesBs.numLiqTotal.annualAcc\"\n      }, \n      \"montoLiqTotal_annualAccPrev\": {\n        \"$first\": \"$BalancemetricpreviuspreviusYearDate.liquidacionesBs.montoLiqTotal.annualAccPrev\"\n      }, \n      \"numLiq_annualAccPrev\": {\n        \"$first\": \"$BalancemetricpreviuspreviusYearDate.liquidacionesBs.numLiqTotal.annualAccPrev\"\n      }, \n      \"fecha_valor\": 1\n    }\n  }, {\n    \"$set\": {\n      \"montoLiqTotal_monthAcc\": {\n        \"$sum\": [\n          \"$montoLiq_current\", \"$montoLiqTotal_monthAcc\"\n        ]\n      }, \n      \"numLiq_monthAcc\": {\n        \"$sum\": [\n          \"$numLiq_current\", \"$numLiq_monthAcc\"\n        ]\n      }, \n      \"montoLiqTotal_monthAccPrev\": {\n        \"$sum\": [\n          \"$montoLiqTotal_monthAccPrev\"\n        ]\n      }, \n      \"numLiq_monthAccPrev\": {\n        \"$sum\": [\n          \"$numLiq_monthAccPrev\"\n        ]\n      }, \n      \"montoLiqTotal_annualAcc\": {\n        \"$sum\": [\n          \"$montoLiq_current\", \"$montoLiqTotal_annualAcc\"\n        ]\n      }, \n      \"numLiq_annualAcc\": {\n        \"$sum\": [\n          \"$numLiq_current\", \"$numLiq_annualAcc\"\n        ]\n      }, \n      \"montoLiqTotal_annualAccPrev\": {\n        \"$sum\": [\n          \"$montoLiqTotal_annualAccPrev\"\n        ]\n      }, \n      \"numLiq_annualAccPrev\": {\n        \"$sum\": [\n          \"$numLiq_annualAccPrev\"\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"result\"\n    }\n  }, {\n    \"$addFields\": {\n      \"montoLiq_currentUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$montoLiq_current\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"montoLiqTotal_monthAccUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$montoLiqTotal_monthAcc\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"montoLiqTotal_monthAccPrevUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$montoLiqTotal_monthAccPrev\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"montoLiqTotal_annualAccUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$montoLiqTotal_annualAcc\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"montoLiqTotal_annualAccPrevUSD\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$montoLiqTotal_annualAccPrev\", {\n                \"$first\": \"$result.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"annualGrowthPrc\": {\n        \"$cond\": [\n          {\n            \"$ne\": [\n              \"$montoLiqTotal_annualAccPrev\", 0\n            ]\n          }, {\n            \"$multiply\": [\n              {\n                \"$divide\": [\n                  {\n                    \"$subtract\": [\n                      \"$montoLiqTotal_annualAcc\", \"$montoLiqTotal_annualAccPrev\"\n                    ]\n                  }, \"$montoLiqTotal_annualAccPrev\"\n                ]\n              }, 100\n            ]\n          }, 0\n        ]\n      }, \n      \"result\": \"$$REMOVE\", \n      \"_id\": \"$$REMOVE\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"localField\": \"fecha_valor\", \n      \"foreignField\": \"fecha_valor\", \n      \"as\": \"Balancemetric\"\n    }\n  }, {\n    \"$set\": {\n      \"Balancemetric\": {\n        \"$first\": \"$Balancemetric\"\n      }\n    }\n  }, {\n    \"$set\": {\n      \"Balancemetric.liquidacionesBs.montoLiqTotal.current\": \"$montoLiq_current\", \n      \"Balancemetric.liquidacionesBs.montoLiqTotal.monthAcc\": \"$montoLiqTotal_monthAcc\", \n      \"Balancemetric.liquidacionesBs.montoLiqTotal.monthAccPrev\": \"$montoLiqTotal_monthAccPrev\", \n      \"Balancemetric.liquidacionesBs.montoLiqTotal.annualAcc\": \"$montoLiqTotal_annualAcc\", \n      \"Balancemetric.liquidacionesBs.montoLiqTotal.annualAccPrev\": \"$montoLiqTotal_annualAccPrev\", \n      \"Balancemetric.liquidacionesBs.montoLiqTotal.annualGrowthPrc\": \"$annualGrowthPrc\", \n      \"Balancemetric.liquidacionesBs.numLiqTotal.current\": \"$numLiq_current\", \n      \"Balancemetric.liquidacionesBs.numLiqTotal.monthAcc\": \"$numLiq_monthAcc\", \n      \"Balancemetric.liquidacionesBs.numLiqTotal.monthAccPrev\": \"$numLiq_monthAccPrev\", \n      \"Balancemetric.liquidacionesBs.numLiqTotal.annualAcc\": \"$numLiq_annualAcc\", \n      \"Balancemetric.liquidacionesBs.numLiqTotal.annualAccPrev\": \"$numLiq_annualAccPrev\", \n      \"Balancemetric.liquidacionesBs.numLiqTotal.annualGrowthPrc\": \"$annualGrowthPrc\", \n      \"Balancemetric.liquidaciones.montoLiqTotal.current\": \"$montoLiq_currentUSD\", \n      \"Balancemetric.liquidaciones.montoLiqTotal.monthAcc\": \"$montoLiqTotal_monthAccUSD\", \n      \"Balancemetric.liquidaciones.montoLiqTotal.monthAccPrev\": \"$montoLiqTotal_monthAccPrevUSD\", \n      \"Balancemetric.liquidaciones.montoLiqTotal.annualAcc\": \"$montoLiqTotal_annualAccUSD\", \n      \"Balancemetric.liquidaciones.montoLiqTotal.annualAccPrev\": \"$montoLiqTotal_annualAccPrevUSD\", \n      \"Balancemetric.liquidaciones.montoLiqTotal.annualGrowthPrc\": \"$annualGrowthPrc\", \n      \"Balancemetric.liquidaciones.numLiqTotal.current\": \"$numLiq_current\", \n      \"Balancemetric.liquidaciones.numLiqTotal.monthAcc\": \"$numLiq_monthAcc\", \n      \"Balancemetric.liquidaciones.numLiqTotal.monthAccPrev\": \"$numLiq_monthAccPrev\", \n      \"Balancemetric.liquidaciones.numLiqTotal.annualAcc\": \"$numLiq_annualAcc\", \n      \"Balancemetric.liquidaciones.numLiqTotal.annualAccPrev\": \"$numLiq_annualAccPrev\", \n      \"Balancemetric.liquidaciones.numLiqTotal.annualGrowthPrc\": \"$annualGrowthPrc\"\n    }\n  }, {\n    \"$project\": {\n      \"Balancemetric\": 1\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": \"fecha_valor\", \n      \"whenMatched\": \"merge\", \n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]"
        },
        "id": "738c759d-d14e-4459-82fa-cfd0560caa90",
        "name": "9_Indicadores131",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          2960,
          4900
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "a6f38322-db6f-40ba-83e0-20cfae948747",
        "name": "Merge30",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          3760,
          9240
        ]
      },
      {
        "parameters": {
          "content": "TK7-1 Homologacion:\n\n",
          "height": 1189.6882845846444,
          "width": 1851.6906344017125
        },
        "id": "bd0c18e0-725a-4594-b358-12b3d316baea",
        "name": "Note10",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          700,
          10520
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/11895d34-903b-41a6-a68c-76d9fb5ddb5f",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet}}"
              }
            ]
          },
          "options": {}
        },
        "id": "3d7420fe-e618-450d-9091-93ed26c5934a",
        "name": "HTTP Request26",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          740,
          11540
        ]
      },
      {
        "parameters": {
          "functionCode": "var offSet\n\nfor (const item of $input.all()) {\n  body=item.json.body;\n}\noffSet = body.offSet;\n\nconst proceso = \"8_Procesamiento_IngresosComision\"  //enter process name\n\nconst jsonOutput = {\n  offSet: offSet, proceso: proceso// Nombre del campo y valor deseado\n};\n\nreturn jsonOutput"
        },
        "name": "FunctionItem19",
        "type": "n8n-nodes-base.functionItem",
        "typeVersion": 1,
        "position": [
          1060,
          11540
        ],
        "id": "64b5a62f-81b5-44d2-ab8c-1ae605e625d0",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{$json}}",
                "operation": "isNotEmpty"
              },
              {
                "value1": "={{$json.offSet}}",
                "operation": "largerEqual",
                "value2": 1
              }
            ]
          }
        },
        "id": "5cb11086-5911-40f1-89b2-619e6a06de0d",
        "name": "IF9",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1200,
          11540
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=http://workflowsidis.banvenez.corp:30991/webhook/11895d34-903b-41a6-a68c-76d9fb5ddb5f",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "offSet",
                "value": "={{$json.offSet-1}}"
              },
              {
                "name": "proceso",
                "value": "={{$json.proceso}}"
              }
            ]
          },
          "options": {}
        },
        "id": "fbb1c493-fdd9-4d59-8ebd-085fc0355f6a",
        "name": "HTTP Request27",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 3,
        "position": [
          2380,
          11500
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "473aacd1-70e8-4a5e-a9f0-e4dfa56fff16",
        "name": "Merge47",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2180,
          11500
        ]
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n    {\n      \"$limit\": 1\n    }, {\n      \"$project\": {\n        \"_id\": 0, \n        \"todayDate\": {\n          \"$subtract\": [\n            {\n              \"$toDate\": {\n                \"$dateFromString\": {\n                  \"dateString\": {\n                    \"$dateToString\": {\n                      \"format\": \"%Y-%m-%dT00:00:00%z\", \n                      \"date\": {\n                        \"$toDate\": \"$$NOW\"\n                      }\n                    }\n                  }\n                }\n              }\n            }, {\n              \"$multiply\": [\n                {\n                  \"$toInt\": \"{{$json.offSet}}\"\n                }, 86400000\n              ]\n            }\n          ]\n        }\n      }\n    }, {\n      \"$addFields\": {\n        \"currentProcessDate\": {\n          \"$dateAdd\": {\n            \"startDate\": {\n              \"$dateFromParts\": {\n                \"year\": {\n                  \"$year\": \"$todayDate\"\n                }, \n                \"month\": {\n                  \"$add\": [\n                    {\n                      \"$month\": \"$todayDate\"\n                    }, 1\n                  ]\n                }\n              }\n            }, \n            \"unit\": \"day\", \n            \"amount\": -1\n          }\n        }, \n        \"listYears\": [\n          {\n            \"$year\": \"$todayDate\"\n          }, {\n            \"$subtract\": [\n              {\n                \"$year\": \"$todayDate\"\n              }, 1\n            ]\n          }, {\n            \"$subtract\": [\n              {\n                \"$year\": \"$todayDate\"\n              }, 2\n            ]\n          }\n        ], \n        \"listMonths\": [\n          1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\n        ]\n      }\n    }, {\n      \"$unwind\": {\n        \"path\": \"$listMonths\"\n      }\n    }, {\n      \"$unwind\": {\n        \"path\": \"$listYears\"\n      }\n    }, {\n      \"$addFields\": {\n        \"processDate\": {\n          \"$dateAdd\": {\n            \"startDate\": {\n              \"$dateFromParts\": {\n                \"year\": \"$listYears\", \n                \"month\": \"$listMonths\"\n              }\n            }, \n            \"unit\": \"day\", \n            \"amount\": -1\n          }\n        }\n      }\n    }, {\n      \"$match\": {\n        \"$and\": [\n          {\n            \"$expr\": {\n              \"$gte\": [\n                \"$currentProcessDate\", {\n                  \"$dateFromParts\": {\n                    \"year\": \"$listYears\", \n                    \"month\": \"$listMonths\"\n                  }\n                }\n              ]\n            }\n          }, {\n            \"$expr\": {\n              \"$gte\": [\n                \"$processDate\", {\n                  \"$dateFromParts\": {\n                    \"year\": 2022, \n                    \"month\": 1, \n                    \"day\": 31\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"sidis_Financialstatement\", \n        \"let\": {\n          \"processDate\": \"$processDate\", \n          \"name\": \"VENEZUELA [BU]\"\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$and\": [\n                {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"$name\", \"$$name\"\n                    ]\n                  }\n                }, {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"$fechaProceso\", \"$$processDate\"\n                    ]\n                  }\n                }\n              ]\n            }\n          }, {\n            \"$project\": {\n              \"publicDeposits\": 1\n            }\n          }\n        ], \n        \"as\": \"sidis_Financialstatement\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"Balancemetric\", \n        \"let\": {\n          \"processDate\": \"$processDate\"\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$and\": [\n                {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"$fecha_valor\", \"$$processDate\"\n                    ]\n                  }\n                }\n              ]\n            }\n          }\n        ], \n        \"as\": \"Balancemetric\"\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"sidis_brm\", \n        \"let\": {\n          \"processDate\": \"$processDate\"\n        }, \n        \"pipeline\": [\n          {\n            \"$match\": {\n              \"$and\": [\n                {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"$fecha_odate\", \"$$processDate\"\n                    ]\n                  }\n                }, {\n                  \"$expr\": {\n                    \"$eq\": [\n                      \"$nucta\", \"21\"\n                    ]\n                  }\n                }\n              ]\n            }\n          }, {\n            \"$project\": {\n              \"sal_act\": {\n                \"$round\": [\n                  {\n                    \"$multiply\": [\n                      \"$sal_act\", -1\n                    ]\n                  }, 0\n                ]\n              }\n            }\n          }\n        ], \n        \"as\": \"sidis_brm\"\n      }\n    }, {\n      \"$addFields\": {\n        \"valFinCapTot\": {\n          \"$sum\": [\n            \"$sidis_Financialstatement.publicDeposits\"\n          ]\n        }, \n        \"valBalCapTot\": {\n          \"$round\": [\n            {\n              \"$sum\": [\n                \"$Balancemetric.captacionesBs.total.mensual\"\n              ]\n            }, 0\n          ]\n        }, \n        \"valBrmCapTot\": {\n          \"$sum\": [\n            \"$sidis_brm.sal_act\"\n          ]\n        }, \n        \"listYears\": \"$$REMOVE\", \n        \"listMonths\": \"$$REMOVE\", \n        \"sidis_Financialstatement\": \"$$REMOVE\", \n        \"sidis_brm\": \"$$REMOVE\"\n      }\n    }, {\n      \"$sort\": {\n        \"processDate\": 1\n      }\n    }, {\n      \"$match\": {\n        \"$expr\": {\n          \"$eq\": [\n            {\n              \"$cond\": [\n                {\n                  \"$cond\": [\n                    {\n                      \"$gt\": [\n                        {\n                          \"$abs\": {\n                            \"$subtract\": [\n                              \"$valFinCapTot\", \"$valBalCapTot\"\n                            ]\n                          }\n                        }, 1\n                      ]\n                    }, {\n                      \"$cond\": [\n                        {\n                          \"$eq\": [\n                            \"$valFinCapTot\", 0\n                          ]\n                        }, true, false\n                      ]\n                    }, true\n                  ]\n                }, true, {\n                  \"$eq\": [\n                    \"$valFinCapTot\", \"$valBalCapTot\"\n                  ]\n                }\n              ]\n            }, false\n          ]\n        }\n      }\n    }, {\n      \"$lookup\": {\n        \"from\": \"sidis_tasaconversion\", \n        \"localField\": \"processDate\", \n        \"foreignField\": \"Fecha\", \n        \"as\": \"sidis_tasaconversion\"\n      }\n    }, {\n      \"$addFields\": {\n        \"todayDate\": \"$$REMOVE\", \n        \"currentProcessDate\": \"$$REMOVE\", \n        \"processDate\": \"$$REMOVE\", \n        \"valFinCapTot\": \"$$REMOVE\", \n        \"valBalCapTot\": \"$$REMOVE\", \n        \"valBrmCapTot\": \"$$REMOVE\", \n        \"sidis_tasaconversion\": \"$$REMOVE\", \n        \"Balancemetric.captaciones.total.mensual\": {\n          \"$round\": [\n            {\n              \"$divide\": [\n                \"$valFinCapTot\", {\n                  \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n                }\n              ]\n            }, 4\n          ]\n        }, \n        \"Balancemetric.captacionesBs.total.mensual\": {\n          \"$round\": [\n            \"$valFinCapTot\", 4\n          ]\n        }\n      }\n    }, {\n      \"$replaceRoot\": {\n        \"newRoot\": {\n          \"$first\": \"$Balancemetric\"\n        }\n      }\n    }, {\n      \"$merge\": {\n        \"into\": \"sidis_brm\", \n        \"on\": [\n          \"fecha_valor\"\n        ]\n      }\n    }\n  ]"
        },
        "id": "66f702dd-e8dc-4524-a108-e55a3dc5b2a0",
        "name": "Captaciones",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1500,
          10560
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"currentProcessDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$add\": [\n                  {\n                    \"$month\": \"$todayDate\"\n                  }, 1\n                ]\n              }\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"listYears\": [\n        {\n          \"$year\": \"$todayDate\"\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 1\n          ]\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 2\n          ]\n        }\n      ], \n      \"listMonths\": [\n        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\n      ]\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listMonths\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listYears\"\n    }\n  }, {\n    \"$addFields\": {\n      \"processDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": \"$listYears\", \n              \"month\": \"$listMonths\"\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$and\": [\n        {\n          \"$expr\": {\n            \"$gte\": [\n              \"$currentProcessDate\", {\n                \"$dateFromParts\": {\n                  \"year\": \"$listYears\", \n                  \"month\": \"$listMonths\"\n                }\n              }\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$gte\": [\n              \"$processDate\", {\n                \"$dateFromParts\": {\n                  \"year\": 2022, \n                  \"month\": 1, \n                  \"day\": 31\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_Financialstatement\", \n      \"let\": {\n        \"processDate\": \"$processDate\", \n        \"name\": \"VENEZUELA [BU]\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$name\", \"$$name\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fechaProceso\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"currentLoans1\": 1, \n            \"restructuredLoans1\": 1, \n            \"overdueLoans1\": 1, \n            \"litigationLoans1\": 1\n          }\n        }\n      ], \n      \"as\": \"sidis_Financialstatement\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_valor\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ], \n      \"as\": \"Balancemetric\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$$processDate\"\n                  ]\n                }\n              }, {\n                \"$or\": [\n                  {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$nucta\", \"131\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$nucta\", \"132\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$nucta\", \"133\"\n                      ]\n                    }\n                  }, {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$nucta\", \"134\"\n                      ]\n                    }\n                  }\n                ]\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"sal_act\": {\n              \"$round\": [\n                {\n                  \"$multiply\": [\n                    \"$sal_act\", 1\n                  ]\n                }, 0\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$sort\": {\n      \"processDate\": 1\n    }\n  }, {\n    \"$addFields\": {\n      \"valFinCapTot\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$sidis_Financialstatement.currentLoans1\"\n          }, {\n            \"$first\": \"$sidis_Financialstatement.restructuredLoans1\"\n          }, {\n            \"$first\": \"$sidis_Financialstatement.overdueLoans1\"\n          }, {\n            \"$first\": \"$sidis_Financialstatement.litigationLoans1\"\n          }\n        ]\n      }, \n      \"valBalCapTot\": {\n        \"$round\": [\n          {\n            \"$sum\": [\n              \"$Balancemetric.carteraCreditoBs.total.mensual\"\n            ]\n          }, 0\n        ]\n      }, \n      \"valBrmCapTot\": {\n        \"$sum\": [\n          \"$sidis_brm.sal_act\"\n        ]\n      }, \n      \"listYears\": \"$$REMOVE\", \n      \"listMonths\": \"$$REMOVE\", \n      \"sidis_Financialstatement\": \"$$REMOVE\", \n      \"sidis_brm\": \"$$REMOVE\"\n    }\n  }, {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          {\n            \"$cond\": [\n              {\n                \"$cond\": [\n                  {\n                    \"$gt\": [\n                      {\n                        \"$abs\": {\n                          \"$subtract\": [\n                            \"$valFinCapTot\", \"$valBalCapTot\"\n                          ]\n                        }\n                      }, 1\n                    ]\n                  }, {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$valFinCapTot\", 0\n                        ]\n                      }, true, false\n                    ]\n                  }, true\n                ]\n              }, true, {\n                \"$eq\": [\n                  \"$valFinCapTot\", \"$valBalCapTot\"\n                ]\n              }\n            ]\n          }, false\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"processDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$sort\": {\n      \"processDate\": 1\n    }\n  }, {\n    \"$addFields\": {\n      \"todayDate\": \"$$REMOVE\", \n      \"currentProcessDate\": \"$$REMOVE\", \n      \"processDate\": \"$$REMOVE\", \n      \"valFinCapTot\": \"$$REMOVE\", \n      \"valBalCapTot\": \"$$REMOVE\", \n      \"valBrmCapTot\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"Balancemetric.carteraCredito.total.mensual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$valFinCapTot\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"Balancemetric.carteraCreditoBs.total.mensual\": {\n        \"$round\": [\n          \"$valFinCapTot\", 4\n        ]\n      }\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$first\": \"$Balancemetric\"\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_brm\", \n      \"on\": [\n        \"fecha_valor\"\n      ]\n    }\n  }\n]"
        },
        "id": "e77aff2c-c0d1-4cd2-a5d1-1ecd6b24e26d",
        "name": "CarteraCredito",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1500,
          10720
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"currentProcessDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$add\": [\n                  {\n                    \"$month\": \"$todayDate\"\n                  }, 1\n                ]\n              }\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"listYears\": [\n        {\n          \"$year\": \"$todayDate\"\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 1\n          ]\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 2\n          ]\n        }\n      ], \n      \"listMonths\": [\n        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\n      ]\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listMonths\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listYears\"\n    }\n  }, {\n    \"$addFields\": {\n      \"processDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": \"$listYears\", \n              \"month\": \"$listMonths\"\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$and\": [\n        {\n          \"$expr\": {\n            \"$gte\": [\n              \"$currentProcessDate\", {\n                \"$dateFromParts\": {\n                  \"year\": \"$listYears\", \n                  \"month\": \"$listMonths\"\n                }\n              }\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$gte\": [\n              \"$processDate\", {\n                \"$dateFromParts\": {\n                  \"year\": 2022, \n                  \"month\": 1, \n                  \"day\": 31\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_Financialstatement\", \n      \"let\": {\n        \"processDate\": \"$processDate\", \n        \"name\": \"VENEZUELA [BU]\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$name\", \"$$name\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fechaProceso\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"currentLoans1\": 1\n          }\n        }\n      ], \n      \"as\": \"sidis_Financialstatement\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_valor\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ], \n      \"as\": \"Balancemetric\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$$processDate\"\n                  ]\n                }\n              }, {\n                \"$or\": [\n                  {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$nucta\", \"131\"\n                      ]\n                    }\n                  }\n                ]\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"sal_act\": {\n              \"$round\": [\n                {\n                  \"$multiply\": [\n                    \"$sal_act\", 1\n                  ]\n                }, 0\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$addFields\": {\n      \"valFinCapTot\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$sidis_Financialstatement.currentLoans1\"\n          }\n        ]\n      }, \n      \"valBalCapTot\": {\n        \"$round\": [\n          {\n            \"$sum\": [\n              \"$Balancemetric.carteraCreditoBs.total.mensual\"\n            ]\n          }, 0\n        ]\n      }, \n      \"valBrmCapTot\": {\n        \"$sum\": [\n          \"$sidis_brm.sal_act\"\n        ]\n      }, \n      \"listYears\": \"$$REMOVE\", \n      \"listMonths\": \"$$REMOVE\", \n      \"sidis_Financialstatement\": \"$$REMOVE\", \n      \"sidis_brm\": \"$$REMOVE\"\n    }\n  }, {\n    \"$sort\": {\n      \"processDate\": -1\n    }\n  }, {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          {\n            \"$cond\": [\n              {\n                \"$cond\": [\n                  {\n                    \"$gt\": [\n                      {\n                        \"$abs\": {\n                          \"$subtract\": [\n                            \"$valFinCapTot\", \"$valBalCapTot\"\n                          ]\n                        }\n                      }, 1\n                    ]\n                  }, {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$valFinCapTot\", 0\n                        ]\n                      }, true, false\n                    ]\n                  }, true\n                ]\n              }, true, {\n                \"$eq\": [\n                  \"$valFinCapTot\", \"$valBalCapTot\"\n                ]\n              }\n            ]\n          }, false\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"processDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"todayDate\": \"$$REMOVE\", \n      \"currentProcessDate\": \"$$REMOVE\", \n      \"processDate\": \"$$REMOVE\", \n      \"valFinCapTot\": \"$$REMOVE\", \n      \"valBalCapTot\": \"$$REMOVE\", \n      \"valBrmCapTot\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"Balancemetric.liquidaciones.total.monthly\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$valFinCapTot\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"Balancemetric.liquidacionesBs.total.monthly\": {\n        \"$round\": [\n          \"$valFinCapTot\", 4\n        ]\n      }\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$first\": \"$Balancemetric\"\n      }\n    }\n  }, {\n    \"$sort\": {\n      \"fechaProceso\": -1\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"sidis_brm\", \n      \"on\": [\n        \"fecha_valor\"\n      ]\n    }\n  }\n]"
        },
        "id": "b0ba07c9-faf1-47ce-907d-b28c21c43c3a",
        "name": "Liquidaciones",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1500,
          10880
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "11895d34-903b-41a6-a68c-76d9fb5ddb5f",
          "options": {}
        },
        "id": "620aa63c-ff86-4060-90db-e7e8cb006a0d",
        "name": "Webhook11",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          920,
          11540
        ],
        "webhookId": "11895d34-903b-41a6-a68c-76d9fb5ddb5f"
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"currentProcessDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$add\": [\n                  {\n                    \"$month\": \"$todayDate\"\n                  }, 1\n                ]\n              }\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"listYears\": [\n        {\n          \"$year\": \"$todayDate\"\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 1\n          ]\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 2\n          ]\n        }\n      ], \n      \"listMonths\": [\n        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\n      ]\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listMonths\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listYears\"\n    }\n  }, {\n    \"$addFields\": {\n      \"processDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": \"$listYears\", \n              \"month\": \"$listMonths\"\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$and\": [\n        {\n          \"$expr\": {\n            \"$gte\": [\n              \"$currentProcessDate\", {\n                \"$dateFromParts\": {\n                  \"year\": \"$listYears\", \n                  \"month\": \"$listMonths\"\n                }\n              }\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$gte\": [\n              \"$processDate\", {\n                \"$dateFromParts\": {\n                  \"year\": 2022, \n                  \"month\": 1, \n                  \"day\": 31\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_Financialstatement\", \n      \"let\": {\n        \"processDate\": \"$processDate\", \n        \"name\": \"VENEZUELA [BU]\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$name\", \"$$name\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fechaProceso\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"incomeFromLoanPortfolio\": 1\n          }\n        }\n      ], \n      \"as\": \"sidis_Financialstatement\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_valor\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ], \n      \"as\": \"Balancemetric\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$$processDate\"\n                  ]\n                }\n              }, {\n                \"$or\": [\n                  {\n                    \"$expr\": {\n                      \"$eq\": [\n                        \"$nucta\", \"513\"\n                      ]\n                    }\n                  }\n                ]\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"sal_net_act\": {\n              \"$round\": [\n                {\n                  \"$multiply\": [\n                    \"$sal_net_act\", -1\n                  ]\n                }, 0\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$addFields\": {\n      \"valFinCapTot\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$sidis_Financialstatement.incomeFromLoanPortfolio\"\n          }\n        ]\n      }, \n      \"valBalCapTot\": {\n        \"$round\": [\n          {\n            \"$sum\": [\n              \"$Balancemetric.ingresosCarteraBs.iccAcMensual\"\n            ]\n          }, 0\n        ]\n      }, \n      \"valBrmCapTot\": {\n        \"$sum\": [\n          \"$sidis_brm.sal_net_act\"\n        ]\n      }, \n      \"listYears\": \"$$REMOVE\", \n      \"listMonths\": \"$$REMOVE\", \n      \"sidis_Financialstatement\": \"$$REMOVE\", \n      \"sidis_brm\": \"$$REMOVE\"\n    }\n  }, {\n    \"$sort\": {\n      \"processDate\": -1\n    }\n  }, {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          {\n            \"$cond\": [\n              {\n                \"$cond\": [\n                  {\n                    \"$gt\": [\n                      {\n                        \"$abs\": {\n                          \"$subtract\": [\n                            \"$valFinCapTot\", \"$valBalCapTot\"\n                          ]\n                        }\n                      }, 1\n                    ]\n                  }, {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$valFinCapTot\", 0\n                        ]\n                      }, true, false\n                    ]\n                  }, true\n                ]\n              }, true, {\n                \"$eq\": [\n                  \"$valFinCapTot\", \"$valBalCapTot\"\n                ]\n              }\n            ]\n          }, false\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"processDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"todayDate\": \"$$REMOVE\", \n      \"currentProcessDate\": \"$$REMOVE\", \n      \"processDate\": \"$$REMOVE\", \n      \"valFinCapTot\": \"$$REMOVE\", \n      \"valBalCapTot\": \"$$REMOVE\", \n      \"valBrmCapTot\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"Balancemetric.ingresosCartera.iccAcMensual\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$valFinCapTot\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"Balancemetric.ingresosCarteraBs.iccAcMensual\": {\n        \"$round\": [\n          \"$valFinCapTot\", 4\n        ]\n      }\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$first\": \"$Balancemetric\"\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": [\n        \"fecha_valor\"\n      ]\n    }\n  }\n]"
        },
        "id": "a3d95bd0-5f9a-456d-824c-16b9a4321a87",
        "name": "IngresosCartera",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1500,
          11060
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"currentProcessDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$add\": [\n                  {\n                    \"$month\": \"$todayDate\"\n                  }, 1\n                ]\n              }\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"listYears\": [\n        {\n          \"$year\": \"$todayDate\"\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 1\n          ]\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 2\n          ]\n        }\n      ], \n      \"listMonths\": [\n        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\n      ]\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listMonths\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listYears\"\n    }\n  }, {\n    \"$addFields\": {\n      \"processDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": \"$listYears\", \n              \"month\": \"$listMonths\"\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$and\": [\n        {\n          \"$expr\": {\n            \"$gte\": [\n              \"$currentProcessDate\", {\n                \"$dateFromParts\": {\n                  \"year\": \"$listYears\", \n                  \"month\": \"$listMonths\"\n                }\n              }\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$gte\": [\n              \"$processDate\", {\n                \"$dateFromParts\": {\n                  \"year\": 2022, \n                  \"month\": 1, \n                  \"day\": 31\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_Financialstatement\", \n      \"let\": {\n        \"processDate\": \"$processDate\", \n        \"name\": \"VENEZUELA [BU]\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$name\", \"$$name\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fechaProceso\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"otherOperatingIncome\": 1\n          }\n        }\n      ], \n      \"as\": \"sidis_Financialstatement\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_valor\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ], \n      \"as\": \"Balancemetric\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$$processDate\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"53\", \"$nucta\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"sal_net_act\": {\n              \"$round\": [\n                {\n                  \"$multiply\": [\n                    \"$sal_net_act\", -1\n                  ]\n                }, 0\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_odate\", \"$$processDate\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"539\", \"$nucta\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"sal_net_act\": {\n              \"$round\": [\n                {\n                  \"$multiply\": [\n                    \"$sal_net_act\", -1\n                  ]\n                }, 0\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm539\"\n    }\n  }, {\n    \"$addFields\": {\n      \"valFinCapTot\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$sidis_Financialstatement.otherOperatingIncome\"\n          }\n        ]\n      }, \n      \"valBalCapTot\": {\n        \"$round\": [\n          {\n            \"$sum\": [\n              \"$Balancemetric.ingresosOtrosOperativosBs.monthAcc\"\n            ]\n          }, 0\n        ]\n      }, \n      \"valBrmCapTot\": {\n        \"$subtract\": [\n          {\n            \"$sum\": [\n              \"$sidis_brm.sal_net_act\"\n            ]\n          }, {\n            \"$sum\": [\n              \"$sidis_brm539.sal_net_act\"\n            ]\n          }\n        ]\n      }, \n      \"listYears\": \"$$REMOVE\", \n      \"listMonths\": \"$$REMOVE\", \n      \"sidis_Financialstatement\": \"$$REMOVE\", \n      \"sidis_brm\": \"$$REMOVE\"\n    }\n  }, {\n    \"$sort\": {\n      \"processDate\": -1\n    }\n  }, {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          {\n            \"$cond\": [\n              {\n                \"$cond\": [\n                  {\n                    \"$gt\": [\n                      {\n                        \"$abs\": {\n                          \"$subtract\": [\n                            \"$valFinCapTot\", \"$valBalCapTot\"\n                          ]\n                        }\n                      }, 1\n                    ]\n                  }, {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$valFinCapTot\", 0\n                        ]\n                      }, true, false\n                    ]\n                  }, true\n                ]\n              }, true, {\n                \"$eq\": [\n                  \"$valFinCapTot\", \"$valBalCapTot\"\n                ]\n              }\n            ]\n          }, false\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"processDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"todayDate\": \"$$REMOVE\", \n      \"currentProcessDate\": \"$$REMOVE\", \n      \"processDate\": \"$$REMOVE\", \n      \"valFinCapTot\": \"$$REMOVE\", \n      \"valBalCapTot\": \"$$REMOVE\", \n      \"valBrmCapTot\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"Balancemetric.ingresosOtrosOperativos.monthAcc\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$valFinCapTot\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"Balancemetric.ingresosOtrosOperativosBs.monthAcc\": {\n        \"$round\": [\n          \"$valFinCapTot\", 4\n        ]\n      }\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$first\": \"$Balancemetric\"\n      }\n    }\n  }, {\n    \"$merge\": {\n      \"into\": \"Balancemetric\", \n      \"on\": [\n        \"fecha_valor\"\n      ]\n    }\n  }\n]"
        },
        "id": "e916f073-d4b2-4e68-ac7d-a924d06a81f0",
        "name": "IngresosOtrosOperativos",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1500,
          11220
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "operation": "aggregate",
          "collection": "sidis_brm",
          "query": "=[\n  {\n    \"$limit\": 1\n  }, {\n    \"$project\": {\n      \"_id\": 0, \n      \"todayDate\": {\n        \"$subtract\": [\n          {\n            \"$toDate\": {\n              \"$dateFromString\": {\n                \"dateString\": {\n                  \"$dateToString\": {\n                    \"format\": \"%Y-%m-%dT00:00:00%z\", \n                    \"date\": {\n                      \"$toDate\": \"$$NOW\"\n                    }\n                  }\n                }\n              }\n            }\n          }, {\n            \"$multiply\": [\n              {\n                \"$toInt\": \"{{$json.offSet}}\"\n              }, 86400000\n            ]\n          }\n        ]\n      }\n    }\n  }, {\n    \"$addFields\": {\n      \"currentProcessDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": {\n                \"$year\": \"$todayDate\"\n              }, \n              \"month\": {\n                \"$add\": [\n                  {\n                    \"$month\": \"$todayDate\"\n                  }, 1\n                ]\n              }\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }, \n      \"listYears\": [\n        {\n          \"$year\": \"$todayDate\"\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 1\n          ]\n        }, {\n          \"$subtract\": [\n            {\n              \"$year\": \"$todayDate\"\n            }, 2\n          ]\n        }\n      ], \n      \"listMonths\": [\n        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\n      ]\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listMonths\"\n    }\n  }, {\n    \"$unwind\": {\n      \"path\": \"$listYears\"\n    }\n  }, {\n    \"$addFields\": {\n      \"processDate\": {\n        \"$dateAdd\": {\n          \"startDate\": {\n            \"$dateFromParts\": {\n              \"year\": \"$listYears\", \n              \"month\": \"$listMonths\"\n            }\n          }, \n          \"unit\": \"day\", \n          \"amount\": -1\n        }\n      }\n    }\n  }, {\n    \"$match\": {\n      \"$and\": [\n        {\n          \"$expr\": {\n            \"$gte\": [\n              \"$currentProcessDate\", {\n                \"$dateFromParts\": {\n                  \"year\": \"$listYears\", \n                  \"month\": \"$listMonths\"\n                }\n              }\n            ]\n          }\n        }, {\n          \"$expr\": {\n            \"$gte\": [\n              \"$processDate\", {\n                \"$dateFromParts\": {\n                  \"year\": 2022, \n                  \"month\": 1, \n                  \"day\": 31\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_Financialstatement\", \n      \"let\": {\n        \"processDate\": \"$processDate\", \n        \"name\": \"VENEZUELA [BU]\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$name\", \"$$name\"\n                  ]\n                }\n              }, {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fechaProceso\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }, {\n          \"$project\": {\n            \"netResult2\": 1\n          }\n        }\n      ], \n      \"as\": \"sidis_Financialstatement\"\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"Balancemetric\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$and\": [\n              {\n                \"$expr\": {\n                  \"$eq\": [\n                    \"$fecha_valor\", \"$$processDate\"\n                  ]\n                }\n              }\n            ]\n          }\n        }\n      ], \n      \"as\": \"Balancemetric\"\n    }\n  }, {\n    \"$sort\": {\n      \"processDate\": 1\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_brm\", \n      \"let\": {\n        \"processDate\": \"$processDate\"\n      }, \n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$eq\": [\n                \"$$processDate\", \"$fecha_odate\"\n              ]\n            }, \n            \"nucta\": {\n              \"$in\": [\n                \"511\", \"512\", \"513\", \"514\", \"519\", \"52\", \"531\", \"532\", \"534\", \"536\", \"538\", \"539\", \"54\", \"441\", \"442\", \"443\", \"444\", \"445\", \"446\", \"447\", \"448\", \"449\", \"411\", \"413\", \"414\", \"415\", \"431\", \"434\", \"439\", \"42\", \"45\", \"47\"\n              ]\n            }\n          }\n        }, {\n          \"$project\": {\n            \"sal_net_act\": {\n              \"$round\": [\n                {\n                  \"$multiply\": [\n                    \"$sal_net_act\", -1\n                  ]\n                }, 0\n              ]\n            }\n          }\n        }\n      ], \n      \"as\": \"sidis_brm\"\n    }\n  }, {\n    \"$addFields\": {\n      \"valFinCapTot\": {\n        \"$sum\": [\n          {\n            \"$first\": \"$sidis_Financialstatement.netResult2\"\n          }\n        ]\n      }, \n      \"valBalCapTot\": {\n        \"$round\": [\n          {\n            \"$sum\": [\n              \"$Balancemetric.netResultBs.total.monthAcc\"\n            ]\n          }, 0\n        ]\n      }, \n      \"valBrmCapTot\": {\n        \"$sum\": [\n          \"$sidis_brm.sal_net_act\"\n        ]\n      }, \n      \"listYears\": \"$$REMOVE\", \n      \"listMonths\": \"$$REMOVE\", \n      \"sidis_Financialstatement\": \"$$REMOVE\", \n      \"sidis_brm\": \"$$REMOVE\"\n    }\n  }, {\n    \"$match\": {\n      \"$expr\": {\n        \"$eq\": [\n          {\n            \"$cond\": [\n              {\n                \"$cond\": [\n                  {\n                    \"$gt\": [\n                      {\n                        \"$abs\": {\n                          \"$subtract\": [\n                            \"$valFinCapTot\", \"$valBalCapTot\"\n                          ]\n                        }\n                      }, 1\n                    ]\n                  }, {\n                    \"$cond\": [\n                      {\n                        \"$eq\": [\n                          \"$valFinCapTot\", 0\n                        ]\n                      }, true, false\n                    ]\n                  }, true\n                ]\n              }, true, {\n                \"$eq\": [\n                  \"$valFinCapTot\", \"$valBalCapTot\"\n                ]\n              }\n            ]\n          }, false\n        ]\n      }\n    }\n  }, {\n    \"$lookup\": {\n      \"from\": \"sidis_tasaconversion\", \n      \"localField\": \"processDate\", \n      \"foreignField\": \"Fecha\", \n      \"as\": \"sidis_tasaconversion\"\n    }\n  }, {\n    \"$addFields\": {\n      \"todayDate\": \"$$REMOVE\", \n      \"currentProcessDate\": \"$$REMOVE\", \n      \"processDate\": \"$$REMOVE\", \n      \"valFinCapTot\": \"$$REMOVE\", \n      \"valBalCapTot\": \"$$REMOVE\", \n      \"valBrmCapTot\": \"$$REMOVE\", \n      \"sidis_tasaconversion\": \"$$REMOVE\", \n      \"Balancemetric.netResult.total.monthAcc\": {\n        \"$round\": [\n          {\n            \"$divide\": [\n              \"$valFinCapTot\", {\n                \"$first\": \"$sidis_tasaconversion.Tasa_DOL\"\n              }\n            ]\n          }, 4\n        ]\n      }, \n      \"Balancemetric.netResultBs.total.monthAcc\": {\n        \"$round\": [\n          \"$valFinCapTot\", 4\n        ]\n      }\n    }\n  }, {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"$first\": \"$Balancemetric\"\n      }\n    }\n  }\n]"
        },
        "id": "2a02af59-8308-44af-b891-974c787be3aa",
        "name": "NetResult",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          1500,
          11420
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "2",
            "name": "MongoDB account"
          }
        }
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "db7c26c6-d092-435c-b2d5-4fde68e42c0d",
        "name": "Merge48",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1680,
          10640
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "d3ce6494-dfef-4940-98a3-606f9db4b5df",
        "name": "Merge49",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1680,
          10960
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "0a94e7b6-8836-4f08-87f1-3fce809dc0f8",
        "name": "Merge50",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1700,
          11320
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "f92c9cb6-92c0-40f0-b019-ed7b9ef9ae24",
        "name": "Merge51",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1840,
          10800
        ]
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "input2"
        },
        "id": "1b22ab83-d9d7-4664-951b-957b0583cfba",
        "name": "Merge52",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          2020,
          11060
        ]
      }
    ],
    "connections": {
      "1_FormateoObjetivos": {
        "main": [
          [
            {
              "node": "1_marcadoProcesamiento",
              "type": "main",
              "index": 0
            },
            {
              "node": "FunctionItem16",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge12": {
        "main": [
          [
            {
              "node": "2_IndicadoresConbranzaMora_Balancemetric",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge25",
              "type": "main",
              "index": 1
            },
            {
              "node": "Merge28",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem4": {
        "main": [
          [
            {
              "node": "IF1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge25": {
        "main": [
          [
            {
              "node": "5_sustemFinancPcrt_Balancemetric",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge27": {
        "main": [
          [
            {
              "node": "Merge38",
              "type": "main",
              "index": 1
            },
            {
              "node": "2_updated_OP1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge1": {
        "main": [
          [
            {
              "node": "2_updated_OP2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge39",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge2": {
        "main": [
          [
            {
              "node": "2_Indicadores_Balancemetric",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge1",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "FunctionItem2",
              "type": "main",
              "index": 0
            },
            {
              "node": "1_FormateoObjetivos",
              "type": "main",
              "index": 0
            },
            {
              "node": "Crea la operacion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook5": {
        "main": [
          [
            {
              "node": "FunctionItem8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook6": {
        "main": [
          [
            {
              "node": "CaptacionesConv20VersionFinalBs",
              "type": "main",
              "index": 0
            },
            {
              "node": "CaptacionesConv20VersionFinalUsd",
              "type": "main",
              "index": 0
            },
            {
              "node": "CaptacionesLibreConvVersionFinalBs1",
              "type": "main",
              "index": 0
            },
            {
              "node": "CaptacionesLibreConvVersionFinalUsd1",
              "type": "main",
              "index": 0
            },
            {
              "node": "NoOp",
              "type": "main",
              "index": 0
            },
            {
              "node": "CaptacionesTotalesVersionFinalBs1",
              "type": "main",
              "index": 0
            },
            {
              "node": "CaptacionesTotalesVersionFinalUsd",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge3": {
        "main": [
          [
            {
              "node": "Merge7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge5": {
        "main": [
          [
            {
              "node": "Merge6",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge7": {
        "main": [
          [
            {
              "node": "CaptacionesConDivisaVersionFinalBs",
              "type": "main",
              "index": 0
            },
            {
              "node": "CaptacionesSinConv20VersionFinalBs",
              "type": "main",
              "index": 0
            },
            {
              "node": "CaptacionesSinDivisaVersionFinalBs",
              "type": "main",
              "index": 0
            },
            {
              "node": "CaptacionesSinLibreConvVersionFinalBs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NoOp3": {
        "main": [
          [
            {
              "node": "Merge11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesConv20VersionFinalBs": {
        "main": [
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesConv20VersionFinalUsd": {
        "main": [
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "CaptacionesTotalesVersionFinalUsd": {
        "main": [
          [
            {
              "node": "Merge5",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "CaptacionesTotalesVersionFinalBs1": {
        "main": [
          [
            {
              "node": "Merge5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesConDivisaVersionFinalBs": {
        "main": [
          [
            {
              "node": "CaptacionesConDivisaVersionFinalUsd",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesConDivisaVersionFinalUsd": {
        "main": [
          [
            {
              "node": "NoOp3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesLibreConvVersionFinalBs1": {
        "main": [
          [
            {
              "node": "Merge4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesLibreConvVersionFinalUsd1": {
        "main": [
          [
            {
              "node": "Merge4",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "CaptacionesSinConv20VersionFinalUsd": {
        "main": [
          [
            {
              "node": "NoOp3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesSinDivisaVersionFinalBs": {
        "main": [
          [
            {
              "node": "CaptacionesSinDivisaVersionFinalUsd",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesSinDivisaVersionFinalUsd": {
        "main": [
          [
            {
              "node": "NoOp3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesSinLibreConvVersionFinalBs": {
        "main": [
          [
            {
              "node": "CaptacionesSinLibreConvVersionFinalUsd",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesSinLibreConvVersionFinalUsd": {
        "main": [
          [
            {
              "node": "NoOp3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1_marcadoProcesamiento": {
        "main": [
          [
            {
              "node": "2_procesadosDias",
              "type": "main",
              "index": 0
            },
            {
              "node": "3_FormateoBrmAjustado_SidisBrmAjustado",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_procesadosDias": {
        "main": [
          [
            {
              "node": "FunctionItem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "3_FormateoBrmAjustado_SidisBrmAjustado": {
        "main": [
          [
            {
              "node": "4_marcadoProcesados",
              "type": "main",
              "index": 0
            },
            {
              "node": "FunctionItem17",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "4_marcadoProcesados": {
        "main": [
          [
            {
              "node": "5_AjusteBrm_SidisBRMx",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge8": {
        "main": [
          [
            {
              "node": "Item Lists",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem": {
        "main": [
          [
            {
              "node": "Merge9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook1": {
        "main": [
          [
            {
              "node": "FunctionItem4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesProducto": {
        "main": [
          [
            {
              "node": "Merge30",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CaptacionesSinConv20VersionFinalBs": {
        "main": [
          [
            {
              "node": "CaptacionesSinConv20VersionFinalUsd",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge4": {
        "main": [
          [
            {
              "node": "Merge6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge6": {
        "main": [
          [
            {
              "node": "Merge7",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "1_activosliqUvcToLiquidacionesmetricUVC": {
        "main": [
          [
            {
              "node": "Merge23",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge23": {
        "main": [
          [
            {
              "node": "Merge24",
              "type": "main",
              "index": 1
            },
            {
              "node": "2_activosliqbsToLiquidacionesmetricBS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_activosliqbsToLiquidacionesmetricBS": {
        "main": [
          [
            {
              "node": "Merge24",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NoOp4": {
        "main": [
          [
            {
              "node": "Merge23",
              "type": "main",
              "index": 1
            },
            {
              "node": "1_activosliqUvcToLiquidacionesmetricUVC",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge24": {
        "main": [
          [
            {
              "node": "Merge37",
              "type": "main",
              "index": 1
            },
            {
              "node": "4_IndicadoresDiariosBalancemetric1",
              "type": "main",
              "index": 0
            },
            {
              "node": "5_IndicadoresMensualBalancemetric1",
              "type": "main",
              "index": 0
            },
            {
              "node": "6_IndicadoresAnualBalancemetric1",
              "type": "main",
              "index": 0
            },
            {
              "node": "9_Indicadores131",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge33": {
        "main": [
          [
            {
              "node": "8_indicadoresMesAnoAnteriorBalancemetric",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge34",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge34": {
        "main": [
          [
            {
              "node": "2_updated_OP",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge36",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "8_indicadoresMesAnoAnteriorBalancemetric": {
        "main": [
          [
            {
              "node": "Merge34",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook2": {
        "main": [
          [
            {
              "node": "FunctionItem15",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AjustaVentanaFinSemana": {
        "main": [
          [
            {
              "node": "Merge10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem2": {
        "main": [
          [
            {
              "node": "Merge8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge9": {
        "main": [
          [
            {
              "node": "Merge8",
              "type": "main",
              "index": 1
            },
            {
              "node": "FunctionItem18",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Item Lists": {
        "main": [
          [
            {
              "node": "Item Lists1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Item Lists1": {
        "main": [
          [
            {
              "node": "HTTP Request1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge10",
              "type": "main",
              "index": 1
            },
            {
              "node": "HTTP Request2",
              "type": "main",
              "index": 0
            },
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            },
            {
              "node": "AjustaVentanaFinSemana",
              "type": "main",
              "index": 0
            },
            {
              "node": "HTTP Request6",
              "type": "main",
              "index": 0
            },
            {
              "node": "HTTP Request4",
              "type": "main",
              "index": 0
            },
            {
              "node": "HTTP Request11",
              "type": "main",
              "index": 0
            },
            {
              "node": "HTTP Request20",
              "type": "main",
              "index": 0
            },
            {
              "node": "HTTP Request26",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge10": {
        "main": [
          [
            {
              "node": "Item Lists2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Item Lists2": {
        "main": [
          [
            {
              "node": "Item Lists3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Item Lists3": {
        "main": [
          [
            {
              "node": "AjustaVentanaFinSemana1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "5_AjusteBrm_SidisBRMx": {
        "main": [
          [
            {
              "node": "Merge9",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "AjustaVentanaFinSemana1": {
        "main": [
          [
            {
              "node": "HTTP Request16",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge11": {
        "main": [
          [
            {
              "node": "HTTP Request10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge29": {
        "main": [
          [
            {
              "node": "Merge37",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "4_IndicadoresDiariosBalancemetric1": {
        "main": [
          [
            {
              "node": "Merge35",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "5_IndicadoresMensualBalancemetric1": {
        "main": [
          [
            {
              "node": "Merge46",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "6_IndicadoresAnualBalancemetric1": {
        "main": [
          [
            {
              "node": "Merge46",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge35": {
        "main": [
          [
            {
              "node": "Merge29",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge37": {
        "main": [
          [
            {
              "node": "7_CrecimientoAnualLiquidacionBalancemetric",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge33",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "FunctionItem8": {
        "main": [
          [
            {
              "node": "IF2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF1": {
        "main": [
          [
            {
              "node": "1_DailyGroup_IngresosCarteraCredito",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge2",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "IF2": {
        "main": [
          [
            {
              "node": "01_IngresosPorComisionDiario_ingresosComisionMetric",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge14",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge14": {
        "main": [
          [
            {
              "node": "02_IngresosPorComisionIndicadores_Balancemetric",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge15",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "01_IngresosPorComisionDiario_ingresosComisionMetric": {
        "main": [
          [
            {
              "node": "Merge14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "02_IngresosPorComisionIndicadores_Balancemetric": {
        "main": [
          [
            {
              "node": "Merge15",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge15": {
        "main": [
          [
            {
              "node": "2_updated_OP4",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge41",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Webhook7": {
        "main": [
          [
            {
              "node": "FunctionItem9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "7_CrecimientoAnualLiquidacionBalancemetric": {
        "main": [
          [
            {
              "node": "Merge33",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem9": {
        "main": [
          [
            {
              "node": "IF4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF4": {
        "main": [
          [
            {
              "node": "Merge17",
              "type": "main",
              "index": 1
            },
            {
              "node": "1_agrupacionDiaSidisBrm_carteraCreditometric",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge17": {
        "main": [
          [
            {
              "node": "Merge18",
              "type": "main",
              "index": 1
            },
            {
              "node": "2_CalculoIndicadoresCarteraCreditoMetric_Balancemetric",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge18": {
        "main": [
          [
            {
              "node": "Merge19",
              "type": "main",
              "index": 1
            },
            {
              "node": "3_IndicarorMensualCarteraCreditoMetric_Balancemetric",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge19": {
        "main": [
          [
            {
              "node": "2_updated_OP3",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge40",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "3_IndicarorMensualCarteraCreditoMetric_Balancemetric": {
        "main": [
          [
            {
              "node": "Merge19",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_CalculoIndicadoresCarteraCreditoMetric_Balancemetric": {
        "main": [
          [
            {
              "node": "Merge18",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1_agrupacionDiaSidisBrm_carteraCreditometric": {
        "main": [
          [
            {
              "node": "Merge17",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem7": {
        "main": [
          [
            {
              "node": "IF3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF3": {
        "main": [
          [
            {
              "node": "1_agrupacionDiaSidisIaToCobranzamorametric",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge12",
              "type": "main",
              "index": 1
            },
            {
              "node": "3_CastigoFormateo",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1_agrupacionDiaSidisIaToCobranzamorametric": {
        "main": [
          [
            {
              "node": "Merge12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_IndicadoresConbranzaMora_Balancemetric": {
        "main": [
          [
            {
              "node": "Merge25",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge28": {
        "main": [
          [
            {
              "node": "4_CastigoBalancemetric",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "3_CastigoFormateo": {
        "main": [
          [
            {
              "node": "Merge28",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "4_CastigoBalancemetric": {
        "main": [
          [
            {
              "node": "Merge27",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Webhook4": {
        "main": [
          [
            {
              "node": "FunctionItem7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NoOp": {
        "main": [
          [
            {
              "node": "FunctionItem13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook8": {
        "main": [
          [
            {
              "node": "FunctionItem11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem11": {
        "main": [
          [
            {
              "node": "IF6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF6": {
        "main": [
          [
            {
              "node": "CaptacionesProducto",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge30",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "FunctionItem13": {
        "main": [
          [
            {
              "node": "Merge11",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge36": {
        "main": [
          [
            {
              "node": "HTTP Request14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_updated_OP": {
        "main": [
          [
            {
              "node": "Merge36",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF5": {
        "main": [
          [
            {
              "node": "NoOp4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem15": {
        "main": [
          [
            {
              "node": "IF5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge38": {
        "main": [
          [
            {
              "node": "HTTP Request15",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_updated_OP1": {
        "main": [
          [
            {
              "node": "Merge38",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge39": {
        "main": [
          [
            {
              "node": "HTTP Request13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_updated_OP2": {
        "main": [
          [
            {
              "node": "Merge39",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge40": {
        "main": [
          [
            {
              "node": "HTTP Request19",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_updated_OP3": {
        "main": [
          [
            {
              "node": "Merge40",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge42": {
        "main": [
          [
            {
              "node": "HTTP Request21",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_updated_OP5": {
        "main": [
          [
            {
              "node": "Merge42",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge41": {
        "main": [
          [
            {
              "node": "HTTP Request17",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_updated_OP4": {
        "main": [
          [
            {
              "node": "Merge41",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem16": {
        "main": [
          [
            {
              "node": "2_updated_OP7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem17": {
        "main": [
          [
            {
              "node": "2_updated_OP8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem18": {
        "main": [
          [
            {
              "node": "2_updated_OP9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Merge27",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "5_sustemFinancPcrt_Balancemetric": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_Indicadores_Balancemetric": {
        "main": [
          [
            {
              "node": "Merge1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem10": {
        "main": [
          [
            {
              "node": "IF",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF": {
        "main": [
          [
            {
              "node": "01_DailyGroup_IngresosComisionesOtros",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge16",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge16": {
        "main": [
          [
            {
              "node": "Merge20",
              "type": "main",
              "index": 1
            },
            {
              "node": "02_IngresosOtrosOperativosIndicadores",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge20": {
        "main": [
          [
            {
              "node": "2_updated_OP10",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge43",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge43": {
        "main": [
          [
            {
              "node": "HTTP Request18",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_updated_OP10": {
        "main": [
          [
            {
              "node": "Merge43",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "01_DailyGroup_IngresosComisionesOtros": {
        "main": [
          [
            {
              "node": "Merge16",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "02_IngresosOtrosOperativosIndicadores": {
        "main": [
          [
            {
              "node": "Merge20",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem12": {
        "main": [
          [
            {
              "node": "IF7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF7": {
        "main": [
          [
            {
              "node": "1_DailyGroup_NetResult",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge22",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge22": {
        "main": [
          [
            {
              "node": "Merge26",
              "type": "main",
              "index": 1
            },
            {
              "node": "02_netResult_IndicadoresBalancemetric",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge26": {
        "main": [
          [
            {
              "node": "2_updated_OP11",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge44",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge44": {
        "main": [
          [
            {
              "node": "HTTP Request22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2_updated_OP11": {
        "main": [
          [
            {
              "node": "Merge44",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1_DailyGroup_NetResult": {
        "main": [
          [
            {
              "node": "Merge22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "02_netResult_IndicadoresBalancemetric": {
        "main": [
          [
            {
              "node": "Merge26",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FunctionItem14": {
        "main": [
          [
            {
              "node": "IF8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF8": {
        "main": [
          [
            {
              "node": "test",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge45",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge45": {
        "main": [
          [
            {
              "node": "HTTP Request25",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "test": {
        "main": [
          [
            {
              "node": "Merge45",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook9": {
        "main": [
          [
            {
              "node": "FunctionItem14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1_DailyGroup_IngresosCarteraCredito": {
        "main": [
          [
            {
              "node": "Merge2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook3": {
        "main": [
          [
            {
              "node": "FunctionItem10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook10": {
        "main": [
          [
            {
              "node": "FunctionItem12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge46": {
        "main": [
          [
            {
              "node": "Merge29",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "9_Indicadores131": {
        "main": [
          [
            {
              "node": "Merge35",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge30": {
        "main": [
          [
            {
              "node": "2_updated_OP5",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge42",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "FunctionItem19": {
        "main": [
          [
            {
              "node": "IF9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF9": {
        "main": [
          [
            {
              "node": "Captaciones",
              "type": "main",
              "index": 0
            },
            {
              "node": "CarteraCredito",
              "type": "main",
              "index": 0
            },
            {
              "node": "Liquidaciones",
              "type": "main",
              "index": 0
            },
            {
              "node": "IngresosCartera",
              "type": "main",
              "index": 0
            },
            {
              "node": "IngresosOtrosOperativos",
              "type": "main",
              "index": 0
            },
            {
              "node": "NetResult",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge47",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge47": {
        "main": [
          [
            {
              "node": "HTTP Request27",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Captaciones": {
        "main": [
          [
            {
              "node": "Merge48",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CarteraCredito": {
        "main": [
          [
            {
              "node": "Merge48",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Liquidaciones": {
        "main": [
          [
            {
              "node": "Merge49",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook11": {
        "main": [
          [
            {
              "node": "FunctionItem19",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IngresosCartera": {
        "main": [
          [
            {
              "node": "Merge49",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "IngresosOtrosOperativos": {
        "main": [
          [
            {
              "node": "Merge50",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NetResult": {
        "main": [
          [
            {
              "node": "Merge50",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge48": {
        "main": [
          [
            {
              "node": "Merge51",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge49": {
        "main": [
          [
            {
              "node": "Merge51",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge50": {
        "main": [
          [
            {
              "node": "Merge52",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge51": {
        "main": [
          [
            {
              "node": "Merge52",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge52": {
        "main": [
          [
            {
              "node": "Merge47",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  }