[{"$match":{"$expr":{"$eq":["$mcl_fecha_proceso",{"$toDate":"@fechaProceso"}]},"mcl_naturaleza_producto":{"$in":[1,"1"]},"mcl_estatus":"A","mcl_banca":{"$nin":["0",0,"4",4,"5",5,"1",1]}}},{"$group":{"_id":{"fechaProceso":"$mcl_fecha_proceso"},"rifCedulaList":{"$addToSet":"$mcl_rif_cedula"}}},{"$addFields":{"countDistinctRif":{"$size":"$rifCedulaList"},"fechaProceso":"$_id.fechaProceso"}},{"$addFields":{"processDate":"$fechaProceso","kpi":[{"name":"Tasa","baseCollectionCount":"$countDistinctRif","baseCollection":"sidis_transaccionesOperativas","toCollection":"sidis_ingresoCarteraCredito"}],"processName":"Ingresoporcarteradecredito","recipeCode":"T01","_id":"$$REMOVE","countDistinctRif":"$$REMOVE","fechaProceso":"$$REMOVE","rifCedulaList":"$$REMOVE"}},{"$lookup":{"from":"sidis_consistencyData","let":{"fechaProcesoLookup":"$fechaProceso","codeLookup":"$code"},"pipeline":[{"$match":{"$expr":{"$and":[{"$eq":["$fechaProceso","$$fechaProcesoLookup"]},{"$eq":["$code","$$codeLookup"]}]}}},{"$project":{"kpi":1}}],"as":"resultados"}},{"$unwind":{"path":"$resultados"}},{"$addFields":{"resultados":{"$concatArrays":["$resultados.kpi","$kpi"]}}},{"$project":{"processDate":1,"recipeCode":1,"updatedAt":"$$NOW","kpi":"$resultados","_id":0}},{"$merge":{"into":"sidis_consistencyData","on":["processDate","recipeCode"]}}]