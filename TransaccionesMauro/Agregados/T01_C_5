[{"$match":{"$expr":{"$eq":["$fechaProceso",{"$toDate":"@fechaProceso"}]},"tra_cod_op":7865,"tra_cuenta_contable":"276031000051135"}},{"$group":{"_id":{"fechaProceso":"$fechaProceso"},"rifCedulaList":{"$addToSet":"$tra_rif"}}},{"$addFields":{"countDistinctRif":{"$size":"$rifCedulaList"},"fechaProceso":"$_id.fechaProceso"}},{"$addFields":{"processDate":"$fechaProceso","kpi":[{"name":"GastosFlat+Otros","baseCollectionCount":"$countDistinctRif","baseCollection":"sidis_transaccionesOperativas","toCollection":"sidis_ingresoCarteraCredito"}],"processName":"Ingresoporcarteradecredito","recipeCode":"T01","_id":"$$REMOVE","countDistinctRif":"$$REMOVE","fechaProceso":"$$REMOVE","rifCedulaList":"$$REMOVE"}},{"$lookup":{"from":"sidis_consistencyData","let":{"fechaProcesoLookup":"$fechaProceso","codeLookup":"$code"},"pipeline":[{"$match":{"$expr":{"$and":[{"$eq":["$fechaProceso","$$fechaProcesoLookup"]},{"$eq":["$code","$$codeLookup"]}]}}},{"$project":{"kpi":1}}],"as":"resultados"}},{"$unwind":{"path":"$resultados"}},{"$addFields":{"found":{"$filter":{"input":"$resultados.kpi","as":"arregloSecundario","cond":{"$eq":["GastosFlat+Otros","$$arregloSecundario.name"]}}}}},{"$addFields":{"resultados":{"$concatArrays":["$resultados.kpi","$kpi"]}}},{"$project":{"processDate":1,"recipeCode":1,"updatedAt":"$$NOW","kpi":"$resultados","_id":0}},{"$merge":{"into":"sidis_consistencyData","on":["processDate","recipeCode"]}}]