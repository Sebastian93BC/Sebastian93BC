[{"$match":{"$expr":{"$eq":["$fechaProceso",{"$toDate":"@fechaProceso"}]}}},{"$group":{"_id":{"cta_contable":"$cta_contable","rifCedula":"$rifCedula","fechaProceso":"$fechaProceso"},"montos":{"$push":{"valor":"$capindif"}}}},{"$unwind":{"path":"$montos"}},{"$group":{"_id":{"rifCedula":"$_id.rifCedula","fechaProceso":"$_id.fechaProceso"},"variacionIDIBolivares":{"$sum":{"$toDouble":"$montos.valor"}}}},{"$lookup":{"from":"sidis_tasaconversion","localField":"_id.fechaProceso","foreignField":"Fecha","as":"result"}},{"$project":{"rifCedula":"$_id.rifCedula","fechaProceso":"$_id.fechaProceso","variacionIDIBolivares":{"$round":["$variacionIDIBolivares",4]},"variacionIDIDolares":{"$round":[{"$divide":["$variacionIDIBolivares",{"$arrayElemAt":["$result.Tasa_DOL",0]}]},4]},"variacionIDIEuros":{"$round":[{"$divide":["$variacionIDIBolivares",{"$arrayElemAt":["$result.Tasa_EUR",0]}]},4]},"_id":0}},{"$merge":{"into":"sidis_ingresoCarteraCredito","on":["fechaProceso","rifCedula"]}}]