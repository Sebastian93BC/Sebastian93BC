[{"$match":{"$expr":{"$gt":["$fecha_valor",{"$toDate":"@fechaProceso"}]}}},{"$addFields":{"fechaProceso":{"$dateFromParts":{"year":{"$year":"$fecha_formalizacion"},"month":{"$add":[{"$month":"$fecha_formalizacion"},1]},"day":{"$subtract":[{"$dayOfMonth":{"$dateFromParts":{"year":{"$year":"$fecha_formalizacion"},"month":{"$add":[{"$month":"$fecha_formalizacion"},1]},"day":1}}},1]},"hour":0,"minute":0,"second":0,"millisecond":0}},"rifCedula":{"$trim":{"input":{"$substr":["$cedula_identidad",1,{"$strLenCP":"$cedula_identidad"}]},"chars":""}},"primeraLetraRif":{"$substr":["$cedula_identidad",0,1]}}},{"$addFields":{"rifCedula":{"$ltrim":{"input":"$rifCedula","chars":"0"}}}},{"$addFields":{"longitudIdentificacionSinCero":{"$strLenCP":"$rifCedula"}}},{"$addFields":{"rifCedula":{"$switch":{"branches":[{"case":{"$gte":["$longitudIdentificacionSinCero",8]},"then":"$rifCedula"},{"case":{"$eq":["$longitudIdentificacionSinCero",7]},"then":{"$concat":["0","$rifCedula"]}},{"case":{"$eq":["$longitudIdentificacionSinCero",6]},"then":{"$concat":["00","$rifCedula"]}}],"default":{"$concat":["000","$rifCedula"]}}}}},{"$addFields":{"rifCedula":{"$concat":["$primeraLetraRif","$rifCedula"]}}},{"$project":{"primeraLetraRif":0,"longitudIdentificacionSinCero":0,"ced_identidad":0,"_id":0}},{"$merge":{"into":"sidis_activos_liq_bs","on":["fecha_valor","cuenta_credito"]}}]